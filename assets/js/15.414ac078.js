(window.webpackJsonp=window.webpackJsonp||[]).push([[15],{1643:function(t,a,s){t.exports=s.p+"assets/img/76.86a2c281.png"},1644:function(t,a,s){t.exports=s.p+"assets/img/77.35caec7d.png"},1645:function(t,a,s){t.exports=s.p+"assets/img/78.22599856.png"},1646:function(t,a,s){t.exports=s.p+"assets/img/79.d4d34114.png"},1647:function(t,a,s){t.exports=s.p+"assets/img/80.ce8a0c66.png"},1648:function(t,a,s){t.exports=s.p+"assets/img/81.8ec1f0a8.png"},1649:function(t,a,s){t.exports=s.p+"assets/img/82.aa797165.png"},1650:function(t,a,s){t.exports=s.p+"assets/img/84.5cdce1ef.png"},1651:function(t,a,s){t.exports=s.p+"assets/img/85.11ae41b2.png"},1652:function(t,a,s){t.exports=s.p+"assets/img/87.31636ad4.png"},1653:function(t,a,s){t.exports=s.p+"assets/img/88.16d6285f.png"},1654:function(t,a,s){t.exports=s.p+"assets/img/89.50229661.png"},1655:function(t,a,s){t.exports=s.p+"assets/img/90.4c856c38.png"},1656:function(t,a,s){t.exports=s.p+"assets/img/91.9a8fd48c.png"},1657:function(t,a,s){t.exports=s.p+"assets/img/92.a02444e4.png"},1658:function(t,a,s){t.exports=s.p+"assets/img/93.41b1b4ab.png"},1659:function(t,a,s){t.exports=s.p+"assets/img/94.24032801.png"},1660:function(t,a,s){t.exports=s.p+"assets/img/95.0085e48b.png"},1661:function(t,a,s){t.exports=s.p+"assets/img/96.0ab5af97.png"},1662:function(t,a,s){t.exports=s.p+"assets/img/97.21b32281.png"},1663:function(t,a,s){t.exports=s.p+"assets/img/98.52629107.png"},1664:function(t,a,s){t.exports=s.p+"assets/img/99.cb17e4e7.png"},1665:function(t,a,s){t.exports=s.p+"assets/img/100.fb23b229.png"},1666:function(t,a,s){t.exports=s.p+"assets/img/101.3919450a.png"},1667:function(t,a,s){t.exports=s.p+"assets/img/102.7b5f0098.png"},1668:function(t,a,s){t.exports=s.p+"assets/img/103.c872f853.png"},1669:function(t,a){t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAABBoAAAFzCAYAAACQH2pqAAAgAElEQVR4nO3dX2yd9X0/8M9J7Dh2GxNocUaqYcdOIS0QnEISsBPKVG1QNb9NG5s0taI33TRVVcPExrTtIhetpmlCYlJ2FQm0m3Cxn1ptrTZNGvsTOtvDWRYHMjHaOE3cEViISCGlZnFSzu+C37FOjp/z19/jc479eklH9vPv+3xOjPDzvP15vieXz+fzAQAAANCAs2fPxsjIyOJyLp/P56/8n8fi+qlXWlgWAAAA0Km6H9wbm/7v0Yj4/0HD5Z//ZItLAgAAADrZLf99JiIiurJWAgAAANSitHlhXYvqAAAAAFYhQQMAAACQjKABAAAASEbQAAAAACQjaAAAAACSETQAAAAAyQgaAAAAgGQEDQAAAEAyggYAAAAgGUEDAAAAkIygAQAAAEhG0AAAAAAkI2gAAAAAkhE0AAAAAMkIGgAAAIBkBA0AAABAMoIGAAAAIBlBAwAAAJCMoAEAAABIRtAAAAAAJCNoAAAAAJIRNAAAAADJCBoAAACAZAQNAAAAQDKCBgAAACAZQQMAAACQjKABAAAASEbQAAAAACQjaAAAAACSETQAAAAAyQgaAAAAgGQEDQAAAEAyggYAAAAgGUEDAAAAkIygAQAAAEhG0AAAAAAkI2gAAAAAkhE0AAAAAMkIGgAAAIBkBA0AAABAMoIGAAAAIBlBAwAAAJCMoAEAAABIRtAAAAAAJCNoAAAAAJIRNAAAAADJCBoAAACAZAQNAAAAQDJdrS4AAIDyDh8+HLOzs60uA+hQ27dvj4MHD7a6DNYYQQMAQBubnZ2NZ555ptVlAB3qySefbHUJrEGCBgCANpfP51tdAtDB3n777ejr64ve3t5Wl8IaYY4GAACAVSyfzwssWVGCBgAAACAZQQMAAACQjKABAAAASMZkkAAAbc6z1QB0Eh0NAAAAQDKCBgAAACAZQQMAAACQjKABAAAASMZkkAAAbc5kkAB0Eh0NAAAAQDKCBgAAACAZQQMAAACQjDkaAADanDkaAOgkOhoAAACAZAQNAAAAQDKCBgAAACAZQQMAAACQjMkgAQDanMkgO9vY2FhMTU0lO67R8Ro5F0AjBA0AANBEU1NTizfyY2NjFfcrd1xBpUCgdOxy5ys9vrBPLfsC1ELQAAAATVa4Yc+6yS/XtZD1ffFy1nGFdcXHlAYVWeevJ9AAqEbQAAAAbajSjX+lzohGzlHa/SBkAJZD0AAA0AauXLkSR44ciUceeSR27tzZ6nJIZDk37+U6Geo5pnR9pe6JrCBD4AA0QtAAANAG+vv74+LFi/H888/HCy+8EI8//ngMDAxEhMkgO9nk5GRERIyPj5f9OZZbXzi2cHzpctZxWefL5/OL64uPGR8fv+GYsbGxxe+L15XWAlCNoAEAoE3s2LEjTp8+HXNzc/H000/H6Ohoq0uihQpBQLnlRscpDRMqETAAjRA0AABUcPjw4ZidnV2x83V1dcX169fj6tWrceLEiRU7L+2l9Aa/tKOhnKwwYnJycvH4auFFuVACoB6CBgCACmZnZ+Pw4cMrcq5nn302Tp8+HRERPT09MTo6GtPT0ytyblZGLYFBuc6FciFC1nKt3Q/F+2eFGwCNEDQAALSJ1157LTZu3BgDAwOLczRMT0+bo2GVGB8fj4mJiSU/z9LliYmJJcfu27cvc32lsYrnaJiYmCh7/nJjlVsHUI2gAQCgDVy5ciW2bNniUydWsaygYKUUgoqswKJciAHQKEEDAEAb6O/vj6eeeqrVZdAkWTf3KRWHBaVjVwoSygUPEa0NRoDOJmgAAIAVVu9NfLX9i7eX+76W5UZqAyi1rtUFAAAAAKuHjgYAgDZnQj4AOomOBgAAACAZQQMAAACQjKABAAAASEbQAAAAACRjMkgAgDZnMkgAOomOBgAAACAZQQMAAACQjKABAAAASMYcDQAAbc4cDQB0Eh0NAAAAQDKCBgAAACAZQQMAAACQjKABAAAASMZkkAAAbc5kkAB0Eh0NAAAAQDKCBgAAACAZQQMAAACQjKABAAAASMZkkAAAbc5kkAB0Eh0NAAAAQDI6GgAA2tjIyEgcOnSo1WUAHWpwcLDVJbAGCRoAANrYE088ERER8/PzMT8/3+JqAKA6QQMAQAfo7e2NjRs3troMoEPlcrlWl8AaImgAAOgAuVzOjQIAHcFkkAAAAEAyggYAAAAgGUEDAAAAkIygAQAAAEhG0AAAAAAkI2gAAAAAkhE0AAAAAMkIGgCAmuzatavVJdSkU+oEgNVK0AAAVLVr166YmZlJPmbqUKAZdQIA9RE0AAAtsZKBQKVAQwcEAKQlaAAAKuqULoGsOktDhOLlStsAgMZ1tboAAKAzFd+YF9/gF9bPzMzc8H3WcanGLKd4/9IgotI2AKBxggYAoKxyN+Cl64uXCzfw5ToMyoUOjY5ZqU4AYOV5dAIAaIpGbvwLYUK5rod6x8wKK2rZBgA0TkcDANA2UncllI5X+uhEM88NAGuVjgYAIFOrH0eotcOgljorbRcwAEBaOhoAgLqVPmqQNe9C1qSNWY8oFIKCRscEANqLoAEAWGI5XQLN6C4ot77VXRcAwFIenQAAluiUm/dOqRMA1hJBAwAAAJCMoAEAAABIRtAAAAAAJCNoAAAAAJIRNAAAAADJCBoAAACAZAQNAAAAQDKCBgAAACAZQQMAAACQjKABAAAASEbQAAAAACQjaAAAAACSETQAAAAAyQgaAAAAgGQEDQAAAEAyggYAAAAgGUEDAAAAkIygAQAAAEhG0AAAAAAkI2gAAAAAkhE0AAAAAMkIGgAAAIBkBA0AAABAMl2tLmBubi7m5ubi/PnzERExNDQUg4ODMTg42OLKAAAAgHq1LGh48cUX4+WXX46FhYW4/fbb484774yID4OH48ePx4YNG+Lee++Nz372s60qEQAAAKhTS4KGb33rW3Ht2rX46le/umTbZz7zmRv2+9a3vhW//uu/vpLlAQAAAA1a8Tkajh49GgMDA/HYY49FPp+v+HrsscdiYGAgjh49utJlAgAAAA1Y0Y6G73//+7GwsBB79+6NfD5f0zF79+6NM2fOxGuvvRY7duxocoVwo8OHD8fs7GyrywA61Pbt2+PgwYOtLgNYxVyrAMvRrGuVFQ0aTp48Gffee2/NIUPB6OhoHD9+PO68887I5XJNqg6Wmp2djWeeeabVZQAd6sknn2x1CcAq51oFWI5mXauseEfDZz/72bqDhttuuy2+853vxHvvvRebNm1qUnWQrd7/XgGKvf3229HX1xe9vb2tLgVYpVyrAMvRjGuVFQ0abr755ti8eXPd/zPcvHlzbN68Oa5evRp9fX2xfv36JlUIAGkV5h0CAGhHzbhWWdHJIPP5fJw7d67qJJClrx/+8IeLY1y/fn0lSwYAAADqsKJBw6c+9an4n//5n7qDhjfffDNGRkYiQmsYAAAAtLMVDRoeeeSRmJiYiLfffrvmkOHChQtx4sSJGB8fj4jw2AQAQAvt2rWr1SXUpFPqBFiNVnSOhoiIP/iDP4gjR47Eww8/HMPDwxX3PX78eLzyyivx27/92xHxYcjQ3d29EmXCIl00APChXbt2xczMTM3rW6Xd6mk21ypAu1nRjoaIiN7e3vid3/mdePHFF+Pv//7vY2ZmJt58883I5/Nx6dKl+K//+q+Ynp6OZ555Jl5//fX40pe+tHjsRz/60ZUuFwCAKsrd1LdbV0GletqtVoBO1tSg4fDhw5nre3t744knnojBwcGYnZ2Nb3/72/Hcc8/F0aNH48SJE/HOO+/El770pThw4ECsX78+crlcbNq0aUk3Q7nxAQBIq1O6BLLqLA0RipcrbQOgMU17dOLYsWOxYcOGeO655+IrX/lK5j4PPPBA3H///TE/Px8LCwtLtudyuejp6Ym+vr5Yt+7GTOTP//zP46abbopjx47Fww8/3JT3AABAecU35cU391k38pVu/gvbsm7yq4UGtYQfMzMzi8eVBhGVtgHQmKZ1NBw7dix+7dd+Lbq6umJ6errsfl1dXdHf3x8f+9jH4qabbopNmzbFpk2bYvPmzXHLLbfERz/60SUhw9/8zd/E3XffHQcOHIhjx47F1atXm/U2AADWvHI34DMzM1XXZ+1TGK/wKg0jir+WhhbFx9VaJwArqykdDadPn46tW7fGzTffHF/84hfjD//wD2N0dDR6enrKHpPL5Wqa6PHFF1+Mt99+O77whS9ERMTWrVvjxIkTMTY2FrlcLtl7gAITLAFAeo08olAaStQaKhQCiNKv1bZ1CtcqQLtpSkfDsWPHYv/+/YvL3/zmN+Mb3/jGssd96aWX4s0334wvf/nLi+seeuihmJ6eznz0AgCA9lTcmVDPjX1pF0Stx5RbrrQNgMYkDxouXLgQP/3pT2P79u2L67q7u+PJJ5+M3/3d343333+/oXG/+93vxpkzZ+LixYs3rB8ZGYmrV6/GuXPnllU3AABLpfoLf4pPfCid1yHrsYpKKm0XMACkk/zRiWPHjsVDDz20ZP3Ro0fjz/7sz+Iv/uIvYteuXfG5z32upvG+//3vx8mTJ+OWW26J3/zN34zf+73fi+PHj8eePXsW93n44YdjcnIytm/fHl1dTZvfEgCAItUmfcyaf6F0ffG2coFD6aMOpccB0F6S3pW///778corr8Rv/MZv3PCs2OTkZJw9ezZyuVx8/etfj7/7u7+L3//9349f/uVfjjvuuCO2bNlyw/wKly9fjkuXLsXf/u3fRk9PT3zuc5+LkZGRxTGnp6dj9+7di/vfd9998dd//dfxzjvvxMc//vGUbwkAYM2q1iVQ6yc+1Lo+65GGSo851FonACsradBQOjdDweTk5OL3uVwuDhw4EL/0S78U//zP/xzPPfdcvPXWW3HrrbfG5s2b49y5c7Fp06b41Kc+Fb/yK78St99++5Lx3nvvvbh06VLceuuti+v2798f3/ve9+JXf/VXTQpJUiZYAmCt6pSb906ps1lcqwDtJnnQ8Md//Mc3rDt79mz09fUt2XfDhg3x6KOPxqOPPhoREZcuXYqFhYUYGBio+ukTo6Ojcfz48cVPnoj4cFLIP/mTP4nPf/7z0dvbm+DdAAAAAPVKNhnk8ePH46677lpykz85ORn3339/1eNvvfXW+MQnPlHTR1wWgoZivb29cffdd8e//du/1Vc4AAAAkEyyoOFf/uVfYv/+/ZHP5xdf7733Xpw9ezY+/elPR0TcsK3RV0REX19fbNu2Lf7zP//zhm379++Pl156Ka5du5bqbQEAAAB1SPLoxOzsbGzcuDG2bt16w/rJyckbJm1Mac+ePTE9PR133XXX4rqtW7dGX19fvPrqq3Hvvfc25bysPZ57BADamWuV1WVsbCympqZq2q+cWo6vR601QUGSoOHYsWOxb9++Jeunpqbiq1/9aopTLHH33XfHX/3VX8X8/PwNc0A89NBDMTk5Gffcc0+sW5esYQMAACCpcmFB1vqsG/2sdbWOOTU1VdN5CvvUWhNEJAgaLl++HK+//no8/vjjN6x/+eWXY2hoKPr6+mqad6ERDz74YExPT8cv/MIvLK6766674jvf+U68+eab8YlPfKIp5wU6S/EvRr8QAYB2UbguKdcxkLqToPh8petK1xefv7QOHQ5Us+w/+Re6GUrnUpiamor77rsvImJxgshUczQUPPDAA/Hv//7vS/bZt29ffO9731vuWwNWgcIvwkZ+GVZqSQQASCWru6AdbuYL5y/UV3i1ui7a37I7Gl5//fX42Mc+FhcuXFjsILh48WL85Cc/iaGhoVi/fn1s2LBh2YVmGRgYiE2bNsX58+djaGgoIiIuXLgQFy9ejLfeeisWFhaadm5WlytXrsSRI0fikUceiZ07d7a6HBIp/UXolyIAncq1yupVHDBkhQ0R5a9h6v2jSLXHKio9ipHV+eDainKWHTQcPHgwpqam4tvf/nbk8/l44IEH4o033lj8SMuNGzcuu8hKCl0NFy9ejJdeeiny+Xx85jOfiUcffTTef/99QQM16e/vj4sXL8bzzz8fL7zwQjz++OMxMDAQESZY6nTVfn7j4+OL309OTi5ZV/hFWthWy3GTk5MxPj6++LXc2OXWZe0DwNrmWmV1K74mKL6OKKzL+hlXukYo999E1pj5fH5xffFxpdcwY2Nji98Xr6tWC2tTkskgx8bG4u677465ubn4j//4j7h8+XL84i/+YuRyuRUJGo4fPx5dXV3xhS98IX7u535ucVvhUYpcLtfUGlgdduzYEadPn465ubl4+umnY3R0tNUl0WTFv8SLl0t/2ddzXHFIUFBuvNLjin95lzs3AGuXa5XVrdZrgXLXGpWuQaqdN+uYWo51rUI5SYKGiIhNmzbFHXfcEUNDQ7GwsBD5fD42btx4w01+s9LWgwcPRkTET3/603j//feju7s7/vVf/zX+4R/+oSnnY/Xq6uqK69evx9WrV+PEiROtLoeEsroEsjoKGhmvVpXOV9oF4Rf36vGNb3yj1SWQQOFaA1rNtcrqVNoJGVE+PChsKz622vpK67I6McvtXy6UgFLJgoZcLhc9PT3R09MT+Xw+rl27Fl1dyYavSW9vb/T09ERXV1ccOHAgDhw4sKLnp7M9++yzcfr06YiI6OnpidHR0Zienm5xVaRS7ga+tDWxnvEa0ej56FyHDh2Kvr6+Gz6Kmc5y8ODBOHz4cKvLANcqq1jxdUXpo5cprxfqvQap1OXpOoZKmpIE5HK5lsyNsG7duli3btkfpMEa9dprr8XGjRtjYGBg8bnH6elpzz12sImJiRgfH4+JiYnFdcU/z3379sXExMQN60p/3oXlwr6Vxik9Z+Fr6Rjlzpd1DAAUuFZZvbLmRqjl+qR0udb9So+p5Roka73/9ihnxVoORkZGkoyzbdu2JONAsStXrsSWLVvM5LwKTUxMxL59+xa/L7etoDQ0yDq29LjScWupJet8AFCOa5W1odZrgtLriWrraxmvcJ1SWoNrFRqxIkHD7Ozs4sSMy5XL5eL8+fMmvyGp/v7+eOqpp1pdBk1S6ZdjtV+c5bbXMmbWPn5RA9AI1yprU7ngoPh6otwfP4rXF4cF9fzRo1zwUHouKLUiQcOZM2dieHg4yVjbtm2LH/3oR5JcYNVopDsCAFgd6v2DSFaHZqX1tX5fy3K1eqFgRSY0qDVoOHLkSNV9RkZG4vz587GwsJCiNICWm5iYWHwBAECnW7FHJ37rt36r4j4zMzPxzjvvxMzMTOzatavsfsPDw3H+/Pm4du1a6jIhk0luAIB25loFaDdN72iYnZ2N4eHhxTkayr1OnjwZo6OjcfLkyar7Dg8Px9mzZ+ODDz5odvkAAABAHZoeNNTy2MT8/HxcuHAh9u/fHxcuXIj5+fmK+xfmafD4BAAAALSXFQkaqn0k5czMzOLkjqOjozEzM1Nx/8I8DR6fAAAAgPayYo9OVHLy5Mm45557IiJi7969VYOGbdu2CRoAAACgDTV1Msji+RnKuXTpUiwsLMRtt90W69evj23btsW1a9firbfeiltvvbXscdu2bYsf/vCH0d/fH11dKzKnJWuUCZYAgHbmWgVoN03taKj3sYmenp6IiNizZ0+cOnWq4nGFeRp0NQAAAED7aIugofDYxMaNGyMiYvfu3eZpAAAAgA7U1KCh2vwM58+fj82bN8dNN90U3d3dsW7dh+XcfPPNccstt8T58+fLHmueBgAAAGg/TZvcoJZJILO6GQoKj08MDQ2VPX7btm1x7ty56O/vj+7u7uUXDRk89wgAtDPXKkC7aVpHQ+GxiXw+X/Z16tSpuOeeeyKXy8WGDRtuOP7++++PU6dOVTzePA0AAADQXpoaNFTqRnj11VdjZGQkuru7o6enJ3K53A3bN2zYEHfeeWe8+uqrZccYHh6O8+fPx8LCQrK6AQAAgMY1LWio9ujEyZMnFz9tovSxiYK9e/dW/PSJwjwN169f1zIGAAAAbaApQUO1kOHatWsxOzsbO3bsiPXr10dXV/ZUETt37owzZ85UfDTCpJAAAADQPpoyGWThsYlyXQaFuRkiynczFNx3331x6tSpuP/++zO3Dw0NxY9+9KPYsWPHknkeIAXdMgBAO3OtArSbpnQ0FCaCLGdmZmbxsYmenp6KY+3ZsydefvnlstuHh4fj3LlzOhoAAACgDTTt0YlyQcO7774b77zzTtx+++2xYcOGWLeucgkjIyPx4x//ON59993M7du2bYu5ubn42c9+Fh988MGyawcAAAAalzxoqBQyRHzYzVDrYxMFe/bsqWlSSF0NAAAA0FrJg4bCYxP5fD7zderUqdi5c2esW7eu5jkVdu/eHadOnSo7ZmGeBh9zCQAAAK2VfDLIM2fOxEMPPZS57Y033oju7u74+Mc/XnVuhmJbtmyJnp6eeOONN2Lr1q1Ltg8PD8c//uM/6migKUywBAC0M9cqQLtZ0UcnCt0MEdUngSxVaVLIoaGhmJubiw8++CB+9rOf1VcwAAAAkEzSjoZq8zO8/PLL8bWvfS26urqiq6u+U+/evTu++c1vxuc///nM7YV5Gj7ykY9Eb29vXWNDOSMjI3Ho0KFWlwF0qMHBwVaXAKxyrlWA5WjWtUrSoOEHP/hBDA0NZbZvnTlzJm677bbo7e2teRLIYh/5yEfi9ttvjx/84AfxyU9+csn2wcHBmJubizvuuEPQQDJPPPFERETMz8/H/Px8i6sBALiRaxWgHSXvaNi/f3/mtldeeWXx0ybqfWyiYPfu3XH69OnMoGF4eDj+6Z/+yTwNNEWjARlAREQul2t1CcAq51oFWI7U1ypJg4Z8Ph9/+Zd/mbltcHAwdu7cGT09PQ2/id27d8fU1FTZ9rDBwcHI5/Nx7dq16O7ubugckCWXy7lRAADalmsVoJ0kDRoKrVvvvfde/O///m/mPo12M5Se49133y3bvSBoAAAAgNZI/vGWER/Op9DX15e5bd26NB900d/fX/ajfKS5AAAA0BpNCRpWonVLexgAAAC0nzTtBQAAAAAhaAAAAAASEjQAAAAAyQgaAAAAgGQEDQAAAEAyggYAAAAgGUEDAAAAkIygAQAAAEhG0AAAAAAkI2gAAAAAkhE0AAAAAMkIGgAAAIBkBA0AAABAMoIGAAAAIBlBAwAAAJCMoAEAAABIRtAAAAAAJCNoAAAAAJIRNAAAAADJCBoAAACAZAQNAAAAQDKCBgAAACAZQQMAAACQjKABAGjIrl27Wl3ConaqBQDWOkEDAFC3Xbt2xczMTKvLiIj2qgUAEDQAAKtUpS4HHRAA0DyCBgCgLu3UQZBVS2mIULxcaRsAkEZXqwsAADpb4Wa9cMNfuly8rqDctqz1MzMzmWOWU7x/aRBRaRsAkIaOBgCgZlk359WWC8cUXpW2ZYUOxftUqwUAaD1BAwDQVIUAoVxXQmFbuccY6g0TigOI0vCi0jYAIA2PTgAATVfanZC1LfW5spabfW4AQEcDAFCjWh9VqDThYrUuglo7DGqppdJ2AQMANI+OBgBg2UonbCw8ClE6QWRhe9ZxpduKJ20s3QYAtC9BAwBQVb0dBJUeV6h0XC3rTQIJAO3NoxMAQFXtdGPfTrUAAEsJGgAAAIBkBA0AAABAMoIGAAAAIBlBAwAAAJCMoAEAAABIRtAAAAAAJCNoAAAAAJIRNAAAAADJCBoAAACAZAQNAAAAQDKCBgAAACAZQQMAAACQTFerCwAAoLzDhw/H7Oxsq8sAOtT27dvj4MGDrS6DNUbQAADQxmZnZ+OZZ55pdRlAh3ryySdbXQJrkEcnAAAAVrEPPvgg8vl8q8tgDdHRAADQ5twgAMtx+fLl6Ovri76+vlaXwhqhowEAAABIRtAAAAAAJCNoAAAAAJIRNAAAAADJmAwSAKDNmQwSgE6iowEAAABIRtAAAAAAJCNoAAAAAJIRNAAAAADJmAwSAKDNmQwSgE6iowEAAABIRtAAAAAAJCNoAAAAAJIxRwMAQJszRwMAnURHAwAAAJCMoAEAAABIRtAAAAAAJCNoAAAAAJIRNAAAtLl8Pu+V8XrwwQfr3q/0mFrHSF2Tl9dKvaAVfOoEAAArbmxsrOo+U1NTVbePjY1V3K+wvXS/SseV1lY4vlp9hX1q2RdgNRM0AADQEpVu/MsFEVnrs4KBrDHLydqveIxy9WaNUU+gQWNqCZcihDvQSoIGAIA2cOXKlThy5Eg88sgjsXPnzlaX09Zqucks3q+006D4a7luhUZrKh3PzW56tXa6AK0jaAAAaAP9/f1x8eLFeP755+OFF16Ixx9/PAYGBlpdVlNldQU04xxZN6a1/lW83PpyY5Zu89d1YC0SNAAAtIkdO3bE6dOnY25uLp5++ukYHR2NiFi1E7pNTk4ufj8+Pr5kudz7rvbvUdg+Pj6euVw499jY2OI5S8csrC+uI5/PZ+5fGLewrXjc4nWl77lepecpXS59j5W2Za2fnJzMHLNSLdXOVW7MrFoq7Vc8Trn6SmvK+hnVWyfQGEEDAEAF27dvj4MHD67Y+bq6uuL69etx9erVOHHixIqdt5Nk3eRmqeXmdDnnLQ0TqtWyXFnvp3g5K6yptK24/vHx8YrHl9ZROKbeMSvVUvp+is9X/DVrn9TvHVgeQQMAQAUrGTI8++yzcfr06YiI6OnpidHR0Zienl6x86+00hvGegKEWscst63Rv9gXbkir1V6ps6BZSv8qn3WDX+34SsuN1tQO6n3vwPIIGgAA2sRrr70WGzdujIGBgcU5GlZz0FDt0Ynljllue2m7fNYxlf56Xum85f6Cv1Iq1dEJN9OlYU6qmjvhvcNqImgAAGgDV65ciS1btmR+6sRqnaOh9H1VW963b19MTEzU/e9RvH/xfA0TExOZ5yl3TD6fj4mJicVj65lDIuXPsDDWvn37liwX3lNxnVk1FO+7nBrr/RnWe9xy/o2zfoYR6d47UJ6gAQCgDfT390U9BxIAAAMRSURBVMdTTz3V6jLWjImJicUbzqwbz3IqHVPPOI0qnLv4++LzFrYVtmcdV7qtsL543Fo1MmalWoq3Z/37ln5fHKwUby/sMzEx0bT3DpQnaAAAYEVl3URm3ShXO6bRc1YKF8rdtFerodKNceqb19Kb9qzvqx1Xy/p6a6lnzEa2L2fMZrx3oLxcPp/PX/75T0ZExC3/fabF5QAAUOzgwYPxp3/6p60uA25QqSOB9vJHf/RHcejQoejr64u+vr5Wl8MqVZop6GgAAADqIlwAKhE0AAC0ORPVAdBJ1rW6AAAAAGD1EDQAAAAAyQgaAAAAgGQEDQAAAEAyJoMEAGhzJoMEoJPoaAAAAACSETQAAAAAyQgaAAAAgGTM0QAA0ObM0QBAJ9HRAAAAACQjaAAAAACSETQAAAAAyQgaAAAAgGRMBgkA0OZMBglAJ9HRAAAAACQjaAAAAACSETQAAAAAyQgaAAAAgGRMBgkA0OZMBglAJxE0AAC0sZGRkTh06FCrywA61ODgYKtLYA0SNAAAtLEnnngiIiLm5+djfn6+xdUAQHWCBgCADpDL5SKXy7W6DKBD+f8HK0nQAADQAXp7e6O3t7fVZQBAVT51AgAAAEhG0AAAAAAkI2gAAAAAkhE0AAAAAMkIGgAAAIBkBA0AAABAMoIGAAAAIBlBAwAAAJCMoAEAAABIRtAAAAAAJCNoAAAAAJIRNAAAAADJCBoAAACAZAQNAAAAQDKCBgAAACAZQQMAAACQjKABAAAASEbQAAAAACQjaAAAAACSETQAAAAAyQgaAAAAgGQEDQAAAEAyggYAAAAgGUEDAAAAkIygAQAAAEhG0AAAAAAkI2gAAAAAkhE0AAAAAMkIGgAAAIBkBA0AAABAMoIGAAAAIBlBAwAAAJCMoAEAAABIRtAAAAAAJCNoAAAAAJIRNAAAAADJCBoAAACAZAQNAAAAQDKCBgAAACAZQQMAAACQTFfxwuWf/2Sr6gAAAABWgXUREd0P7m11HQAAAECHKs4Vcvl8Pt/CWgAAAIAOdvbs2RgZGVlc/n/zLoSb7qx2uQAAAABJRU5ErkJggg=="},1670:function(t,a,s){t.exports=s.p+"assets/img/105.b027e21b.png"},1671:function(t,a,s){t.exports=s.p+"assets/img/106.115ec697.png"},1672:function(t,a,s){t.exports=s.p+"assets/img/107.ab28ab7a.png"},1673:function(t,a,s){t.exports=s.p+"assets/img/108.6e7c23d5.png"},1674:function(t,a,s){t.exports=s.p+"assets/img/109.ba5bc08a.png"},1675:function(t,a,s){t.exports=s.p+"assets/img/110.9ebda6c3.png"},1676:function(t,a,s){t.exports=s.p+"assets/img/111.79f3c03b.png"},1677:function(t,a,s){t.exports=s.p+"assets/img/112.41b11dc2.png"},1678:function(t,a,s){t.exports=s.p+"assets/img/113.32a2fb84.png"},1679:function(t,a,s){t.exports=s.p+"assets/img/114.5feb760e.png"},1680:function(t,a,s){t.exports=s.p+"assets/img/115.84382c82.png"},1681:function(t,a,s){t.exports=s.p+"assets/img/116.646b7d48.png"},1682:function(t,a,s){t.exports=s.p+"assets/img/117.1962bc16.png"},1683:function(t,a,s){t.exports=s.p+"assets/img/118.5a16cc0f.png"},1684:function(t,a,s){t.exports=s.p+"assets/img/119.0e551d54.png"},2468:function(t,a,s){"use strict";s.r(a);var n=s(21),e=Object(n.a)({},(function(){var t=this,a=t.$createElement,n=t._self._c||a;return n("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[n("h1",{attrs:{id:"第2天-springcloud"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#第2天-springcloud"}},[t._v("#")]),t._v(" 第2天 SpringCloud")]),t._v(" "),n("h2",{attrs:{id:"_1-spring-cloud-feign"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-spring-cloud-feign"}},[t._v("#")]),t._v(" 1 Spring Cloud Feign")]),t._v(" "),n("h3",{attrs:{id:"_1-1-目标"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-目标"}},[t._v("#")]),t._v(" 1.1 目标")]),t._v(" "),n("p",[t._v("了解Feign的作用")]),t._v(" "),n("p",[t._v("掌握Feign的使用过程")]),t._v(" "),n("p",[t._v("掌握Feign的负载均衡配置")]),t._v(" "),n("p",[t._v("掌握Feign的熔断配置")]),t._v(" "),n("p",[t._v("掌握Feign的压缩配置")]),t._v(" "),n("p",[t._v("掌握Feign的日志配置")]),t._v(" "),n("h3",{attrs:{id:"_1-2-讲解"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-讲解"}},[t._v("#")]),t._v(" 1.2 讲解")]),t._v(" "),n("h4",{attrs:{id:"_1-2-1-feign简介"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-1-feign简介"}},[t._v("#")]),t._v(" 1.2.1 Feign简介")]),t._v(" "),n("p",[n("img",{staticClass:"lazy",attrs:{alt:"images","data-src":s(1643),loading:"lazy"}})]),t._v(" "),n("p",[t._v("Feign 的英文表意为“假装，伪装，变形”， 是一个http请求调用的轻量级框架")]),t._v(" "),n("p",[t._v("为什么叫伪装？")]),t._v(" "),n("p",[t._v("Feign可以把HTTP 的请求进行隐藏，伪装成类似 SpringMVC 的 Controller一样。你不用再自己拼接 url，拼接参数等等操作，一切都交给 Feign 去做。")]),t._v(" "),n("p",[t._v("创建好了用户，订单，商品微服务，这三个微服务是互相隔离的，那么微服务和微服务之间如何互相调用呢，显然三个微服务都可以采用http通信，也就是 restTemplate 进行互相访问，但是这种方式对参数传递和使用都不是很方便，所以弃用此方式，采用 feign 进行服务之间的调用，可以简化调用流程，真正感觉到是在同一个项目中调用另一个类的方法")]),t._v(" "),n("p",[t._v("当我们通过RestTemplate调用其它服务的API时，所需要的参数须在请求的URL中进行拼接，如果参数少的话或许我们还可以忍受，一旦有多个参数的话，这时拼接请求字符串就会效率低下，并且显得好傻。")]),t._v(" "),n("p",[t._v("在开发 Spring Cloud 微服务的时候，我们知道，服务之间都是以 HTTP 接口的形式对外提供服务的，因此消费者在进行调用的时候，底层就是通过 HTTP Client 的这种方式进行访问。Spring 的 RestTemplate 去实现服务间的调用。但是最方便、最优雅的方式是通过 Spring Cloud Feign 进行服务间的调用。使用 Feign 只需要创建一个接口加上对应的注解，比如：@FeignClient 注解。")]),t._v(" "),n("p",[t._v("总之总结下：")]),t._v(" "),n("p",[t._v("Feign 是一种声明式、模板化的 HTTP 客户端。在 Spring Cloud 中使用 Feign，可以做到使用 HTTP 请求访问远程服务，就像调用本地方法一样的，开发者完全感知不到这是在调用远程方法，更感知不到在访问 HTTP 请求。")]),t._v(" "),n("p",[t._v("接下来介绍一下 Feign 的特性，具体如下：")]),t._v(" "),n("p",[t._v("集成Ribbon的负载均衡功能\n集成了Hystrix的熔断器功能\n支持请求压缩\n大大简化了远程调用的代码，同时功能还增强啦\nFeign以更加优雅的方式编写远程调用代码，并简化重复代码")]),t._v(" "),n("h4",{attrs:{id:"_1-2-2-快速入门"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-2-快速入门"}},[t._v("#")]),t._v(" 1.2.2 快速入门")]),t._v(" "),n("p",[t._v("使用 Feign 替代 RestTemplate 发送 HTTP请求。")]),t._v(" "),n("p",[t._v("实现步骤：")]),t._v(" "),n("ol",[n("li",[t._v("导入feign依赖")]),t._v(" "),n("li",[t._v("编写Feign客户端接口-将请求地址写到该接口上")]),t._v(" "),n("li",[t._v("消费者启动引导类开启Feign功能注解")]),t._v(" "),n("li",[t._v("访问接口测试\n实现过程：")])]),t._v(" "),n("p",[t._v("(1)导入依赖")]),t._v(" "),n("p",[t._v("在user-consumer中添加spring-cloud-starter-openfeign依赖")]),t._v(" "),n("div",{staticClass:"language-xml extra-class"},[n("pre",{pre:!0,attrs:{class:"language-xml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("\x3c!--配置feign--\x3e")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("dependency")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("groupId")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("org.springframework.cloud"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("groupId")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("artifactId")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("spring-cloud-starter-openfeign"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("artifactId")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("dependency")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])])]),n("p",[t._v("(2)创建Feign客户端")]),t._v(" "),n("p",[t._v("在user-consumer中创建com.atguigu.feign.UserClient接口，代码如下：")]),t._v(" "),n("p",[n("img",{staticClass:"lazy",attrs:{alt:"images","data-src":s(1644),loading:"lazy"}})]),t._v(" "),n("div",{staticClass:"language-java extra-class"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("package")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("com"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("atguigu"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("feign")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("com"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("atguigu"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("domain"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")])]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("User")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("org"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("springframework"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cloud"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("openfeign"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")])]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("FeignClient")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("org"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("springframework"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("web"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("bind"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("annotation"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")])]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("PathVariable")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("org"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("springframework"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("web"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("bind"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("annotation"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")])]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("RequestMapping")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n * UserClient\n *\n * @Author: 马伟奇\n * @CreateTime: 2020-03-22\n * @Description:\n */")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v('//@FeignClient(value = "要调用微服务的名字")')]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@FeignClient")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("value "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"user-provider"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("interface")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("UserClient")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/***\n     * 根据ID查询用户信息\n     * @param id\n     * @return\n     */")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@RequestMapping")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("value "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/user/find/{id}"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("User")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("findById")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@PathVariable")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("value "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"id"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Integer")]),t._v(" id"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("p",[t._v("解释：")]),t._v(" "),n("p",[t._v("Feign会通过动态代理，帮我们生成实现类。\n注解@FeignClient声明Feign的客户端，注解value指明服务名称\n接口定义的方法，采用SpringMVC的注解。Feign会根据注解帮我们生成URL地址\n注解@RequestMapping中的/user，不要忘记。因为Feign需要拼接可访问地址\n(3)编写控制层")]),t._v(" "),n("p",[t._v("在user-consumer中创建com.atguigu.controller.ConsumerFeignController，在 Controller 中使用@Autowired注入FeignClient ,代码如下：")]),t._v(" "),n("div",{staticClass:"language-java extra-class"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("package")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("com"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("atguigu"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("controller")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("com"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("atguigu"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("domain"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")])]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("User")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("com"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("atguigu"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("feign"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")])]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("UserClient")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("org"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("springframework"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("beans"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("factory"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("annotation"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")])]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Autowired")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("org"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("springframework"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("web"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("bind"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("annotation"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")])]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("PathVariable")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("org"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("springframework"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("web"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("bind"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("annotation"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")])]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("RequestMapping")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("org"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("springframework"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("web"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("bind"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("annotation"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")])]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("RestController")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n * ConsumerFeignController\n *\n * @Author: 马伟奇\n * @CreateTime: 2020-03-22\n * @Description:\n */")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@RestController")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@RequestMapping")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("value "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/feign"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ConsumerFeignController")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\n\n    "),n("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Autowired")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("UserClient")]),t._v(" userClient"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@RequestMapping")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("value "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/{id}"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("User")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("queryById")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@PathVariable")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("value "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"id"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Integer")]),t._v(" id"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" userClient"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("findById")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("id"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("p",[t._v("(4)开启Feign")]),t._v(" "),n("p",[t._v("修改user-consumer的启动类，在启动类上添加@EnableFeignClients注解，开启Feign,代码如下：")]),t._v(" "),n("p",[n("img",{staticClass:"lazy",attrs:{alt:"images","data-src":s(1645),loading:"lazy"}})]),t._v(" "),n("p",[t._v("(5)测试")]),t._v(" "),n("p",[t._v("请求http://localhost:18082/feign/2，效果如下：")]),t._v(" "),n("p",[n("img",{staticClass:"lazy",attrs:{alt:"images","data-src":s(1646),loading:"lazy"}})]),t._v(" "),n("h4",{attrs:{id:"_1-2-3-负载均衡"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-3-负载均衡"}},[t._v("#")]),t._v(" 1.2.3 负载均衡")]),t._v(" "),n("p",[t._v("Feign自身已经集成了Ribbon，因此使用Feign的时候，不需要额外引入依赖。")]),t._v(" "),n("p",[n("img",{staticClass:"lazy",attrs:{alt:"images","data-src":s(1647),loading:"lazy"}})]),t._v(" "),n("p",[t._v("Feign内置的ribbon默认设置了请求超时时长，默认是1000，可以修改")]),t._v(" "),n("p",[t._v("ribbon内部有重试机制，一旦超时，会自动重新发起请求。如果不希望重试可以关闭配置：")]),t._v(" "),n("p",[t._v("在 user-consumer 配置文件添加如下配置")]),t._v(" "),n("p",[n("img",{staticClass:"lazy",attrs:{alt:"images","data-src":s(1648),loading:"lazy"}})]),t._v(" "),n("p",[t._v("修改服务地址轮询策略，默认是轮询，配置之后变随机")]),t._v(" "),n("div",{staticClass:"language-yaml extra-class"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("user-provider")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ribbon")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#轮询")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("NFLoadBalancerRuleClassName")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" com.netflix.loadbalancer.RoundRobinRule\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ConnectTimeout")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1000")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 连接超时时间 没有连接上")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ReadTimeout")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2000")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 数据读取超时时间 连接上了，连上之后开始计时，但读取数据需要花费很长时间")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("MaxAutoRetries")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 最大重试次数(第一个服务)在第一次连接超时之后，在重新连接一次")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("MaxAutoRetriesNextServer")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 最大重试下一个服务次数(集群的情况才会用到)")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("OkToRetryOnAllOperations")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("false")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 是否所有操作都进行重试")]),t._v("\n")])])]),n("p",[t._v("① 测试 ReadTimeout 读取超时")]),t._v(" "),n("p",[t._v("在 UserController 添加连接超时时间")]),t._v(" "),n("p",[n("img",{staticClass:"lazy",attrs:{alt:"images","data-src":s(1649),loading:"lazy"}})]),t._v(" "),n("p",[t._v("运行测试连接超时 http://localhost:18082/feign/2")]),t._v(" "),n("p",[t._v("ReadTimeout: 2000 读取超时时间是2秒，休眠10秒，肯定连接超时")]),t._v(" "),n("p",[n("img",{staticClass:"lazy",attrs:{alt:"images","data-src":s(424),loading:"lazy"}})]),t._v(" "),n("p",[t._v("ReadTimeout: 15000 读取超时时间是15 秒，休眠10秒，可以读取数据")]),t._v(" "),n("p",[n("img",{staticClass:"lazy",attrs:{alt:"images","data-src":s(1650),loading:"lazy"}})]),t._v(" "),n("p",[t._v("② 测试 ConnectTimeout 超时 ，随意写一个不存在的IP地址，测试连接超时时间")]),t._v(" "),n("p",[n("img",{staticClass:"lazy",attrs:{alt:"images","data-src":s(1651),loading:"lazy"}})]),t._v(" "),n("p",[t._v("运行测试连接超时 http://localhost:18082/feign/2")]),t._v(" "),n("p",[n("img",{staticClass:"lazy",attrs:{alt:"images","data-src":s(424),loading:"lazy"}})]),t._v(" "),n("p",[t._v("③ 测试 MaxAutoRetries 重试机制")]),t._v(" "),n("p",[t._v("修改 ReadTimeout: 5000 5秒读取超时 ，会重新在连接一次")]),t._v(" "),n("p",[n("img",{staticClass:"lazy",attrs:{alt:"images","data-src":s(1652),loading:"lazy"}})]),t._v(" "),n("h4",{attrs:{id:"_1-2-4-熔断器支持"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-4-熔断器支持"}},[t._v("#")]),t._v(" 1.2.4 熔断器支持")]),t._v(" "),n("p",[t._v("feign整合Hystrix熔断器")]),t._v(" "),n("p",[t._v("Feign默认也有对Hystrix的集成!")]),t._v(" "),n("p",[n("img",{staticClass:"lazy",attrs:{alt:"images","data-src":s(1653),loading:"lazy"}})]),t._v(" "),n("p",[t._v("实现步骤：")]),t._v(" "),n("ol",[n("li",[t._v("在配置文件application.yml中开启feign熔断器支持")]),t._v(" "),n("li",[t._v("编写FallBack处理类，实现FeignClient客户端")]),t._v(" "),n("li",[t._v("在@FeignClient注解中，指定FallBack处理类。")]),t._v(" "),n("li",[t._v("测试\n(1)开启Hystrix")])]),t._v(" "),n("p",[t._v("在 user-consumer 配置文件 application.yml 中开启 feign 熔断器支持：默认关闭")]),t._v(" "),n("p",[t._v("feign:\nhystrix:\nenabled: true # 开启Feign的熔断功能\n"),n("img",{staticClass:"lazy",attrs:{alt:"images","data-src":s(1654),loading:"lazy"}})]),t._v(" "),n("p",[t._v("(2)熔断降级类创建")]),t._v(" "),n("p",[t._v("修改user-consumer,创建一个类com.atguigu.feign.fallback.UserClientFallback，实现刚才编写的UserClient，作为FallBack的处理类,代码如下：")]),t._v(" "),n("div",{staticClass:"language-java extra-class"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("package")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("com"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("atguigu"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("feign"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("fallback")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("com"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("atguigu"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("domain"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")])]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("User")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("com"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("atguigu"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("feign"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")])]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("UserClient")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("org"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("springframework"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("stereotype"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")])]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Component")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n * UserClientFallback\n *\n * @Author: 马伟奇\n * @CreateTime: 2020-03-22\n * @Description:\n */")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Component")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("UserClientFallback")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("implements")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("UserClient")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Override")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("User")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("findById")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Integer")]),t._v(" id"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("User")]),t._v(" user "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("User")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        user"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("setUsername")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"服务熔断"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" user"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("p",[t._v("(3)指定Fallback处理类")]),t._v(" "),n("p",[t._v("在@FeignClient注解中，指定FallBack处理类")]),t._v(" "),n("p",[n("img",{staticClass:"lazy",attrs:{alt:"images","data-src":s(1655),loading:"lazy"}})]),t._v(" "),n("div",{staticClass:"language-java extra-class"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("package")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("com"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("atguigu"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("feign")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("com"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("atguigu"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("domain"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")])]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("User")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("com"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("atguigu"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("feign"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("fallback"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")])]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("UserClientFallback")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("org"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("springframework"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cloud"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("openfeign"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")])]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("FeignClient")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("org"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("springframework"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("web"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("bind"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("annotation"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")])]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("PathVariable")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("org"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("springframework"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("web"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("bind"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("annotation"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")])]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("RequestMapping")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n * UserClient\n *\n * @Author: 马伟奇\n * @CreateTime: 2020-03-22\n * @Description:\n */")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v('//@FeignClient(value = "要调用微服务的名字")')]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//fallback = UserClientFallback.class 指定当前feign接口发生熔断降级处理类")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@FeignClient")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("value "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"user-provider"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("fallback "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("UserClientFallback")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("interface")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("UserClient")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/***\n     * 根据ID查询用户信息\n     * @param id\n     * @return\n     */")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@RequestMapping")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("value "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/user/find/{id}"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("User")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("findById")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@PathVariable")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("value "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"id"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Integer")]),t._v(" id"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("p",[t._v("避免测试干扰注释掉配置文件当中的链接超时时间")]),t._v(" "),n("p",[n("img",{staticClass:"lazy",attrs:{alt:"images","data-src":s(1656),loading:"lazy"}})]),t._v(" "),n("p",[n("img",{staticClass:"lazy",attrs:{alt:"images","data-src":s(1657),loading:"lazy"}})]),t._v(" "),n("p",[t._v("(4)测试")]),t._v(" "),n("p",[t._v("关闭服务消费方，请求http://localhost:18082/feign/3，效果如下：")]),t._v(" "),n("p",[n("img",{staticClass:"lazy",attrs:{alt:"images","data-src":s(1658),loading:"lazy"}})]),t._v(" "),n("h4",{attrs:{id:"_1-2-5-请求压缩"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-5-请求压缩"}},[t._v("#")]),t._v(" 1.2.5 请求压缩")]),t._v(" "),n("p",[t._v("SpringCloudFeign支持对请求和响应进行GZIP压缩，以减少通信过程中的性能损耗。")]),t._v(" "),n("p",[t._v("user-consumer通过配置开启请求与响应的压缩功能：（简单压缩）")]),t._v(" "),n("div",{staticClass:"language-yaml extra-class"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("feign")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n\t"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("compression")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("request")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("enabled")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 开启请求压缩")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("response")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("enabled")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 开启响应压缩")]),t._v("\n")])])]),n("p",[t._v("也可以对请求的数据类型，以及触发压缩的大小下限进行设置（完整压缩）")]),t._v(" "),n("div",{staticClass:"language-yaml extra-class"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#  Feign配置")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("feign")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n\t"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("compression")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n\t\t"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("request")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n\t\t\t"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("enabled")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 开启请求压缩")]),t._v("\n\t\t\t"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("mime-types")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\ttext/html"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("application/xml"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("application/json "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 设置压缩的数据类型")]),t._v("\n\t\t\t"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("min-request-size")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2048")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 设置触发压缩的大小下限")]),t._v("\n\t\t\t"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#以上数据类型，压缩大小下限均为默认值")]),t._v("\n\t\t"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("response")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("enabled")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 开启响应压缩")]),t._v("\n")])])]),n("p",[n("img",{staticClass:"lazy",attrs:{alt:"images","data-src":s(1659),loading:"lazy"}})]),t._v(" "),n("h4",{attrs:{id:"_1-2-6-feign的日志级别配置"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-6-feign的日志级别配置"}},[t._v("#")]),t._v(" 1.2.6 Feign的日志级别配置")]),t._v(" "),n("p",[t._v("通过loggin.level.xx=debug来设置日志级别。然而这个对Feign客户端不会产生效果。因为@FeignClient注解修饰的客户端在被代理时，都会创建一个新的Feign.Logger实例。我们需要额外通过配置类的方式指定这个日志的级别才可以。")]),t._v(" "),n("p",[t._v("实现步骤：")]),t._v(" "),n("ol",[n("li",[t._v("在application.yml配置文件中开启日志级别配置")]),t._v(" "),n("li",[t._v("编写配置类，定义日志级别bean。")]),t._v(" "),n("li",[t._v("在接口的@FeignClient中指定配置类")]),t._v(" "),n("li",[t._v("重启项目，测试访问\n实现过程：")])]),t._v(" "),n("p",[t._v("(1)普通日志等级配置")]),t._v(" "),n("p",[t._v("在user-consumer的配置文件中设置com.atguigu包下的日志级别都为debug")]),t._v(" "),n("p",[n("img",{staticClass:"lazy",attrs:{alt:"images","data-src":s(1660),loading:"lazy"}})]),t._v(" "),n("p",[t._v("com.atguigu 包下的日志级别都为Debug")]),t._v(" "),n("div",{staticClass:"language-yaml extra-class"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("logging")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("level")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("com.atguigu")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" debug\n")])])]),n("p",[t._v("(2)Feign日志等级配置")]),t._v(" "),n("p",[t._v("在user-consumer中的application启动类com.atguigu.UserConsumerApplication,定义日志级别")]),t._v(" "),n("p",[n("img",{staticClass:"lazy",attrs:{alt:"images","data-src":s(1661),loading:"lazy"}})]),t._v(" "),n("div",{staticClass:"language-java extra-class"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("package")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("com"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("atguigu")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("feign"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")])]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Logger")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("org"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("springframework"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("boot"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")])]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SpringApplication")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("org"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("springframework"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("boot"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("autoconfigure"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")])]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SpringBootApplication")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("org"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("springframework"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cloud"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("client"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("circuitbreaker"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")])]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("EnableCircuitBreaker")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("org"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("springframework"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cloud"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("client"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("discovery"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")])]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("EnableDiscoveryClient")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("org"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("springframework"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cloud"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("client"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("loadbalancer"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")])]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("LoadBalanced")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("org"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("springframework"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cloud"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("openfeign"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")])]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("EnableFeignClients")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("org"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("springframework"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("annotation"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")])]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Bean")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("org"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("springframework"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("web"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("client"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")])]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("RestTemplate")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n * UserConsumerApplication\n *\n * @Author: 马伟奇\n * @CreateTime: 2020-03-18\n * @Description:\n */")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@SpringBootApplication")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@EnableDiscoveryClient")]),t._v("  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//开启Eureka客户端发现功能")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@EnableCircuitBreaker")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@EnableFeignClients")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("basePackages "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"com.atguigu.feign"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("UserConsumerApplication")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("main")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" args"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SpringApplication")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("run")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("UserConsumerApplication")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("args"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/***\n     * 将RestTemplate的实例放到Spring容器中\n     * @return\n     */")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Bean")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@LoadBalanced")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("RestTemplate")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("restTemplate")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("RestTemplate")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n     * 配置日志级别\n     * @return\n     */")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Bean")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Logger"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Level")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("feignloggerlevel")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Logger"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Level")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("FULL"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("p",[t._v("日志级别说明：")]),t._v(" "),n("p",[t._v("Feign支持4中级别：\nNONE：不记录任何日志，默认值\nBASIC：仅记录请求的方法，URL以及响应状态码和执行时间\nHEADERS：在BASIC基础上，额外记录了请求和响应的头信息\nFULL：记录所有请求和响应的明细，包括头信息、请求体、元数据\n运行程序 http://localhost:18082/feign/2")]),t._v(" "),n("p",[n("img",{staticClass:"lazy",attrs:{alt:"images","data-src":s(1662),loading:"lazy"}})]),t._v(" "),n("p",[t._v("重启项目，即可看到每次访问的日志， 文件压缩")]),t._v(" "),n("p",[n("img",{staticClass:"lazy",attrs:{alt:"images","data-src":s(1663),loading:"lazy"}})]),t._v(" "),n("p",[t._v("1.2.7 Feign 工作原理\n① 在开发微服务应用时，我们会在主程序入口添加 @EnableFeignClients 配置的扫描包路径。如果没配置，默认为启动类的包路径。")]),t._v(" "),n("p",[t._v("② 当程序启动时，会进行包扫描，扫描所有 @FeignClient 的注解的类，并将这些信息注入 Spring IOC 容器中。")]),t._v(" "),n("p",[t._v("③ 校验 @FeignClient 修饰的类，包括类必须是 interface ，以及@FeignClient的fallback及fallbackFactory配置的必须是接口的实现类。")]),t._v(" "),n("h3",{attrs:{id:"_1-3-小结"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-3-小结"}},[t._v("#")]),t._v(" 1.3 小结")]),t._v(" "),n("p",[t._v("Feign的作用:不再使用拼接URL的方式实现远程调用，以接口调用的方式实现远程调用，简化了远程调用的实现方式，增强了远程调用的功能，例如：增加了负载均衡、熔断、压缩、日志启用。")]),t._v(" "),n("p",[t._v("掌握Feign的使用过程")]),t._v(" "),n("p",[t._v("properties\n1.引入Feign依赖包\n2.创建Feign接口,feign接口中需要指定调用的服务名字\n3.使用@EnabledFeignClients启用Feign功能\n掌握Feign的负载均衡配置\nproperties\n在配置文件中配置\n{spring.application.name}🎀负载均衡属性配置\n掌握Feign的熔断配置\nproperties\n1.在application.yml中开启Hystrix\n2.给Feign接口创建一个实现类\n3.给Feign指定fallback类\n掌握Feign的压缩配置\nproperties\n在application.yml中指定压缩属性即可\n掌握Feign的日志配置\nproperties\n1.在application.yml中开启普通日志等级\n2.创建一个类，定义Feign日志等级\n3.在Feign接口中指定定义日志的配置")]),t._v(" "),n("h2",{attrs:{id:"_2-网关-spring-cloud-gateway"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-网关-spring-cloud-gateway"}},[t._v("#")]),t._v(" 2 网关 Spring Cloud Gateway")]),t._v(" "),n("p",[n("img",{staticClass:"lazy",attrs:{alt:"images","data-src":s(1664),loading:"lazy"}})]),t._v(" "),n("p",[n("img",{staticClass:"lazy",attrs:{alt:"images","data-src":s(1665),loading:"lazy"}})]),t._v(" "),n("h3",{attrs:{id:"_2-1-目标"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-目标"}},[t._v("#")]),t._v(" 2.1 目标")]),t._v(" "),n("p",[t._v("网关的作用\n会配置动态路由\n会配置过滤器\n能自定义全局过滤器\nAPI 网关出现的原因是微服务架构的出现，不同的微服务一般会有不同的网络地址，而外部客户端可能需要调用多个服务的接口才能完成一个业务需求，如果让客户端直接与各个微服务通信，会有以下的问题：")]),t._v(" "),n("p",[t._v("客户端会多次请求不同的微服务，增加了客户端的复杂性。\n存在跨域请求，在一定场景下处理相对复杂。\n认证复杂，每个服务都需要独立认证。\n难以重构，随着项目的迭代，可能需要重新划分微服务。例如，可能将多个服务合并成一个或者将一个服务拆分成多个。如果客户端直接与微服务通信，那么重构将会很难实施。\n某些微服务可能使用了防火墙 / 浏览器不友好的协议，直接访问会有一定的困难。\n以上这些问题可以借助 API 网关解决。API 网关是介于客户端和服务器端之间的中间层，所有的外部请求都会先经过 API 网关这一层。也就是说，API 的实现方面更多的考虑业务逻辑，而安全、性能、监控可以交由 API 网关来做，这样既提高业务灵活性又不缺安全性，典型的架构图如图所示：")]),t._v(" "),n("p",[n("img",{staticClass:"lazy",attrs:{alt:"images","data-src":s(1666),loading:"lazy"}})]),t._v(" "),n("p",[t._v("使用 API 网关后的优点如下：")]),t._v(" "),n("p",[t._v("易于监控。可以在网关收集监控数据并将其推送到外部系统进行分析。\n易于认证。可以在网关上进行认证，然后再将请求转发到后端的微服务，而无须在每个微服务中进行认证。\n减少了客户端与各个微服务之间的交互次数。")]),t._v(" "),n("h3",{attrs:{id:"_2-2-讲解"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-讲解"}},[t._v("#")]),t._v(" 2.2 讲解")]),t._v(" "),n("h4",{attrs:{id:"_2-2-1-gateway-简介"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-1-gateway-简介"}},[t._v("#")]),t._v(" 2.2.1 Gateway 简介")]),t._v(" "),n("p",[t._v("Spring Cloud Gateway 是Spring Cloud团队的一个全新项目，基于Spring 5.0、SpringBoot2.0、Project Reactor 等技术开发的网关。 旨在为微服务架构提供一种简单有效统一的API路由管理方式。")]),t._v(" "),n("p",[t._v("Spring Cloud Gateway 作为SpringCloud生态系统中的网关，目标是替代Netflix Zuul。Gateway不仅提供统一路由方式，并且基于Filter链的方式提供网关的基本功能。例如：安全，监控/指标，和限流。")]),t._v(" "),n("p",[t._v("本身也是一个微服务，需要注册到Eureka")]),t._v(" "),n("p",[t._v("网关的核心功能：过滤、路由")]),t._v(" "),n("p",[t._v("核心概念：通过画图解释")]),t._v(" "),n("p",[t._v("路由(route)：\n断言Predicate函数：路由转发规则\n过滤器(Filter)：\n"),n("img",{staticClass:"lazy",attrs:{alt:"images","data-src":s(1667),loading:"lazy"}})]),t._v(" "),n("h4",{attrs:{id:"_2-2-2-快速入门"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-2-快速入门"}},[t._v("#")]),t._v(" 2.2.2 快速入门")]),t._v(" "),n("p",[t._v("实现步骤：")]),t._v(" "),n("ol",[n("li",[t._v("创建gateway-service工程SpringBoot")]),t._v(" "),n("li",[t._v("编写基础配置")]),t._v(" "),n("li",[t._v("编写路由规则，配置静态路由策略")]),t._v(" "),n("li",[t._v("启动网关服务进行测试\n实现过程：")])]),t._v(" "),n("p",[t._v("(1)创建一个子工程 gateway-service")]),t._v(" "),n("p",[n("img",{staticClass:"lazy",attrs:{alt:"images","data-src":s(1668),loading:"lazy"}})]),t._v(" "),n("p",[t._v("(2)pom.xml依赖")]),t._v(" "),n("div",{staticClass:"language-xml extra-class"},[n("pre",{pre:!0,attrs:{class:"language-xml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token prolog"}},[t._v('<?xml version="1.0" encoding="UTF-8"?>')]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("project")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("xmlns")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("http://maven.apache.org/POM/4.0.0"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v("\n         "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[n("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("xmlns:")]),t._v("xsi")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("http://www.w3.org/2001/XMLSchema-instance"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v("\n         "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[n("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("xsi:")]),t._v("schemaLocation")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("parent")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("artifactId")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("springcloud-parent"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("artifactId")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("groupId")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("com.atguigu"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("groupId")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("version")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("1.0-SNAPSHOT"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("version")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("parent")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("modelVersion")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("4.0.0"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("modelVersion")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("artifactId")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("gateway-service"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("artifactId")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("dependencies")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("\x3c!--网关依赖--\x3e")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("dependency")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("groupId")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("org.springframework.cloud"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("groupId")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("artifactId")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("spring-cloud-starter-gateway"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("artifactId")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("dependency")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("\x3c!-- Eureka客户端 --\x3e")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("dependency")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("groupId")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("org.springframework.cloud"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("groupId")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("artifactId")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("spring-cloud-starter-netflix-eureka-client"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("artifactId")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("dependency")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("dependencies")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("project")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])])]),n("p",[t._v("(3)启动类")]),t._v(" "),n("p",[t._v("创建启动类com.atguigu.GatewayApplication,代码如下：")]),t._v(" "),n("div",{staticClass:"language-java extra-class"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("package")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("com"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("atguigu")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("org"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("springframework"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("boot"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")])]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SpringApplication")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("org"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("springframework"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("boot"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("autoconfigure"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")])]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SpringBootApplication")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("org"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("springframework"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cloud"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("client"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("discovery"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")])]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("EnableDiscoveryClient")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n * GatewayApplication\n *\n * @Author: 马伟奇\n * @CreateTime: 2020-03-22\n * @Description:\n */")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@SpringBootApplication")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@EnableDiscoveryClient")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("GatewayApplication")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("main")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" args"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SpringApplication")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("run")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("GatewayApplication")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("args"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("p",[t._v("(4) application.yml 配置")]),t._v(" "),n("div",{staticClass:"language-yaml extra-class"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 注释版本")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("server")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("port")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("18084")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spring")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("application")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" api"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("gateway "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 应用名")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Eureka服务中心配置")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("eureka")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("client")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("service-url")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 注册Eureka Server集群")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("defaultZone")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" http"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("//127.0.0.1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("7001/eureka\n")])])]),n("h4",{attrs:{id:"_2-2-3-路由配置"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-3-路由配置"}},[t._v("#")]),t._v(" 2.2.3 路由配置")]),t._v(" "),n("p",[n("img",{staticClass:"lazy",attrs:{alt:"images","data-src":s(1669),loading:"lazy"}})]),t._v(" "),n("p",[t._v("通过网关配置一个路由功能，用户访问网关的时候,如果用户请求的路径是以/user开始，则路由到user-provider服务去,修改application.yml配置即可实现，配置如下：")]),t._v(" "),n("p",[n("img",{staticClass:"lazy",attrs:{alt:"images","data-src":s(1670),loading:"lazy"}})]),t._v(" "),n("div",{staticClass:"language-yaml extra-class"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spring")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("application")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 应用名")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" api"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("gateway\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("cloud")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("gateway")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("routes")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 用户所有以/user开始的请求，都给http://localhost:18081服务处理")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#id唯一标识，可自定义 , 随便写，可以写小红，小花都行")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("id")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" user"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("service"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("route\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#路由的服务地址")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("uri")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" http"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("//localhost"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("18081")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 路由拦截的地址配置（断言）")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# /user/**所有以/user开始的请求都将被路由到uri指定的服务地址，")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 将该请求交给uri指定的服务处理，比如请求：http://localhost:18084/user/find/2会把请求交给http://localhost:18081/user/find/2处理")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("predicates")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" Path=/user/"),n("span",{pre:!0,attrs:{class:"token important"}},[t._v("**")]),t._v("\n")])])]),n("p",[t._v("概念解释：")]),t._v(" "),n("p",[t._v("Route（路由）：路由是网关的基本单元，由ID、URI、一组Predicate、一组Filter组成，根据Predicate进行匹配转发。\nPredicate（谓语、断言）：路由转发的判断条件\nFilter（过滤器）：过滤器是路由转发请求时所经过的过滤逻辑，可用于修改请求、响应内容。\n启动GatewayApplication测试")]),t._v(" "),n("p",[t._v("访问http://localhost:18084/user/find/2会访问user-provider服务，效果如下：")]),t._v(" "),n("p",[n("img",{staticClass:"lazy",attrs:{alt:"images","data-src":s(1671),loading:"lazy"}})]),t._v(" "),n("h4",{attrs:{id:"_2-2-4-动态路由"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-4-动态路由"}},[t._v("#")]),t._v(" 2.2.4 动态路由")]),t._v(" "),n("p",[n("img",{staticClass:"lazy",attrs:{alt:"images","data-src":s(1672),loading:"lazy"}})]),t._v(" "),n("p",[t._v("刚才路由规则中，我们把路径对应服务地址写死了！如果服务提供者集群的话，这样做不合理。应该是"),n("strong",[t._v("根据服务名称")]),t._v("，去Eureka注册中心查找服务对应的所有实例列表，然后进行动态路由！")]),t._v(" "),n("p",[t._v("修改映射配置：通过服务名称获取：")]),t._v(" "),n("p",[t._v("修改application.yml")]),t._v(" "),n("p",[t._v("因为已经配置了Eureka客户端，可以从Eureka获取服务的地址信息，修改application.yml文件如下:")]),t._v(" "),n("p",[n("img",{staticClass:"lazy",attrs:{alt:"images","data-src":s(1673),loading:"lazy"}})]),t._v(" "),n("p",[t._v("上图代码如下：")]),t._v(" "),n("div",{staticClass:"language-yaml extra-class"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spring")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("application")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 应用名")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" api"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("gateway\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("cloud")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("gateway")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("routes")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#id唯一标识，可自定义")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("id")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" user"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("service"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("route\n          "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#路由的服务地址")]),t._v("\n          "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#uri: http://localhost:18081 请求负载均衡算法Load Balance")]),t._v("\n          "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#lb协议表示从Eureka注册中心获取服务请求地址")]),t._v("\n          "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#user-provider访问的服务名称。")]),t._v("\n          "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#路由地址如果通过lb协议加服务名称时，会自动使用负载均衡访问对应服务")]),t._v("\n          "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("uri")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" lb"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("//user"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("provider\n          "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 路由拦截的地址配置（断言）")]),t._v("\n          "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("predicates")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" Path=/user/"),n("span",{pre:!0,attrs:{class:"token important"}},[t._v("**")]),t._v("\n")])])]),n("p",[t._v("路由配置中uri所用的协议为lb时，gateway将把user-provider解析为实际的主机和端口，并通过Ribbon进行负载均衡。http://localhost:18084/user/find/2")]),t._v(" "),n("p",[n("img",{staticClass:"lazy",attrs:{alt:"images","data-src":s(1674),loading:"lazy"}})]),t._v(" "),n("h4",{attrs:{id:"_2-2-5-过滤器"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-5-过滤器"}},[t._v("#")]),t._v(" 2.2.5 过滤器")]),t._v(" "),n("p",[t._v("过滤器作为Gateway的重要功能。常用于请求鉴权、服务调用时长统计、修改请求或响应header、限流、去除路径等等…")]),t._v(" "),n("h5",{attrs:{id:"_2-2-5-1-过滤器的分类"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-5-1-过滤器的分类"}},[t._v("#")]),t._v(" 2.2.5.1 过滤器的分类")]),t._v(" "),n("p",[t._v("默认过滤器：出厂自带，实现好了拿来就用，不需要实现\n全局默认过滤器\n局部默认过滤器\n自定义过滤器：根据需求自己实现，实现后需配置，然后才能用哦。\n全局过滤器：作用在所有路由上。\n局部过滤器：配置在具体路由下，只作用在当前路由上。\n默认过滤器几个，常见如下：")]),t._v(" "),n("p",[t._v("过滤器名称\t说明\nAddRequestHeader\t对匹配上的请求加上Header\nAddRequestParameters\t对匹配上的请求路由\nAddResponseHeader\t对从网关返回的响应添加Header\nStripPrefix\t对匹配上的请求路径去除前缀\n详细说明官方链接")]),t._v(" "),n("h5",{attrs:{id:"_2-2-5-2-默认过滤器配置"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-5-2-默认过滤器配置"}},[t._v("#")]),t._v(" 2.2.5.2 默认过滤器配置")]),t._v(" "),n("p",[t._v("默认过滤器有两个：全局默认过滤器和局部默认过滤器。")]),t._v(" "),n("p",[t._v("全局过滤器：对输出响应头设置属性")]),t._v(" "),n("p",[t._v("对输出的响应设置其头部属性名称为X-Response-Default-MyName,值为atguigu")]),t._v(" "),n("p",[t._v("修改 gateway-service 的 yml 配置文件")]),t._v(" "),n("p",[n("img",{staticClass:"lazy",attrs:{alt:"images","data-src":s(1675),loading:"lazy"}})]),t._v(" "),n("div",{staticClass:"language-yaml extra-class"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spring")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("cloud")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("gateway")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n     "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 配置全局默认过滤器")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("default-filters")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 往响应过滤器中加入信息")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" AddResponseHeader=X"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("Response"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("Default"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("MyName"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("atguigu\n")])])]),n("p",[t._v("查看浏览器响应头信息!")]),t._v(" "),n("p",[n("img",{staticClass:"lazy",attrs:{alt:"images","data-src":s(1676),loading:"lazy"}})]),t._v(" "),n("p",[t._v("局部过滤器：通过局部默认过滤器，修改请求路径。局部过滤器在这里介绍两种：添加路径前缀、去除路径前缀。")]),t._v(" "),n("p",[t._v("第一：添加路径前缀：")]),t._v(" "),n("p",[t._v("在gateway中可以通过配置路由的过滤器PrefixPath 实现映射路径中的前缀")]),t._v(" "),n("p",[t._v("配置请求地址添加路径前缀过滤器")]),t._v(" "),n("p",[n("img",{staticClass:"lazy",attrs:{alt:"images","data-src":s(1677),loading:"lazy"}})]),t._v(" "),n("p",[t._v("上图配置如下：")]),t._v(" "),n("div",{staticClass:"language-yaml extra-class"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 注释版本")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("server")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("port")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("18084")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spring")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("application")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" api"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("gateway "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 应用名")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("cloud")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("gateway")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("routes")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 用户所有以/user开始的请求，都给http://localhost:18081服务处理")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#id唯一标识，可自定义")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("id")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" user"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("service"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("route\n          "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#路由的服务地址")]),t._v("\n          "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("uri")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" lb"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("//user"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("provider\n          "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 路由拦截的地址配置（断言）")]),t._v("\n          "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# /user/**所有以/user开始的请求都将被路由到uri指定的服务地址，")]),t._v("\n          "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 将该请求交给uri指定的服务处理，比如请求：http://localhost:18084/user/find/2会把请求交给http://localhost:18081/user/find/2处理")]),t._v("\n          "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("predicates")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n          "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#  - Path=/user/**")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" Path=/"),n("span",{pre:!0,attrs:{class:"token important"}},[t._v("**")]),t._v("\n          "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 配置全局默认过滤器")]),t._v("\n          "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 给每次请求都添加一个前缀 /user比如请求：http://localhost:18084/2--\x3ehttp://localhost:18084/user/2")]),t._v("\n          "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("filters")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" PrefixPath=/user\n      "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 配置全局默认过滤器")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("default-filters")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 往响应过滤器中加入信息")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" AddResponseHeader=X"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("Response"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("Default"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("MyName"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("atguigu\n")])])]),n("div",{staticClass:"language-yaml extra-class"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Eureka服务中心配置")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("eureka")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("client")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("service-url")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 注册Eureka Server集群")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("defaultZone")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" http"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("//127.0.0.1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("7001/eureka\n")])])]),n("p",[t._v("路由地址信息：")]),t._v(" "),n("p",[t._v("配置\t访问地址\t路由地址\nPrefixPath=/user\thttp://localhost:18084/find/2\thttp://localhost:18081/user/find/2\n全局和局部的区别：全局是对所有的id有效，局部只是对某一个id有效")]),t._v(" "),n("p",[t._v("请求：http://localhost:18084/find/2 会自动添加/user")]),t._v(" "),n("p",[n("img",{staticClass:"lazy",attrs:{alt:"images","data-src":s(1678),loading:"lazy"}})]),t._v(" "),n("p",[t._v("第二：去除路径前缀：")]),t._v(" "),n("p",[t._v("在gateway中通过配置路由过滤器StripPrefix，实现映射路径中地址的去除。通过StripPrefix=1来指定路由要去掉的前缀个数。如：路径/api/user/1将会被路由到/user/1。")]),t._v(" "),n("p",[t._v("http://localhost:18084/api/user/2 可以去掉指定个数的前缀 http://localhost:18084/user/2")]),t._v(" "),n("p",[t._v("配置去除路径前缀过滤器")]),t._v(" "),n("p",[n("img",{staticClass:"lazy",attrs:{alt:"images","data-src":s(1679),loading:"lazy"}})]),t._v(" "),n("p",[t._v("上图配置如下：")]),t._v(" "),n("div",{staticClass:"language-yaml extra-class"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spring")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("application")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 应用名")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" api"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("gateway\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("cloud")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("gateway")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("routes")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#id唯一标识，可自定义")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("id")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" user"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("service"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("route\n          "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#路由的服务地址")]),t._v("\n          "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#uri: http://localhost:18081")]),t._v("\n          "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#lb协议表示从Eureka注册中心获取服务请求地址")]),t._v("\n          "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#user-provider访问的服务名称。")]),t._v("\n          "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#路由地址如果通过lb协议加服务名称时，会自动使用负载均衡访问对应服务")]),t._v("\n          "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("uri")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" lb"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("//user"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("provider\n          "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 路由拦截的地址配置（断言）")]),t._v("\n          "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("predicates")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" Path=/"),n("span",{pre:!0,attrs:{class:"token important"}},[t._v("**")]),t._v("\n          "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("filters")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 请求地址添加路径前缀过滤器")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#- PrefixPath=/user")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 去除路径前缀过滤器 添加前缀和去掉前缀不要一起使用")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" StripPrefix=1\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("default-filters")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" AddResponseHeader=X"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("Response"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("Default"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("MyName"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("atguigu\n")])])]),n("p",[t._v("路由地址信息：")]),t._v(" "),n("p",[t._v("配置\t访问地址\t路由地址\nStripPrefix=1\thttp://localhost:18084/api/user/find/2\thttp://localhost:18081/user/find/2\nStripPrefix=2\thttp://localhost:18084/api/r/user/find/2\thttp://localhost:18081/user/find/2\n"),n("img",{staticClass:"lazy",attrs:{alt:"images","data-src":s(1680),loading:"lazy"}})]),t._v(" "),n("h5",{attrs:{id:"_2-2-5-3-自定义过滤器案例"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-5-3-自定义过滤器案例"}},[t._v("#")]),t._v(" 2.2.5.3 自定义过滤器案例")]),t._v(" "),n("p",[t._v("自定义过滤器也有两个：全局自定义过滤器，和局部自定义过滤器。")]),t._v(" "),n("p",[t._v("自定义全局过滤器的案例，自定义局部过滤器的案例。")]),t._v(" "),n("p",[t._v("自定义全局过滤器的案例：模拟登陆校验。")]),t._v(" "),n("p",[t._v("基本逻辑：如果请求中有Token参数，则认为请求有效放行，如果没有则拦截提示授权无效")]),t._v(" "),n("h6",{attrs:{id:"_2-2-5-3-1-全局过滤器自定义"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-5-3-1-全局过滤器自定义"}},[t._v("#")]),t._v(" 2.2.5.3.1 全局过滤器自定义：")]),t._v(" "),n("p",[t._v("实现步骤：")]),t._v(" "),n("p",[t._v("1.在gateway-service工程编写全局过滤器类GlobalFilter,Ordered\n2.编写业务逻辑代码\n3.访问接口测试，加token和不加token。\n全局过滤器作用范围：所有请求都会被拦截。")]),t._v(" "),n("p",[t._v("实现过程：")]),t._v(" "),n("p",[t._v("在gateway-service中创建com.atguigu.filter.LoginGlobalFilter全局过滤器类,代码如下：")]),t._v(" "),n("div",{staticClass:"language-java extra-class"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("package")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("com"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("atguigu"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("filter")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("org"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("springframework"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cloud"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("gateway"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("filter"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")])]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("GatewayFilterChain")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("org"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("springframework"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cloud"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("gateway"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("filter"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")])]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("GlobalFilter")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("org"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("springframework"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("core"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")])]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Ordered")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("org"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("springframework"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("core"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("annotation"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")])]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Order")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("org"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("springframework"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("http"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")])]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("HttpStatus")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("org"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("springframework"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("http"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("server"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("reactive"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")])]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ServerHttpRequest")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("org"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("springframework"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("http"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("server"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("reactive"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")])]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ServerHttpResponse")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("org"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("springframework"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("stereotype"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")])]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Component")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("org"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("springframework"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("util"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")])]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("StringUtils")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("org"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("springframework"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("web"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("server"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")])]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ServerWebExchange")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("reactor"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("core"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("publisher"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")])]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Mono")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("java"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("lang"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("annotation"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")])]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Annotation")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n * LoginGlobalFilter\n *\n * @Author: 马伟奇\n * @CreateTime: 2020-03-22\n * @Description:\n *   如果项目只有一个过滤器，只需要实现GlobalFilter接口\n *   Ordered：表示项目有多个过滤器的时候，过滤器执行的先后顺序\n */")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Component")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("LoginGlobalFilter")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("implements")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("GlobalFilter")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Ordered")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\n\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n     * 过滤拦截\n     * @param exchange\n     * @param chain\n     * @return\n     */")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Override")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Mono")]),n("span",{pre:!0,attrs:{class:"token generics"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Void")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("filter")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ServerWebExchange")]),t._v(" exchange"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("GatewayFilterChain")]),t._v(" chain"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("System")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("out"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("println")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"全局拦截器"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//  request获取")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ServerHttpRequest")]),t._v(" request "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" exchange"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("getRequest")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// response获取")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ServerHttpResponse")]),t._v(" response "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" exchange"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("getResponse")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 获取请求参数")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" token "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" request"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("getQueryParams")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("getFirst")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"token"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 判断token是否为null,如果用户请求参数中没有token，则表示用户未登录")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("StringUtils")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("isEmpty")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("token"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 没有登录，状态设置401")]),t._v("\n            response"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("setStatusCode")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("HttpStatus")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("UNAUTHORIZED"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 结束请求")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" response"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("setComplete")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 如果用户传递了一个token，则表示用户已经登录 ,直接放行")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" chain"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("filter")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("exchange"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/***\n     * 定义过滤器执行顺序\n     * 返回值越小，越靠前执行\n     * @return\n     */")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Override")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("getOrder")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("p",[t._v("测试：不携带token http://localhost:18084/hahah/user/find/2效果如下：")]),t._v(" "),n("p",[n("img",{staticClass:"lazy",attrs:{alt:"images","data-src":s(1681),loading:"lazy"}})]),t._v(" "),n("p",[t._v("测试：携带token http://localhost:18084/hahah/user/find/2?token=abc 此时可以正常访问。")]),t._v(" "),n("p",[n("img",{staticClass:"lazy",attrs:{alt:"images","data-src":s(1682),loading:"lazy"}})]),t._v(" "),n("h6",{attrs:{id:"_2-2-5-3-2-局部过滤器定义"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-5-3-2-局部过滤器定义"}},[t._v("#")]),t._v(" 2.2.5.3.2 局部过滤器定义")]),t._v(" "),n("p",[t._v("自定义局部过滤器，该过滤器在控制台输出配置文件中指定名称的请求参数及参数的值")]),t._v(" "),n("p",[t._v("实现步骤：")]),t._v(" "),n("ol",[n("li",[t._v("在gateway-service中编写MyParamGatewayFilterFactory类 继承AbstractGatewayFilterFactory类")]),t._v(" "),n("li",[t._v("实现业务代码：循环请求参数中是否包含name，如果包含则输出参数值")]),t._v(" "),n("li",[t._v("修改配置文件")]),t._v(" "),n("li",[t._v("访问请求测试，带name参数\n局部过滤器作用范围：该局部过滤器在哪个id下配置，则该局部过滤器只针对该id的路由规则有效。")])]),t._v(" "),n("p",[t._v("实现过程：")]),t._v(" "),n("p",[t._v("在gateway_service中编写MyParamGatewayFilterFactory类")]),t._v(" "),n("div",{staticClass:"language-java extra-class"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("package")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("com"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("atguigu"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("filter")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("org"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("springframework"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cloud"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("gateway"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("filter"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")])]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("GatewayFilter")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("org"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("springframework"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cloud"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("gateway"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("filter"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")])]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("GatewayFilterChain")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("org"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("springframework"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cloud"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("gateway"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("filter"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("factory"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")])]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("AbstractGatewayFilterFactory")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("org"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("springframework"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("stereotype"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")])]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Component")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("org"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("springframework"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("web"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("server"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")])]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ServerWebExchange")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("reactor"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("core"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("publisher"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")])]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Mono")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n * MyParamGatewayFilterFactory\n *\n * @Author: 马伟奇\n * @CreateTime: 2020-03-22\n * @Description:\n */")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Component")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("MyParamGatewayFilterFactory")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("extends")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("AbstractGatewayFilterFactory")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n     * 拦截当前id对应的请求\n     * @param config\n     * @return\n     */")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Override")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("GatewayFilter")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("apply")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Object")]),t._v(" config"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("GatewayFilter")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Override")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Mono")]),n("span",{pre:!0,attrs:{class:"token generics"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Void")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("filter")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ServerWebExchange")]),t._v(" exchange"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("GatewayFilterChain")]),t._v(" chain"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("System")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("out"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("println")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"局部拦截器"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" chain"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("filter")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("exchange"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/***\n     * 构造函数\n     */")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("MyParamGatewayFilterFactory")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("super")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("MyParamGatewayFilterFactory"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Config")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n\n\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/****\n     * 在该类执行初始化后，可以在这里执行相关初始化操作\n     */")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Config")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("p",[t._v("修改application.yml配置文件")]),t._v(" "),n("p",[n("img",{staticClass:"lazy",attrs:{alt:"images","data-src":s(1683),loading:"lazy"}})]),t._v(" "),n("p",[t._v("测试访问，访问http://localhost:18084/hahah/user/find/2?token=aaa会输出。")]),t._v(" "),n("p",[n("img",{staticClass:"lazy",attrs:{alt:"images","data-src":s(1684),loading:"lazy"}})]),t._v(" "),n("h4",{attrs:{id:"_2-2-6-微服务架构加入gateway后"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-6-微服务架构加入gateway后"}},[t._v("#")]),t._v(" 2.2.6 微服务架构加入Gateway后")]),t._v(" "),n("p",[t._v("![SpringCloud微服务架构–加入Gateway后 (1)](./images\\SpringCloud微服务架构–加入Gateway后 (1).jpg)")]),t._v(" "),n("p",[t._v("不管是来自客户端的请求，还是服务内部调用。一切对服务的请求都可经过网关。")]),t._v(" "),n("p",[t._v("网关实现鉴权、动态路由等等操作。")]),t._v(" "),n("p",[t._v("Gateway就是我们服务的统一入口")]),t._v(" "),n("h3",{attrs:{id:"_2-3-小结"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-小结"}},[t._v("#")]),t._v(" 2.3 小结")]),t._v(" "),n("p",[t._v("网关的作用")]),t._v(" "),n("p",[t._v("properties")]),t._v(" "),n("p",[t._v("1.为微服务架构提供一种简单有效统一的API路由管理方式\n2.可以在网关中实现微服务鉴权、安全控制、请求监控、限流\n会配置动态路由\nproperties\n使用lb配置，能根据服务名字动态请求。\n会配置过滤器\nproperties\n默认过滤器：default-filters:\n能自定义全局过滤器\nproperties\n编写过滤器类，实现GlobalFilter和Ordered，在filter方法中实现过滤。")]),t._v(" "),n("h2",{attrs:{id:"_3-配置中心"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-配置中心"}},[t._v("#")]),t._v(" 3 配置中心")]),t._v(" "),n("p",[t._v("参考阿里讲义")])])}),[],!1,null,null,null);a.default=e.exports},424:function(t,a,s){t.exports=s.p+"assets/img/83.f6568bf6.png"}}]);