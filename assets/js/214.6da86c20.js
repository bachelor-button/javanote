(window.webpackJsonp=window.webpackJsonp||[]).push([[214],{2478:function(e,v,_){"use strict";_.r(v);var s=_(21),t=Object(s.a)({},(function(){var e=this,v=e.$createElement,_=e._self._c||v;return _("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[_("ol",[_("li",[e._v("ç®€è¿°")])]),e._v(" "),_("p",[e._v("Redisä¸ºä¸€ä¸ªè¿è¡Œåœ¨å†…å­˜ä¸­çš„æ•°æ®ç»“æ„æœåŠ¡å™¨ï¼ˆdata structures serverï¼‰ã€‚Redisä½¿ç”¨çš„æ˜¯å•è¿›\nç¨‹ï¼ˆé™¤æŒä¹…åŒ–æ—¶ï¼‰ï¼Œæ‰€ä»¥åœ¨é…ç½®æ—¶ï¼Œä¸€ä¸ªå®ä¾‹åªä¼šç”¨åˆ°ä¸€ä¸ªCPUã€‚æœ¬æ‰‹å†Œåˆ†ä¸ºä¸‰éƒ¨åˆ†ï¼Œç¬¬ä¸€\néƒ¨åˆ†ä»å¼€å‘è§’åº¦ä»‹ç»äº†rediså¼€å‘ä¸­ä½¿ç”¨APIã€åœºæ™¯å’Œç”Ÿäº§è®¾è®¡è§„èŒƒæœ€ä½³å®è·µï¼Œç¬¬äºŒéƒ¨åˆ†ä»è¿ç»´\nè§’åº¦ä»‹ç»äº†å¦‚ä½•è¿ç»´redisï¼Œå…¶é—´çš„å¸¸è§æ“ä½œå’Œæœ€ä½³å®è·µç­‰,ç¬¬ä¸‰éƒ¨åˆ†æ˜¯ä»é«˜å¯ç”¨å’Œé›†ç¾¤æ–¹é¢ä»‹\nç»äº†redisç›¸å…³çš„é›†ç¾¤æ¶æ„ã€æ­å»ºå’Œæµ‹è¯•ã€‚")]),e._v(" "),_("p",[e._v("13")]),e._v(" "),_("p",[e._v("æ•°æ®æ“ä½œ")]),e._v(" "),_("ol",{attrs:{start:"2"}},[_("li",[e._v("æ•°æ®æ“ä½œ")])]),e._v(" "),_("p",[e._v("ç†Ÿæ‚‰æ¯ä¸ªæ•°æ®æ“ä½œå‰ä¸€å®šè¦æ˜ç™½æ¯ä¸ªæ“ä½œéƒ½æ˜¯ä»£ä»·ï¼Œä»¥æ—¶é—´å¤æ‚åº¦å’Œå¯¹åº”æŸ¥è¯¢é›†æˆ–è€…ç»“æœé›†\nå¤§å°ä¸ºè¡¡é‡ã€‚æ—¶é—´å¤æ‚åº¦æ”¶æ•›çŠ¶å†µå¦‚ä¸‹ï¼š")]),e._v(" "),_("p",[e._v("14")]),e._v(" "),_("p",[e._v("keyæ“ä½œ")]),e._v(" "),_("p",[e._v("2.1. keyæ“ä½œ")]),e._v(" "),_("p",[e._v("redis çš„keyæ“ä½œæ˜¯æ¶‰åŠèŒƒå›´æœ€å¹¿çš„æ“ä½œ ã€‚")]),e._v(" "),_("p",[e._v("15")]),e._v(" "),_("p",[e._v("åˆ—å‡ºkey")]),e._v(" "),_("p",[e._v("2.1.1 åˆ—å‡ºkey")]),e._v(" "),_("p",[e._v("keys "),_("em",[e._v("user")]),e._v("\nkeys *")]),e._v(" "),_("p",[e._v("æœ‰3ä¸ªé€šé…ç¬¦ *, ? ,[]")]),e._v(" "),_("p",[e._v("*: é€šé…ä»»æ„å¤šä¸ªå­—ç¬¦")]),e._v(" "),_("p",[e._v("?: é€šé…å•ä¸ªå­—ç¬¦")]),e._v(" "),_("p",[e._v("[]: é€šé…æ‹¬å·å†…çš„æŸ1ä¸ªå­—ç¬¦")]),e._v(" "),_("p",[e._v("æ³¨ï¼šç”Ÿäº§å·²ç»ç¦æ­¢ã€‚æ›´å®‰å…¨çš„åšæ³•æ˜¯é‡‡ç”¨scanï¼ŒåŸç†å’Œæ“ä½œå¦‚ä¸‹ï¼š")]),e._v(" "),_("p",[e._v("é’ˆå¯¹Keysçš„æ”¹è¿›ï¼Œæ”¯æŒåˆ†é¡µæŸ¥è¯¢Keyã€‚åœ¨è¿­ä»£è¿‡ç¨‹ä¸­ï¼ŒKeysæœ‰å¢åˆ æ—¶ä¸ä¼šè¦é”å®šå†™æ“\nä½œï¼Œæ•°æ®é›†å®Œæ•´åº¦ä¸åšä»»ä½•ä¿è¯ï¼ŒåŒä¸€æ¡keyå¯èƒ½ä¼šè¢«è¿”å›å¤šæ¬¡.")]),e._v(" "),_("p",[e._v("å¯¹äºå…¶ä»–å±é™©çš„å‘½ä»¤ï¼Œæ–°ç‰ˆæœ¬ä¹Ÿè¿›è¡Œäº†æ›¿ä»£ï¼š")]),e._v(" "),_("p",[e._v("16")]),e._v(" "),_("p",[e._v("åˆ—å‡ºkey")]),e._v(" "),_("p",[e._v("redis-cliä¸‹çš„æ‰«æ:")]),e._v(" "),_("p",[e._v("redis-cli --scan --pattern 'chenqun_*'")]),e._v(" "),_("p",[e._v("è¿™æ˜¯ç”¨scanå‘½ä»¤æ‰«æredisä¸­çš„keyï¼Œ--patterné€‰é¡¹æŒ‡å®šæ‰«æçš„keyçš„patternã€‚ç›¸æ¯”keys pattern")]),e._v(" "),_("p",[e._v("æ¨¡å¼,ä¸ä¼šé•¿æ—¶é—´é˜»å¡redisè€Œå¯¼è‡´å…¶ä»–å®¢æˆ·ç«¯çš„å‘½ä»¤è¯·æ±‚ä¸€ç›´å¤„äºé˜»å¡çŠ¶æ€ã€‚")]),e._v(" "),_("p",[e._v("æœ¬é¡µä¸­é‡‡ç”¨äº†å°è±¡å­¦é™¢çš„ä¸¤å¼ ç‰‡å­ï¼Œç‰ˆæƒå½’ http://www.chinahadoop.cn/ æ‰€æœ‰")]),e._v(" "),_("p",[e._v("17")]),e._v(" "),_("p",[e._v("æµ‹è¯•æŒ‡å®škeyæ˜¯å¦å­˜åœ¨")]),e._v(" "),_("p",[e._v("2.1.2 æµ‹è¯•æŒ‡å®škeyæ˜¯å¦å­˜åœ¨")]),e._v(" "),_("p",[e._v("exists key")]),e._v(" "),_("p",[e._v("è¿”å›1è¡¨ç¤ºå­˜åœ¨ï¼Œ0ä¸å­˜åœ¨")]),e._v(" "),_("p",[e._v("18")]),e._v(" "),_("p",[e._v("åˆ é™¤ç»™å®škey")]),e._v(" "),_("p",[e._v("2.1.3 åˆ é™¤ç»™å®škey")]),e._v(" "),_("p",[e._v("del key1 key2   keyN")]),e._v(" "),_("p",[e._v("è¿”å›æˆåŠŸåˆ é™¤çš„keyçš„ä¸ªæ•°")]),e._v(" "),_("p",[e._v("19")]),e._v(" "),_("p",[e._v("è¿”å›ç»™å®škeyçš„valueç±»å‹")]),e._v(" "),_("p",[e._v("2.1.4 è¿”å›ç»™å®škeyçš„valueç±»å‹")]),e._v(" "),_("p",[e._v("type key")]),e._v(" "),_("p",[e._v("è¿”å› none è¡¨ç¤ºä¸å­˜åœ¨keyã€‚stringå­—ç¬¦ç±»å‹ï¼Œlist é“¾è¡¨ç±»å‹ set æ— åºé›†åˆç±»å‹...")]),e._v(" "),_("p",[e._v("20")]),e._v(" "),_("p",[e._v("è¿”å›ä»å½“å‰æ•°æ®åº“ä¸­éšæœºé€‰æ‹©çš„ä¸€ä¸ªkey")]),e._v(" "),_("p",[e._v("2.1.5 è¿”å›ä»å½“å‰æ•°æ®åº“ä¸­éšæœºé€‰æ‹©çš„ä¸€ä¸ªkey")]),e._v(" "),_("p",[e._v("randomkey")]),e._v(" "),_("p",[e._v("å¦‚æœå½“å‰æ•°æ®åº“æ˜¯ç©ºçš„ï¼Œè¿”å›ç©ºä¸²")]),e._v(" "),_("p",[e._v("21")]),e._v(" "),_("p",[e._v("åŸå­çš„é‡å‘½åä¸€ä¸ªkey")]),e._v(" "),_("p",[e._v("2.1.6 åŸå­çš„é‡å‘½åä¸€ä¸ªkey")]),e._v(" "),_("p",[e._v("rename oldkey newkey")]),e._v(" "),_("p",[e._v("å¦‚æœnewkeyå­˜åœ¨ï¼Œå°†ä¼šè¢«è¦†ç›–ï¼Œè¿”å›1è¡¨ç¤ºæˆåŠŸï¼Œ0å¤±è´¥ã€‚å¯èƒ½æ˜¯oldkeyä¸å­˜åœ¨æˆ–è€…å’Œnewkey\nç›¸åŒ")]),e._v(" "),_("p",[e._v("renamenx oldkey newkey")]),e._v(" "),_("p",[e._v("åŒä¸Šï¼Œä½†æ˜¯å¦‚æœnewkeyå­˜åœ¨è¿”å›å¤±è´¥")]),e._v(" "),_("p",[e._v("22")]),e._v(" "),_("p",[e._v("Keyçš„è¶…æ—¶è®¾ç½®å¤„ç†")]),e._v(" "),_("p",[e._v("2.1.7 Keyçš„è¶…æ—¶è®¾ç½®å¤„ç†")]),e._v(" "),_("p",[e._v("expire key seconds")]),e._v(" "),_("p",[e._v("å•ä½æ˜¯ç§’ã€‚è¿”å›1æˆåŠŸï¼Œ0è¡¨ç¤ºkeyå·²ç»è®¾ç½®è¿‡è¿‡æœŸæ—¶é—´æˆ–è€…ä¸å­˜åœ¨ã€‚ å¦‚æœæƒ³æ¶ˆé™¤è¶…æ—¶åˆ™ä½¿ç”¨")]),e._v(" "),_("p",[e._v("persist keyã€‚å¦‚æœå¸Œæœ›é‡‡ç”¨ç»å¯¹è¶…æ—¶ï¼Œåˆ™ä½¿ç”¨expireatå‘½ä»¤ã€‚")]),e._v(" "),_("p",[e._v("ttl key")]),e._v(" "),_("p",[e._v("è¿”å›è®¾ç½®è¿‡è¿‡æœŸæ—¶é—´çš„keyçš„å‰©ä½™è¿‡æœŸç§’æ•° -1è¡¨ç¤ºæ²¡æœ‰è®¾ç½®è¿‡è¿‡æœŸæ—¶é—´ï¼Œå¯¹äºä¸å­˜åœ¨çš„key,è¿”\nå›-2ã€‚")]),e._v(" "),_("p",[e._v("pexpire key æ¯«ç§’æ•°")]),e._v(" "),_("p",[e._v("è®¾ç½®ç”Ÿå‘½å‘¨æœŸã€‚")]),e._v(" "),_("p",[e._v("pttl key")]),e._v(" "),_("p",[e._v("ä»¥æ¯«ç§’è¿”å›ç”Ÿå‘½å‘¨æœŸã€‚")]),e._v(" "),_("p",[e._v("æ³¨æ„ï¼š")]),e._v(" "),_("p",[e._v("å½“clientä¸»åŠ¨è®¿é—®keyä¼šå…ˆå¯¹keyè¿›è¡Œè¶…æ—¶åˆ¤æ–­ï¼Œè¿‡æ—¶çš„keyä¼š åˆ»åˆ é™¤ã€‚")]),e._v(" "),_("p",[e._v("å¦‚æœclienæ°¸è¿œéƒ½ä¸å†geté‚£æ¡keyå‘¢ï¼Ÿ å®ƒä¼šåœ¨Masterçš„åå°ï¼Œæ¯ç§’10æ¬¡çš„æ‰§è¡Œå¦‚ä¸‹æ“ä½œï¼š\néšæœºé€‰å–100ä¸ªkeyæ ¡éªŒæ˜¯å¦è¿‡æœŸï¼Œå¦‚æœæœ‰25ä¸ªä»¥ä¸Šçš„keyè¿‡æœŸäº†ï¼Œ åˆ»é¢å¤–éšæœºé€‰å–ä¸‹\n100ä¸ªkey(ä¸è®¡ç®—åœ¨10æ¬¡ä¹‹å†…)ã€‚å¯è§ï¼Œå¦‚æœè¿‡æœŸçš„keyä¸å¤šï¼Œå®ƒæœ€å¤šæ¯ç§’å›æ”¶200æ¡å·¦\nå³ï¼Œå¦‚æœæœ‰è¶…è¿‡25%çš„keyè¿‡æœŸäº†ï¼Œå®ƒå°±ä¼šåšå¾—æ›´å¤šï¼Œä½†åªè¦keyä¸è¢«ä¸»åŠ¨getï¼Œå®ƒå ç”¨çš„\nå†…å­˜ä»€ä¹ˆæ—¶å€™æœ€ç»ˆè¢«æ¸…ç†æ‰åªæœ‰å¤©çŸ¥é“ã€‚")]),e._v(" "),_("p",[e._v("åœ¨ä¸»ä»å¤åˆ¶ç¯å¢ƒä¸­ï¼Œç”±äºä¸Šè¿°åŸå› å­˜åœ¨å·²ç»è¿‡æœŸä½†æ˜¯æ²¡æœ‰åˆ é™¤çš„keyï¼Œåœ¨ä¸»snapshotæ—¶å¹¶\nä¸åŒ…å«è¿™äº›keyï¼Œå› æ­¤åœ¨slaveç¯å¢ƒä¸­æˆ‘ä»¬å¾€å¾€çœ‹åˆ°dbsizeè¾ƒmasteræ˜¯æ›´å°çš„ã€‚")]),e._v(" "),_("p",[e._v("23")]),e._v(" "),_("p",[e._v("Keyçš„è¶…æ—¶è®¾ç½®å¤„ç†")]),e._v(" "),_("p",[e._v("24")]),e._v(" "),_("p",[e._v("å­—ç¬¦ä¸²æ“ä½œ")]),e._v(" "),_("p",[e._v("æœ€å¤§å­—ç¬¦ä¸²ä¸º512Mï¼Œä½†æ˜¯å¤§å­—ç¬¦ä¸²éå¸¸ä¸å»ºè®®ã€‚")]),e._v(" "),_("p",[e._v("25")]),e._v(" "),_("p",[e._v("è®¾ç½®keyå¯¹åº”çš„å€¼ä¸ºstringç±»å‹çš„value")]),e._v(" "),_("p",[e._v("2.2.1 è®¾ç½®keyå¯¹åº”çš„å€¼ä¸ºstringç±»å‹çš„value")]),e._v(" "),_("p",[e._v("set key value [ex ç§’æ•°] / [px æ¯«ç§’æ•°] [nx] /[xx]")]),e._v(" "),_("p",[e._v("è¿”å›1è¡¨ç¤ºæˆåŠŸï¼Œ0å¤±è´¥")]),e._v(" "),_("p",[e._v("æ³¨: å¦‚æœex,pxåŒæ—¶å†™,ä»¥åé¢çš„æœ‰æ•ˆæœŸä¸ºå‡†")]),e._v(" "),_("p",[e._v("setnx key value")]),e._v(" "),_("p",[e._v("ä»…å½“keyä¸å­˜åœ¨æ—¶æ‰Setï¼Œå¦‚æœkeyå·²ç»å­˜åœ¨ï¼Œè¿”å›0 ã€‚nx æ˜¯not existçš„æ„æ€ã€‚")]),e._v(" "),_("p",[e._v("åº”ç”¨åœºæ™¯ï¼šç”¨æ¥é€‰ä¸¾Masteræˆ–åšåˆ†å¸ƒå¼é”ï¼šæ‰€æœ‰Clientä¸æ–­å°è¯•ä½¿ç”¨SetNx master\nmyNameæŠ¢æ³¨Masterï¼ŒæˆåŠŸçš„é‚£ä½ä¸æ–­ä½¿ç”¨Expireåˆ·æ–°å®ƒçš„è¿‡æœŸæ—¶é—´ã€‚å¦‚æœMasterå€’æ‰\näº†keyå°±ä¼šå¤±æ•ˆï¼Œå‰©ä¸‹çš„èŠ‚ç‚¹åˆä¼šå‘ç”Ÿæ–°ä¸€è½®æŠ¢å¤ºã€‚")]),e._v(" "),_("p",[e._v("mset key1 value1 ... keyN valueN")]),e._v(" "),_("p",[e._v("ä¸€æ¬¡è®¾ç½®å¤šä¸ªkeyçš„å€¼ï¼ŒæˆåŠŸè¿”å›1è¡¨ç¤ºæ‰€æœ‰çš„å€¼éƒ½è®¾ç½®äº†ï¼Œå¤±è´¥è¿”å›0è¡¨ç¤ºæ²¡æœ‰ä»»ä½•å€¼è¢«è®¾ç½®")]),e._v(" "),_("p",[e._v("msetnx key1 value1 ... keyN valueN")]),e._v(" "),_("p",[e._v("åŒä¸Šï¼Œä½†æ˜¯ä¸ä¼šè¦†ç›–å·²ç»å­˜åœ¨çš„key")]),e._v(" "),_("p",[e._v('SET å‘½ä»¤è¿˜æ”¯æŒå¯é€‰çš„ NX é€‰é¡¹å’Œ XX é€‰é¡¹ï¼Œä¾‹å¦‚ï¼šSET nx-str "this will fail" XX')]),e._v(" "),_("p",[e._v("å¦‚æœç»™å®šäº† NX é€‰é¡¹ï¼Œé‚£ä¹ˆå‘½ä»¤ä»…åœ¨é”® key ä¸å­˜åœ¨çš„æƒ…å†µä¸‹ï¼Œæ‰è¿›è¡Œè®¾ç½®æ“ä½œï¼›å¦‚æœé”®")]),e._v(" "),_("p",[e._v("key å·²ç»å­˜åœ¨ï¼Œé‚£ä¹ˆ SET ... NX å‘½ä»¤ä¸åšåŠ¨ä½œï¼ˆä¸ä¼šè¦†ç›–æ—§å€¼ï¼‰ã€‚")]),e._v(" "),_("p",[e._v("å¦‚æœç»™å®šäº† XX é€‰é¡¹ï¼Œé‚£ä¹ˆå‘½ä»¤ä»…åœ¨é”® key å·²ç»å­˜åœ¨çš„æƒ…å†µä¸‹ï¼Œæ‰è¿›è¡Œè®¾ç½®æ“ä½œï¼›å¦‚æœ\né”® key ä¸å­˜åœ¨ï¼Œé‚£ä¹ˆ SET ... XX å‘½ä»¤ä¸åšåŠ¨ä½œï¼ˆä¸€å®šä¼šè¦†ç›–æ—§å€¼ï¼‰ã€‚åœ¨ç»™å®š NX é€‰é¡¹å’Œ\nXX é€‰é¡¹çš„æƒ…å†µä¸‹ï¼ŒSET å‘½ä»¤åœ¨è®¾ç½®æˆåŠŸæ—¶è¿”å› OK ï¼Œè®¾ç½®å¤±è´¥æ—¶è¿”å› nil ã€‚")]),e._v(" "),_("p",[e._v("26")]),e._v(" "),_("p",[e._v("è®¾ç½®keyå¯¹åº”çš„å€¼ä¸ºstringç±»å‹çš„value")]),e._v(" "),_("p",[e._v("27")]),e._v(" "),_("p",[e._v("è·å–keyå¯¹åº”çš„stringå€¼")]),e._v(" "),_("p",[e._v("2.2.2 è·å–keyå¯¹åº”çš„stringå€¼")]),e._v(" "),_("p",[e._v("get key")]),e._v(" "),_("p",[e._v("å¦‚æœkeyä¸å­˜åœ¨è¿”å›nil")]),e._v(" "),_("p",[e._v("getset key value")]),e._v(" "),_("p",[e._v("åŸå­çš„è®¾ç½®keyçš„å€¼ï¼Œå¹¶è¿”å›keyçš„æ—§å€¼ã€‚å¦‚æœkeyä¸å­˜åœ¨è¿”å›nilã€‚åº”ç”¨åœºæ™¯ï¼šè®¾ç½®æ–°å€¼ï¼Œè¿”å›\næ—§å€¼ï¼Œé…åˆsetnxå¯å®ç°åˆ†å¸ƒå¼é”ã€‚")]),e._v(" "),_("p",[e._v("åˆ†å¸ƒå¼é”çš„æ€è·¯ï¼šæ³¨æ„è¯¥æ€è·¯è¦ä¿è¯å¤šå°ClientæœåŠ¡å™¨çš„NTPä¸€è‡´ã€‚")]),e._v(" "),_("ol",[_("li",[_("p",[e._v("C3å‘é€SETNX lock.foo æƒ³è¦è·å¾—é”ï¼Œç”±äºC0è¿˜æŒæœ‰é”ï¼Œæ‰€ä»¥Redisè¿”å›ç»™C3ä¸€ä¸ª0")])]),e._v(" "),_("li",[_("p",[e._v("C3å‘é€GET lock.foo ä»¥æ£€æŸ¥é”æ˜¯å¦è¶…æ—¶äº†ï¼Œå¦‚æœæ²¡è¶…æ—¶ï¼Œåˆ™ç­‰å¾…æˆ–é‡è¯•ã€‚")])]),e._v(" "),_("li",[_("p",[e._v("åä¹‹ï¼Œå¦‚æœå·²è¶…æ—¶ï¼ŒC3é€šè¿‡ä¸‹é¢çš„æ“ä½œæ¥å°è¯•è·å¾—é”ï¼š")])]),e._v(" "),_("li",[_("p",[e._v("GETSET lock.foo")])]),e._v(" "),_("li",[_("p",[e._v("é€šè¿‡GETSETï¼ŒC3æ‹¿åˆ°çš„æ—¶é—´æˆ³å¦‚æœä»ç„¶æ˜¯è¶…æ—¶çš„ï¼Œé‚£å°±è¯´æ˜ï¼ŒC3å¦‚æ„¿ä»¥å¿æ‹¿åˆ°é”äº†ã€‚")])]),e._v(" "),_("li",[_("p",[e._v("å¦‚æœåœ¨C3ä¹‹å‰ï¼Œæœ‰ä¸ªå«C4çš„å®¢æˆ·ç«¯æ¯”C3å¿«ä¸€æ­¥æ‰§è¡Œäº†ä¸Šé¢çš„æ“ä½œï¼Œé‚£ä¹ˆC3æ‹¿åˆ°çš„æ—¶é—´\næˆ³æ˜¯ä¸ªæœªè¶…æ—¶çš„å€¼ï¼Œè¿™æ—¶ï¼ŒC3æ²¡æœ‰å¦‚æœŸè·å¾—é”ï¼Œéœ€è¦å†æ¬¡ç­‰å¾…æˆ–é‡è¯•ã€‚ç•™æ„ä¸€ä¸‹ï¼Œå°½ç®¡\nC3æ²¡æ‹¿åˆ°é”ï¼Œä½†å®ƒæ”¹å†™äº†C4è®¾ç½®çš„é”çš„è¶…æ—¶å€¼ï¼Œä¸è¿‡è¿™ä¸€ç‚¹éå¸¸å¾®å°çš„è¯¯å·®å¸¦æ¥çš„å½±å“\nå¯ä»¥å¿½ç•¥ä¸è®¡ã€‚")])])]),e._v(" "),_("p",[e._v("ä¼ªä»£ç ä¸ºï¼š")]),e._v(" "),_("p",[e._v("28")]),e._v(" "),_("p",[e._v("è·å–keyå¯¹åº”çš„stringå€¼")]),e._v(" "),_("h1",{attrs:{id:"get-lock"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#get-lock"}},[e._v("#")]),e._v(" get lock")]),e._v(" "),_("p",[e._v("lock = 0")]),e._v(" "),_("p",[e._v("while lock != 1:")]),e._v(" "),_("p",[e._v("timestamp = current Unix time + lock timeout + 1\nlock = SETNX lock.foo timestamp")]),e._v(" "),_("p",[e._v("if lock == 1 or (now() > (GET lock.foo) and now() > (GETSET lock.foo timestamp)):\nbreak;")]),e._v(" "),_("p",[e._v("else:")]),e._v(" "),_("p",[e._v("sleep(10ms)")]),e._v(" "),_("h1",{attrs:{id:"do-your-job"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#do-your-job"}},[e._v("#")]),e._v(" do your job")]),e._v(" "),_("p",[e._v("do_job()")]),e._v(" "),_("h1",{attrs:{id:"release"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#release"}},[e._v("#")]),e._v(" release")]),e._v(" "),_("p",[e._v("if now() < GET lock.foo:")]),e._v(" "),_("p",[e._v("DEL lock.foo")]),e._v(" "),_("p",[e._v("ä»¥ä¸Šæ˜¯ä¸€ä¸ªå•Server çš„åˆ†å¸ƒå¼é”æ€è·¯ï¼Œå®˜ç½‘ä¸Šè¿˜ä»‹ç»äº†å¦ä¸€ä¸ªå•æœºä½¿ç”¨è¶…æ—¶æ–¹å¼è¿›è¡Œçš„æ€\nè·¯ï¼Œå’Œè¿™ä¸ªåŸºæœ¬ä¸€è‡´ï¼Œå¹¶ä¸”åœ¨åŒä¸€ä¸ªæ–‡æ¡£ä¸­ä»‹ç»äº†ä¸€ä¸ªåä¸ºredlockçš„å¤šServerå®¹é”™å‹åˆ†å¸ƒå¼\né”çš„ç®—æ³•ï¼ŒåŒæ—¶åˆ—å‡ºäº†å¤šè¯­è¨€çš„å®ç°ã€‚è¿™ä¸ªç®—æ³•çš„ä¼˜åŠ¿åœ¨äºå‡ ä¸ªæœåŠ¡å™¨å¯ä»¥æœ‰å°‘é‡çš„æ—¶é—´\nå·®ï¼Œä¸è¦æ±‚ä¸¥æ ¼æ—¶é—´ä¸€è‡´ã€‚")]),e._v(" "),_("p",[e._v("ä¹Ÿå¯ä»¥è®¾è®¡ä¸€ä¸ªæŒ‰å°æ—¶è®¡ç®—çš„è®¡æ•°å™¨ï¼Œå¯ä»¥ç”¨GetSetè·å–è®¡æ•°å¹¶é‡ç½®ä¸º0ã€‚")]),e._v(" "),_("p",[e._v("mget key1 key2 ... keyN")]),e._v(" "),_("p",[e._v("ä¸€æ¬¡è·å–å¤šä¸ªkeyçš„å€¼ï¼Œå¦‚æœå¯¹åº”keyä¸å­˜åœ¨ï¼Œåˆ™å¯¹åº”è¿”å›nil")]),e._v(" "),_("p",[e._v("29")]),e._v(" "),_("p",[e._v("å¢å‡æ“ä½œ")]),e._v(" "),_("p",[e._v("incr key")]),e._v(" "),_("p",[e._v("å¯¹keyçš„å€¼åšåŠ åŠ æ“ä½œ,å¹¶è¿”å›æ–°çš„å€¼ã€‚æ³¨æ„incrä¸€ä¸ªä¸æ˜¯intçš„valueä¼šè¿”å›é”™è¯¯ï¼Œincrä¸€ä¸ªä¸å­˜\nåœ¨çš„keyï¼Œåˆ™è®¾ç½®keyä¸º1ã€‚èŒƒå›´ä¸º64æœ‰ç¬¦")]),e._v(" "),_("p",[e._v("å·ï¼Œ-9223372036854775808~9223372036854775807ã€‚")]),e._v(" "),_("p",[e._v("decr key")]),e._v(" "),_("p",[e._v("åŒä¸Šï¼Œä½†æ˜¯åšçš„æ˜¯å‡å‡æ“ä½œï¼Œdecrä¸€ä¸ªä¸å­˜åœ¨keyï¼Œåˆ™è®¾ç½®keyä¸º-1")]),e._v(" "),_("p",[e._v("incrby key integer")]),e._v(" "),_("p",[e._v("åŒincrï¼ŒåŠ æŒ‡å®šå€¼ ï¼Œkeyä¸å­˜åœ¨æ—¶å€™ä¼šè®¾ç½®keyï¼Œå¹¶è®¤ä¸ºåŸæ¥çš„valueæ˜¯ 0")]),e._v(" "),_("p",[e._v("decrby key integer")]),e._v(" "),_("p",[e._v("åŒdecrï¼Œå‡æŒ‡å®šå€¼ã€‚decrbyå®Œå…¨æ˜¯ä¸ºäº†å¯è¯»æ€§ï¼Œæˆ‘ä»¬å®Œå…¨å¯ä»¥é€šè¿‡incrbyä¸€ä¸ªè´Ÿå€¼æ¥å®ç°åŒæ ·\næ•ˆæœï¼Œåä¹‹ä¸€æ ·ã€‚")]),e._v(" "),_("p",[e._v("incrbyfloat key floatnumber")]),e._v(" "),_("p",[e._v("é’ˆå¯¹æµ®ç‚¹æ•°")]),e._v(" "),_("p",[e._v("30")]),e._v(" "),_("p",[e._v("å¢å‡æ“ä½œ")]),e._v(" "),_("p",[e._v("å“ªäº›å¯ä»¥è¢«æ“ä½œå‘¢ï¼Ÿ")]),e._v(" "),_("p",[e._v("è¿™ä¸ªæ“ä½œçš„åº”ç”¨åœºæ™¯ï¼šè®¡æ•°å™¨")]),e._v(" "),_("p",[e._v("31")]),e._v(" "),_("p",[e._v("è¿½åŠ å­—ç¬¦ä¸²")]),e._v(" "),_("p",[e._v("2.2.4 è¿½åŠ å­—ç¬¦ä¸²")]),e._v(" "),_("p",[e._v("append key value")]),e._v(" "),_("p",[e._v("è¿”å›æ–°å­—ç¬¦ä¸²å€¼çš„é•¿åº¦ã€‚")]),e._v(" "),_("p",[e._v("32")]),e._v(" "),_("p",[e._v("æˆªå–å­—ç¬¦ä¸²")]),e._v(" "),_("p",[e._v("2.2.5 æˆªå–å­—ç¬¦ä¸²")]),e._v(" "),_("p",[e._v("substr key start end")]),e._v(" "),_("p",[e._v("è¿”å›æˆªå–è¿‡çš„keyçš„å­—ç¬¦ä¸²å€¼,æ³¨æ„å¹¶ä¸ä¿®æ”¹keyçš„å€¼ã€‚ä¸‹æ ‡æ˜¯ä»0å¼€å§‹çš„")]),e._v(" "),_("p",[e._v("33")]),e._v(" "),_("p",[e._v("æ”¹å†™å­—ç¬¦ä¸²")]),e._v(" "),_("p",[e._v("2.2.6 æ”¹å†™å­—ç¬¦ä¸²")]),e._v(" "),_("p",[e._v("SETRANGE key offset value")]),e._v(" "),_("p",[e._v("ç”¨value å‚æ•°è¦†å†™(overwrite)ç»™å®škey æ‰€å‚¨å­˜çš„å­—ç¬¦ä¸²å€¼ï¼Œä»åç§»é‡offset å¼€å§‹ã€‚ ä¸å­˜åœ¨çš„key\nå½“ä½œç©ºç™½å­—ç¬¦ä¸²å¤„ç†ã€‚å¯ä»¥ç”¨ä½œappendï¼š")]),e._v(" "),_("p",[e._v("æ³¨æ„: å¦‚æœåç§»é‡>å­—ç¬¦é•¿åº¦, è¯¥å­—ç¬¦è‡ªåŠ¨è¡¥0x00ï¼Œæ³¨æ„å®ƒä¸ä¼šæŠ¥é”™")]),e._v(" "),_("p",[e._v("34")]),e._v(" "),_("p",[e._v("è¿”å›å­å­—ç¬¦ä¸²")]),e._v(" "),_("p",[e._v("2.2.7 è¿”å›å­å­—ç¬¦ä¸²")]),e._v(" "),_("p",[e._v("GETRANGE key start end")]),e._v(" "),_("p",[e._v("è¿”å›key ä¸­å­—ç¬¦ä¸²å€¼çš„å­å­—ç¬¦ä¸²ï¼Œå­—ç¬¦ä¸²çš„æˆªå–èŒƒå›´ç”±start å’Œend ä¸¤ä¸ªåç§»é‡å†³å®š(åŒ…æ‹¬start\nå’Œend åœ¨å†…)ã€‚å¯ä»¥ä½¿ç”¨è´Ÿå€¼ï¼Œå­—ç¬¦ä¸²å³é¢ä¸‹æ ‡æ˜¯ä»-1å¼€å§‹çš„ã€‚")]),e._v(" "),_("p",[e._v("æ³¨æ„è¿”å›å€¼å¤„ç†ï¼š")]),e._v(" "),_("p",[e._v("1: start>=length, åˆ™è¿”å›ç©ºå­—ç¬¦ä¸² 2: stop>=length,åˆ™æˆªå–è‡³å­—ç¬¦ç»“å°¾ 3: å¦‚æœstart æ‰€å¤„ä½ç½®åœ¨")]),e._v(" "),_("p",[e._v("stopå³è¾¹, è¿”å›ç©ºå­—ç¬¦ä¸²")]),e._v(" "),_("p",[e._v("35")]),e._v(" "),_("p",[e._v("ä¸­æ–‡å­—ç¬¦ä¸²å¤„ç†")]),e._v(" "),_("p",[e._v("36")]),e._v(" "),_("p",[e._v("å–æŒ‡å®škeyçš„valueå€¼çš„é•¿åº¦")]),e._v(" "),_("p",[e._v("2.2.9 å–æŒ‡å®škeyçš„valueå€¼çš„é•¿åº¦")]),e._v(" "),_("p",[e._v("strlen")]),e._v(" "),_("p",[e._v("37")]),e._v(" "),_("p",[e._v("ä½æ“ä½œ")]),e._v(" "),_("p",[e._v("2.2.10 ä½æ“ä½œ")]),e._v(" "),_("p",[e._v("æ³¨æ„ï¼šä½æ“ä½œä¸­çš„ä½ç½®æ˜¯åè¿‡æ¥çš„ï¼Œoffsetè¿‡å¤§,åˆ™ä¼šåœ¨ä¸­é—´å¡«å……0ï¼Œæ¯”å¦‚ SETBIT bit 0 1ï¼Œæ­¤\næ—¶bitä¸º10000000ï¼Œæ­¤æ—¶å†è¿›è¡ŒSETBIT bit 7 1ï¼Œæ­¤æ—¶bitä¸º10000001ã€‚offsetæœ€å¤§2^32-1ã€‚")]),e._v(" "),_("p",[e._v("GETBIT key offset / SETBIT key offset value")]),e._v(" "),_("p",[e._v("è®¾ç½®æŸä¸ªç´¢å¼•çš„ä½ä¸º0/1")]),e._v(" "),_("p",[e._v("bitcount")]),e._v(" "),_("p",[e._v("å¯¹ä½è¿›è¡Œç»Ÿè®¡")]),e._v(" "),_("p",[e._v("38")]),e._v(" "),_("p",[e._v("ä½æ“ä½œ")]),e._v(" "),_("p",[e._v("bitop")]),e._v(" "),_("p",[e._v("å¯¹1ä¸ªæˆ–å¤šä¸ªkeyå¯¹åº”çš„å€¼è¿›è¡ŒAND/OR/XOR/NOTæ“ä½œ\næ³¨æ„:")]),e._v(" "),_("p",[e._v("1.bitopæ“ä½œé¿å…é˜»å¡åº”å°½é‡ç§»åˆ°slaveä¸Šæ“ä½œ. 2.å¯¹äºNOTæ“ä½œ, keyä¸èƒ½å¤šä¸ª")]),e._v(" "),_("p",[e._v("39")]),e._v(" "),_("p",[e._v("åˆ—è¡¨æ“ä½œ")]),e._v(" "),_("p",[e._v("40")]),e._v(" "),_("p",[e._v("æ·»åŠ å…ƒç´ ")]),e._v(" "),_("p",[e._v("2.3.1 æ·»åŠ å…ƒç´ ")]),e._v(" "),_("p",[e._v("lpush key string")]),e._v(" "),_("p",[e._v("åœ¨keyå¯¹åº”listçš„å¤´éƒ¨æ·»åŠ å­—ç¬¦ä¸²å…ƒç´ ï¼Œè¿”å›1è¡¨ç¤ºæˆåŠŸï¼Œ0è¡¨ç¤ºkeyå­˜åœ¨ä¸”ä¸æ˜¯listç±»å‹ã€‚æ³¨æ„ï¼š\næ±Ÿæ¹–è§„çŸ©ä¸€èˆ¬ä»å·¦ç«¯Pushï¼Œå³ç«¯Popï¼Œå³LPush/RPopã€‚")]),e._v(" "),_("p",[e._v("lpushx")]),e._v(" "),_("p",[e._v("ä¹Ÿæ˜¯å°†ä¸€ä¸ªæˆ–è€…å¤šä¸ªvalueæ’å…¥åˆ°keyåˆ—è¡¨çš„è¡¨å¤´ï¼Œä½†æ˜¯å¦‚æœkeyä¸å­˜åœ¨ï¼Œé‚£ä¹ˆå°±ä»€ä¹ˆéƒ½ä¸åœ¨ï¼Œ\nè¿”å›ä¸€ä¸ªfalseã€rpushxä¹Ÿæ˜¯åŒæ ·ã€‘")]),e._v(" "),_("p",[e._v("rpush key string")]),e._v(" "),_("p",[e._v("åŒä¸Šï¼Œåœ¨å°¾éƒ¨æ·»åŠ ")]),e._v(" "),_("p",[e._v("linsert")]),e._v(" "),_("p",[e._v("åœ¨keyå¯¹åº”listçš„ç‰¹å®šä½ç½®ä¹‹å‰æˆ–ä¹‹åæ·»åŠ å­—ç¬¦ä¸²å…ƒç´  , ä¾‹å¦‚")]),e._v(" "),_("p",[e._v('redis 127.0.0.1:6379linsert mylist3 before "world" "there"')]),e._v(" "),_("p",[e._v("41")]),e._v(" "),_("p",[e._v("æŸ¥çœ‹åˆ—è¡¨é•¿åº¦")]),e._v(" "),_("p",[e._v("2.3.2 æŸ¥çœ‹åˆ—è¡¨é•¿åº¦")]),e._v(" "),_("p",[e._v("llen key")]),e._v(" "),_("p",[e._v("è¿”å›keyå¯¹åº”listçš„é•¿åº¦ï¼Œkeyä¸å­˜åœ¨è¿”å›0,å¦‚æœkeyå¯¹åº”ç±»å‹ä¸æ˜¯listè¿”å›é”™è¯¯")]),e._v(" "),_("p",[e._v("42")]),e._v(" "),_("p",[e._v("æŸ¥çœ‹åˆ—è¡¨å…ƒç´ ")]),e._v(" "),_("p",[e._v("2.3.3 æŸ¥çœ‹å…ƒç´ ")]),e._v(" "),_("p",[e._v("lindex")]),e._v(" "),_("p",[e._v("è¿”å›åç§°ä¸ºkeyçš„listä¸­indexä½ç½®çš„å…ƒç´ ï¼Œä¾‹å¦‚ï¼š")]),e._v(" "),_("p",[e._v("redis 127.0.0.1:6379> lindex mylist5 0")]),e._v(" "),_("p",[e._v("43")]),e._v(" "),_("p",[e._v("æŸ¥çœ‹ä¸€æ®µåˆ—è¡¨")]),e._v(" "),_("p",[e._v("2.3.4 æŸ¥çœ‹ä¸€æ®µåˆ—è¡¨")]),e._v(" "),_("p",[e._v("lrange key start end")]),e._v(" "),_("p",[e._v("è¿”å›æŒ‡å®šåŒºé—´å†…çš„å…ƒç´ ï¼Œä¸‹æ ‡ä»0å¼€å§‹ï¼Œè´Ÿå€¼è¡¨ç¤ºä»åé¢è®¡ç®—ï¼Œ-1è¡¨ç¤ºå€’æ•°ç¬¬ä¸€ä¸ªå…ƒç´  ï¼Œkey\nä¸å­˜åœ¨è¿”å›ç©ºåˆ—è¡¨ã€‚ç‰¹æ®Šçš„ï¼Œ")]),e._v(" "),_("p",[e._v("lrange key 0 -1")]),e._v(" "),_("p",[e._v("è¿”å›æ‰€æœ‰æ•°æ®ã€‚")]),e._v(" "),_("p",[e._v("44")]),e._v(" "),_("p",[e._v("æˆªå–åˆ—è¡¨")]),e._v(" "),_("p",[e._v("2.3.5 æˆªå–list")]),e._v(" "),_("p",[e._v("ltrim key start end")]),e._v(" "),_("p",[e._v("ä¿ç•™æŒ‡å®šåŒºé—´å†…å…ƒç´ ï¼ŒæˆåŠŸè¿”å›1ï¼Œkeyä¸å­˜åœ¨è¿”å›é”™è¯¯ã€‚O(N)æ“ä½œã€‚\næ³¨æ„ï¼šNæ˜¯è¢«ç§»é™¤çš„å…ƒç´ çš„ä¸ªæ•°ï¼Œä¸æ˜¯åˆ—è¡¨é•¿åº¦ã€‚")]),e._v(" "),_("p",[e._v("45")]),e._v(" "),_("p",[e._v("åˆ é™¤å…ƒç´ ")]),e._v(" "),_("p",[e._v("2.3.6 åˆ é™¤å…ƒç´ ")]),e._v(" "),_("p",[e._v("lrem key count value")]),e._v(" "),_("p",[e._v("ä»keyå¯¹åº”listä¸­åˆ é™¤countä¸ªå’Œvalueç›¸åŒçš„å…ƒç´ ã€‚countä¸º0æ—¶å€™åˆ é™¤å…¨éƒ¨ï¼Œcountä¸ºæ­£ï¼Œåˆ™åˆ \né™¤åŒ¹é…countä¸ªå…ƒç´ ï¼Œå¦‚æœä¸ºè´Ÿæ•°ï¼Œåˆ™æ˜¯ä»å³ä¾§æ‰«æåˆ é™¤åŒ¹é…countä¸ªå…ƒç´ ã€‚å¤æ‚åº¦æ˜¯O(N)ï¼ŒN\næ˜¯Listé•¿åº¦ï¼Œå› ä¸ºListçš„å€¼ä¸å”¯ä¸€ï¼Œæ‰€ä»¥è¦éå†å…¨éƒ¨å…ƒç´ ï¼Œè€ŒSetåªè¦O(log(N))ã€‚")]),e._v(" "),_("p",[e._v("lpop key")]),e._v(" "),_("p",[e._v("ä»listçš„å¤´éƒ¨åˆ é™¤å…ƒç´ ï¼Œå¹¶è¿”å›åˆ é™¤å…ƒç´ ã€‚å¦‚æœkeyå¯¹åº”listä¸å­˜åœ¨æˆ–è€…æ˜¯ç©ºè¿”å›nilï¼Œå¦‚æœkeyå¯¹\nåº”å€¼ä¸æ˜¯listè¿”å›é”™è¯¯ã€‚")]),e._v(" "),_("p",[e._v("rpop")]),e._v(" "),_("p",[e._v("åŒä¸Šï¼Œä½†æ˜¯ä»å°¾éƒ¨åˆ é™¤ã€‚")]),e._v(" "),_("p",[e._v("46")]),e._v(" "),_("p",[e._v("è®¾ç½®listä¸­æŒ‡å®šä¸‹æ ‡çš„å…ƒç´ å€¼")]),e._v(" "),_("p",[e._v("2.3.7 è®¾ç½®listä¸­æŒ‡å®šä¸‹æ ‡çš„å…ƒç´ å€¼")]),e._v(" "),_("p",[e._v("lset key index value")]),e._v(" "),_("p",[e._v("æˆåŠŸè¿”å›1ï¼Œkeyæˆ–è€…ä¸‹æ ‡ä¸å­˜åœ¨è¿”å›é”™è¯¯")]),e._v(" "),_("p",[e._v("47")]),e._v(" "),_("p",[e._v("é˜»å¡é˜Ÿåˆ—")]),e._v(" "),_("p",[e._v("2.3.8 é˜»å¡é˜Ÿåˆ—")]),e._v(" "),_("p",[e._v("blpop key1...keyN timeout")]),e._v(" "),_("p",[e._v("ä»å·¦åˆ°å³æ‰«æè¿”å›å¯¹ç¬¬ä¸€ä¸ªéç©ºlistè¿›è¡Œlpopæ“ä½œå¹¶è¿”å›ï¼Œæ¯”å¦‚blpop list1 list2 list3 0 ,å¦‚æœlist\nä¸å­˜åœ¨list2,list3éƒ½æ˜¯éç©ºåˆ™å¯¹list2åšlpopå¹¶è¿”å›ä»list2ä¸­åˆ é™¤çš„å…ƒç´ ã€‚å¦‚æœæ‰€æœ‰çš„listéƒ½æ˜¯ç©ºæˆ–\nä¸å­˜åœ¨ï¼Œåˆ™ä¼šé˜»å¡timeoutç§’ï¼Œtimeoutä¸º0è¡¨ç¤ºä¸€ç›´é˜»å¡ã€‚å½“é˜»å¡æ—¶ï¼Œå¦‚æœæœ‰clientå¯¹\nkey1...keyNä¸­çš„ä»»æ„keyè¿›è¡Œpushæ“ä½œï¼Œåˆ™ç¬¬ä¸€åœ¨è¿™ä¸ªkeyä¸Šè¢«é˜»å¡çš„clientä¼š å³è¿”å›ï¼ˆè¿”å›\né”®å’Œå€¼ï¼‰ã€‚å¦‚æœè¶…æ—¶å‘ç”Ÿï¼Œåˆ™è¿”å›nilã€‚æœ‰ç‚¹åƒunixçš„selectæˆ–è€…pollã€‚")]),e._v(" "),_("p",[e._v("brpop")]),e._v(" "),_("p",[e._v("åŒblpopï¼Œä¸€ä¸ªæ˜¯ä»å¤´éƒ¨åˆ é™¤ä¸€ä¸ªæ˜¯ä»å°¾éƒ¨åˆ é™¤ã€‚")]),e._v(" "),_("p",[e._v("æ³¨æ„ï¼šä¸è¦é‡‡ç”¨å…¶ä½œä¸ºajaxçš„æœåŠ¡ç«¯æ¨é€ï¼Œå› ä¸ºè¿æ¥æœ‰é™ï¼Œé‡åˆ°é—®é¢˜è¿æ¥ç›´æ¥æ‰“æ»¡ã€‚")]),e._v(" "),_("p",[e._v('BLPOP/BRPOP çš„å…ˆåˆ°å…ˆæœåŠ¡åŸåˆ™ å¦‚æœæœ‰å¤šä¸ªå®¢æˆ·ç«¯åŒæ—¶å› ä¸ºæŸä¸ªåˆ—è¡¨è€Œè¢«é˜»å¡ï¼Œé‚£ä¹ˆå½“æœ‰\næ–°å€¼è¢«æ¨å…¥åˆ°è¿™ä¸ªåˆ—è¡¨æ—¶ï¼ŒæœåŠ¡å™¨ä¼šæŒ‰ç…§å…ˆåˆ°å…ˆæœåŠ¡ï¼ˆfirst in first serviceï¼‰åŸåˆ™ï¼Œä¼˜å…ˆå‘æœ€\næ—©è¢«é˜»å¡çš„å®¢æˆ·ç«¯è¿”å›æ–°å€¼ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œå‡è®¾åˆ—è¡¨ lst ä¸ºç©ºï¼Œé‚£ä¹ˆå½“å®¢æˆ·ç«¯ X æ‰§è¡Œå‘½ä»¤\nBLPOP lst timeout æ—¶ï¼Œå®¢æˆ·ç«¯ X å°†è¢«é˜»å¡ã€‚åœ¨æ­¤ä¹‹åï¼Œå®¢æˆ·ç«¯ Y ä¹Ÿæ‰§è¡Œå‘½ä»¤ BLPOP lst\ntimeout ï¼Œä¹Ÿå› æ­¤è¢«é˜»å¡ã€‚å¦‚æœè¿™æ—¶ï¼Œå®¢æˆ·ç«¯ Z æ‰§è¡Œå‘½ä»¤ RPUSH lst "hello" ï¼Œå°†å€¼ "hello" æ¨\nå…¥åˆ—è¡¨ lst ï¼Œé‚£ä¹ˆè¿™ä¸ª "hello" å°†è¢«è¿”å›ç»™å®¢æˆ·ç«¯ X ï¼Œè€Œä¸æ˜¯å®¢æˆ·ç«¯ Y ï¼Œå› ä¸ºå®¢æˆ·ç«¯ X çš„è¢«é˜»\nå¡æ—¶é—´è¦æ—©äºå®¢æˆ·ç«¯ Y çš„è¢«é˜»å¡æ—¶é—´ã€‚')]),e._v(" "),_("p",[e._v("rpoplpush/brpoplpushï¼šrpoplpush srckey destkey ä»srckeyå¯¹åº”listçš„å°¾éƒ¨ç§»é™¤å…ƒç´ å¹¶æ·»åŠ åˆ°\ndestkeyå¯¹åº”listçš„å¤´éƒ¨,æœ€åè¿”å›è¢«ç§»é™¤çš„å…ƒç´ å€¼ï¼Œæ•´ä¸ªæ“ä½œæ˜¯åŸå­çš„.å¦‚æœsrckeyæ˜¯ç©ºæˆ–è€…ä¸\nå­˜åœ¨è¿”å›nilï¼Œæ³¨æ„è¿™æ˜¯å”¯ä¸€ä¸€ä¸ªæ“ä½œä¸¤ä¸ªåˆ—è¡¨çš„æ“ä½œï¼Œç”¨äºä¸¤ä¸ªé˜Ÿåˆ—äº¤æ¢æ¶ˆæ¯ã€‚")]),e._v(" "),_("p",[e._v("åº”ç”¨åœºæ™¯ï¼štask + bak åŒé“¾è¡¨å®Œæˆå·¥ä½œä»»åŠ¡è½¬äº¤çš„å®‰å…¨é˜Ÿåˆ—ï¼Œä¿è¯åŸå­æ€§ã€‚ ä¸šåŠ¡é€»è¾‘: 1:\nRpoplpush task bak 2: æ¥æ”¶è¿”å›å€¼,å¹¶åšä¸šåŠ¡å¤„ç† 3: å®Œæˆæ—¶ç”¨LREMæ¶ˆæ‰ã€‚å¦‚ä¸æˆåŠŸæˆ–è€…å¦‚æœ\né›†ç¾¤ç®¡ç†(å¦‚zookeeper)å‘ç°workerå·²ç»æŒ‚æ‰,ä¸‹æ¬¡ä»bakè¡¨é‡Œå–ä»»åŠ¡")]),e._v(" "),_("p",[e._v('å¦ä¸€ä¸ªåº”ç”¨åœºæ™¯æ˜¯å¾ªç¯é“¾è¡¨ï¼š 127.0.0.1:6379> lrange list 0 -1 1) "c" 2) "b" 3) "a"')]),e._v(" "),_("p",[e._v('127.0.0.1:6379> rpoplpush list list "a" 127.0.0.1:6379> lrange list 0 -1 1) "a" 2) "c" 3) "b"')]),e._v(" "),_("p",[e._v("48")]),e._v(" "),_("p",[e._v("é›†åˆæ“ä½œ")]),e._v(" "),_("p",[e._v("49")]),e._v(" "),_("p",[e._v("æ·»åŠ å…ƒç´ ")]),e._v(" "),_("p",[e._v("2.4.1 æ·»åŠ å…ƒç´ ")]),e._v(" "),_("p",[e._v("sadd key member")]),e._v(" "),_("p",[e._v("æˆåŠŸè¿”å›1,å¦‚æœå…ƒç´ ä»¥åŠåœ¨é›†åˆä¸­è¿”å›0,keyå¯¹åº”çš„setä¸å­˜åœ¨è¿”å›é”™è¯¯")]),e._v(" "),_("p",[e._v("50")]),e._v(" "),_("p",[e._v("ç§»é™¤å…ƒç´ ")]),e._v(" "),_("p",[e._v("2.4.2 ç§»é™¤å…ƒç´ ")]),e._v(" "),_("p",[e._v("srem key member")]),e._v(" "),_("p",[e._v("æˆåŠŸè¿”å›1ï¼Œå¦‚æœmemberåœ¨é›†åˆä¸­ä¸å­˜åœ¨æˆ–è€…keyä¸å­˜åœ¨è¿”å›0ï¼Œå¦‚æœkeyå¯¹åº”çš„ä¸æ˜¯setç±»å‹\nçš„å€¼è¿”å›é”™è¯¯")]),e._v(" "),_("p",[e._v("51")]),e._v(" "),_("p",[e._v("åˆ é™¤å¹¶è¿”å›å…ƒç´ ")]),e._v(" "),_("p",[e._v("2.4.3 åˆ é™¤å¹¶è¿”å›å…ƒç´ ")]),e._v(" "),_("p",[e._v("spop key")]),e._v(" "),_("p",[e._v("å¦‚æœsetæ˜¯ç©ºæˆ–è€…keyä¸å­˜åœ¨è¿”å›nil")]),e._v(" "),_("p",[e._v("52")]),e._v(" "),_("p",[e._v("éšæœºè¿”å›ä¸€ä¸ªå…ƒç´ ")]),e._v(" "),_("p",[e._v("2.4.4 éšæœºè¿”å›ä¸€ä¸ªå…ƒç´ ")]),e._v(" "),_("p",[e._v("srandmember key")]),e._v(" "),_("p",[e._v("åŒspopï¼Œéšæœºå–setä¸­çš„ä¸€ä¸ªå…ƒç´ ï¼Œä½†æ˜¯ä¸åˆ é™¤å…ƒç´ ")]),e._v(" "),_("p",[e._v("53")]),e._v(" "),_("p",[e._v("é›†åˆé—´ç§»åŠ¨å…ƒç´ ")]),e._v(" "),_("p",[e._v("2.4.5 é›†åˆé—´ç§»åŠ¨å…ƒç´ ")]),e._v(" "),_("p",[e._v("smove srckey dstkey member")]),e._v(" "),_("p",[e._v("ä»srckeyå¯¹åº”setä¸­ç§»é™¤memberå¹¶æ·»åŠ åˆ°dstkeyå¯¹åº”setä¸­ï¼Œæ•´ä¸ªæ“ä½œæ˜¯åŸå­çš„ã€‚æˆåŠŸè¿”å›1,\nå¦‚æœmemberåœ¨srckeyä¸­ä¸å­˜åœ¨è¿”å›0ï¼Œå¦‚æœkeyä¸æ˜¯setç±»å‹è¿”å›é”™è¯¯")]),e._v(" "),_("p",[e._v("54")]),e._v(" "),_("p",[e._v("æŸ¥çœ‹é›†åˆå¤§å°")]),e._v(" "),_("p",[e._v("2.4.6 æŸ¥çœ‹é›†åˆå¤§å°")]),e._v(" "),_("p",[e._v("scard key")]),e._v(" "),_("p",[e._v("å¦‚æœsetæ˜¯ç©ºæˆ–è€…keyä¸å­˜åœ¨è¿”å›0")]),e._v(" "),_("p",[e._v("55")]),e._v(" "),_("p",[e._v("åˆ¤æ–­memberæ˜¯å¦åœ¨setä¸­")]),e._v(" "),_("p",[e._v("2.4.7 åˆ¤æ–­memberæ˜¯å¦åœ¨setä¸­")]),e._v(" "),_("p",[e._v("sismember key member")]),e._v(" "),_("p",[e._v("å­˜åœ¨è¿”å›1ï¼Œ0è¡¨ç¤ºä¸å­˜åœ¨æˆ–è€…keyä¸å­˜åœ¨")]),e._v(" "),_("p",[e._v("56")]),e._v(" "),_("p",[e._v("é›†åˆäº¤é›†")]),e._v(" "),_("p",[e._v("2.4.8 é›†åˆäº¤é›†")]),e._v(" "),_("p",[e._v("sinter key1 key2...keyN")]),e._v(" "),_("p",[e._v("è¿”å›æ‰€æœ‰ç»™å®škeyçš„äº¤é›†")]),e._v(" "),_("p",[e._v("sinterstore dstkey key1...keyN")]),e._v(" "),_("p",[e._v("åŒsinterï¼Œä½†æ˜¯ä¼šåŒæ—¶å°†äº¤é›†å­˜åˆ°dstkeyä¸‹")]),e._v(" "),_("p",[e._v("57")]),e._v(" "),_("p",[e._v("é›†åˆå¹¶é›†")]),e._v(" "),_("p",[e._v("2.4.9 é›†åˆå¹¶é›†")]),e._v(" "),_("p",[e._v("sunion key1 key2...keyN")]),e._v(" "),_("p",[e._v("è¿”å›æ‰€æœ‰ç»™å®škeyçš„å¹¶é›†")]),e._v(" "),_("p",[e._v("sunionstore dstkey key1...keyN")]),e._v(" "),_("p",[e._v("åŒsunionï¼Œå¹¶åŒæ—¶ä¿å­˜å¹¶é›†åˆ°dstkeyä¸‹")]),e._v(" "),_("p",[e._v("58")]),e._v(" "),_("p",[e._v("é›†åˆå·®é›†")]),e._v(" "),_("p",[e._v("2.4.10 é›†åˆå·®é›†")]),e._v(" "),_("p",[e._v("sdiff key1 key2...keyN")]),e._v(" "),_("p",[e._v("è¿”å›æ‰€æœ‰ç»™å®škeyçš„å·®é›†")]),e._v(" "),_("p",[e._v("sdiffstore dstkey key1...keyN")]),e._v(" "),_("p",[e._v("åŒsdiffï¼Œå¹¶åŒæ—¶ä¿å­˜å·®é›†åˆ°dstkeyä¸‹")]),e._v(" "),_("p",[e._v("59")]),e._v(" "),_("p",[e._v("è·å–æ‰€æœ‰å…ƒç´ ")]),e._v(" "),_("p",[e._v("2.4.11 è·å–æ‰€æœ‰å…ƒç´ ")]),e._v(" "),_("p",[e._v("smembers key")]),e._v(" "),_("p",[e._v("è¿”å›keyå¯¹åº”setçš„æ‰€æœ‰å…ƒç´ ï¼Œç»“æœæ˜¯æ— åºçš„ï¼Œé›†åˆå…ƒç´ å¾ˆå¤šæ—¶ä¼šé˜»å¡ï¼Œç”Ÿäº§ä¸Šç¦ç”¨ï¼")]),e._v(" "),_("p",[e._v("60")]),e._v(" "),_("p",[e._v("æœ‰åºé›†åˆæ“ä½œ")]),e._v(" "),_("p",[e._v("Sorted Setçš„å®ç°æ˜¯hash table(element->score, ç”¨äºå®ç°ZScoreåŠåˆ¤æ–­elementæ˜¯å¦åœ¨é›†åˆ\nå†…)ï¼Œå’Œskip list(score->element,æŒ‰scoreæ’åº)çš„æ··åˆä½“ã€‚ skip listæœ‰ç‚¹åƒå¹³è¡¡äºŒå‰æ ‘é‚£æ ·ï¼Œä¸\nåŒèŒƒå›´çš„scoreè¢«åˆ†æˆä¸€å±‚ä¸€å±‚ï¼Œæ¯å±‚æ˜¯ä¸€ä¸ªæŒ‰scoreæ’åºçš„é“¾è¡¨ã€‚")]),e._v(" "),_("p",[e._v("ZAdd/ZRemæ˜¯O(log(N))ï¼ŒZRangeByScore/ZRemRangeByScoreæ˜¯O(log(N)+M)ï¼ŒNæ˜¯Setå¤§\nå°ï¼ŒMæ˜¯ç»“æœ/æ“ä½œå…ƒç´ çš„ä¸ªæ•°ã€‚å¯è§ï¼ŒåŸæœ¬å¯èƒ½å¾ˆå¤§çš„Nè¢«å¾ˆå…³é”®çš„Logäº†ä¸€ä¸‹ï¼Œ1000ä¸‡å¤§å°\nçš„Setï¼Œå¤æ‚åº¦ä¹Ÿåªæ˜¯å‡ åä¸åˆ°ã€‚å½“ç„¶ï¼Œå¦‚æœä¸€æ¬¡å‘½ä¸­å¾ˆå¤šå…ƒç´ Må¾ˆå¤§é‚£è°ä¹Ÿæ²¡åŠæ³•äº†ã€‚")]),e._v(" "),_("p",[e._v("61")]),e._v(" "),_("p",[e._v("æ·»åŠ å…ƒç´ ")]),e._v(" "),_("p",[e._v("2.5.1 æ·»åŠ å…ƒç´ ")]),e._v(" "),_("p",[e._v("zadd key score member")]),e._v(" "),_("p",[e._v("æ·»åŠ å…ƒç´ åˆ°é›†åˆï¼Œå…ƒç´ åœ¨é›†åˆä¸­å­˜åœ¨åˆ™æ›´æ–°å¯¹åº”scoreã€‚")]),e._v(" "),_("p",[e._v("62")]),e._v(" "),_("p",[e._v("åˆ é™¤å…ƒç´ ")]),e._v(" "),_("p",[e._v("2.5.2 åˆ é™¤å…ƒç´ ")]),e._v(" "),_("p",[e._v("zrem key member")]),e._v(" "),_("p",[e._v("1è¡¨ç¤ºæˆåŠŸï¼Œå¦‚æœå…ƒç´ ä¸å­˜åœ¨è¿”å›0")]),e._v(" "),_("p",[e._v("zremrangebyrank key min max")]),e._v(" "),_("p",[e._v("åˆ é™¤é›†åˆä¸­æ’ååœ¨ç»™å®šåŒºé—´çš„å…ƒç´ ")]),e._v(" "),_("p",[e._v("zremrangebyscore key min max")]),e._v(" "),_("p",[e._v("åˆ é™¤é›†åˆä¸­scoreåœ¨ç»™å®šåŒºé—´çš„å…ƒç´ ")]),e._v(" "),_("p",[e._v("63")]),e._v(" "),_("p",[e._v("å¢åŠ score")]),e._v(" "),_("p",[e._v("2.5.3 å¢åŠ score")]),e._v(" "),_("p",[e._v("zincrby key incr member")]),e._v(" "),_("p",[e._v("å¢åŠ å¯¹åº”memberçš„scoreå€¼ï¼Œç„¶åç§»åŠ¨å…ƒç´ å¹¶ä¿æŒskip listä¿æŒæœ‰åºã€‚è¿”å›æ›´æ–°åçš„scoreå€¼ï¼Œ\nå¯ä»¥ä¸ºè´Ÿæ•°é€’å‡")]),e._v(" "),_("p",[e._v("64")]),e._v(" "),_("p",[e._v("è·å–æ’å")]),e._v(" "),_("p",[e._v("2.5.4 è·å–æ’å")]),e._v(" "),_("p",[e._v("zrank key member")]),e._v(" "),_("p",[e._v("è¿”å›æŒ‡å®šå…ƒç´ åœ¨é›†åˆä¸­çš„æ’åï¼ˆä¸‹æ ‡ï¼Œæ³¨æ„ä¸æ˜¯åˆ†æ•°ï¼‰,é›†åˆä¸­å…ƒç´ æ˜¯æŒ‰scoreä»å°åˆ°å¤§æ’åºçš„")]),e._v(" "),_("p",[e._v("zrevrank key member")]),e._v(" "),_("p",[e._v("åŒä¸Š,ä½†æ˜¯é›†åˆä¸­å…ƒç´ æ˜¯æŒ‰scoreä»å¤§åˆ°å°æ’åº")]),e._v(" "),_("p",[e._v("65")]),e._v(" "),_("p",[e._v("è·å–æ’è¡Œæ¦œ")]),e._v(" "),_("p",[e._v("2.5.5 è·å–æ’è¡Œæ¦œ")]),e._v(" "),_("p",[e._v("zrange key start end")]),e._v(" "),_("p",[e._v("ç±»ä¼¼lrangeæ“ä½œä»é›†åˆä¸­å»æŒ‡å®šåŒºé—´çš„å…ƒç´ ã€‚è¿”å›çš„æ˜¯æœ‰åºç»“æœ")]),e._v(" "),_("p",[e._v("zrevrange key start end åŒä¸Šï¼Œè¿”å›ç»“æœæ˜¯æŒ‰scoreé€†åºçš„,å¦‚æœéœ€è¦å¾—åˆ†åˆ™åŠ ä¸Šwithscores\næ³¨ï¼šindexä»startåˆ°endçš„æ‰€æœ‰å…ƒç´ ")]),e._v(" "),_("p",[e._v("66")]),e._v(" "),_("p",[e._v("è¿”å›ç»™å®šåˆ†æ•°åŒºé—´çš„å…ƒç´ ")]),e._v(" "),_("p",[e._v("2.5.6 è¿”å›ç»™å®šåˆ†æ•°åŒºé—´çš„å…ƒç´ ")]),e._v(" "),_("p",[e._v("zrangebyscore key min max")]),e._v(" "),_("p",[e._v("å¯ä»¥æŒ‡å®šinfä¸ºæ— ç©·")]),e._v(" "),_("p",[e._v("67")]),e._v(" "),_("p",[e._v("è¿”å›é›†åˆä¸­scoreåœ¨ç»™å®šåŒºé—´çš„æ•°é‡")]),e._v(" "),_("p",[e._v("2.5.7 è¿”å›é›†åˆä¸­scoreåœ¨ç»™å®šåŒºé—´çš„æ•°é‡")]),e._v(" "),_("p",[e._v("zcount key min max")]),e._v(" "),_("p",[e._v("68")]),e._v(" "),_("p",[e._v("è¿”å›é›†åˆä¸­å…ƒç´ ä¸ªæ•°")]),e._v(" "),_("p",[e._v("2.5.8 è¿”å›é›†åˆä¸­å…ƒç´ ä¸ªæ•°")]),e._v(" "),_("p",[e._v("zcard key")]),e._v(" "),_("p",[e._v("69")]),e._v(" "),_("p",[e._v("è¿”å›ç»™å®šå…ƒç´ å¯¹åº”çš„score")]),e._v(" "),_("p",[e._v("2.5.9 è¿”å›ç»™å®šå…ƒç´ å¯¹åº”çš„score")]),e._v(" "),_("p",[e._v("zscore key element")]),e._v(" "),_("p",[e._v("70")]),e._v(" "),_("p",[e._v("è¯„åˆ†çš„èšåˆ")]),e._v(" "),_("p",[e._v("2.5.10 è¯„åˆ†çš„èšåˆ")]),e._v(" "),_("p",[e._v("ZUNIONSTORE destination numkeys key [key ...] [WEIGHTS weight] [AGGREGATE SUM|MIN|MAX]")]),e._v(" "),_("p",[e._v("ä¾‹å¦‚ï¼š")]),e._v(" "),_("p",[e._v("127.0.0.1:6379> zrangebyscore votes -inf inf withscores")]),e._v(" "),_("ol",[_("li",[_("p",[e._v('"sina"')])]),e._v(" "),_("li",[_("p",[e._v('"1"')])]),e._v(" "),_("li",[_("p",[e._v('"google"')])]),e._v(" "),_("li",[_("p",[e._v('"5"')])]),e._v(" "),_("li",[_("p",[e._v('"baidu"')])]),e._v(" "),_("li",[_("p",[e._v('"10"')])])]),e._v(" "),_("p",[e._v("127.0.0.1:6379> zrangebyscore visits -inf inf withscores")]),e._v(" "),_("ol",[_("li",[_("p",[e._v('"baidu"')])]),e._v(" "),_("li",[_("p",[e._v('"1"')])]),e._v(" "),_("li",[_("p",[e._v('"google"')])]),e._v(" "),_("li",[_("p",[e._v('"5"')])]),e._v(" "),_("li",[_("p",[e._v('"sina"')])]),e._v(" "),_("li",[_("p",[e._v('"10"')])])]),e._v(" "),_("p",[e._v("127.0.0.1:6379> zunionstore award 2 visits votes weights 1 2 aggregate sum")]),e._v(" "),_("p",[e._v("(integer) 3")]),e._v(" "),_("p",[e._v("127.0.0.1:6379> zrangebyscore award -inf inf withscores")]),e._v(" "),_("ol",[_("li",[_("p",[e._v('"sina"')])]),e._v(" "),_("li",[_("p",[e._v('"12"')])]),e._v(" "),_("li",[_("p",[e._v('"google"')])]),e._v(" "),_("li",[_("p",[e._v('"15"')])]),e._v(" "),_("li",[_("p",[e._v('"baidu"')])]),e._v(" "),_("li",[_("p",[e._v('"21"')])])]),e._v(" "),_("p",[e._v("ä¸€ä¸ªå°æŠ€å·§æ˜¯å¦‚æœéœ€è¦å¯¹è¯„åˆ†è¿›è¡Œå€åŠ ï¼Œåˆ™ä½¿ç”¨å¦‚ä¸‹çš„æ–¹æ³•ï¼š")]),e._v(" "),_("p",[e._v("71")]),e._v(" "),_("p",[e._v("è¯„åˆ†çš„èšåˆ")]),e._v(" "),_("p",[e._v("127.0.0.1:6379>zrangebyscore visits -inf inf withscores")]),e._v(" "),_("ol",[_("li",[_("p",[e._v('"baidu"')])]),e._v(" "),_("li",[_("p",[e._v('"1"')])]),e._v(" "),_("li",[_("p",[e._v('"google"')])]),e._v(" "),_("li",[_("p",[e._v('"5"')])]),e._v(" "),_("li",[_("p",[e._v('"sina"')])]),e._v(" "),_("li",[_("p",[e._v('"10"')])])]),e._v(" "),_("p",[e._v("127.0.0.1:6379>zunionstore visits 1 visits weights 2")]),e._v(" "),_("p",[e._v("(integer) 3")]),e._v(" "),_("p",[e._v("127.0.0.1:6379>zrangebyscore visits -inf inf withscores")]),e._v(" "),_("ol",[_("li",[_("p",[e._v('"baidu"')])]),e._v(" "),_("li",[_("p",[e._v('"2"')])]),e._v(" "),_("li",[_("p",[e._v('"google"')])]),e._v(" "),_("li",[_("p",[e._v('"10"')])]),e._v(" "),_("li",[_("p",[e._v('"sina"')])]),e._v(" "),_("li",[_("p",[e._v('"20"')])])]),e._v(" "),_("p",[e._v("72")]),e._v(" "),_("p",[e._v("å“ˆå¸Œæ“ä½œ")]),e._v(" "),_("p",[e._v("åº•å±‚å®ç°æ˜¯hash tableï¼Œä¸€èˆ¬æ“ä½œå¤æ‚åº¦æ˜¯O(1)ï¼Œè¦åŒæ—¶æ“ä½œå¤šä¸ªfieldæ—¶å°±æ˜¯O(N)ï¼ŒNæ˜¯field")]),e._v(" "),_("p",[e._v("çš„æ•°é‡ã€‚åº”ç”¨åœºæ™¯ï¼šåœŸæ³•å»ºç´¢å¼•ã€‚æ¯”å¦‚Userå¯¹è±¡ï¼Œé™¤äº†idæœ‰æ—¶è¿˜è¦æŒ‰nameæ¥æŸ¥è¯¢ã€‚")]),e._v(" "),_("p",[e._v('å¯ä»¥æœ‰å¦‚ä¸‹çš„æ•°æ®è®°å½•: (String) user:101 -> {"id":101,"name":"calvin"...} (String) user:102 ->')]),e._v(" "),_("p",[e._v('{"id":102,"name":"kevin"...} (Hash) user:name:index-> "calvin"->101, "kevin" -> 102')]),e._v(" "),_("p",[e._v("73")]),e._v(" "),_("p",[e._v("è®¾ç½®hashå€¼")]),e._v(" "),_("p",[e._v("2.6.1 è®¾ç½®hashå€¼")]),e._v(" "),_("p",[e._v("hset key field value")]),e._v(" "),_("p",[e._v("è®¾ç½®hash fieldä¸ºæŒ‡å®šå€¼ï¼Œå¦‚æœkeyä¸å­˜åœ¨ï¼Œåˆ™å…ˆåˆ›å»ºã€‚")]),e._v(" "),_("p",[e._v("hsetnx")]),e._v(" "),_("p",[e._v("è®¾ç½®hash fieldä¸ºæŒ‡å®šå€¼ï¼Œå¦‚æœ key ä¸å­˜åœ¨ï¼Œåˆ™å…ˆåˆ›å»ºã€‚å¦‚æœ fieldå·²ç»å­˜åœ¨ï¼Œè¿”å›0ï¼Œnxæ˜¯not\nexistçš„æ„æ€ã€‚")]),e._v(" "),_("p",[e._v("74")]),e._v(" "),_("p",[e._v("è·å–hashå€¼")]),e._v(" "),_("p",[e._v("2.6.2 è·å–hashå€¼")]),e._v(" "),_("p",[e._v("hget key field")]),e._v(" "),_("p",[e._v("è·å–æŒ‡å®šçš„hash field")]),e._v(" "),_("p",[e._v("hmget key filed1   fieldN")]),e._v(" "),_("p",[e._v("è·å–å…¨éƒ¨æŒ‡å®šçš„hash filed")]),e._v(" "),_("p",[e._v("hmset key filed1 value1 ... filedN valueN")]),e._v(" "),_("p",[e._v("åŒæ—¶è®¾ç½®hashçš„å¤šä¸ªfield")]),e._v(" "),_("p",[e._v("75")]),e._v(" "),_("p",[e._v("é€’å¢æŸä¸€ä¸ªåŸŸçš„å€¼")]),e._v(" "),_("p",[e._v("2.6.3 é€’å¢æŸä¸€ä¸ªåŸŸçš„å€¼")]),e._v(" "),_("p",[e._v("hincrby key field integer")]),e._v(" "),_("p",[e._v("å°†æŒ‡å®šçš„hash filed åŠ ä¸Šç»™å®šå€¼")]),e._v(" "),_("p",[e._v("76")]),e._v(" "),_("p",[e._v("åˆ¤æ–­æŸä¸€ä¸ªåŸŸæ˜¯å¦å­˜åœ¨")]),e._v(" "),_("p",[e._v("2.6.4 åˆ¤æ–­æŸä¸€ä¸ªåŸŸæ˜¯å¦å­˜åœ¨")]),e._v(" "),_("p",[e._v("hexists key field")]),e._v(" "),_("p",[e._v("æµ‹è¯•æŒ‡å®šfieldæ˜¯å¦å­˜åœ¨")]),e._v(" "),_("p",[e._v("77")]),e._v(" "),_("p",[e._v("åˆ é™¤åŸŸ")]),e._v(" "),_("p",[e._v("2.6.5 åˆ é™¤åŸŸ")]),e._v(" "),_("p",[e._v("hdel key field")]),e._v(" "),_("p",[e._v("åˆ é™¤æŒ‡å®šçš„hash field")]),e._v(" "),_("p",[e._v("78")]),e._v(" "),_("p",[e._v("è·å–åŸŸçš„æ•°é‡")]),e._v(" "),_("p",[e._v("2.6.6 è·å–åŸŸçš„æ•°é‡")]),e._v(" "),_("p",[e._v("hlen key")]),e._v(" "),_("p",[e._v("è¿”å›æŒ‡å®šhashçš„fieldæ•°é‡")]),e._v(" "),_("p",[e._v("79")]),e._v(" "),_("p",[e._v("è·å–æ‰€æœ‰çš„åŸŸå")]),e._v(" "),_("p",[e._v("2.6.7 è·å–æ‰€æœ‰çš„åŸŸå")]),e._v(" "),_("p",[e._v("hkeys key")]),e._v(" "),_("p",[e._v("è¿”å›hashçš„æ‰€æœ‰field")]),e._v(" "),_("p",[e._v("80")]),e._v(" "),_("p",[e._v("è·å–æ‰€æœ‰åŸŸçš„å€¼")]),e._v(" "),_("p",[e._v("2.6.8 è·å–æ‰€æœ‰åŸŸçš„å€¼")]),e._v(" "),_("p",[e._v("hvals key")]),e._v(" "),_("p",[e._v("è¿”å›hashçš„æ‰€æœ‰value")]),e._v(" "),_("p",[e._v("81")]),e._v(" "),_("p",[e._v("è·å–æ‰€æœ‰åŸŸåå’Œå€¼")]),e._v(" "),_("p",[e._v("2.6.9 è·å–æ‰€æœ‰åŸŸåå’Œå€¼")]),e._v(" "),_("p",[e._v("hgetall")]),e._v(" "),_("p",[e._v("è¿”å›hashçš„æ‰€æœ‰filedå’Œvalue")]),e._v(" "),_("p",[e._v("82")]),e._v(" "),_("p",[e._v("HyperLogLogæ“ä½œ")]),e._v(" "),_("p",[e._v("2.7 HyperLogLogæ“ä½œ")]),e._v(" "),_("p",[e._v("HyperLogLogä¸»è¦è§£å†³å¤§æ•°æ®åº”ç”¨ä¸­çš„éç²¾ç¡®è®¡æ•°ï¼ˆå¯èƒ½å¤šä¹Ÿå¯èƒ½å°‘ï¼Œä½†æ˜¯ä¼šåœ¨ä¸€ä¸ªåˆç†çš„\nèŒƒå›´ï¼‰æ“ä½œï¼Œå®ƒå¯ä»¥æ¥å—å¤šä¸ªå…ƒç´ ä½œä¸ºè¾“å…¥ï¼Œå¹¶ç»™å‡ºè¾“å…¥å…ƒç´ çš„åŸºæ•°ä¼°ç®—å€¼ï¼ŒåŸºæ•°æŒ‡çš„æ˜¯é›†\nåˆä¸­ä¸åŒå…ƒç´ çš„æ•°é‡ã€‚æ¯”å¦‚ {'apple', 'banana', 'cherry', 'banana', 'apple'} çš„åŸºæ•°å°±æ˜¯ 3 ã€‚\nHyperLogLog çš„ä¼˜ç‚¹æ˜¯ï¼Œå³ä½¿è¾“å…¥å…ƒç´ çš„æ•°é‡æˆ–è€…ä½“ç§¯éå¸¸éå¸¸å¤§ï¼Œè®¡ç®—åŸºæ•°æ‰€éœ€çš„ç©ºé—´æ€»\næ˜¯å›ºå®šçš„ã€å¹¶ä¸”æ˜¯å¾ˆå°çš„ã€‚åœ¨ Redis é‡Œé¢ï¼Œæ¯ä¸ª HyperLogLog é”®åªéœ€è¦èŠ±è´¹ 12 KB å†…å­˜ï¼Œ\nå°±å¯ä»¥è®¡ç®—æ¥è¿‘ 2^64 ä¸ªä¸åŒå…ƒç´ çš„åŸºæ•°ã€‚è¿™å’Œè®¡ç®—åŸºæ•°æ—¶ï¼Œå…ƒç´ è¶Šå¤šè€—è´¹å†…å­˜å°±è¶Šå¤šçš„é›†åˆ\nå½¢æˆé²œæ˜å¯¹æ¯”ã€‚ä½†æ˜¯ï¼Œå› ä¸º HyperLogLog åªä¼šæ ¹æ®è¾“å…¥å…ƒç´ æ¥è®¡ç®—åŸºæ•°ï¼Œè€Œä¸ä¼šå‚¨å­˜è¾“å…¥å…ƒ\nç´ æœ¬èº«ï¼Œæ‰€ä»¥ HyperLogLog ä¸èƒ½åƒé›†åˆé‚£æ ·ï¼Œè¿”å›è¾“å…¥çš„å„ä¸ªå…ƒç´ ã€‚")]),e._v(" "),_("p",[e._v("å…³äºè¿™ä¸ªæ•°æ®ç±»å‹çš„è¯¯å·®ï¼šåœ¨ä¸€ä¸ªå¤§å°ä¸º12kçš„keyæ‰€å­˜å‚¨çš„hyperloglogé›†åˆåŸºæ•°è®¡ç®—çš„è¯¯å·®\næ˜¯%0.81.")]),e._v(" "),_("p",[e._v("å‚è€ƒæ–‡çŒ®ï¼šhttp://highscalability.com/blog/2012/4/5/big-data-counting-how-to-count-a-billion-\ndistinct-objects-us.html")]),e._v(" "),_("p",[e._v("83")]),e._v(" "),_("p",[e._v("å°†å…ƒç´ æ·»åŠ è‡³ HyperLogLog")]),e._v(" "),_("p",[e._v("2.7.1 å°†å…ƒç´ æ·»åŠ è‡³ HyperLogLog")]),e._v(" "),_("p",[e._v("PFADD key element [element ...]")]),e._v(" "),_("p",[e._v("è¿™ä¸ªå‘½ä»¤å¯èƒ½ä¼šå¯¹ HyperLogLog è¿›è¡Œä¿®æ”¹ï¼Œä»¥ä¾¿åæ˜ æ–°çš„åŸºæ•°ä¼°ç®—å€¼ï¼Œå¦‚æœ HyperLogLog\nçš„åŸºæ•°ä¼°ç®—å€¼åœ¨å‘½ä»¤æ‰§è¡Œä¹‹åå‡ºç°äº†å˜åŒ–ï¼Œ é‚£ä¹ˆå‘½ä»¤è¿”å› 1 ï¼Œ å¦åˆ™è¿”å› 0 ã€‚ å‘½ä»¤çš„å¤æ‚åº¦\nä¸º O(N) ï¼ŒN ä¸ºè¢«æ·»åŠ å…ƒç´ çš„æ•°é‡ã€‚")]),e._v(" "),_("p",[e._v("84")]),e._v(" "),_("p",[e._v("è¿”å›ç»™å®š HyperLogLog çš„åŸºæ•°ä¼°ç®—å€¼")]),e._v(" "),_("p",[e._v("2.7.2 è¿”å›ç»™å®š HyperLogLog çš„åŸºæ•°ä¼°ç®—å€¼")]),e._v(" "),_("p",[e._v("PFCOUNT key [key ...]")]),e._v(" "),_("p",[e._v("å½“åªç»™å®šä¸€ä¸ª HyperLogLog æ—¶ï¼Œå‘½ä»¤è¿”å›ç»™å®š HyperLogLog çš„åŸºæ•°ä¼°ç®—å€¼ã€‚å½“ç»™å®šå¤šä¸ª\nHyperLogLog æ—¶ï¼Œå‘½ä»¤ä¼šå…ˆå¯¹ç»™å®šçš„ HyperLogLog è¿›è¡Œå¹¶é›†è®¡ç®—ï¼Œå¾—å‡ºä¸€ä¸ªåˆå¹¶åçš„\nHyperLogLog ï¼Œç„¶åè¿”å›è¿™ä¸ªåˆå¹¶ HyperLogLog çš„åŸºæ•°ä¼°ç®—å€¼ä½œä¸ºå‘½ä»¤çš„ç»“æœï¼ˆåˆå¹¶å¾—å‡ºçš„\nHyperLogLog ä¸ä¼šè¢«å‚¨å­˜ï¼Œä½¿ç”¨ä¹‹åå°±ä¼šè¢«åˆ æ‰ï¼‰ã€‚ å½“å‘½ä»¤ä½œç”¨äºå•ä¸ª HyperLogLog æ—¶ï¼Œ\nå¤æ‚åº¦ä¸º O(1) ï¼Œ å¹¶ä¸”å…·æœ‰éå¸¸ä½çš„å¹³å‡å¸¸æ•°æ—¶é—´ã€‚ å½“å‘½ä»¤ä½œç”¨äºå¤šä¸ª HyperLogLog æ—¶ï¼Œ\nå¤æ‚åº¦ä¸º O(N) ï¼Œå¹¶ä¸”å¸¸æ•°æ—¶é—´ä¹Ÿæ¯”å¤„ç†å•ä¸ª HyperLogLog æ—¶è¦å¤§å¾—å¤šã€‚")]),e._v(" "),_("p",[e._v("85")]),e._v(" "),_("p",[e._v("åˆå¹¶å¤šä¸ª HyperLogLog")]),e._v(" "),_("p",[e._v("2.7.3 åˆå¹¶å¤šä¸ª HyperLogLog")]),e._v(" "),_("p",[e._v("PFMERGE destkey sourcekey [sourcekey ...]")]),e._v(" "),_("p",[e._v("å°†å¤šä¸ª HyperLogLog åˆå¹¶ä¸ºä¸€ä¸ª HyperLogLog ï¼Œåˆå¹¶åçš„ HyperLogLog çš„åŸºæ•°ä¼°ç®—å€¼æ˜¯é€š\nè¿‡å¯¹æ‰€æœ‰ç»™å®š HyperLogLog è¿›è¡Œå¹¶é›†è®¡ç®—å¾—å‡ºçš„ã€‚ å‘½ä»¤çš„å¤æ‚åº¦ä¸º O(N) ï¼Œ å…¶ä¸­ N ä¸ºè¢«åˆ\nå¹¶çš„ HyperLogLog æ•°é‡ï¼Œ ä¸è¿‡è¿™ä¸ªå‘½ä»¤çš„å¸¸æ•°å¤æ‚åº¦æ¯”è¾ƒé«˜ã€‚")]),e._v(" "),_("p",[e._v("86")]),e._v(" "),_("p",[e._v("ä¸“é¢˜åŠŸèƒ½")]),e._v(" "),_("ol",{attrs:{start:"3"}},[_("li",[e._v("ä¸“é¢˜åŠŸèƒ½")])]),e._v(" "),_("p",[e._v("87")]),e._v(" "),_("p",[e._v("æ’åº")]),e._v(" "),_("p",[e._v("3.1 æ’åº")]),e._v(" "),_("p",[e._v("redisæ”¯æŒå¯¹listï¼Œsetå’Œsorted setå…ƒç´ çš„æ’åºã€‚æ’åºå‘½ä»¤æ˜¯sort å®Œæ•´çš„å‘½ä»¤æ ¼å¼å¦‚ä¸‹ï¼š")]),e._v(" "),_("p",[e._v("SORT key [BY pattern] [LIMIT start count] [GET pattern] [ASC|DESC] [ALPHA] [STORE dstk\ney]")]),e._v(" "),_("p",[e._v("å¤æ‚åº¦ä¸ºO(N+M*log(M))ã€‚(Næ˜¯é›†åˆå¤§å°ï¼ŒM ä¸ºè¿”å›å…ƒç´ çš„æ•°é‡)\nè¯´æ˜ï¼š")]),e._v(" "),_("ol",[_("li",[_("p",[e._v("[ASC|DESC] [ALPHA]: sorté»˜è®¤çš„æ’åºæ–¹å¼ï¼ˆascï¼‰æ˜¯ä»å°åˆ°å¤§æ’çš„,å½“ç„¶ä¹Ÿå¯ä»¥æŒ‰ç…§é€†åº\næˆ–è€…æŒ‰å­—ç¬¦é¡ºåºæ’ã€‚")])]),e._v(" "),_("li",[_("p",[e._v("[BY pattern] : é™¤äº†å¯ä»¥æŒ‰é›†åˆå…ƒç´ è‡ªèº«å€¼æ’åºå¤–ï¼Œè¿˜å¯ä»¥å°†é›†åˆå…ƒç´ å†…å®¹æŒ‰ç…§ç»™å®š")])])]),e._v(" "),_("p",[e._v("patternç»„åˆæˆæ–°çš„keyï¼Œå¹¶æŒ‰ç…§æ–°keyä¸­å¯¹åº”çš„å†…å®¹è¿›è¡Œæ’åºã€‚ä¾‹å¦‚ï¼š")]),e._v(" "),_("ol",{attrs:{start:"3"}},[_("li",[_("p",[e._v("127.0.0.1:6379sort watch:leto by severtity:* desc")])]),e._v(" "),_("li",[_("p",[e._v("[GET pattern]ï¼šå¯ä»¥é€šè¿‡geté€‰é¡¹å»è·å–æŒ‡å®špatternä½œä¸ºæ–°keyå¯¹åº”çš„å€¼ï¼Œgeté€‰é¡¹å¯ä»¥æœ‰\nå¤šä¸ªã€‚ä¾‹å¦‚ï¼š127.0.0.1:6379sort watch:leto by severtity: get severtity:ã€‚ å¯¹äºHashçš„å¼•\nç”¨ï¼Œé‡‡ç”¨->ï¼Œä¾‹å¦‚ï¼šsort watch:leto get # get bug:*->priorityã€‚")])]),e._v(" "),_("li",[_("p",[e._v("[LIMIT start count] é™å®šè¿”å›ç»“æœçš„æ•°é‡ã€‚")])]),e._v(" "),_("li",[_("p",[e._v("[STORE dstkey] æŠŠæ’åºç»“æœç¼“å­˜èµ·æ¥")])])]),e._v(" "),_("p",[e._v("88")]),e._v(" "),_("p",[e._v("æ’åº")]),e._v(" "),_("p",[e._v("89")]),e._v(" "),_("p",[e._v("äº‹åŠ¡")]),e._v(" "),_("p",[e._v("3.2 äº‹åŠ¡")]),e._v(" "),_("p",[e._v("ç”¨Multi(Start Transaction)ã€Exec(Commit)ã€Discard(Rollback)å®ç°ã€‚ åœ¨äº‹åŠ¡æäº¤å‰ï¼Œä¸ä¼šæ‰§\nè¡Œä»»ä½•æŒ‡ä»¤ï¼Œåªä¼šæŠŠå®ƒä»¬å­˜åˆ°ä¸€ä¸ªé˜Ÿåˆ—é‡Œï¼Œä¸å½±å“å…¶ä»–å®¢æˆ·ç«¯çš„æ“ä½œã€‚åœ¨äº‹åŠ¡æäº¤æ—¶ï¼Œæ‰¹é‡\næ‰§è¡Œæ‰€æœ‰æŒ‡ä»¤ã€‚ ä¸€èˆ¬æƒ…å†µä¸‹redisåœ¨æ¥å—åˆ°ä¸€ä¸ªclientå‘æ¥çš„å‘½ä»¤åä¼š å³å¤„ç†å¹¶è¿”å›å¤„ç†ç»“\næœï¼Œä½†æ˜¯å½“ä¸€ä¸ªclientåœ¨ä¸€ä¸ªè¿æ¥ä¸­å‘å‡ºmultiå‘½ä»¤åï¼Œè¿™ä¸ªè¿æ¥ä¼šè¿›å…¥ä¸€ä¸ªäº‹åŠ¡ä¸Šä¸‹æ–‡ï¼Œè¯¥è¿\næ¥åç»­çš„å‘½ä»¤å¹¶ä¸æ˜¯ å³æ‰§è¡Œï¼Œè€Œæ˜¯å…ˆæ”¾åˆ°ä¸€ä¸ªé˜Ÿåˆ—ä¸­ã€‚å½“ä»æ­¤è¿æ¥å—åˆ°execå‘½ä»¤åï¼Œredis\nä¼šé¡ºåºçš„æ‰§è¡Œé˜Ÿåˆ—ä¸­çš„æ‰€æœ‰å‘½ä»¤ã€‚å¹¶å°†æ‰€æœ‰å‘½ä»¤çš„è¿è¡Œç»“æœæ‰“åŒ…åˆ°ä¸€èµ·è¿”å›ç»™client.ç„¶åæ­¤è¿\næ¥å°±ç»“æŸäº‹åŠ¡ä¸Šä¸‹æ–‡ã€‚")]),e._v(" "),_("p",[e._v("Redisè¿˜æä¾›äº†ä¸€ä¸ªWatchåŠŸèƒ½ï¼Œä½ å¯ä»¥å¯¹ä¸€ä¸ªkeyè¿›è¡ŒWatchï¼Œç„¶åå†æ‰§è¡ŒTransactionsï¼Œåœ¨\nè¿™è¿‡ç¨‹ä¸­ï¼Œå¦‚æœè¿™ä¸ªWatchedçš„å€¼è¿›è¡Œäº†ä¿®æ”¹ï¼Œé‚£ä¹ˆè¿™ä¸ªTransactionsä¼šå‘ç°å¹¶æ‹’ç»æ‰§è¡Œã€‚")]),e._v(" "),_("p",[e._v("ä½¿ç”¨discardå‘½ä»¤æ¥å–æ¶ˆä¸€ä¸ªäº‹åŠ¡ã€‚")]),e._v(" "),_("p",[e._v('æ³¨æ„ï¼šredisåªèƒ½ä¿è¯äº‹åŠ¡çš„æ¯ä¸ªå‘½ä»¤è¿ç»­æ‰§è¡Œï¼ˆå› ä¸ºæ˜¯å•çº¿ç¨‹æ¶æ„ï¼Œåœ¨æ‰§è¡Œå®Œäº‹åŠ¡å†…æ‰€æœ‰æŒ‡\nä»¤å‰æ˜¯ä¸å¯èƒ½å†å»åŒæ—¶æ‰§è¡Œå…¶ä»–å®¢æˆ·ç«¯çš„è¯·æ±‚çš„ï¼Œä¹Ÿå› æ­¤å°±ä¸å­˜åœ¨"äº‹åŠ¡å†…çš„æŸ¥è¯¢è¦çœ‹åˆ°äº‹åŠ¡\né‡Œçš„æ›´æ–°ï¼Œåœ¨äº‹åŠ¡å¤–æŸ¥è¯¢ä¸èƒ½çœ‹åˆ°"è¿™ä¸ªè®©äººä¸‡åˆ†å¤´ç—›çš„é—®é¢˜ï¼‰ï¼Œä½†æ˜¯å¦‚æœäº‹åŠ¡ä¸­çš„ä¸€ä¸ªå‘½ä»¤\nå¤±è´¥äº†ï¼Œå¹¶ä¸å›æ»šå…¶ä»–å‘½ä»¤ã€‚å¦å¤–ï¼Œä¸€ä¸ªååˆ†ç½•è§çš„é—®é¢˜æ˜¯å½“äº‹åŠ¡çš„æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œå¦‚æœredis\næ„å¤–çš„æŒ‚äº†ã€‚åªæœ‰éƒ¨åˆ†å‘½ä»¤æ‰§è¡Œäº†ï¼Œåé¢çš„ä¹Ÿå°±è¢«ä¸¢å¼ƒäº†ã€‚æ³¨æ„ï¼Œå¦‚æœæ˜¯ç¬”è¯¯ï¼Œè¯­æ³•å‡ºç°é”™\nè¯¯ï¼Œåˆ™æ•´ä¸ªäº‹åŠ¡éƒ½æ— æ³•æ‰§è¡Œã€‚')]),e._v(" "),_("p",[e._v("ä¸€ä¸ªç®€å•æ¡ˆä¾‹è¡¨æ˜å‡ºé”™ä¹Ÿä¸ä¼šå›æ»šï¼š")]),e._v(" "),_("p",[e._v("127.0.0.1:6379> del q1")]),e._v(" "),_("p",[e._v("(integer) 0")]),e._v(" "),_("p",[e._v("127.0.0.1:6379> exists q1")]),e._v(" "),_("p",[e._v("(integer) 0")]),e._v(" "),_("p",[e._v("127.0.0.1:6379> multi\nOK")]),e._v(" "),_("p",[e._v("127.0.0.1:6379> rpush q1 bar\nQUEUED")]),e._v(" "),_("p",[e._v("127.0.0.1:6379> scard q1\nQUEUED")]),e._v(" "),_("p",[e._v("127.0.0.1:6379> exec")]),e._v(" "),_("ol",[_("li",[_("p",[e._v("(integer) 1")])]),e._v(" "),_("li",[_("p",[e._v("(error) WRONGTYPE Operation against a key holding the wrong kind of value\n127.0.0.1:6379> exists q1")])])]),e._v(" "),_("p",[e._v("(integer) 1")]),e._v(" "),_("p",[e._v("å½“ç„¶å¦‚æœæˆ‘ä»¬ä½¿ç”¨çš„append-only fileæ–¹å¼æŒä¹…åŒ–ï¼Œredisä¼šç”¨å•ä¸ªwriteæ“ä½œå†™å…¥æ•´ä¸ªäº‹åŠ¡å†…\nå®¹ã€‚å³æ˜¯æ˜¯è¿™ç§æ–¹å¼è¿˜æ˜¯æœ‰å¯èƒ½åªéƒ¨åˆ†å†™å…¥äº†äº‹åŠ¡åˆ°ç£ç›˜ã€‚å‘ç”Ÿéƒ¨åˆ†å†™å…¥äº‹åŠ¡çš„æƒ…å†µä¸‹ï¼Œ\nredisé‡å¯æ—¶ä¼šæ£€æµ‹åˆ°è¿™ç§æƒ…å†µï¼Œç„¶åå¤±è´¥é€€å‡ºã€‚å¯ä»¥ä½¿ç”¨redis-check-aofå·¥å…·è¿›è¡Œä¿®å¤ï¼Œä¿®")]),e._v(" "),_("p",[e._v("90")]),e._v(" "),_("p",[e._v("äº‹åŠ¡")]),e._v(" "),_("p",[e._v("å¤ä¼šåˆ é™¤éƒ¨åˆ†å†™å…¥çš„äº‹åŠ¡å†…å®¹ã€‚ä¿®å¤å®Œåå°±èƒ½å¤Ÿé‡æ–°å¯åŠ¨äº†ã€‚")]),e._v(" "),_("p",[e._v("91")]),e._v(" "),_("p",[e._v("æµæ°´çº¿")]),e._v(" "),_("p",[e._v("3.3 æµæ°´çº¿")]),e._v(" "),_("p",[e._v("åˆ©ç”¨æµæ°´çº¿ï¼ˆpipelineï¼‰çš„æ–¹å¼ä»clientæ‰“åŒ…å¤šæ¡å‘½ä»¤ä¸€èµ·å‘å‡ºï¼Œä¸éœ€è¦ç­‰å¾…å•æ¡å‘½ä»¤çš„å“åº”è¿”\nå›ï¼Œè€ŒredisæœåŠ¡ç«¯ä¼šå¤„ç†å®Œå¤šæ¡å‘½ä»¤åä¼šå°†å¤šæ¡å‘½ä»¤çš„å¤„ç†ç»“æœæ‰“åŒ…åˆ°ä¸€èµ·è¿”å›ç»™å®¢æˆ·ç«¯ï¼š")]),e._v(" "),_("p",[e._v("cat data.txt | redis-cli â€“pipe")]),e._v(" "),_("p",[e._v("åœ¨é€‰æ‹©å¼€æºrediså¼€å‘åº“æ—¶éœ€è¦ç€é‡æ³¨æ„æ˜¯å¦æ”¯æŒpipelineï¼Œå¸¸è§çš„jediså¯ä»¥æ”¯æŒã€‚\nåœ¨éƒ¨ç½²æ¶æ„æ˜¯ç½‘ç»œå¤šè·³çš„æ—¶å€™éœ€è¦æ³¨æ„ä½¿ç”¨pipelineæé«˜å¤„ç†æ•ˆç‡ã€‚")]),e._v(" "),_("p",[e._v("92")]),e._v(" "),_("p",[e._v("å‘å¸ƒè®¢é˜…")]),e._v(" "),_("p",[e._v("3.4 å‘å¸ƒè®¢é˜…")]),e._v(" "),_("p",[e._v("redisä½œä¸ºä¸€ä¸ªpub/sub serverï¼Œåœ¨è®¢é˜…è€…å’Œå‘å¸ƒè€…ä¹‹é—´èµ·åˆ°äº†æ¶ˆæ¯è·¯ç”±çš„åŠŸèƒ½ã€‚è®¢é˜…è€…å¯ä»¥é€š\nè¿‡subscribeå’Œpsubscribeå‘½ä»¤å‘redis serverè®¢é˜…è‡ªå·±æ„Ÿå…´è¶£çš„æ¶ˆæ¯ç±»å‹ï¼Œrediså°†æ¶ˆæ¯ç±»å‹ç§°\nä¸ºé¢‘é“(channel)ã€‚å½“å‘å¸ƒè€…é€šè¿‡publishå‘½ä»¤å‘redis serverå‘é€ç‰¹å®šç±»å‹çš„æ¶ˆæ¯æ—¶ã€‚è®¢é˜…è¯¥æ¶ˆ\næ¯ç±»å‹çš„å…¨éƒ¨clientéƒ½ä¼šæ”¶åˆ°æ­¤æ¶ˆæ¯ã€‚è¿™é‡Œæ¶ˆæ¯çš„ä¼ é€’æ˜¯å¤šå¯¹å¤šçš„ã€‚ä¸€ä¸ªclientå¯ä»¥è®¢é˜…å¤šä¸ª\nchannel,ä¹Ÿå¯ä»¥å‘å¤šä¸ªchannelå‘é€æ¶ˆæ¯ã€‚")]),e._v(" "),_("p",[e._v("ç»ˆç«¯Aï¼š")]),e._v(" "),_("p",[e._v("127.0.0.1:6379> subscribe comments\nReading messages... (press Ctrl-C to quit)")]),e._v(" "),_("ol",[_("li",[_("p",[e._v('"subscribe"')])]),e._v(" "),_("li",[_("p",[e._v('"comments"')])]),e._v(" "),_("li",[_("p",[e._v("(integer) 1")])])]),e._v(" "),_("p",[e._v("ç»ˆç«¯B:")]),e._v(" "),_("p",[e._v("127.0.0.1:6379> subscribe comments\nReading messages... (press Ctrl-C to quit)")]),e._v(" "),_("ol",[_("li",[_("p",[e._v('"subscribe"')])]),e._v(" "),_("li",[_("p",[e._v('"comments"')])]),e._v(" "),_("li",[_("p",[e._v("(integer) 1")])])]),e._v(" "),_("p",[e._v("ç»ˆç«¯Cï¼š")]),e._v(" "),_("p",[e._v("127.0.0.1:6379> publish comments good!\n(integer) 2")]),e._v(" "),_("p",[e._v("ç»ˆç«¯A:")]),e._v(" "),_("p",[e._v("127.0.0.1:6379> subscribe comments\nReading messages... (press Ctrl-C to quit)")]),e._v(" "),_("ol",[_("li",[_("p",[e._v('"subscribe"')])]),e._v(" "),_("li",[_("p",[e._v('"comments"')])]),e._v(" "),_("li",[_("p",[e._v("(integer) 1")])]),e._v(" "),_("li",[_("p",[e._v('"message"')])]),e._v(" "),_("li",[_("p",[e._v('"comments"')])]),e._v(" "),_("li",[_("p",[e._v('"good!"')])])]),e._v(" "),_("p",[e._v("ç»ˆç«¯Bï¼š")]),e._v(" "),_("p",[e._v("127.0.0.1:6379> subscribe comments\nReading messages... (press Ctrl-C to quit)")]),e._v(" "),_("ol",[_("li",[_("p",[e._v('"subscribe"')])]),e._v(" "),_("li",[_("p",[e._v('"comments"')])]),e._v(" "),_("li",[_("p",[e._v("(integer) 1")])]),e._v(" "),_("li",[_("p",[e._v('"message"')])]),e._v(" "),_("li",[_("p",[e._v('"comments"')])]),e._v(" "),_("li",[_("p",[e._v('"good!"')])])]),e._v(" "),_("p",[e._v("å¯ä»¥ä½¿ç”¨psubscribeé€šè¿‡é€šé…ç¬¦è¿›è¡Œå¤šä¸ªchannelçš„è®¢é˜…")]),e._v(" "),_("p",[e._v("93")]),e._v(" "),_("p",[e._v("å‘å¸ƒè®¢é˜…")]),e._v(" "),_("p",[e._v("94")]),e._v(" "),_("p",[e._v("å¼€å‘è®¾è®¡è§„èŒƒ")]),e._v(" "),_("ol",{attrs:{start:"4"}},[_("li",[e._v("å¼€å‘è®¾è®¡è§„èŒƒ")])]),e._v(" "),_("p",[e._v("95")]),e._v(" "),_("p",[e._v("Keyè®¾è®¡")]),e._v(" "),_("p",[e._v("4.1 Keyè®¾è®¡")]),e._v(" "),_("p",[e._v('keyçš„ä¸€ä¸ªæ ¼å¼çº¦å®šï¼š object-typeğŸ†”field ã€‚ç”¨":"åˆ†éš”åŸŸï¼Œç”¨"."ä½œä¸ºå•è¯é—´çš„è¿æ¥ï¼Œ\nå¦‚" comment:12345:reply.to "ã€‚ä¸æ¨èå«ä¹‰ä¸æ¸…çš„keyå’Œç‰¹åˆ«é•¿çš„keyã€‚')]),e._v(" "),_("p",[e._v("ä¸€èˆ¬çš„è®¾è®¡æ–¹æ³•å¦‚ä¸‹ï¼š 1: æŠŠè¡¨åè½¬æ¢ä¸ºkeyå‰ç¼€ å¦‚, tag: 2: ç¬¬2æ®µæ”¾ç½®ç”¨äºåŒºåˆ†åŒºkeyçš„å­—æ®µ--\nå¯¹åº”mysqlä¸­çš„ä¸»é”®çš„åˆ—å,å¦‚userid 3: ç¬¬3æ®µæ”¾ç½®ä¸»é”®å€¼,å¦‚2,3,4  , a , b ,c 4: ç¬¬4æ®µ,å†™è¦å­˜å‚¨")]),e._v(" "),_("p",[e._v("çš„åˆ—å")]),e._v(" "),_("p",[e._v("ä¾‹å¦‚ç”¨æˆ·è¡¨ user, è½¬æ¢ä¸ºkey-valueå­˜å‚¨ï¼š")]),e._v(" "),_("p",[e._v("userid")]),e._v(" "),_("p",[e._v("9")]),e._v(" "),_("p",[e._v("username")]),e._v(" "),_("p",[e._v("lisi")]),e._v(" "),_("p",[e._v("password")]),e._v(" "),_("p",[e._v("1111111")]),e._v(" "),_("p",[e._v("email")]),e._v(" "),_("p",[e._v("lisi@163.com")]),e._v(" "),_("p",[e._v("set user:userid:9:username lisi\nset user:userid:9:password 111111")]),e._v(" "),_("p",[e._v("set user:userid:9:email lisi@163.com")]),e._v(" "),_("p",[e._v("ä¾‹å¦‚ï¼ŒæŸ¥çœ‹æŸä¸ªç”¨æˆ·çš„æ‰€æœ‰ä¿¡æ¯ä¸ºï¼š")]),e._v(" "),_("p",[e._v("keys user:userid:9*")]),e._v(" "),_("p",[e._v("å¦‚æœå¦ä¸€ä¸ªåˆ—ä¹Ÿå¸¸å¸¸è¢«ç”¨æ¥æŸ¥æ‰¾ï¼Œæ¯”å¦‚usernameï¼Œåˆ™ä¹Ÿè¦ç›¸åº”çš„ç”Ÿæˆä¸€æ¡æŒ‰ç…§è¯¥åˆ—ä¸ºä¸»çš„")]),e._v(" "),_("p",[e._v("key-valueï¼Œä¾‹å¦‚ï¼š")]),e._v(" "),_("p",[e._v("user:username:lisi:uid 9")]),e._v(" "),_("p",[e._v("æ­¤æ—¶ç›¸å½“äºRDBMSä¸­åœ¨usernameä¸ŠåŠ ç´¢å¼•ï¼Œæˆ‘ä»¬å¯ä»¥æ ¹æ®  username:lisi:uid ,æŸ¥å‡º")]),e._v(" "),_("p",[e._v("userid=9ï¼Œå†æŸ¥ user:9:password/email  ...")]),e._v(" "),_("p",[e._v("96")]),e._v(" "),_("p",[e._v("è¶…æ—¶è®¾ç½®")]),e._v(" "),_("p",[e._v("4.2 è¶…æ—¶è®¾ç½®")]),e._v(" "),_("p",[e._v("ä»ä¸šåŠ¡éœ€æ±‚é€»è¾‘å’Œå†…å­˜çš„è§’åº¦ï¼Œå°½å¯èƒ½çš„è®¾ç½®keyå­˜æ´»æ—¶é—´ã€‚")]),e._v(" "),_("p",[e._v("97")]),e._v(" "),_("p",[e._v("æ•°æ®å¼‚å¸¸å¤„ç†")]),e._v(" "),_("p",[e._v("4.3 æ•°æ®å¼‚å¸¸å¤„ç†")]),e._v(" "),_("p",[e._v("ç¨‹åºåº”è¯¥å¤„ç†å¦‚æœredisæ•°æ®ä¸¢å¤±æ—¶çš„æ¸…ç†rediså†…å­˜å’Œé‡æ–°åŠ è½½çš„è¿‡ç¨‹ã€‚")]),e._v(" "),_("p",[e._v("98")]),e._v(" "),_("p",[e._v("å†…å­˜è€ƒè™‘")]),e._v(" "),_("p",[e._v("4.4 å†…å­˜è€ƒè™‘")]),e._v(" "),_("ol",[_("li",[e._v("åªè¦æœ‰å¯èƒ½çš„è¯ï¼Œå°±å°½é‡ä½¿ç”¨æ•£åˆ—é”®è€Œä¸æ˜¯å­—ç¬¦ä¸²é”®æ¥å‚¨å­˜é”®å€¼å¯¹æ•°æ®ï¼Œå› ä¸ºæ•£åˆ—é”®ç®¡\nç†æ–¹ä¾¿ã€èƒ½å¤Ÿé¿å…é”®åå†²çªã€å¹¶ä¸”è¿˜èƒ½å¤ŸèŠ‚çº¦å†…å­˜ã€‚")])]),e._v(" "),_("p",[e._v("å…·ä½“å®ä¾‹ï¼š èŠ‚çº¦å†…å­˜ï¼šInstagramçš„Rediså®è·µ blog.nosqlfan.com/html/3379.html")]),e._v(" "),_("ol",{attrs:{start:"2"}},[_("li",[_("p",[e._v("å¦‚æœå°†redisä½œä¸ºcacheè¿›è¡Œé¢‘ç¹è¯»å†™å’Œè¶…æ—¶åˆ é™¤ç­‰ï¼Œæ­¤æ—¶åº”è¯¥é¿å…è®¾ç½®è¾ƒå¤§çš„k-vï¼Œå› ä¸º\nè¿™æ ·ä¼šå¯¼è‡´redisçš„ å†…å­˜ç¢ç‰‡å¢åŠ ï¼Œå¯¼è‡´rsså ç”¨è¾ƒå¤§ï¼Œæœ€åè¢«æ“ä½œç³»ç»ŸOOM killerå¹²æ‰ã€‚\nä¸€ä¸ªå¾ˆå…·ä½“çš„issueä¾‹å­è¯·è§ï¼šhttps://github.com/antirez/redis/issues/2136")])]),e._v(" "),_("li",[_("p",[e._v("å¦‚æœé‡‡ç”¨åºåˆ—åŒ–è€ƒè™‘é€šç”¨æ€§ï¼Œè¯·é‡‡ç”¨jsonç›¸å…³çš„åº“è¿›è¡Œå¤„ç†ï¼Œå¦‚æœå¯¹å†…å­˜å¤§å°å’Œé€Ÿåº¦éƒ½å¾ˆ\nå…³æ³¨çš„ï¼Œæ¨èä½¿ç”¨messagepackè¿›è¡Œåºåˆ—åŒ–å’Œååºåˆ—åŒ–")])]),e._v(" "),_("li",[_("p",[e._v("å¦‚æœéœ€è¦è®¡æ•°å™¨ï¼Œè¯·å°†è®¡æ•°å™¨çš„keyé€šè¿‡å¤©æˆ–è€…å°æ—¶åˆ†å‰²ï¼Œæ¯”å¦‚ä¸‹è¾¹çš„è®¾è®¡:")])])]),e._v(" "),_("p",[e._v("éœ€è¦ä¿®æ”¹ä¸ºï¼š")]),e._v(" "),_("p",[e._v("æ›´å¥½çš„ä¸€ä¸ªè®¾è®¡æ˜¯é‡‡ç”¨hashï¼š")]),e._v(" "),_("p",[e._v("99")]),e._v(" "),_("p",[e._v("å†…å­˜è€ƒè™‘")]),e._v(" "),_("ol",{attrs:{start:"5"}},[_("li",[e._v("å„ç§æ•°æ®ç»“æ„åŠå…¶å ç”¨å†…å­˜çš„benchmarkæµ‹è¯•")])]),e._v(" "),_("p",[e._v("setä¸ªæ•°")]),e._v(" "),_("p",[e._v("100")]),e._v(" "),_("p",[e._v("100")]),e._v(" "),_("p",[e._v("100")]),e._v(" "),_("p",[e._v("1000")]),e._v(" "),_("p",[e._v("1000")]),e._v(" "),_("p",[e._v("1000")]),e._v(" "),_("p",[e._v("10000")]),e._v(" "),_("p",[e._v("10000")]),e._v(" "),_("p",[e._v("æ¯ä¸ªsetçš„å…ƒç´ æ€»æ•°")]),e._v(" "),_("p",[e._v("100")]),e._v(" "),_("p",[e._v("1000")]),e._v(" "),_("p",[e._v("10000")]),e._v(" "),_("p",[e._v("100")]),e._v(" "),_("p",[e._v("1000")]),e._v(" "),_("p",[e._v("10000")]),e._v(" "),_("p",[e._v("100")]),e._v(" "),_("p",[e._v("1000")]),e._v(" "),_("p",[e._v("å†…å­˜å ç”¨")]),e._v(" "),_("p",[e._v("1.88M")]),e._v(" "),_("p",[e._v("10.75M")]),e._v(" "),_("p",[e._v("111.12M")]),e._v(" "),_("p",[e._v("11.59M")]),e._v(" "),_("p",[e._v("100.35M")]),e._v(" "),_("p",[e._v("1.08G")]),e._v(" "),_("p",[e._v("108.71M")]),e._v(" "),_("p",[e._v("996.23M")]),e._v(" "),_("p",[e._v("Keyå¤§å°")]),e._v(" "),_("p",[e._v("7")]),e._v(" "),_("p",[e._v("7")]),e._v(" "),_("p",[e._v("7")]),e._v(" "),_("p",[e._v("8")]),e._v(" "),_("p",[e._v("8")]),e._v(" "),_("p",[e._v("8")]),e._v(" "),_("p",[e._v("9")]),e._v(" "),_("p",[e._v("9")]),e._v(" "),_("p",[e._v("Valueå¤§å°")]),e._v(" "),_("p",[e._v("36")]),e._v(" "),_("p",[e._v("36")]),e._v(" "),_("p",[e._v("36")]),e._v(" "),_("p",[e._v("36")]),e._v(" "),_("p",[e._v("36")]),e._v(" "),_("p",[e._v("36")]),e._v(" "),_("p",[e._v("36")]),e._v(" "),_("p",[e._v("36")]),e._v(" "),_("p",[e._v("zsetä¸ªæ•°")]),e._v(" "),_("p",[e._v("100")]),e._v(" "),_("p",[e._v("100")]),e._v(" "),_("p",[e._v("100")]),e._v(" "),_("p",[e._v("1000")]),e._v(" "),_("p",[e._v("1000")]),e._v(" "),_("p",[e._v("1000")]),e._v(" "),_("p",[e._v("æ¯ä¸ªzsetçš„å…ƒç´ æ€»æ•°")]),e._v(" "),_("p",[e._v("100")]),e._v(" "),_("p",[e._v("1000")]),e._v(" "),_("p",[e._v("10000")]),e._v(" "),_("p",[e._v("100")]),e._v(" "),_("p",[e._v("1000")]),e._v(" "),_("p",[e._v("10000")]),e._v(" "),_("p",[e._v("å†…å­˜å ç”¨")]),e._v(" "),_("p",[e._v("1.62M")]),e._v(" "),_("p",[e._v("15.91M")]),e._v(" "),_("p",[e._v("162.06M")]),e._v(" "),_("p",[e._v("8.71M")]),e._v(" "),_("p",[e._v("151.87M")]),e._v(" "),_("p",[e._v("1.58G")]),e._v(" "),_("p",[e._v("Keyå¤§å°")]),e._v(" "),_("p",[e._v("8")]),e._v(" "),_("p",[e._v("8")]),e._v(" "),_("p",[e._v("8")]),e._v(" "),_("p",[e._v("9")]),e._v(" "),_("p",[e._v("9")]),e._v(" "),_("p",[e._v("9")]),e._v(" "),_("p",[e._v("Valueå¤§å°")]),e._v(" "),_("p",[e._v("49")]),e._v(" "),_("p",[e._v("49")]),e._v(" "),_("p",[e._v("49")]),e._v(" "),_("p",[e._v("49")]),e._v(" "),_("p",[e._v("49")]),e._v(" "),_("p",[e._v("49")]),e._v(" "),_("p",[e._v("10000")]),e._v(" "),_("p",[e._v("10000")]),e._v(" "),_("p",[e._v("100")]),e._v(" "),_("p",[e._v("1000")]),e._v(" "),_("p",[e._v("79.83M     10       49")]),e._v(" "),_("p",[e._v("1.48G     10        49")]),e._v(" "),_("p",[e._v("hashä¸ªæ•°")]),e._v(" "),_("p",[e._v("100")]),e._v(" "),_("p",[e._v("100")]),e._v(" "),_("p",[e._v("100")]),e._v(" "),_("p",[e._v("1000")]),e._v(" "),_("p",[e._v("1000")]),e._v(" "),_("p",[e._v("1000")]),e._v(" "),_("p",[e._v("10000")]),e._v(" "),_("p",[e._v("10000")]),e._v(" "),_("p",[e._v("æ¯ä¸ªhashçš„å…ƒç´ æ€»æ•°")]),e._v(" "),_("p",[e._v("100")]),e._v(" "),_("p",[e._v("1000")]),e._v(" "),_("p",[e._v("10000")]),e._v(" "),_("p",[e._v("100")]),e._v(" "),_("p",[e._v("1000")]),e._v(" "),_("p",[e._v("10000")]),e._v(" "),_("p",[e._v("100")]),e._v(" "),_("p",[e._v("1000")]),e._v(" "),_("p",[e._v("å†…å­˜å ç”¨")]),e._v(" "),_("p",[e._v("1.63M")]),e._v(" "),_("p",[e._v("6.29M")]),e._v(" "),_("p",[e._v("156.91M")]),e._v(" "),_("p",[e._v("8.71M")]),e._v(" "),_("p",[e._v("55.59M")]),e._v(" "),_("p",[e._v("1.52G")]),e._v(" "),_("p",[e._v("79.83M")]),e._v(" "),_("p",[e._v("548.58M")]),e._v(" "),_("p",[e._v("Keyå¤§å°")]),e._v(" "),_("p",[e._v("8")]),e._v(" "),_("p",[e._v("8")]),e._v(" "),_("p",[e._v("8")]),e._v(" "),_("p",[e._v("9")]),e._v(" "),_("p",[e._v("9")]),e._v(" "),_("p",[e._v("9")]),e._v(" "),_("p",[e._v("10")]),e._v(" "),_("p",[e._v("10")]),e._v(" "),_("p",[e._v("Valueå¤§å°")]),e._v(" "),_("p",[e._v("49")]),e._v(" "),_("p",[e._v("49")]),e._v(" "),_("p",[e._v("49")]),e._v(" "),_("p",[e._v("49")]),e._v(" "),_("p",[e._v("49")]),e._v(" "),_("p",[e._v("49")]),e._v(" "),_("p",[e._v("49")]),e._v(" "),_("p",[e._v("49")]),e._v(" "),_("p",[e._v("100")]),e._v(" "),_("p",[e._v("å†…å­˜è€ƒè™‘")]),e._v(" "),_("p",[e._v("listä¸ªæ•°")]),e._v(" "),_("p",[e._v("100")]),e._v(" "),_("p",[e._v("100")]),e._v(" "),_("p",[e._v("100")]),e._v(" "),_("p",[e._v("1000")]),e._v(" "),_("p",[e._v("1000")]),e._v(" "),_("p",[e._v("1000")]),e._v(" "),_("p",[e._v("æ¯ä¸ªlistçš„å…ƒç´ æ€»æ•°")]),e._v(" "),_("p",[e._v("100")]),e._v(" "),_("p",[e._v("1000")]),e._v(" "),_("p",[e._v("10000")]),e._v(" "),_("p",[e._v("100")]),e._v(" "),_("p",[e._v("1000")]),e._v(" "),_("p",[e._v("10000")]),e._v(" "),_("p",[e._v("å†…å­˜å ç”¨")]),e._v(" "),_("p",[e._v("1.23M")]),e._v(" "),_("p",[e._v("10.00M")]),e._v(" "),_("p",[e._v("92.40M")]),e._v(" "),_("p",[e._v("4.83M")]),e._v(" "),_("p",[e._v("92.52M")]),e._v(" "),_("p",[e._v("916.47M")]),e._v(" "),_("p",[e._v("Keyå¤§å°")]),e._v(" "),_("p",[e._v("8")]),e._v(" "),_("p",[e._v("8")]),e._v(" "),_("p",[e._v("8")]),e._v(" "),_("p",[e._v("9")]),e._v(" "),_("p",[e._v("9")]),e._v(" "),_("p",[e._v("9")]),e._v(" "),_("p",[e._v("Valueå¤§å°")]),e._v(" "),_("p",[e._v("36")]),e._v(" "),_("p",[e._v("36")]),e._v(" "),_("p",[e._v("36")]),e._v(" "),_("p",[e._v("36")]),e._v(" "),_("p",[e._v("36")]),e._v(" "),_("p",[e._v("36")]),e._v(" "),_("p",[e._v("10000")]),e._v(" "),_("p",[e._v("10000")]),e._v(" "),_("p",[e._v("100")]),e._v(" "),_("p",[e._v("1000")]),e._v(" "),_("p",[e._v("40.76M     10        36")]),e._v(" "),_("p",[e._v("917.69M    10        36")]),e._v(" "),_("p",[e._v("100")]),e._v(" "),_("p",[e._v("1000")]),e._v(" "),_("p",[e._v("stringä¸ªæ•°")]),e._v(" "),_("p",[e._v("å†…å­˜å ç”¨")]),e._v(" "),_("p",[e._v("846.79K")]),e._v(" "),_("p",[e._v("966.29K")]),e._v(" "),_("p",[e._v("Keyå¤§å°")]),e._v(" "),_("p",[e._v("13")]),e._v(" "),_("p",[e._v("13")]),e._v(" "),_("p",[e._v("Valueå¤§å°")]),e._v(" "),_("p",[e._v("36")]),e._v(" "),_("p",[e._v("36")]),e._v(" "),_("p",[e._v("10000")]),e._v(" "),_("p",[e._v("100000")]),e._v(" "),_("p",[e._v("2.16M         13           36")]),e._v(" "),_("p",[e._v("130.88M        13           36")]),e._v(" "),_("p",[e._v("101")]),e._v(" "),_("p",[e._v("å»¶è¿Ÿè€ƒè™‘")]),e._v(" "),_("p",[e._v("4.5 å»¶è¿Ÿè€ƒè™‘")]),e._v(" "),_("ol",[_("li",[e._v("å°½å¯èƒ½ä½¿ç”¨æ‰¹é‡æ“ä½œï¼š")])]),e._v(" "),_("p",[e._v("mgetã€hmgetè€Œä¸æ˜¯getå’Œhgetï¼Œå¯¹äºsetä¹Ÿæ˜¯å¦‚æ­¤ã€‚")]),e._v(" "),_("p",[e._v("lpushå‘ä¸€ä¸ªlistä¸€æ¬¡æ€§å¯¼å…¥å¤šä¸ªå…ƒç´ ï¼Œè€Œä¸ç”¨lsetä¸€ä¸ªä¸ªæ·»åŠ \nLRANGE ä¸€æ¬¡å–å‡ºä¸€ä¸ªèŒƒå›´çš„å…ƒç´ ï¼Œä¹Ÿä¸ç”¨LINDEXä¸€ä¸ªä¸ªå–å‡º")]),e._v(" "),_("ol",{attrs:{start:"2"}},[_("li",[_("p",[e._v("å°½å¯èƒ½çš„æŠŠrediså’ŒAPP SERVERéƒ¨ç½²åœ¨ä¸€ä¸ªç½‘æ®µç”šè‡³ä¸€å°æœº\nå™¨ã€‚")])]),e._v(" "),_("li",[_("p",[e._v("å¯¹äºæ•°æ®é‡è¾ƒå¤§çš„é›†åˆï¼Œä¸è¦è½»æ˜“è¿›è¡Œåˆ é™¤æ“ä½œï¼Œè¿™æ ·ä¼šé˜»å¡\næœåŠ¡å™¨ï¼Œä¸€èˆ¬é‡‡ç”¨é‡å‘½å+æ‰¹é‡åˆ é™¤çš„ç­–ç•¥ï¼š")])])]),e._v(" "),_("p",[e._v("æ’åºé›†åˆï¼š")]),e._v(" "),_("h1",{attrs:{id:"rename-the-key"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#rename-the-key"}},[e._v("#")]),e._v(" Rename the key")]),e._v(" "),_("p",[e._v('newkey = "gc:hashes:" + redis.INCR("gc:index")\nredis.RENAME("my.zset.key", newkey)')]),e._v(" "),_("h1",{attrs:{id:"delete-members-from-the-sorted-set-in-batche-of-100s"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#delete-members-from-the-sorted-set-in-batche-of-100s"}},[e._v("#")]),e._v(" Delete members from the sorted set in batche of 100s")]),e._v(" "),_("p",[e._v("while redis.ZCARD(newkey) > 0")]),e._v(" "),_("p",[e._v("redis.ZREMRANGEBYRANK(newkey, 0, 99)\nend")]),e._v(" "),_("p",[e._v("é›†åˆï¼š")]),e._v(" "),_("h1",{attrs:{id:"rename-the-key-2"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#rename-the-key-2"}},[e._v("#")]),e._v(" Rename the key")]),e._v(" "),_("p",[e._v('newkey = "gc:hashes:" + redis.INCR("gc:index")\nredis.RENAME("my.set.key", newkey)')]),e._v(" "),_("h1",{attrs:{id:"delete-members-from-the-set-in-batches-of-100"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#delete-members-from-the-set-in-batches-of-100"}},[e._v("#")]),e._v(" Delete members from the set in batches of 100")]),e._v(" "),_("p",[e._v("cursor = 0")]),e._v(" "),_("p",[e._v("loop")]),e._v(" "),_("p",[e._v('cursor, members = redis.SSCAN(newkey, cursor, "COUNT", 100)\nif size of members > 0')]),e._v(" "),_("p",[e._v("redis.SREM(newkey, members)\nend")]),e._v(" "),_("p",[e._v("if cursor == 0\nbreak")]),e._v(" "),_("p",[e._v("end\nend")]),e._v(" "),_("p",[e._v("102")]),e._v(" "),_("p",[e._v("å»¶è¿Ÿè€ƒè™‘")]),e._v(" "),_("p",[e._v("åˆ—è¡¨ï¼š")]),e._v(" "),_("h1",{attrs:{id:"rename-the-key-3"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#rename-the-key-3"}},[e._v("#")]),e._v(" Rename the key")]),e._v(" "),_("p",[e._v('newkey = "gc:hashes:" + redis.INCR("gc:index")\nredis.RENAME("my.list.key", newkey)')]),e._v(" "),_("h1",{attrs:{id:"trim-off-elements-in-batche-of-100s"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#trim-off-elements-in-batche-of-100s"}},[e._v("#")]),e._v(" Trim off elements in batche of 100s")]),e._v(" "),_("p",[e._v("while redis.LLEN(newkey) > 0")]),e._v(" "),_("p",[e._v("redis.LTRIM(newkey, 0, -99)\nend")]),e._v(" "),_("p",[e._v("Hashï¼š")]),e._v(" "),_("h1",{attrs:{id:"rename-the-key-4"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#rename-the-key-4"}},[e._v("#")]),e._v(" Rename the key")]),e._v(" "),_("p",[e._v('newkey = "gc:hashes:" + redis.INCR( "gc:index" )\nredis.RENAME("my.hash.key", newkey)')]),e._v(" "),_("h1",{attrs:{id:"delete-fields-from-the-hash-in-batche-of-100s"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#delete-fields-from-the-hash-in-batche-of-100s"}},[e._v("#")]),e._v(" Delete fields from the hash in batche of 100s")]),e._v(" "),_("p",[e._v("cursor = 0")]),e._v(" "),_("p",[e._v("loop")]),e._v(" "),_("p",[e._v('cursor, hash_keys = redis.HSCAN(newkey, cursor, "COUNT", 100)\nif hash_keys count > 0')]),e._v(" "),_("p",[e._v("redis.HDEL(newkey, hash_keys)\nend")]),e._v(" "),_("p",[e._v("if cursor == 0\nbreak")]),e._v(" "),_("p",[e._v("end\nend")]),e._v(" "),_("ol",{attrs:{start:"4"}},[_("li",[_("p",[e._v("å°½å¯èƒ½ä½¿ç”¨ä¸è¦è¶…è¿‡1Må¤§å°çš„kvã€‚")])]),e._v(" "),_("li",[_("p",[e._v("å‡å°‘å¯¹å¤§æ•°æ®é›†çš„é«˜æ—¶é—´å¤æ‚åº¦çš„æ“ä½œï¼šæ ¹æ®å¤æ‚åº¦è®¡ç®—ï¼Œå¦‚\nä¸‹å‘½ä»¤å¯ä»¥ä¼˜åŒ–:")])])]),e._v(" "),_("p",[e._v("103")]),e._v(" "),_("p",[e._v("å»¶è¿Ÿè€ƒè™‘")]),e._v(" "),_("ol",{attrs:{start:"6"}},[_("li",[e._v("å°½å¯èƒ½ä½¿ç”¨pipelineæ“ä½œï¼šä¸€æ¬¡æ€§çš„å‘é€å‘½ä»¤æ¯”ä¸€ä¸ªä¸ªå‘è¦å‡\nå°‘ç½‘ç»œå»¶è¿Ÿå’Œå•ä¸ªå¤„ç†å¼€é”€ã€‚ä¸€ä¸ªæ€§èƒ½æµ‹è¯•ç»“æœä¸ºï¼ˆæ³¨æ„å¹¶ä¸æ˜¯\npipelineè¶Šå¤§æ•ˆç‡è¶Šé«˜ï¼Œæ³¨æ„æœ€åä¸€ä¸ªæµ‹è¯•ç»“æœï¼‰ :")])]),e._v(" "),_("p",[e._v("logger@BIGD1TMP:~> redis-benchmark -q -r 100000 -n 1000000 -c 50\nPING_INLINE: 90155.07 requests per second")]),e._v(" "),_("p",[e._v("PING_BULK: 92302.02 requests per second\nSET: 85070.18 requests per second")]),e._v(" "),_("p",[e._v("GET: 86184.61 requests per second")]),e._v(" "),_("p",[e._v("logger@BIGD1TMP:~> redis-benchmark -q -r 100000 -n 1000000 -c 50 -P 10\nPING_INLINE: 558035.69 requests per second")]),e._v(" "),_("p",[e._v("PING_BULK: 668002.69 requests per second\nSET: 275027.50 requests per second")]),e._v(" "),_("p",[e._v("GET: 376647.84 requests per second")]),e._v(" "),_("p",[e._v("logger@BIGD1TMP:~> redis-benchmark -q -r 100000 -n 1000000 -c 50 -P 20\nPING_INLINE: 705716.25 requests per second")]),e._v(" "),_("p",[e._v("PING_BULK: 869565.25 requests per second\nSET: 343406.59 requests per second")]),e._v(" "),_("p",[e._v("GET: 459347.72 requests per second")]),e._v(" "),_("p",[e._v("logger@BIGD1TMP:~> redis-benchmark -q -r 100000 -n 1000000 -c 50 -P 50\nPING_INLINE: 940733.81 requests per second")]),e._v(" "),_("p",[e._v("PING_BULK: 1317523.00 requests per second\nSET: 380807.31 requests per second")]),e._v(" "),_("p",[e._v("GET: 523834.47 requests per second")]),e._v(" "),_("p",[e._v("logger@BIGD1TMP:~> redis-benchmark -q -r 100000 -n 1000000 -c 50 -P 100\nPING_INLINE: 999000.94 requests per second")]),e._v(" "),_("p",[e._v("PING_BULK: 1440922.12 requests per second\nSET: 386996.88 requests per second")]),e._v(" "),_("p",[e._v("GET: 602046.94 requests per second")]),e._v(" "),_("p",[e._v("logger@BIGD1TMP:~> redis-benchmark -q -r 100000 -n 1000000 -c 50 -P 200\nPING_INLINE: 1078748.62 requests per second")]),e._v(" "),_("p",[e._v("PING_BULK: 1381215.50 requests per second\nSET: 379218.81 requests per second")]),e._v(" "),_("p",[e._v("GET: 537634.38 requests per second")]),e._v(" "),_("p",[e._v("104")]),e._v(" "),_("p",[e._v("å»¶è¿Ÿè€ƒè™‘")]),e._v(" "),_("p",[e._v("ä¸€ä¸ªåœºæ™¯æ˜¯ä¸€ä¸ªè´­ç‰©è½¦çš„è®¾è®¡ï¼Œä¸€èˆ¬çš„è®¾è®¡æ€è·¯æ˜¯ï¼š")]),e._v(" "),_("p",[e._v("åœ¨è·å–è´­ç‰©è½¦å†…éƒ¨è´§å“æ—¶ï¼Œä¸ä½¿ç”¨pipelineä¼šå¾ˆä½æ•ˆï¼š")]),e._v(" "),_("p",[e._v("å¯ä»¥ä¿®æ”¹ä¸ºï¼š")]),e._v(" "),_("ol",{attrs:{start:"7"}},[_("li",[_("p",[e._v("å¦‚æœå‡ºç°é¢‘ç¹å¯¹stringè¿›è¡Œappendæ“ä½œï¼Œåˆ™è¯·ä½¿ç”¨listè¿›è¡Œ\npushæ“ä½œï¼Œå–å‡ºæ—¶ä½¿ç”¨popã€‚è¿™æ ·é¿å…stringé¢‘ç¹åˆ†é…å†…å­˜å¯¼è‡´\nçš„å»¶æ—¶ã€‚")])]),e._v(" "),_("li",[_("p",[e._v("å¦‚æœè¦sortçš„é›†åˆéå¸¸å¤§çš„è¯æ’åºå°±ä¼šæ¶ˆè€—å¾ˆé•¿æ—¶é—´ã€‚ç”±äº\nrediså•çº¿ç¨‹çš„ï¼Œæ‰€ä»¥é•¿æ—¶é—´çš„æ’åºæ“ä½œä¼šé˜»å¡å…¶ä»–clientçš„ è¯·\næ±‚ã€‚è§£å†³åŠæ³•æ˜¯é€šè¿‡ä¸»ä»å¤åˆ¶æœºåˆ¶å°†æ•°æ®å¤åˆ¶åˆ°å¤šä¸ªslaveä¸Šã€‚\nç„¶åæˆ‘ä»¬åªåœ¨slaveä¸Šåšæ’åºæ“ä½œã€‚æŠŠå¯èƒ½çš„å¯¹æ’åºç»“æœç¼“å­˜ã€‚\nå¦å¤–å°±æ˜¯ä¸€ä¸ªæ–¹æ¡ˆæ˜¯å°±æ˜¯é‡‡ç”¨sorted setå¯¹éœ€è¦æŒ‰æŸä¸ªé¡ºåºè®¿é—®\nçš„é›†åˆå»º ç´¢å¼•ã€‚")])])]),e._v(" "),_("p",[e._v("105")]),e._v(" "),_("p",[e._v("å»¶è¿Ÿè€ƒè™‘")]),e._v(" "),_("p",[e._v("106")]),e._v(" "),_("p",[e._v("å…¸å‹ä½¿ç”¨åœºæ™¯å‚è€ƒ")]),e._v(" "),_("p",[e._v("4.6 å…¸å‹ä½¿ç”¨åœºæ™¯å‚è€ƒ")]),e._v(" "),_("p",[e._v("ä¸‹é¢æ˜¯Redisé€‚ç”¨çš„ä¸€äº›åœºæ™¯:")]),e._v(" "),_("ol",[_("li",[e._v("å–æœ€æ–° N ä¸ªæ•°æ®çš„æ“ä½œ")])]),e._v(" "),_("p",[e._v("æ¯”å¦‚å…¸å‹çš„å–ä½ ç½‘ç«™çš„æœ€æ–°æ–‡ç« ï¼Œé€šè¿‡ä¸‹é¢æ–¹å¼ï¼Œæˆ‘ä»¬å¯ä»¥å°†æœ€æ–°çš„ 5000æ¡è¯„è®ºçš„IDæ”¾åœ¨\nRedisçš„Listé›†åˆä¸­ï¼Œå¹¶å°†è¶…å‡ºé›†åˆéƒ¨åˆ†ä»æ•°æ®åº“è·å–ã€‚")]),e._v(" "),_("p",[e._v("ä½¿ç”¨LPUSH latest.commentså‘½ä»¤ï¼Œå‘ listé›†åˆä¸­æ’å…¥æ•°æ® æ’å…¥å®Œæˆåå†ç”¨ LTRIM\nlatest.comments 0 5000 å‘½ä»¤ä½¿å…¶æ°¸è¿œåªä¿å­˜æœ€è¿‘5000ä¸ª ID ç„¶åæˆ‘ä»¬åœ¨å®¢æˆ·ç«¯è·å–æŸä¸€é¡µè¯„\nè®ºæ—¶å¯ä»¥ç”¨ä¸‹é¢çš„é€»è¾‘")]),e._v(" "),_("p",[e._v("FUNCTION get_latest_comments(start,num_items):")]),e._v(" "),_("p",[e._v('id_list = redis.lrange("latest.comments",start,start+num_items-1)')]),e._v(" "),_("p",[e._v("IF id_list.length < num_items")]),e._v(" "),_("p",[e._v('id_list = SQL_DB("SELECT ... ORDER BY time LIMIT ...")\nEND')]),e._v(" "),_("p",[e._v("RETURN id_list\nEND")]),e._v(" "),_("p",[e._v("å¦‚æœä½ è¿˜æœ‰ä¸åŒçš„ç­›é€‰ç»´åº¦ï¼Œæ¯”å¦‚æŸä¸ªåˆ†ç±»çš„æœ€æ–° N æ¡ï¼Œé‚£ä¹ˆä½ å¯ä»¥å†å»ºä¸€ä¸ªæŒ‰æ­¤åˆ†ç±»çš„")]),e._v(" "),_("p",[e._v("Listï¼Œåªå­˜IDçš„è¯ï¼ŒRedisæ˜¯éå¸¸é«˜æ•ˆçš„ã€‚")]),e._v(" "),_("ol",{attrs:{start:"2"}},[_("li",[e._v("æ’è¡Œæ¦œåº”ç”¨ï¼Œå– TOP N æ“ä½œ")])]),e._v(" "),_("p",[e._v("è¿™ä¸ªéœ€æ±‚ä¸ä¸Šé¢éœ€æ±‚çš„ä¸åŒä¹‹å¤„åœ¨äºï¼Œå‰é¢æ“ä½œä»¥æ—¶é—´ä¸ºæƒé‡ï¼Œè¿™ä¸ªæ˜¯ä»¥æŸä¸ªæ¡ä»¶ä¸ºæƒé‡ï¼Œ\næ¯”å¦‚æŒ‰é¡¶çš„æ¬¡æ•°æ’åºï¼Œè¿™æ—¶å€™å°±éœ€è¦æˆ‘ä»¬çš„ sorted setå‡ºé©¬äº†ï¼Œå°†ä½ è¦æ’åºçš„å€¼è®¾ç½®æˆ sorted\nsetçš„scoreï¼Œå°†å…·ä½“çš„æ•°æ®è®¾ç½®æˆç›¸åº”çš„ valueï¼Œæ¯æ¬¡åªéœ€è¦æ‰§è¡Œä¸€æ¡ZADDå‘½ä»¤å³å¯ã€‚")]),e._v(" "),_("p",[e._v("107")]),e._v(" "),_("p",[e._v("å…¸å‹ä½¿ç”¨åœºæ™¯å‚è€ƒ")]),e._v(" "),_("p",[e._v("127.0.0.1:6379> zdd topapp 1 weixin\n(error) ERR unknown command 'zdd'\n127.0.0.1:6379> zadd topapp 1 weixin")]),e._v(" "),_("p",[e._v("(integer) 1")]),e._v(" "),_("p",[e._v("127.0.0.1:6379> zadd topapp 1 QQ")]),e._v(" "),_("p",[e._v("(integer) 1")]),e._v(" "),_("p",[e._v("127.0.0.1:6379> zadd topapp 2 meituan")]),e._v(" "),_("p",[e._v("(integer) 1")]),e._v(" "),_("p",[e._v("127.0.0.1:6379> zincrby topapp 1 meituan")]),e._v(" "),_("p",[e._v('"3"')]),e._v(" "),_("p",[e._v("127.0.0.1:6379> zincrby topapp 1 QQ")]),e._v(" "),_("p",[e._v('"2"')]),e._v(" "),_("p",[e._v("127.0.0.1:6379> zrank topapp QQ\n(integer) 1")]),e._v(" "),_("ol",{attrs:{start:"3"}},[_("li",[e._v('"meituan"')])]),e._v(" "),_("p",[e._v("127.0.0.1:6379> zrank topapp weixin\n(integer) 0")]),e._v(" "),_("p",[e._v("127.0.0.1:6379> zrange topapp 0 -1")]),e._v(" "),_("ol",[_("li",[_("p",[e._v('"weixin"')])]),e._v(" "),_("li",[_("p",[e._v('"QQ"')])])]),e._v(" "),_("p",[e._v("3.éœ€è¦ç²¾å‡†è®¾å®šè¿‡æœŸæ—¶é—´çš„åº”ç”¨")]),e._v(" "),_("p",[e._v("æ¯”å¦‚ä½ å¯ä»¥æŠŠä¸Šé¢è¯´åˆ°çš„ sorted set çš„ score å€¼è®¾ç½®æˆè¿‡æœŸæ—¶é—´çš„æ—¶é—´æˆ³ï¼Œé‚£ä¹ˆå°±å¯ä»¥ç®€å•\nåœ°é€šè¿‡è¿‡æœŸæ—¶é—´æ’åºï¼Œå®šæ—¶æ¸…é™¤è¿‡æœŸæ•°æ®äº†ï¼Œä¸ä»…æ˜¯æ¸…é™¤ Redisä¸­çš„è¿‡æœŸæ•°æ®ï¼Œä½ å®Œå…¨å¯ä»¥æŠŠ\nRedis é‡Œè¿™ä¸ªè¿‡æœŸæ—¶é—´å½“æˆæ˜¯å¯¹æ•°æ®åº“ä¸­æ•°æ®çš„ç´¢å¼•ï¼Œç”¨ Redis æ¥æ‰¾å‡ºå“ªäº›æ•°æ®éœ€è¦è¿‡æœŸåˆ \né™¤ï¼Œç„¶åå†ç²¾å‡†åœ°ä»æ•°æ®åº“ä¸­åˆ é™¤ç›¸åº”çš„è®°å½•ã€‚")]),e._v(" "),_("p",[e._v("4.è®¡æ•°å™¨åº”ç”¨")]),e._v(" "),_("p",[e._v("Redisçš„å‘½ä»¤éƒ½æ˜¯åŸå­æ€§çš„ï¼Œä½ å¯ä»¥è½»æ¾åœ°åˆ©ç”¨ INCRï¼ŒDECR å‘½ä»¤æ¥æ„å»ºè®¡æ•°å™¨ç³»ç»Ÿã€‚")]),e._v(" "),_("p",[e._v("5.Uniq æ“ä½œï¼Œè·å–æŸæ®µæ—¶é—´æ‰€æœ‰æ•°æ®æ’é‡å€¼")]),e._v(" "),_("p",[e._v("è¿™ä¸ªä½¿ç”¨Redisçš„ setæ•°æ®ç»“æ„æœ€åˆé€‚äº†ï¼Œåªéœ€è¦ä¸æ–­åœ°å°†æ•°æ®å¾€ setä¸­æ‰”å°±è¡Œäº†ï¼Œsetæ„ä¸ºé›†\nåˆï¼Œæ‰€ä»¥ä¼šè‡ªåŠ¨æ’é‡ã€‚")]),e._v(" "),_("p",[e._v("6.å®æ—¶ç³»ç»Ÿï¼Œååƒåœ¾ç³»ç»Ÿ")]),e._v(" "),_("p",[e._v("é€šè¿‡ä¸Šé¢è¯´åˆ°çš„ setåŠŸèƒ½ï¼Œä½ å¯ä»¥çŸ¥é“ä¸€ä¸ªç»ˆç«¯ç”¨æˆ·æ˜¯å¦è¿›è¡Œäº†æŸä¸ªæ“ä½œï¼Œå¯ä»¥æ‰¾åˆ°å…¶æ“ä½œçš„\né›†åˆå¹¶è¿›è¡Œåˆ†æç»Ÿè®¡å¯¹æ¯”ç­‰ã€‚")]),e._v(" "),_("p",[e._v("7.Pub/Sub æ„å»ºå®æ—¶æ¶ˆæ¯ç³»ç»Ÿ")]),e._v(" "),_("p",[e._v("108")]),e._v(" "),_("p",[e._v("å…¸å‹ä½¿ç”¨åœºæ™¯å‚è€ƒ")]),e._v(" "),_("p",[e._v("Redis çš„ Pub/Sub ç³»ç»Ÿå¯ä»¥æ„å»ºå®æ—¶çš„æ¶ˆæ¯ç³»ç»Ÿï¼Œæ¯”å¦‚å¾ˆå¤šç”¨ Pub/Sub æ„å»ºçš„å®æ—¶èŠå¤©ç³»ç»Ÿ\nçš„ä¾‹å­ã€‚")]),e._v(" "),_("p",[e._v("8.æ„å»ºé˜Ÿåˆ—ç³»ç»Ÿ")]),e._v(" "),_("p",[e._v("ä½¿ç”¨listå¯ä»¥æ„å»ºé˜Ÿåˆ—ç³»ç»Ÿï¼Œä½¿ç”¨ sorted setç”šè‡³å¯ä»¥æ„å»ºæœ‰ä¼˜å…ˆçº§çš„é˜Ÿåˆ—ç³»ç»Ÿã€‚")]),e._v(" "),_("p",[e._v("9.ç¼“å­˜")]),e._v(" "),_("p",[e._v("æ€§èƒ½ä¼˜äºMemcachedï¼Œæ•°æ®ç»“æ„æ›´å¤šæ ·åŒ–ã€‚ä½œä¸ºRDBMSçš„å‰ç«¯æŒ¡ç®­ç‰Œï¼Œrediså¯ä»¥å¯¹ä¸€äº›ä½¿\nç”¨é¢‘ç‡æé«˜çš„sqlæ“ä½œè¿›è¡Œcacheï¼Œæ¯”å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥æ ¹æ®sqlçš„hashè¿›è¡ŒSQLç»“æœçš„ç¼“å­˜ï¼š")]),e._v(" "),_("p",[e._v("def get_results(sql):")]),e._v(" "),_("p",[e._v("hash = md5.new(sql).digest()\nresult = redis.get(hash)")]),e._v(" "),_("p",[e._v("if result is None:")]),e._v(" "),_("p",[e._v("result = db.execute(sql)\nredis.set(hash, result)")]),e._v(" "),_("h1",{attrs:{id:"or-use-redis-setex-to-set-a-ttl-for-the-key"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#or-use-redis-setex-to-set-a-ttl-for-the-key"}},[e._v("#")]),e._v(" or use redis.setex to set a TTL for the key")]),e._v(" "),_("p",[e._v("return result")]),e._v(" "),_("p",[e._v("10.ä½¿ç”¨setbitè¿›è¡Œç»Ÿè®¡è®¡æ•°")]),e._v(" "),_("p",[e._v("ä¸‹è¾¹çš„ä¾‹å­æ˜¯è®°å½•UV")]),e._v(" "),_("p",[e._v("109")]),e._v(" "),_("p",[e._v("å…¸å‹ä½¿ç”¨åœºæ™¯å‚è€ƒ")]),e._v(" "),_("p",[e._v("#!/usr/bin/python\nimport redis")]),e._v(" "),_("p",[e._v("from bitarray import bitarray\nfrom datetime import date")]),e._v(" "),_("p",[e._v("r=redis.Redis(host='localhost', port=6379, db=0)\ntoday=date.today().strftime('%Y-%m-%d')")]),e._v(" "),_("p",[e._v("def bitcount(n):\nlen(bin(n)-2)")]),e._v(" "),_("p",[e._v("def setup():\nr.delete('user:'+today)\nr.setbit('user:'+today,100,0)")]),e._v(" "),_("p",[e._v("def setuniquser(uid):\nr.setbit('user:'+today,uid,1)")]),e._v(" "),_("p",[e._v("def countuniquser():")]),e._v(" "),_("p",[e._v("a = bitarray()\na.frombytes(r.get('user:'+today),)\nprint           a")]),e._v(" "),_("p",[e._v("print a.count()")]),e._v(" "),_("p",[e._v("if   name  =='  main  ':")]),e._v(" "),_("p",[e._v("setup()\nsetuniquser(uid=0)\ncountuniquser()")]),e._v(" "),_("p",[e._v("11.ç»´æŠ¤å¥½å‹å…³ç³»")]),e._v(" "),_("p",[e._v("ä½¿ç”¨setè¿›è¡Œæ˜¯å¦ä¸ºå¥½å‹å…³ç³»ï¼Œå…±åŒå¥½å‹ç­‰æ“ä½œ")]),e._v(" "),_("p",[e._v("12.ä½¿ç”¨ Redis å®ç°è‡ªåŠ¨è¡¥å…¨åŠŸèƒ½")]),e._v(" "),_("p",[e._v("ä½¿ç”¨æœ‰åºé›†åˆä¿å­˜è¾“å…¥ç»“æœï¼š")]),e._v(" "),_("p",[e._v("ZADD word:a 0 apple 0 application 0 acfun 0 adobe")]),e._v(" "),_("p",[e._v("ZADD word:ap 0 apple 0 application")]),e._v(" "),_("p",[e._v("ZADD word:app 0 apple 0 application")]),e._v(" "),_("p",[e._v("ZADD word:appl 0 apple 0 application\nZADD word:apple 0 apple")]),e._v(" "),_("p",[e._v("ZADD word:appli 0 application")]),e._v(" "),_("p",[e._v("å†ä½¿ç”¨ä¸€ä¸ªæœ‰åºé›†åˆä¿å­˜çƒ­åº¦ï¼š")]),e._v(" "),_("p",[e._v("110")]),e._v(" "),_("p",[e._v("å…¸å‹ä½¿ç”¨åœºæ™¯å‚è€ƒ")]),e._v(" "),_("p",[e._v("ZADD word_scores 100 apple 80 adobe 70 application 60 acfun")]),e._v(" "),_("p",[e._v("å–ç»“æœæ—¶é‡‡ç”¨äº¤é›†æ“ä½œï¼š")]),e._v(" "),_("p",[e._v("ZINTERSTORE word_result 2 word_scores word:a WEIGHTS 1 1")]),e._v(" "),_("p",[e._v("ZRANGE word_result 0 -1 withscores")]),e._v(" "),_("ol",{attrs:{start:"13"}},[_("li",[e._v("å¯é é˜Ÿåˆ—è®¾è®¡")])]),e._v(" "),_("p",[e._v("â€¢ UUIDs as Surrogate Keys Our strategy spreads information about the state of an item in\nthe queue across a number of Redis data structures, requiring the use of a per-item\nsurrogate key to tie them together. The UUID is a good choice here because 1) they are\nquick   to generate, and 2) can be generated by the clients in a decentralized manner. â€¢\nPending List The Pending List holds the generated UUIDs for the items that have been\nenqueued(), and are ready to be processed. It is a RedisList, presenting the generated\nUUIDs     in FIFO order. â€¢ Values Hash The Values Hash holds the actual items that have been\nenqueued. It is a Redis Hash, mapping the generated UUID to the binary form of the the\nitem.   This is the only representation of the original item that will appear in any of the data\nstructures. â€¢ Stats Hash The Stats Hash records some timestamps and counts for each of\nthe  items. Specifically: â€¢ enqueue time â€¢ last dequeue time â€¢ dequeue count â€¢ last requeue\ntime â€¢ last requeue count. It is a Redis Hash, mapping the generated UUID to a custom data\nstructure that holds this data in a packed, binary form. Why keep stats on a per-item basis?\nWe find it really useful for debugging (e.g. do we have a bad apple item that is being\ncontinuously requeued?), and for understanding how far behind we are if queues start to\nback    up. Furthermore, the cost is only ~40 bytes per item, much smaller than our typical\nqueued items. â€¢ Working Set The Working Set holds the set of UUIDs that have been\ndequeued(), and are currently being processed. It is a Redis Sorted Set, and scores each of\nthe UUIDs by a pre-calculated, millisecond timestamp. Any object that has exceeded its\nassigned timeout is considered abandoned, and is available to be reclaimed. â€¢ Delay Set")]),e._v(" "),_("p",[e._v("111")]),e._v(" "),_("p",[e._v("å…¸å‹ä½¿ç”¨åœºæ™¯å‚è€ƒ")]),e._v(" "),_("p",[e._v("The Delay Set holds the set of UUIDs that have been requeued() with a per-item deferment.\nIt is a Redis Sorted Set, and scores each of the UUIDs by a pre-calculated, millisecond\ntimestamp. Once the deferment timestamp has expired, the item will be returned to the\nPending  List. Why support per-item deferment? We have a number of use cases where we\nmight want to backoff specific pieces of work â€” maybe an underlying resource is too busy")]),e._v(" "),_("p",[e._v("â€” without backing off the entire queue. Per-item deferment lets us say, â€œrequeue this item,\nbut donâ€™t make it available for dequeue for another n seconds.â€")]),e._v(" "),_("p",[e._v("112")]),e._v(" "),_("p",[e._v("å®¢æˆ·ç«¯æ¨è")]),e._v(" "),_("p",[e._v("4.7 å®¢æˆ·ç«¯æ¨è")]),e._v(" "),_("p",[e._v("4.7.1 Redis-Pythoné©±åŠ¨çš„å®‰è£…å’Œä½¿ç”¨")]),e._v(" "),_("p",[e._v("unzip redis-py-master.zip\ncd redis-py-master/")]),e._v(" "),_("p",[e._v("sudo python setup.py install")]),e._v(" "),_("p",[e._v("å®Œæˆåimport rediså³å¯ã€‚")]),e._v(" "),_("p",[e._v("4.7.2 Redis-Javaå®¢æˆ·ç«¯æ¨è")]),e._v(" "),_("ol",[_("li",[_("p",[e._v("Jedis ï¼šhttps://github.com/xetorthio/jedis é‡ç‚¹æ¨è")])]),e._v(" "),_("li",[_("p",[e._v("Spring Data redis ï¼šhttps://github.com/spring-projects/spring-data-redis ä½¿ç”¨Springæ¡†æ¶\næ—¶æ¨è")])]),e._v(" "),_("li",[_("p",[e._v("Redisson ï¼šhttps://github.com/mrniko/redisson åˆ†å¸ƒå¼é”ã€é˜»å¡é˜Ÿåˆ—çš„æ—¶é‡ç‚¹æ¨è")])])]),e._v(" "),_("p",[e._v("4.7.3 Redis-Cå®¢æˆ·ç«¯æ¨è")]),e._v(" "),_("p",[e._v("Hiredisæ˜¯redisæ•°æ®åº“ä¸€ä¸ªå®˜æ–¹æ¨èçš„Cè¯­è¨€redis clientåº“ã€‚")]),e._v(" "),_("p",[e._v("113")]),e._v(" "),_("p",[e._v("ä¸Šçº¿éƒ¨ç½²è§„åˆ’")]),e._v(" "),_("ol",{attrs:{start:"5"}},[_("li",[e._v("ä¸Šçº¿éƒ¨ç½²è§„åˆ’")])]),e._v(" "),_("p",[e._v("114")]),e._v(" "),_("p",[e._v("å†…å­˜è§„åˆ’")]),e._v(" "),_("p",[e._v("5.1 å†…å­˜ã€CPUè§„åˆ’")]),e._v(" "),_("p",[e._v("ä¸€å®šè¦è®¾ç½®æœ€å¤§å†…å­˜maxmemoryå‚æ•°ï¼Œå¦åˆ™ç‰©ç†å†…å­˜ç”¨çˆ†äº†å°±ä¼šå¤§é‡ä½¿ç”¨Swapï¼Œå†™RDBæ–‡\nä»¶æ—¶çš„é€Ÿåº¦å¾ˆæ…¢ã€‚æ³¨æ„è¿™ä¸ªå‚æ•°æŒ‡çš„æ˜¯infoä¸­çš„used_memoryï¼Œåœ¨ä¸€äº›ä¸åˆ©äºjmallocçš„æ—¶\nå€™ï¼Œå†…å­˜ç¢ç‰‡ä¼šå¾ˆå¤§ã€‚")]),e._v(" "),_("p",[e._v("å¤šç•™55%å†…å­˜æ˜¯æœ€å®‰å…¨çš„ã€‚é‡å†™AOFæ–‡ä»¶å’ŒRDBæ–‡ä»¶çš„è¿›ç¨‹(å³ä½¿ä¸åšæŒä¹…åŒ–ï¼Œå¤åˆ¶åˆ°Slave\nçš„æ—¶å€™ä¹Ÿè¦å†™RDB)ä¼šforkå‡ºä¸€æ¡æ–°è¿›ç¨‹æ¥ï¼Œé‡‡ç”¨äº†æ“ä½œç³»ç»Ÿçš„Copy-On-Writeç­–ç•¥(å­è¿›ç¨‹ä¸\nçˆ¶è¿›ç¨‹å…±äº«Pageã€‚å¦‚æœçˆ¶è¿›ç¨‹çš„Page-æ¯é¡µ4Kæœ‰ä¿®æ”¹ï¼Œçˆ¶è¿›ç¨‹è‡ªå·±åˆ›å»ºé‚£ä¸ªPageçš„å‰¯æœ¬ï¼Œä¸\nä¼šå½±å“åˆ°å­è¿›ç¨‹)ã€‚")]),e._v(" "),_("p",[e._v("å¦å¤–ï¼Œéœ€è¦è€ƒè™‘å†…å­˜ç¢ç‰‡ï¼Œå‡è®¾ç¢ç‰‡ä¸º1.2ï¼Œåˆ™å¦‚æœæœºå™¨ä¸º64Gï¼Œé‚£ä¹ˆ64*45%/1.2 = 24Gä½œä¸º\nmaxmemoryæ˜¯æ¯”è¾ƒå®‰å…¨çš„è§„åˆ’ã€‚")]),e._v(" "),_("p",[e._v('ç•™æ„Consoleæ‰“å‡ºæ¥çš„æŠ¥å‘Šï¼Œå¦‚"RDB: 1215 MB of memory used by copy-on-write"ã€‚åœ¨ç³»ç»Ÿ\næåº¦ç¹å¿™æ—¶ï¼Œå¦‚æœçˆ¶è¿›ç¨‹çš„æ‰€æœ‰Pageåœ¨å­è¿›ç¨‹å†™RDBè¿‡ç¨‹ä¸­éƒ½è¢«ä¿®æ”¹è¿‡äº†ï¼Œå°±éœ€è¦ä¸¤å€å†…\nå­˜ã€‚')]),e._v(" "),_("p",[e._v("æŒ‰ç…§Rediså¯åŠ¨æ—¶çš„æé†’ï¼Œè®¾ç½®")]),e._v(" "),_("p",[e._v('echo "vm.overcommit_memory = 1" >> /etc/sysctl.conf')]),e._v(" "),_("p",[e._v("ä½¿å¾—fork()ä¸€æ¡10Gçš„è¿›ç¨‹æ—¶ï¼Œå› ä¸ºCOWç­–ç•¥è€Œä¸ä¸€å®šéœ€è¦æœ‰10Gçš„free memoryã€‚")]),e._v(" "),_("p",[e._v("å¦å¤–ï¼Œè®°å¾—å…³é—­THPï¼Œè¿™ä¸ªé»˜è®¤çš„Linuxå†…å­˜é¡µé¢å¤§å°åˆ†é…ç­–ç•¥ä¼šå¯¼è‡´RDBæ—¶å‡ºç°å·¨å¤§çš„")]),e._v(" "),_("p",[e._v("latencyå’Œå·¨å¤§çš„å†…å­˜å ç”¨ã€‚å…³é—­æ–¹æ³•ä¸ºï¼š")]),e._v(" "),_("p",[e._v("echo never > /sys/kernel/mm/transparent_hugepage/enabled\necho never > /sys/kernel/mm/transparent_hugepage/defrag")]),e._v(" "),_("p",[e._v("å½“æœ€å¤§å†…å­˜åˆ°è¾¾æ—¶ï¼ŒæŒ‰ç…§é…ç½®çš„Policyè¿›è¡Œå¤„ç†ï¼Œ é»˜è®¤ç­–ç•¥ä¸ºvolatile-lruï¼Œå¯¹è®¾ç½®äº†expire\ntimeçš„keyè¿›è¡ŒLRUæ¸…é™¤(ä¸æ˜¯æŒ‰å®é™…expire time)ã€‚å¦‚æœæ²’æœ‰æ•°æ®è®¾ç½®äº†expire timeæˆ–è€…policy\nä¸ºnoevictionï¼Œåˆ™ç›´æ¥æŠ¥é”™ï¼Œä½†æ­¤æ—¶ç³»ç»Ÿä»æ”¯æŒgetä¹‹ç±»çš„è¯»æ“ä½œã€‚ å¦å¤–è¿˜æœ‰å‡ ç§policyï¼Œæ¯”å¦‚\nvolatile-ttlæŒ‰æœ€æ¥è¿‘expire timeçš„ï¼Œallkeys-lruå¯¹æ‰€æœ‰keyéƒ½åšLRUã€‚æ³¨æ„åœ¨ä¸€èˆ¬çš„ç¼“å­˜ç³»ç»Ÿ")]),e._v(" "),_("p",[e._v("ä¸­ï¼Œå¦‚æœæ²¡æœ‰è®¾ç½®è¶…æ—¶æ—¶é—´ï¼Œåˆ™lruçš„ç­–ç•¥éœ€è¦è®¾ç½®ä¸ºallkeys-lruï¼Œå¹¶ä¸”åº”ç”¨éœ€è¦åšå¥½æœªå‘½ä¸­çš„\nå¼‚å¸¸å¤„ç†ã€‚ç‰¹æ®Šçš„ï¼Œå½“rediså½“åšDBæ—¶ï¼Œè¯·ä½¿ç”¨nonevictionç­–ç•¥ï¼Œä½†æ˜¯éœ€è¦å¯¹ç³»ç»Ÿå†…å­˜ç›‘æ§åŠ \nå¼ºç²’åº¦ã€‚")]),e._v(" "),_("p",[e._v("CPUä¸æ±‚æ ¸æ•°å¤šï¼Œä½†æ±‚ä¸»é¢‘é«˜ï¼ŒCacheå¤§ï¼Œå› ä¸ºredisä¸»å¤„ç†æ¨¡å¼æ˜¯å•è¿›ç¨‹çš„ã€‚åŒæ—¶é¿å…ä½¿ç”¨\nè™šæ‹Ÿæœºã€‚")]),e._v(" "),_("p",[e._v("115")]),e._v(" "),_("p",[e._v("å†…å­˜è§„åˆ’")]),e._v(" "),_("p",[e._v("116")]),e._v(" "),_("p",[e._v("ç½‘å¡RPSè®¾ç½®")]),e._v(" "),_("p",[e._v("5.2 ç½‘å¡RPSè®¾ç½®")]),e._v(" "),_("p",[e._v("RPSå°±æ˜¯è®©ç½‘å¡ä½¿ç”¨å¤šæ ¸CPUçš„ã€‚ä¼ ç»Ÿæ–¹æ³•å°±æ˜¯ç½‘å¡å¤šé˜Ÿåˆ—ï¼ˆRSSï¼Œéœ€è¦ç¡¬ä»¶å’Œé©±åŠ¨æ”¯")]),e._v(" "),_("p",[e._v("æŒï¼‰ï¼ŒRPSåˆ™æ˜¯åœ¨ç³»ç»Ÿå±‚å®ç°äº†åˆ†å‘å’Œå‡è¡¡ã€‚å¦‚æœå¯¹redisç½‘ç»œå¤„ç†èƒ½åŠ›è¦æ±‚é«˜æˆ–è€…åœ¨ç”Ÿäº§ä¸Š\nå‘ç°cpu0çš„ï¼Œå¯ä»¥åœ¨OSå±‚é¢æ‰“å¼€è¿™ä¸ªå†…æ ¸åŠŸèƒ½ã€‚")]),e._v(" "),_("p",[e._v("è®¾ç½®è„šæœ¬ï¼š")]),e._v(" "),_("p",[e._v("#!/bin/bash")]),e._v(" "),_("h1",{attrs:{id:"enable-rps-receive-packet-steering"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#enable-rps-receive-packet-steering"}},[e._v("#")]),e._v(" Enable RPS (Receive Packet Steering)")]),e._v(" "),_("p",[e._v("rfc=32768")]),e._v(" "),_("p",[e._v("cc=$(grep -c processor /proc/cpuinfo)\nrsfe=$(echo $cc*$rfc | bc)")]),e._v(" "),_("p",[e._v("sysctl -w net.core.rps_sock_flow_entries=$rsfe")]),e._v(" "),_("p",[e._v("for fileRps in $(ls /sys/class/net/eth*/queues/rx-*/rps_cpus)\ndo")]),e._v(" "),_("p",[e._v("echo fff > $fileRps\ndone")]),e._v(" "),_("p",[e._v("for fileRfc in $(ls /sys/class/net/eth*/queues/rx-*/rps_flow_cnt)\ndo")]),e._v(" "),_("p",[e._v("echo $rfc > $fileRfc\ndone")]),e._v(" "),_("p",[e._v("tail /sys/class/net/eth*/queues/rx-*/{rps_cpus,rps_flow_cnt}")]),e._v(" "),_("p",[e._v("117")]),e._v(" "),_("p",[e._v("æœåŠ¡å™¨éƒ¨ç½²ä½ç½®")]),e._v(" "),_("p",[e._v("5.3 æœåŠ¡å™¨éƒ¨ç½²ä½ç½®")]),e._v(" "),_("p",[e._v("å°½å¯èƒ½æŠŠclientå’Œserveréƒ¨ç½²åœ¨åŒä¸€å°æœºå™¨ä¸Šï¼Œæ¯”å¦‚éƒ½éƒ¨ç½²åœ¨app serverï¼Œæˆ–è€…ä¸€ä¸ªç½‘æ®µä¸­ï¼Œå‡\nå°‘ç½‘ç»œå»¶è¿Ÿå¯¹äºredisçš„å½±å“ã€‚")]),e._v(" "),_("p",[e._v("å¦‚æœæ˜¯åŒä¸€å°æœºå™¨ï¼Œåˆæƒ³æ¦¨å¹²redisæ€§èƒ½å¯ä»¥è€ƒè™‘é‡‡ç”¨UNIX domain socketsé…ç½®æ–¹å¼ï¼Œé…ç½®æ–¹\nå¼å¦‚ä¸‹")]),e._v(" "),_("h1",{attrs:{id:"_0-do-not-listen-on-a-port"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#_0-do-not-listen-on-a-port"}},[e._v("#")]),e._v(" 0 = do not listen on a port")]),e._v(" "),_("p",[e._v("port 0")]),e._v(" "),_("h1",{attrs:{id:"listen-on-localhost-only"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#listen-on-localhost-only"}},[e._v("#")]),e._v(" listen on localhost only")]),e._v(" "),_("p",[e._v("bind 127.0.0.1")]),e._v(" "),_("h1",{attrs:{id:"create-a-unix-domain-socket-to-listen-on"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#create-a-unix-domain-socket-to-listen-on"}},[e._v("#")]),e._v(" create a unix domain socket to listen on")]),e._v(" "),_("p",[e._v("unixsocket /tmp/redis.sock")]),e._v(" "),_("h1",{attrs:{id:"set-permissions-for-the-socket"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#set-permissions-for-the-socket"}},[e._v("#")]),e._v(" set permissions for the socket")]),e._v(" "),_("p",[e._v("unixsocketperm 755")]),e._v(" "),_("p",[e._v("è¿™æ ·çš„é…ç½®æ–¹å¼åœ¨æ²¡æœ‰å¤§é‡pipelineä¸‹ä¼šæœ‰ä¸€å®šæ€§èƒ½æå‡ï¼Œå…·ä½“è¯·å‚è§")]),e._v(" "),_("p",[e._v("http://redis.io/topics/benchmarksï¼š")]),e._v(" "),_("p",[e._v("å¦å¤–ï¼Œå¯¹äºæ··åˆéƒ¨ç½²å³rediså’Œåº”ç”¨éƒ¨ç½²åœ¨åŒä¸€å°æœåŠ¡å™¨ä¸Šï¼Œé‚£ä¹ˆå¯èƒ½ä¼šå‡ºç°å¦‚ä¸‹çš„æƒ…å†µï¼š")]),e._v(" "),_("p",[e._v("å‡ºç°ç¬æ—¶ Redis å¤§é‡è¿æ¥å’Œå¤„ç†è¶…æ—¶ï¼Œåº”ç”¨ä¸šåŠ¡çº¿ç¨‹è¢«é˜»å¡ï¼Œå¯¼è‡´æœåŠ¡æ‹’ç»ï¼Œè¿‡ä¸€æ®µæ—¶\né—´å¯èƒ½åˆè‡ªåŠ¨æ¢å¤äº†ã€‚è¿™ç§ç¬æ—¶æ•…éšœéå¸¸éš¾æŠ“ç°åœºï¼Œä¸€å¤©æ¥ä¸Šå‡ å‘å°±ä¼šç»™äººä¸šåŠ¡ä¸ç¨³å®š\nçš„æ„Ÿå—ï¼Œè€Œä¸€èˆ¬åŸºç¡€æœºå™¨æŒ‡æ ‡çš„ç›‘æ§å‘¨æœŸåœ¨åˆ†é’Ÿçº§ã€‚ç¬æ—¶æ•…éšœå¯èƒ½å‘ç”Ÿåœ¨ç›‘æ§çš„é‡‡é›†é—´\néš™ï¼Œæ‰€ä»¥åªå¥½ä¸Šè„šæœ¬åœ¨ç§’çº§ç›‘æ§æ—¥å¿—ï¼Œå‘ç°ç¬æ—¶å‡ºç°å¤§é‡ Redis è¶…æ—¶é”™è¯¯ï¼Œå°±æ”¶é›†å½“æ—¶\nåº”ç”¨çš„ JVM å †æ ˆã€å†…å­˜å’Œæœºå™¨ CPU Load ç­‰å„é¡¹æŒ‡æ ‡ã€‚ç»ˆäºå‘ç°ç¬æ—¶æ•…éšœæ—¶åˆ» Redis\næœºå™¨ CPU Load å‡ºç°ç¬é—´é£™å‡å‡ ç™¾çš„ç°è±¡ï¼Œåº”ç”¨å’Œ Redis æ··åˆéƒ¨ç½²æ—¶åº”ç”¨å¯èƒ½ç¬é—´æŠ¢å \näº†å…¨éƒ¨ CPU å¯¼è‡´ Redis æ²¡æœ‰ CPU èµ„æºå¯ç”¨ã€‚è€Œåº”ç”¨å¤„ç†ä¸šåŠ¡çš„é€»è¾‘åˆå¯èƒ½éœ€è¦è®¿é—®\nRedisï¼Œè€Œ Redis åˆæ²¡æœ‰ CPU èµ„æºå¯ç”¨å¯¼è‡´è¶…æ—¶ï¼Œè¿™ä¸å°±åƒä¸€ä¸ªæ­»é”ä¹ˆã€‚ææ¸…æ¥šäº†åŸå› \nå…¶å®è§£å†³æ–¹æ³•ä¹Ÿç®€å•ï¼Œå°±æ˜¯åˆ†ç¦»åº”ç”¨å’Œ Redis çš„éƒ¨ç½²ï¼Œå„è‡ªèµ„æºéš”ç¦»")]),e._v(" "),_("p",[e._v("å‡ºå¤„ï¼š http://mp.weixin.qq.com/s?")]),e._v(" "),_("p",[e._v("biz=MzAxMTEyOTQ5OQ==&mid=402004912&idx=1&sn=7517696a86f54262e60e1b\n5636d6cbe0&3rd=MzA3MDU4NTYzMw==&scene=6#rd")]),e._v(" "),_("p",[e._v("å› æ­¤åœ¨æ··åˆéƒ¨ç½²ä¸‹è¦å¯¹æé™æ€§èƒ½è¿›è¡Œç›‘æ§ï¼Œæå‰å°†å¯èƒ½å‡ºç°æ€§èƒ½é—®é¢˜çš„åº”ç”¨è¿ç§»å‡ºæ¥ã€‚")]),e._v(" "),_("p",[e._v("118")]),e._v(" "),_("p",[e._v("æœåŠ¡å™¨éƒ¨ç½²ä½ç½®")]),e._v(" "),_("p",[e._v("119")]),e._v(" "),_("p",[e._v("æŒä¹…åŒ–è®¾ç½®")]),e._v(" "),_("p",[e._v("5.4 æŒä¹…åŒ–è®¾ç½®")]),e._v(" "),_("p",[e._v('RDBå’ŒAOFä¸¤è€…æ¯«æ— å…³ç³»ï¼Œå®Œå…¨ç‹¬ è¿è¡Œï¼Œå¦‚æœä½¿ç”¨äº†AOFï¼Œé‡å¯æ—¶åªä¼šä»AOFæ–‡ä»¶è½½å…¥æ•°\næ®ï¼Œä¸ä¼šå†ç®¡RDBæ–‡ä»¶ã€‚åœ¨é…ç½®ä¸Šæœ‰ä¸‰ç§é€‰æ‹©ï¼šä¸æŒä¹…åŒ–ï¼ŒRDBï¼ŒRDB+AOFã€‚å®˜æ–¹ä¸æ¨è\nåªå¼€å¯AOFï¼ˆå› ä¸ºæ¢å¤å¤ªæ…¢å¦å¤–å¦‚æœaofå¼•æ“æœ‰bugï¼‰ï¼Œé™¤éæ˜æ˜¾çš„è¯»å¤šå†™å°‘çš„åº”ç”¨ã€‚ å¼€å¯\nAOFæ—¶åº”å½“å…³é—­AOFè‡ªåŠ¨rewriteï¼Œå¹¶åœ¨crontabä¸­å¯åŠ¨åœ¨ä¸šåŠ¡ä½å³°æ—¶æ®µè¿›è¡Œçš„bgrewriteã€‚ å¦‚æœ\nåœ¨ä¸€å°æœºå™¨ä¸Šéƒ¨ç½²å¤šä¸ªrediså®ä¾‹ï¼Œåˆ™å…³é—­RDBå’ŒAOFçš„è‡ªåŠ¨ä¿å­˜ï¼ˆsave "", auto-aof-rewrite-\npercentage 0ï¼‰ï¼Œé€šè¿‡crontabå®šæ—¶è°ƒç”¨ä¿å­˜ï¼š')]),e._v(" "),_("p",[e._v("m h * * * redis-cli -p "),_("port",[e._v(" BGSAVE")])],1),e._v(" "),_("p",[e._v("m h */4 * * redis-cli -p "),_("port",[e._v(" BGREWRITEAOF")])],1),e._v(" "),_("p",[e._v("æŒä¹…åŒ–çš„éƒ¨ç½²è§„åˆ’ä¸Šï¼Œå¦‚æœä¸ºä¸»ä»å¤åˆ¶å…³ç³»ï¼Œå»ºè®®ä¸»å…³é—­æŒä¹…åŒ–ã€‚")]),e._v(" "),_("p",[e._v("120")]),e._v(" "),_("p",[e._v("å¤šå®ä¾‹é…ç½®")]),e._v(" "),_("p",[e._v("5.5 å¤šå®ä¾‹é…ç½®")]),e._v(" "),_("p",[e._v("å¦‚æœä¸€å°æœºå™¨ä¸Šé˜²æ­¢å¤šä¸ªrediså®ä¾‹ï¼Œä¸ºäº†é˜²æ­¢ä¸Šä¸‹æ–‡åˆ‡æ¢å¯¼è‡´çš„å¼€é”€ï¼Œå¯ä»¥é‡‡ç”¨tasksetã€‚\ntasksetæ˜¯LINUXæä¾›çš„ä¸€ä¸ªå‘½ä»¤(ubuntuç³»ç»Ÿå¯èƒ½éœ€è¦è‡ªè¡Œå®‰è£…ï¼Œschedutils package)ã€‚ä»–å¯\nä»¥è®©æŸä¸ªç¨‹åºè¿è¡Œåœ¨æŸä¸ªï¼ˆæˆ–ï¼‰æŸäº›CPUä¸Šã€‚")]),e._v(" "),_("p",[e._v("1ï¼‰æ˜¾ç¤ºè¿›ç¨‹è¿è¡Œçš„CPU ï¼ˆ6137ä¸ºredis-serverçš„è¿›ç¨‹å·ï¼‰")]),e._v(" "),_("p",[e._v("[redis@hadoop1 ~]$ taskset -p 6137\npid 6137's current affinity mask: f")]),e._v(" "),_("p",[e._v("æ˜¾ç¤ºç»“æœçš„få®é™…ä¸Šæ˜¯äºŒè¿›åˆ¶4ä¸ªä½ä½å‡ä¸º1çš„bitmaskï¼Œæ¯ä¸€ä¸ª1å¯¹åº”äº1ä¸ªCPUï¼Œè¡¨ç¤ºè¯¥è¿›ç¨‹\nåœ¨4ä¸ªCPUä¸Šè¿è¡Œ")]),e._v(" "),_("p",[e._v("2ï¼‰æŒ‡å®šè¿›ç¨‹è¿è¡Œåœ¨æŸä¸ªç‰¹å®šçš„CPUä¸Š")]),e._v(" "),_("p",[e._v("[redis@hadoop1 ~]$ taskset -pc 3 6137\npid 6137's current affinity list: 0-3\npid 6137's new affinity list: 3")]),e._v(" "),_("p",[e._v("æ³¨ï¼š3è¡¨ç¤ºCPUå°†åªä¼šè¿è¡Œåœ¨ç¬¬4ä¸ªCPUä¸Šï¼ˆä»0å¼€å§‹è®¡æ•°ï¼‰ã€‚")]),e._v(" "),_("p",[e._v("3ï¼‰è¿›ç¨‹å¯åŠ¨æ—¶æŒ‡å®šCPU")]),e._v(" "),_("p",[e._v("taskset -c 1 ./redis-server ../redis.conf")]),e._v(" "),_("p",[e._v("å‚æ•°ï¼šOPTIONS -p, --pid operate on an existing PID and not launch a new task")]),e._v(" "),_("p",[e._v("-c, --cpu-list specify a numerical list of processors instead of a bitmask. The list may contain\nmultiple items, separated by comma, and ranges. For example, 0,5,7,9-11.")]),e._v(" "),_("p",[e._v("121")]),e._v(" "),_("p",[e._v("å…·ä½“è®¾ç½®å‚æ•°")]),e._v(" "),_("p",[e._v("5.6 å…·ä½“è®¾ç½®å‚æ•°")]),e._v(" "),_("p",[e._v("è¯¦è§æˆ‘è¡Œè‡ªåˆ¶å®‰è£…åŒ…confç›®å½•ä¸­çš„å„ä¸ªé…ç½®æ–‡ä»¶å’Œä¸Šçº¿å‰æ£€æŸ¥è¡¨æ ¼ã€‚")]),e._v(" "),_("p",[e._v("rediså‚æ•°è®¾ç½®æŠ€å·§åˆ—è¡¨ï¼š")]),e._v(" "),_("ol",[_("li",[_("p",[e._v("Daemonize è¿™ä¸ªå‚æ•°åœ¨ä½¿ç”¨supervisordè¿™ç§è¿›ç¨‹ç®¡ç†å·¥å…·æ—¶ä¸€å®šè¦è®¾ç½®ä¸ºnoï¼Œå¦åˆ™æ— æ³•\nä½¿ç”¨è¿™äº›å·¥å…·å°†rediså¯åŠ¨ã€‚")])]),e._v(" "),_("li",[_("p",[e._v("Dir RDBçš„ä½ç½®ï¼Œä¸€å®šè¦äº‹å…ˆåˆ›å»ºå¥½ï¼Œå¹¶ä¸”å¯åŠ¨redis çš„ç”¨æˆ·å¯¹æ­¤ç›®å½•è¦æœ‰è¯»å†™æƒé™ã€‚")])]),e._v(" "),_("li",[_("p",[e._v("Include å¦‚æœæ˜¯å¤šå®ä¾‹çš„è¯å¯ä»¥å°†å…¬å…±çš„è®¾ç½®æ”¾åœ¨ä¸€ä¸ªconfæ–‡ä»¶ä¸­ï¼Œç„¶åå¼•ç”¨å³å¯ï¼š")])])]),e._v(" "),_("p",[e._v("include /redis/conf/redis-common.conf")]),e._v(" "),_("p",[e._v("122")]),e._v(" "),_("p",[e._v("å…¶ä»–å¥½ç”¨çš„é…ç½®æŠ€å·§")]),e._v(" "),_("p",[e._v("5.7 å…¶ä»–å¥½ç”¨çš„é…ç½®æŠ€å·§")]),e._v(" "),_("p",[e._v("5.7.1 ä½¿ç”¨supervisordè¿›è¡Œè¿›ç¨‹ç®¡ç†")]),e._v(" "),_("p",[e._v('Supervisordæ˜¯ä¸€ä¸ªä¼˜ç§€çš„è¿›ç¨‹ç®¡ç†å·¥å…·ï¼Œä¸€èˆ¬åœ¨éƒ¨ç½²redisæ—¶é‡‡ç”¨å®ƒæ¥è¿›è¡Œredisã€sentinelç­‰\nè¿›ç¨‹çš„ç®¡ç†ï¼Œä¸€ä¸ªå·²ç»åœ¨ç”Ÿäº§ç¯å¢ƒé‡‡ç”¨çš„supervisordé…ç½®æ–‡ä»¶å¦‚ä¸‹ï¼š ; Sample supervisor\nconfig file. ; ; For more information on the config file, please see: ;\nhttp://supervisord.org/configuration.html ; ; Notes: ; - Shell expansion ("~" or "$HOME") is not\nsupported.       Environment ; variables can be expanded using this syntax: "%(ENV_HOME)s". ;')]),e._v(" "),_("ul",[_("li",[e._v('Comments must have a leading space: "a=b ;comment" not "a=b;comment".')])]),e._v(" "),_("p",[e._v("[unix_http_server]")]),e._v(" "),_("p",[e._v("file=/smsred/redis-3.0.4/run/supervisor.sock ; (the path to the socket file)")]),e._v(" "),_("p",[e._v(";chmod=0700 ; socket file mode (default 0700)")]),e._v(" "),_("p",[e._v(";chown=nobody:nogroup ; socket file uid:gid owner")]),e._v(" "),_("p",[e._v(";username=user ; (default is no username (open server))")]),e._v(" "),_("p",[e._v(";password=123 ; (default is no password (open server))")]),e._v(" "),_("p",[e._v(";[inet_http_server] ; inet (TCP) server disabled by default")]),e._v(" "),_("p",[e._v(";port=127.0.0.1:9001 ; (ip_address:port specifier, *:port for all iface)")]),e._v(" "),_("p",[e._v(";username=user ; (default is no username (open server))")]),e._v(" "),_("p",[e._v(";password=123 ; (default is no password (open server))")]),e._v(" "),_("p",[e._v("[supervisord]")]),e._v(" "),_("p",[e._v("logfile=/smsred/redis-3.0.4/log/supervisord.log ; (main log file;default $CWD/supervis\nord.log)")]),e._v(" "),_("p",[e._v("logfile_maxbytes=50MB ; (max main logfile bytes b4 rotation;default 50MB)\nlogfile_backups=10 ; (num of main logfile rotation backups;default 10)\nloglevel=info    ; (log level;default info; others: debug,warn,trace)")]),e._v(" "),_("p",[e._v("pidfile=/smsred/redis-3.0.4/run/supervisord.pid ; (supervisord pidfile;default supervi\nsord.pid)")]),e._v(" "),_("p",[e._v("nodaemon=false ; (start in foreground if true;default false)\nminfds=1024 ; (min. avail startup file descriptors;default 1024)\nminprocs=200 ; (min. avail process descriptors;default 200)")]),e._v(" "),_("p",[e._v(";umask=022 ; (process file creation umask;default 022)")]),e._v(" "),_("p",[e._v(";user=chrism ; (default is current user, required if root)")]),e._v(" "),_("p",[e._v(";identifier=supervisor ; (supervisord identifier, default is 'supervisor')")]),e._v(" "),_("p",[e._v(";directory=/tmp ; (default is not to cd during start)")]),e._v(" "),_("p",[e._v(";nocleanup=true ; (don't clean up tempfiles at start;default false)")]),e._v(" "),_("p",[e._v(";childlogdir=/tmp ; ('AUTO' child log dir, default $TEMP)")]),e._v(" "),_("p",[e._v(';environment=KEY="value" ; (key value pairs to add to environment)')]),e._v(" "),_("p",[e._v(";strip_ansi=false ; (strip ansi escape codes in logs; def. false)")]),e._v(" "),_("p",[e._v("; the below section must remain in the config file for RPC")]),e._v(" "),_("p",[e._v("; (supervisorctl/web interface) to work, additional interfaces may be")]),e._v(" "),_("p",[e._v("; added by defining them in separate rpcinterface: sections")]),e._v(" "),_("p",[e._v("123")]),e._v(" "),_("p",[e._v("å…¶ä»–å¥½ç”¨çš„é…ç½®æŠ€å·§")]),e._v(" "),_("p",[e._v("[rpcinterface:supervisor]")]),e._v(" "),_("p",[e._v("supervisor.rpcinterface_factory = supervisor.rpcinterface:make_main_rpcinterface")]),e._v(" "),_("p",[e._v("[supervisorctl]")]),e._v(" "),_("p",[e._v("serverurl=unix:///smsred/redis-3.0.4/run/supervisor.sock ; use a unix:// URL for a uni\nx socket")]),e._v(" "),_("p",[e._v(";serverurl=http://127.0.0.1:9001 ; use an http:// url to specify an inet socket")]),e._v(" "),_("p",[e._v(";username=chris ; should be same as http_username if set")]),e._v(" "),_("p",[e._v(";password=123 ; should be same as http_password if set")]),e._v(" "),_("p",[e._v(';prompt=mysupervisor ; cmd line prompt (default "supervisor")')]),e._v(" "),_("p",[e._v(";history_file=~/.sc_history ; use readline history if available")]),e._v(" "),_("p",[e._v("; The below sample program section shows all possible program subsection values,")]),e._v(" "),_("p",[e._v("; create one or more 'real' program: sections to be able to control them under")]),e._v(" "),_("p",[e._v("; supervisor.")]),e._v(" "),_("p",[e._v(";[program:theprogramname]")]),e._v(" "),_("p",[e._v(";command=/bin/cat ; the program (relative uses PATH, can take args)")]),e._v(" "),_("p",[e._v(";process_name=%(program_name)s ; process_name expr (default %(program_name)s)")]),e._v(" "),_("p",[e._v(";numprocs=1 ; number of processes copies to start (def 1)")]),e._v(" "),_("p",[e._v(";directory=/tmp ; directory to cwd to before exec (def no cwd)")]),e._v(" "),_("p",[e._v(";umask=022 ; umask for process (default None)")]),e._v(" "),_("p",[e._v(";priority=999 ; the relative start priority (default 999)")]),e._v(" "),_("p",[e._v(";autostart=true ; start at supervisord start (default: true)")]),e._v(" "),_("p",[e._v(";autorestart=unexpected ; whether/when to restart (default: unexpected)")]),e._v(" "),_("p",[e._v(";startsecs=1 ; number of secs prog must stay running (def. 1)")]),e._v(" "),_("p",[e._v(";startretries=3 ; max # of serial start failures (default 3)")]),e._v(" "),_("p",[e._v(";exitcodes=0,2 ; 'expected' exit codes for process (default 0,2)")]),e._v(" "),_("p",[e._v(";stopsignal=QUIT ; signal used to kill process (default TERM)")]),e._v(" "),_("p",[e._v(";stopwaitsecs=10 ; max num secs to wait b4 SIGKILL (default 10)")]),e._v(" "),_("p",[e._v(";stopasgroup=false ; send stop signal to the UNIX process group (default false)")]),e._v(" "),_("p",[e._v(";killasgroup=false ; SIGKILL the UNIX process group (def false)")]),e._v(" "),_("p",[e._v(";user=chrism ; setuid to this UNIX account to run the program")]),e._v(" "),_("p",[e._v(";redirect_stderr=true ; redirect proc stderr to stdout (default false)")]),e._v(" "),_("p",[e._v(";stdout_logfile=/a/path ; stdout log path, NONE for none; default AUTO")]),e._v(" "),_("p",[e._v(";stdout_logfile_maxbytes=1MB ; max # logfile bytes b4 rotation (default 50MB)")]),e._v(" "),_("p",[e._v(";stdout_logfile_backups=10 ; # of stdout logfile backups (default 10)")]),e._v(" "),_("p",[e._v(";stdout_capture_maxbytes=1MB ; number of bytes in 'capturemode' (default 0)")]),e._v(" "),_("p",[e._v(";stdout_events_enabled=false ; emit events on stdout writes (default false)")]),e._v(" "),_("p",[e._v(";stderr_logfile=/a/path ; stderr log path, NONE for none; default AUTO")]),e._v(" "),_("p",[e._v(";stderr_logfile_maxbytes=1MB ; max # logfile bytes b4 rotation (default 50MB)")]),e._v(" "),_("p",[e._v(";stderr_logfile_backups=10 ; # of stderr logfile backups (default 10)")]),e._v(" "),_("p",[e._v(";stderr_capture_maxbytes=1MB ; number of bytes in 'capturemode' (default 0)")]),e._v(" "),_("p",[e._v(";stderr_events_enabled=false ; emit events on stderr writes (default false)")]),e._v(" "),_("p",[e._v(';environment=A="1",B="2" ; process environment additions (def no adds)')]),e._v(" "),_("p",[e._v(";serverurl=AUTO ; override serverurl computation (childutils)")]),e._v(" "),_("p",[e._v("; The below sample eventlistener section shows all possible")]),e._v(" "),_("p",[e._v("; eventlistener subsection values, create one or more 'real'")]),e._v(" "),_("p",[e._v("; eventlistener: sections to be able to handle event notifications")]),e._v(" "),_("p",[e._v("; sent by supervisor.")]),e._v(" "),_("p",[e._v(";[eventlistener:theeventlistenername]")]),e._v(" "),_("p",[e._v("124")]),e._v(" "),_("p",[e._v("å…¶ä»–å¥½ç”¨çš„é…ç½®æŠ€å·§")]),e._v(" "),_("p",[e._v(";command=/bin/eventlistener ; the program (relative uses PATH, can take args)")]),e._v(" "),_("p",[e._v(";process_name=%(program_name)s ; process_name expr (default %(program_name)s)")]),e._v(" "),_("p",[e._v(";numprocs=1 ; number of processes copies to start (def 1)")]),e._v(" "),_("p",[e._v(";events=EVENT ; event notif. types to subscribe to (req'd)")]),e._v(" "),_("p",[e._v(";buffer_size=10 ; event buffer queue size (default 10)")]),e._v(" "),_("p",[e._v(";directory=/tmp ; directory to cwd to before exec (def no cwd)")]),e._v(" "),_("p",[e._v(";umask=022 ; umask for process (default None)")]),e._v(" "),_("p",[e._v(";priority=-1 ; the relative start priority (default -1)")]),e._v(" "),_("p",[e._v(";autostart=true ; start at supervisord start (default: true)")]),e._v(" "),_("p",[e._v(";autorestart=unexpected ; whether/when to restart (default: unexpected)")]),e._v(" "),_("p",[e._v(";startsecs=1 ; number of secs prog must stay running (def. 1)")]),e._v(" "),_("p",[e._v(";startretries=3 ; max # of serial start failures (default 3)")]),e._v(" "),_("p",[e._v(";exitcodes=0,2 ; 'expected' exit codes for process (default 0,2)")]),e._v(" "),_("p",[e._v(";stopsignal=QUIT ; signal used to kill process (default TERM)")]),e._v(" "),_("p",[e._v(";stopwaitsecs=10 ; max num secs to wait b4 SIGKILL (default 10)")]),e._v(" "),_("p",[e._v(";stopasgroup=false ; send stop signal to the UNIX process group (default false)")]),e._v(" "),_("p",[e._v(";killasgroup=false ; SIGKILL the UNIX process group (def false)")]),e._v(" "),_("p",[e._v(";user=chrism ; setuid to this UNIX account to run the program")]),e._v(" "),_("p",[e._v(";redirect_stderr=true ; redirect proc stderr to stdout (default false)")]),e._v(" "),_("p",[e._v(";stdout_logfile=/a/path ; stdout log path, NONE for none; default AUTO")]),e._v(" "),_("p",[e._v(";stdout_logfile_maxbytes=1MB ; max # logfile bytes b4 rotation (default 50MB)")]),e._v(" "),_("p",[e._v(";stdout_logfile_backups=10 ; # of stdout logfile backups (default 10)")]),e._v(" "),_("p",[e._v(";stdout_events_enabled=false ; emit events on stdout writes (default false)")]),e._v(" "),_("p",[e._v(";stderr_logfile=/a/path ; stderr log path, NONE for none; default AUTO")]),e._v(" "),_("p",[e._v(";stderr_logfile_maxbytes=1MB ; max # logfile bytes b4 rotation (default 50MB)")]),e._v(" "),_("p",[e._v(";stderr_logfile_backups ; # of stderr logfile backups (default 10)")]),e._v(" "),_("p",[e._v(";stderr_events_enabled=false ; emit events on stderr writes (default false)")]),e._v(" "),_("p",[e._v(';environment=A="1",B="2" ; process environment additions')]),e._v(" "),_("p",[e._v(";serverurl=AUTO ; override serverurl computation (childutils)")]),e._v(" "),_("p",[e._v("; The below sample group section shows all possible group values,")]),e._v(" "),_("p",[e._v("; create one or more 'real' group: sections to create \"heterogeneous\"")]),e._v(" "),_("p",[e._v("; process groups.")]),e._v(" "),_("p",[e._v(";[group:thegroupname]")]),e._v(" "),_("p",[e._v(";programs=progname1,progname2 ; each refers to 'x' in [program:x] definitions")]),e._v(" "),_("p",[e._v(";priority=999 ; the relative start priority (default 999)")]),e._v(" "),_("p",[e._v('; The [include] section can just contain the "files" setting. This')]),e._v(" "),_("p",[e._v("; setting can list multiple files (separated by whitespace or")]),e._v(" "),_("p",[e._v("; newlines). It can also contain wildcards. The filenames are")]),e._v(" "),_("p",[e._v("; interpreted as relative to this file. Included files "),_("em",[e._v("cannot")])]),e._v(" "),_("p",[e._v("; include files themselves.")]),e._v(" "),_("p",[e._v(";[include]")]),e._v(" "),_("p",[e._v(";files = relative/directory/*.ini")]),e._v(" "),_("p",[e._v("[program:redis-1xxx]")]),e._v(" "),_("p",[e._v("command=/smsred/redis-3.0.4/bin/redis-server /smsred/redis-3.0.4/conf/redis-1xxx.conf\nautostart=true")]),e._v(" "),_("p",[e._v("autorestart=false\nuser=smsred")]),e._v(" "),_("p",[e._v("stdout_logfile=/smsred/redis-3.0.4/log/redis-1xxx.out.log")]),e._v(" "),_("p",[e._v("125")]),e._v(" "),_("p",[e._v("å…¶ä»–å¥½ç”¨çš„é…ç½®æŠ€å·§")]),e._v(" "),_("p",[e._v("stderr_logfile=/smsred/redis-3.0.4/log/redis-1xxx.err.log\npriority=1000")]),e._v(" "),_("p",[e._v("[program:redis-1xxx]")]),e._v(" "),_("p",[e._v("command=/smsred/redis-3.0.4/bin/redis-server /smsred/redis-3.0.4/conf/redis-1xxx.conf\nautostart=true")]),e._v(" "),_("p",[e._v("autorestart=false\nuser=smsred")]),e._v(" "),_("p",[e._v("stdout_logfile=/smsred/redis-3.0.4/log/redis-1xxx.out.log\nstderr_logfile=/smsred/redis-3.0.4/log/redis-1xxx.err.log\npriority=1000")]),e._v(" "),_("p",[e._v("[program:redis-1xxx]")]),e._v(" "),_("p",[e._v("command=/smsred/redis-3.0.4/bin/redis-server /smsred/redis-3.0.4/conf/redis-1xxx.conf\nautostart=true")]),e._v(" "),_("p",[e._v("autorestart=false\nuser=smsred")]),e._v(" "),_("p",[e._v("stdout_logfile=/smsred/redis-3.0.4/log/redis-1xxx.out.log\nstderr_logfile=/smsred/redis-3.0.4/log/redis-1xxx.err.log\npriority=1000")]),e._v(" "),_("p",[e._v("[program:redis-sentinel]")]),e._v(" "),_("p",[e._v("command =/smsred/redis-3.0.4/bin/redis-sentinel /smsred/redis-3.0.4/conf/sentinel.conf")]),e._v(" "),_("p",[e._v("autostart=true\nautorestart=true\nstartsecs=3")]),e._v(" "),_("p",[e._v("5.7.2 ä½¿ç”¨aliasæ–¹ä¾¿æ“ä½œ")]),e._v(" "),_("p",[e._v("å¦‚æœå¼€å¤šå®ä¾‹ï¼Œé‚£ä¹ˆshellä¸‹è¿›è¡Œæ“ä½œçš„æ¬¡æ•°ä¼šå¾ˆå¤šï¼Œå› æ­¤ä½ éœ€è¦ä¸€äº›aliasè¿›è¡Œå‘½ä»¤çš„ç¼©çŸ­ï¼Œ\nè¿™ä¸ªæŠ€å·§å¹¶ä¸é«˜æ·±ï¼Œä½†æ˜¯å¾ˆå®ç”¨ã€‚ä¸€ä¸ªå®ä¾‹å¦‚ä¸‹ï¼š")]),e._v(" "),_("p",[e._v("alias cli1='$HOME/redis-3.0.4/bin/redis-cli -a xxx -p 1xx'\nalias cli2='$HOME/redis-3.0.4/bin/redis-cli -a xxx -p 1xx'\nalias cli3='$HOME/redis-3.0.4/bin/redis-cli -a xxx -p 1xx'\nalias clis='$HOME/redis-3.0.4/bin/redis-cli -p 26379'")]),e._v(" "),_("p",[e._v("alias sctl='supervisorctl -c $HOME/redis-3.0.4/conf/redis-supervisord.conf '\nalias sstart='supervisord -c $HOME/redis-3.0.4/conf/redis-supervisord.conf'")]),e._v(" "),_("p",[e._v("alias see='pdsh -R ssh -w MSMSRED[1-3],PSMSRED1,PSMSAPP1 \"/usr/local/bin/supervisorctl")]),e._v(" "),_("p",[e._v("-c /smsred/redis-3.0.4/conf/redis-supervisord.conf status \"'")]),e._v(" "),_("p",[e._v("5.7.3 ä½¿ç”¨pdsh/pdcpè¿›è¡Œå¤šæœºå™¨æ“ä½œ")]),e._v(" "),_("p",[e._v("126")]),e._v(" "),_("p",[e._v("å…¶ä»–å¥½ç”¨çš„é…ç½®æŠ€å·§")]),e._v(" "),_("p",[e._v("Pdsh/pdcpæ˜¯ä¸€ä¸ªpython sshå¤šæœºæ“ä½œçš„å·¥å…·ï¼Œåœ¨éƒ¨ç½²ä¸­å¯ä»¥é‡‡ç”¨å®ƒè¿›è¡Œå¤šæœºçš„åŒä¸€æ“ä½œæ‰¹é‡\næ‰§è¡Œï¼Œæ³¨æ„ç¼–è¯‘çš„æ—¶å€™æŠŠsshç¼–è¯‘è¿›å»ï¼Œåœ¨æ‰§è¡Œæ—¶æŒ‡å®šsshæ¨¡å¼ï¼Œä¸€ä¸ªæŸ¥çœ‹å¤šæœºsupervisordç®¡\nç†è¿›ç¨‹çš„å‘½ä»¤å®ä¾‹å¦‚ä¸‹ï¼š")]),e._v(" "),_("p",[e._v('pdsh -R ssh -w MSMSRED[1-3],PSMSRED1,PSMSAPP1 "/usr/local/bin/supervisorctl -c /smsred')]),e._v(" "),_("p",[e._v('/redis-3.0.4/conf/redis-supervisord.conf status "')]),e._v(" "),_("p",[e._v("å‰ææ˜¯ä½ è¿™äº›æœºå™¨å·²ç»å»º äº†sshäº’ä¿¡ã€‚å»º äº’ä¿¡å¯ä»¥ç”¨ä¸‹è¾¹è¿™ä¸ªè„šæœ¬")]),e._v(" "),_("p",[e._v("#!/bin/bash\n#2015-12-08")]),e._v(" "),_("p",[e._v("#author gnuhpc")]),e._v(" "),_("p",[e._v('expect -c "spawn ssh-keygen -t rsa\nexpect {')]),e._v(" "),_("p",[e._v('":" {send "\\r"; exp_continue}')]),e._v(" "),_("p",[e._v('"'),_("em",[e._v("(y/n)")]),e._v('" {send "y\\r"; exp_continue}')]),e._v(" "),_("p",[e._v("}")]),e._v(" "),_("p",[e._v('"')]),e._v(" "),_("p",[e._v("for p in $(cat ip.cfg)\ndo")]),e._v(" "),_("p",[e._v('ip=$(echo "$p"|cut -f1 -d"ğŸ˜Š\nusername=$(echo "$p"|cut -f2 -d"ğŸ˜Š\npassword=$(echo "$p"|cut -f3 -d"ğŸ˜Š\necho $password')]),e._v(" "),_("p",[e._v('expect -c "')]),e._v(" "),_("p",[e._v("spawn ssh-copy-id ${username}@$ip\nexpect {")]),e._v(" "),_("p",[e._v('"'),_("em",[e._v("yes/no")]),e._v('" {send "yes\\r"; exp_continue}')]),e._v(" "),_("p",[e._v('"'),_("em",[e._v("(y/n)")]),e._v('" {send "y\\r"; exp_continue}')]),e._v(" "),_("p",[e._v('"'),_("em",[e._v("password")]),e._v('" {send "$password\\r"; exp_continue}')]),e._v(" "),_("p",[e._v('"'),_("em",[e._v("Password")]),e._v('" {send "$password\\r"; exp_continue}')]),e._v(" "),_("p",[e._v("}")]),e._v(" "),_("p",[e._v('"')]),e._v(" "),_("p",[e._v('expect -c "')]),e._v(" "),_("p",[e._v('spawn ssh ${username}@$ip "hostname"\nexpect {')]),e._v(" "),_("p",[e._v('"'),_("em",[e._v("yes/no")]),e._v('" {send "yes\\r"; exp_continue}')]),e._v(" "),_("p",[e._v('"'),_("em",[e._v("password")]),e._v('" {send "$password\\r"; exp_continue}')]),e._v(" "),_("p",[e._v('"'),_("em",[e._v("(y/n)")]),e._v('" {send "y\\r"; exp_continue}')]),e._v(" "),_("p",[e._v('"'),_("em",[e._v("Password")]),e._v('" {send "$password\\r";}')]),e._v(" "),_("p",[e._v("}")]),e._v(" "),_("p",[e._v('"')]),e._v(" "),_("p",[e._v("done")]),e._v(" "),_("p",[e._v("æŒ‡å®šä¸€ä¸ªip.cfgï¼Œé‡Œé¢çš„æ ¼å¼ä¸ºï¼šIPï¼ˆä¸»æœºåä¹Ÿè¡Œï¼Œåªè¦èƒ½è§£æï¼‰:ç”¨æˆ·å:å¯†ç  ä¾‹å¦‚ï¼š")]),e._v(" "),_("p",[e._v("127")]),e._v(" "),_("p",[e._v("å…¶ä»–å¥½ç”¨çš„é…ç½®æŠ€å·§")]),e._v(" "),_("p",[e._v("xxxx.139:username:password\nxxxx.140:username:password\nxxxx.141:username:password\nxxxx.142:username:password\nxxxx.137:username:password")]),e._v(" "),_("p",[e._v("5.7.4 ä½¿ç”¨è„šæœ¬è¿›è¡Œsentinelé…ç½®æ–‡ä»¶çš„å¤‡ä»½")]),e._v(" "),_("p",[e._v("Sentinelåœ¨å¯åŠ¨ã€åˆ‡æ¢æ—¶ä¼šå¯¹configæ–‡ä»¶è¿›è¡Œrewriteï¼Œåœ¨ä¸Šçº¿å‰æˆ–è€…æŸäº›æ‰‹åŠ¨ç»´æŠ¤åä½ å¯èƒ½å¸Œ\næœ›æŠŠconfæ–‡ä»¶éƒ½å˜ä¸ºæœ€åˆï¼Œå½“ç³»ç»Ÿä¸­æœ‰å¾ˆå¤šrediså®ä¾‹æ—¶ï¼Œè¿™ä¸ªæ‰‹å·¥æ“ä½œä¼šè®©äººç–¯æ‰ï¼Œé‚£ä¸å¦¨\nå†™ä¸ªè„šæœ¬åœ¨é…ç½®å¥½sentinelå’Œredisåä¸å¯åŠ¨å…ˆå¤‡ä»½ä¸€ä¸‹ï¼Œæµ‹è¯•å®Œæ¯•åå†æ¢å¤ã€‚")]),e._v(" "),_("p",[e._v("ä¸€ä¸ªç®€å•çš„å¤‡ä»½è„šæœ¬å¦‚ä¸‹ï¼š")]),e._v(" "),_("p",[e._v("backupconf.sh\n#!/bin/bash")]),e._v(" "),_("p",[e._v("for i in "),_("code",[e._v("find ~/redis-3.0.4/conf -name *.conf")]),e._v("\ndo")]),e._v(" "),_("p",[e._v("cp -v $i ${i}.bak\ndone")]),e._v(" "),_("p",[e._v("æ¢å¤è„šæœ¬ï¼š")]),e._v(" "),_("p",[e._v("recoveryconf.sh\n#!/bin/bash")]),e._v(" "),_("p",[e._v("for i in "),_("code",[e._v("find ~/redis-3.0.4/conf -name *.conf.bak")]),e._v("\ndo")]),e._v(" "),_("p",[e._v("cp -v $i ${i%.*}\ndone")]),e._v(" "),_("p",[e._v("128")]),e._v(" "),_("p",[e._v("å¸¸è§è¿ç»´æ“ä½œ")]),e._v(" "),_("ol",{attrs:{start:"6"}},[_("li",[e._v("å¸¸è§è¿ç»´æ“ä½œ")])]),e._v(" "),_("p",[e._v("129")]),e._v(" "),_("p",[e._v("å¯åŠ¨")]),e._v(" "),_("p",[e._v("3.1 å¯åŠ¨")]),e._v(" "),_("p",[e._v("3.1.1 å¯åŠ¨redis")]),e._v(" "),_("p",[e._v("$ redis-server redis.conf")]),e._v(" "),_("p",[e._v("å¸¸è§é€‰é¡¹ï¼š ./redis-server (run the server with default conf) ./redis-server /etc/redis/6379.conf")]),e._v(" "),_("p",[e._v("./redis-server --port 7777 ./redis-server --port 7777 --slaveof 127.0.0.1 8888 ./redis-server")]),e._v(" "),_("p",[e._v("/etc/myredis.conf --loglevel verbose")]),e._v(" "),_("p",[e._v("3.1.2 å¯åŠ¨redis-sentinel")]),e._v(" "),_("p",[e._v("./redis-server /etc/sentinel.conf â€“sentinel")]),e._v(" "),_("p",[e._v("./redis-sentinel /etc/sentinel.conf")]),e._v(" "),_("p",[e._v("éƒ¨ç½²åå¯ä»¥ä½¿ç”¨sstartå¯¹redis å’Œsentinelè¿›è¡Œæ‹‰èµ·ï¼Œä½¿ç”¨sctlè¿›è¡Œsupervisorctlçš„æ§åˆ¶ã€‚ï¼ˆä¸¤ä¸ª")]),e._v(" "),_("p",[e._v("aliasï¼‰")]),e._v(" "),_("p",[e._v("130")]),e._v(" "),_("p",[e._v("åœæ­¢")]),e._v(" "),_("p",[e._v("3.2 åœæ­¢")]),e._v(" "),_("p",[e._v("redis-cli shutdown")]),e._v(" "),_("p",[e._v("sentinelæ–¹æ³•ä¸€æ ·ï¼Œåªæ˜¯éœ€è¦æ‰§è¡Œsentinelçš„è¿æ¥ç«¯å£")]),e._v(" "),_("p",[e._v("æ³¨æ„ï¼šæ­£ç¡®å…³é—­æœåŠ¡å™¨æ–¹å¼æ˜¯redis-cli shutdown æˆ–è€… killï¼Œéƒ½ä¼šgraceful shutdownï¼Œä¿\nè¯å†™RDBæ–‡ä»¶ä»¥åŠå°†AOFæ–‡ä»¶fsyncåˆ°ç£ç›˜ï¼Œä¸ä¼šä¸¢å¤±æ•°æ®ã€‚ å¦‚æœæ˜¯ç²—æš´çš„Ctrl+Cï¼Œæˆ–è€…\nkill -9 å°±å¯èƒ½ä¸¢å¤±ã€‚å¦‚æœæœ‰é…ç½®saveï¼Œè¿˜å¸Œæœ›åœ¨shutdownæ—¶è¿›è¡ŒRDBå†™å…¥ï¼Œé‚£ä¹ˆè¯·ä½¿ç”¨\nshutdown saveå‘½ä»¤ã€‚")]),e._v(" "),_("p",[e._v("131")]),e._v(" "),_("p",[e._v("æŸ¥çœ‹å’Œä¿®æ”¹é…ç½®")]),e._v(" "),_("p",[e._v("3.3 æŸ¥çœ‹å’Œä¿®æ”¹é…ç½®")]),e._v(" "),_("p",[e._v("æŸ¥çœ‹ï¼š")]),e._v(" "),_("p",[e._v("config get ï¼šè·å–æœåŠ¡å™¨é…ç½®ä¿¡æ¯ã€‚")]),e._v(" "),_("p",[e._v("redis 127.0.0.1:6379> config get dir\nconfig get *ï¼šæŸ¥çœ‹æ‰€æœ‰é…ç½®")]),e._v(" "),_("p",[e._v("ä¿®æ”¹ï¼š")]),e._v(" "),_("p",[e._v("ä¸´æ—¶è®¾ç½®ï¼šconfig set")]),e._v(" "),_("p",[e._v("æ°¸ä¹…è®¾ç½®ï¼šconfig rewriteï¼Œå°†ç›®å‰æœåŠ¡å™¨çš„å‚æ•°é…ç½®å†™å…¥redis conf.")]),e._v(" "),_("p",[e._v("132")]),e._v(" "),_("p",[e._v("æ‰¹é‡æ‰§è¡Œæ“ä½œ")]),e._v(" "),_("p",[e._v("3.4 æ‰¹é‡æ‰§è¡Œæ“ä½œ")]),e._v(" "),_("p",[e._v("ä½¿ç”¨telnetä¹Ÿå¯ä»¥è¿æ¥redis-serverã€‚å¹¶ä¸”åœ¨è„šæœ¬ä¸­ä½¿ç”¨ncå‘½ä»¤è¿›è¡Œredisæ“ä½œä¹Ÿæ˜¯å¾ˆæœ‰æ•ˆçš„ï¼š")]),e._v(" "),_("p",[e._v('gnuhpc@gnuhpc:~$ (echo -en "ping\\r\\nset key abc\\r\\nget key\\r\\n";sleep 1) | nc 127.0.0.')]),e._v(" "),_("p",[e._v("1 6379")]),e._v(" "),_("p",[e._v("+PONG")]),e._v(" "),_("p",[e._v("+OK")]),e._v(" "),_("p",[e._v("$3\nabc")]),e._v(" "),_("p",[e._v("å¦ä¸€ä¸ªæ–¹å¼æ˜¯ä½¿ç”¨pipelineï¼š")]),e._v(" "),_("p",[e._v("åœ¨ä¸€ä¸ªè„šæœ¬ä¸­æ‰¹é‡æ‰§è¡Œå¤šä¸ªå†™å…¥æ“ä½œ:")]),e._v(" "),_("p",[e._v("å…ˆæŠŠæ’å…¥æ“ä½œæ”¾å…¥æ“ä½œæ–‡æœ¬insert.datï¼š")]),e._v(" "),_("p",[e._v("set a b\nset 1 2\nset h w\nset f u")]),e._v(" "),_("p",[e._v("ç„¶åæ‰§è¡Œå‘½ä»¤:cat insert.bat | ./redis-cli --pipeï¼Œæˆ–è€…å¦‚ä¸‹è„šæœ¬ï¼š")]),e._v(" "),_("p",[e._v("#!/bin/sh\nhost=$1\nport=$ï¼›\npassword=$3")]),e._v(" "),_("p",[e._v("cat insert.dat | ./redis-cli -h $host -p $port -a $password --pipe")]),e._v(" "),_("p",[e._v("133")]),e._v(" "),_("p",[e._v("é€‰æ‹©æ•°æ®åº“")]),e._v(" "),_("p",[e._v("3.5 é€‰æ‹©æ•°æ®åº“")]),e._v(" "),_("p",[e._v("select db-index")]),e._v(" "),_("p",[e._v("é»˜è®¤è¿æ¥çš„æ•°æ®åº“æ‰€æœ‰æ˜¯0,é»˜è®¤æ•°æ®åº“æ•°æ˜¯16ä¸ªã€‚è¿”å›1è¡¨ç¤ºæˆåŠŸï¼Œ0å¤±è´¥")]),e._v(" "),_("p",[e._v("134")]),e._v(" "),_("p",[e._v("æ¸…ç©ºæ•°æ®åº“")]),e._v(" "),_("p",[e._v("3.6 æ¸…ç©ºæ•°æ®åº“")]),e._v(" "),_("p",[e._v("flushdb")]),e._v(" "),_("p",[e._v("åˆ é™¤å½“å‰é€‰æ‹©æ•°æ®åº“ä¸­çš„æ‰€æœ‰ keyã€‚ç”Ÿäº§ä¸Šå·²ç»ç¦æ­¢ã€‚")]),e._v(" "),_("p",[e._v("flushall")]),e._v(" "),_("p",[e._v("åˆ é™¤æ‰€æœ‰çš„æ•°æ®åº“ã€‚ç”Ÿäº§ä¸Šå·²ç»ç¦æ­¢ã€‚")]),e._v(" "),_("p",[e._v("135")]),e._v(" "),_("p",[e._v("é‡å‘½åå‘½ä»¤")]),e._v(" "),_("p",[e._v("3.7 é‡å‘½åå‘½ä»¤")]),e._v(" "),_("p",[e._v("rename-command")]),e._v(" "),_("p",[e._v('ä¾‹å¦‚ï¼šrename-command FLUSHALL ""ã€‚å¿…é¡»é‡å¯ã€‚')]),e._v(" "),_("p",[e._v("136")]),e._v(" "),_("p",[e._v("æ‰§è¡Œluaè„šæœ¬")]),e._v(" "),_("p",[e._v("3.8 æ‰§è¡Œluaè„šæœ¬")]),e._v(" "),_("p",[e._v("--eval")]),e._v(" "),_("p",[e._v("ä¾‹å¦‚ï¼š redis-cli --eval myscript.lua key1 key2 , arg1 arg2 arg3")]),e._v(" "),_("p",[e._v("137")]),e._v(" "),_("p",[e._v("è®¾ç½®å¯†ç ")]),e._v(" "),_("p",[e._v("3.9 è®¾ç½®å¯†ç ")]),e._v(" "),_("p",[e._v("config set requirepass [passw0rd]")]),e._v(" "),_("p",[e._v("138")]),e._v(" "),_("p",[e._v("éªŒè¯å¯†ç ")]),e._v(" "),_("p",[e._v("3.10 éªŒè¯å¯†ç ")]),e._v(" "),_("p",[e._v("auth passw0rd")]),e._v(" "),_("p",[e._v("139")]),e._v(" "),_("p",[e._v("æ€§èƒ½æµ‹è¯•å‘½ä»¤")]),e._v(" "),_("p",[e._v("3.11 æ€§èƒ½æµ‹è¯•å‘½ä»¤")]),e._v(" "),_("p",[e._v("redis-benchmark -q -r 100000 -n 100000 -c 50")]),e._v(" "),_("p",[e._v("æ¯”å¦‚ï¼šå¼€100æ¡çº¿ç¨‹(é»˜è®¤50)ï¼ŒSET 1åƒä¸‡æ¬¡(keyåœ¨0-1åƒä¸‡é—´éšæœº)ï¼Œkeyé•¿21å­—èŠ‚ï¼Œvalueé•¿\n256å­—èŠ‚çš„æ•°æ®ã€‚-ræŒ‡çš„æ˜¯ä½¿ç”¨éšæœºkeyçš„èŒƒå›´ã€‚")]),e._v(" "),_("p",[e._v("redis-benchmark -t SET -c 100 -n 10000000 -r 10000000 -d 256")]),e._v(" "),_("p",[e._v("ä¹Ÿå¯ä»¥ç›´æ¥æ‰§è¡Œluaè„šæœ¬æ¨¡æ‹Ÿå®¢æˆ·ç«¯")]),e._v(" "),_("p",[e._v("redis-benchmark -n 100000 -q script load \"redis.call('set','foo','bar')\"")]),e._v(" "),_("p",[e._v("æ³¨æ„ï¼šRedis-Benchmarkçš„æµ‹è¯•ç»“æœæä¾›äº†ä¸€ä¸ªä¿è¯ä½ çš„ Redis-Server ä¸ä¼šè¿è¡Œåœ¨éæ­£å¸¸çŠ¶\næ€ä¸‹çš„åŸºå‡†ç‚¹ï¼Œä½†æ˜¯ä½ æ°¸è¿œä¸è¦æŠŠå®ƒä½œä¸ºä¸€ä¸ªçœŸå®çš„â€œå‹åŠ›æµ‹è¯•â€ã€‚å‹åŠ›æµ‹è¯•éœ€è¦ååº”å‡ºåº”ç”¨çš„\nè¿è¡Œæ–¹å¼ï¼Œå¹¶ä¸”éœ€è¦ä¸€ä¸ªå°½å¯èƒ½çš„å’Œç”Ÿäº§ç›¸ä¼¼çš„ç¯å¢ƒã€‚")]),e._v(" "),_("p",[e._v("Redis-benchmarkè¿˜æœ‰ä¸€ä¸ªä½œç”¨å°±æ˜¯çŒæ•°æ®ï¼Œä¾‹å¦‚ä¸‹åˆ—æµ‹è¯•åœºæ™¯ï¼Œæˆ‘ä»¬å¯¹æŸä¸ªç³»ç»Ÿå¸¸ç”¨redis\nAPIè¿›è¡Œæµ‹è¯•ï¼Œä¸‹åˆ—æ˜¯ä¸€ä¸ªæµ‹è¯•hgetã€hsetçš„è¿‡ç¨‹ï¼Œæˆ‘ä»¬é¦–å…ˆåˆ©ç”¨rand_intè¿›è¡Œéšæœºæ•´æ•°è·")]),e._v(" "),_("p",[e._v("å–ï¼Œå¯¹myhashè¿™ä¸ªkeyè¿›è¡Œæµ‹è¯•æ•°æ®çŒå…¥ï¼ˆè¿™ä¹Ÿå°±æµ‹è¯•äº†hsetæ€§èƒ½ï¼‰ï¼Œç„¶åå†å¯¹å…¶è¿›è¡Œhgetï¼š")]),e._v(" "),_("p",[e._v("MSMSAPP1:/tmp # ./redis-benchmark -a pass -h 40.XXX.XXX.141 -p 16XXXX -r 500000 -n 500")]),e._v(" "),_("p",[e._v("000 hset myhash   rand_int     rand_int")]),e._v(" "),_("p",[e._v("====== hset myhash   rand_int     rand_int   ======")]),e._v(" "),_("p",[e._v("500000 requests completed in 18.74 seconds")]),e._v(" "),_("p",[e._v("50 parallel clients")]),e._v(" "),_("p",[e._v("3 bytes payload")]),e._v(" "),_("p",[e._v("keep alive: 1")]),e._v(" "),_("p",[e._v("23.53% <= 1 milliseconds")]),e._v(" "),_("p",[e._v("95.84% <= 2 milliseconds")]),e._v(" "),_("p",[e._v("97.62% <= 3 milliseconds")]),e._v(" "),_("p",[e._v("97.71% <= 4 milliseconds")]),e._v(" "),_("p",[e._v("97.80% <= 5 milliseconds")]),e._v(" "),_("p",[e._v("97.84% <= 6 milliseconds")]),e._v(" "),_("p",[e._v("97.84% <= 8 milliseconds")]),e._v(" "),_("p",[e._v("97.85% <= 9 milliseconds")]),e._v(" "),_("p",[e._v("97.85% <= 10 milliseconds")]),e._v(" "),_("p",[e._v("97.85% <= 11 milliseconds")]),e._v(" "),_("p",[e._v("97.86% <= 12 milliseconds")]),e._v(" "),_("p",[e._v("97.88% <= 13 milliseconds")]),e._v(" "),_("p",[e._v("97.90% <= 14 milliseconds")]),e._v(" "),_("p",[e._v("97.92% <= 15 milliseconds")]),e._v(" "),_("p",[e._v("140")]),e._v(" "),_("p",[e._v("æ€§èƒ½æµ‹è¯•å‘½ä»¤")]),e._v(" "),_("p",[e._v("97.94% <= 16 milliseconds")]),e._v(" "),_("p",[e._v("97.94% <= 20 milliseconds")]),e._v(" "),_("p",[e._v("97.95% <= 21 milliseconds")]),e._v(" "),_("p",[e._v("97.95% <= 22 milliseconds")]),e._v(" "),_("p",[e._v("97.99% <= 23 milliseconds")]),e._v(" "),_("p",[e._v("98.01% <= 24 milliseconds")]),e._v(" "),_("p",[e._v("98.11% <= 25 milliseconds")]),e._v(" "),_("p",[e._v("98.43% <= 26 milliseconds")]),e._v(" "),_("p",[e._v("98.85% <= 27 milliseconds")]),e._v(" "),_("p",[e._v("99.17% <= 28 milliseconds")]),e._v(" "),_("p",[e._v("99.43% <= 29 milliseconds")]),e._v(" "),_("p",[e._v("99.54% <= 30 milliseconds")]),e._v(" "),_("p",[e._v("99.68% <= 31 milliseconds")]),e._v(" "),_("p",[e._v("99.77% <= 32 milliseconds")]),e._v(" "),_("p",[e._v("99.81% <= 33 milliseconds")]),e._v(" "),_("p",[e._v("99.85% <= 34 milliseconds")]),e._v(" "),_("p",[e._v("99.85% <= 35 milliseconds")]),e._v(" "),_("p",[e._v("99.87% <= 36 milliseconds")]),e._v(" "),_("p",[e._v("99.88% <= 37 milliseconds")]),e._v(" "),_("p",[e._v("99.89% <= 38 milliseconds")]),e._v(" "),_("p",[e._v("99.90% <= 39 milliseconds")]),e._v(" "),_("p",[e._v("99.90% <= 40 milliseconds")]),e._v(" "),_("p",[e._v("99.91% <= 44 milliseconds")]),e._v(" "),_("p",[e._v("99.91% <= 45 milliseconds")]),e._v(" "),_("p",[e._v("99.91% <= 46 milliseconds")]),e._v(" "),_("p",[e._v("99.92% <= 47 milliseconds")]),e._v(" "),_("p",[e._v("99.92% <= 48 milliseconds")]),e._v(" "),_("p",[e._v("99.93% <= 49 milliseconds")]),e._v(" "),_("p",[e._v("99.93% <= 50 milliseconds")]),e._v(" "),_("p",[e._v("99.95% <= 51 milliseconds")]),e._v(" "),_("p",[e._v("99.96% <= 52 milliseconds")]),e._v(" "),_("p",[e._v("99.96% <= 53 milliseconds")]),e._v(" "),_("p",[e._v("99.97% <= 54 milliseconds")]),e._v(" "),_("p",[e._v("99.98% <= 55 milliseconds")]),e._v(" "),_("p",[e._v("100.00% <= 55 milliseconds\n26679.47 requests per second")]),e._v(" "),_("p",[e._v("MSMSAPP1:/tmp # ./redis-benchmark -a pass 40.XXX.XXX.141 -p 16XXXX -r 500000 -n 500000")]),e._v(" "),_("p",[e._v("hget myhash   rand_int     rand_int")]),e._v(" "),_("p",[e._v("====== hget myhash   rand_int     rand_int   ======")]),e._v(" "),_("p",[e._v("500000 requests completed in 13.83 seconds")]),e._v(" "),_("p",[e._v("50 parallel clients")]),e._v(" "),_("p",[e._v("3 bytes payload")]),e._v(" "),_("p",[e._v("keep alive: 1")]),e._v(" "),_("p",[e._v("74.29% <= 1 milliseconds")]),e._v(" "),_("p",[e._v("98.29% <= 2 milliseconds")]),e._v(" "),_("p",[e._v("98.45% <= 3 milliseconds")]),e._v(" "),_("p",[e._v("98.45% <= 4 milliseconds")]),e._v(" "),_("p",[e._v("98.45% <= 5 milliseconds")]),e._v(" "),_("p",[e._v("98.46% <= 11 milliseconds")]),e._v(" "),_("p",[e._v("98.46% <= 12 milliseconds")]),e._v(" "),_("p",[e._v("98.48% <= 15 milliseconds")]),e._v(" "),_("p",[e._v("141")]),e._v(" "),_("p",[e._v("æ€§èƒ½æµ‹è¯•å‘½ä»¤")]),e._v(" "),_("p",[e._v("98.49% <= 16 milliseconds")]),e._v(" "),_("p",[e._v("98.50% <= 22 milliseconds")]),e._v(" "),_("p",[e._v("98.50% <= 23 milliseconds")]),e._v(" "),_("p",[e._v("98.57% <= 24 milliseconds")]),e._v(" "),_("p",[e._v("98.81% <= 25 milliseconds")]),e._v(" "),_("p",[e._v("99.16% <= 26 milliseconds")]),e._v(" "),_("p",[e._v("99.45% <= 27 milliseconds")]),e._v(" "),_("p",[e._v("99.71% <= 28 milliseconds")]),e._v(" "),_("p",[e._v("99.84% <= 29 milliseconds")]),e._v(" "),_("p",[e._v("99.91% <= 30 milliseconds")]),e._v(" "),_("p",[e._v("99.94% <= 31 milliseconds")]),e._v(" "),_("p",[e._v("99.94% <= 32 milliseconds")]),e._v(" "),_("p",[e._v("99.95% <= 33 milliseconds")]),e._v(" "),_("p",[e._v("99.96% <= 34 milliseconds")]),e._v(" "),_("p",[e._v("99.96% <= 44 milliseconds")]),e._v(" "),_("p",[e._v("99.96% <= 45 milliseconds")]),e._v(" "),_("p",[e._v("99.97% <= 49 milliseconds")]),e._v(" "),_("p",[e._v("99.97% <= 50 milliseconds")]),e._v(" "),_("p",[e._v("99.99% <= 55 milliseconds")]),e._v(" "),_("p",[e._v("100.00% <= 56 milliseconds")]),e._v(" "),_("p",[e._v("100.00% <= 56 milliseconds\n36145.45 requests per second")]),e._v(" "),_("p",[e._v("æ³¨æ„ï¼šä¸Šè¿°æµ‹è¯•ç”±äºæ˜¯å–çš„éšæœºå€¼ï¼Œå› æ­¤hgetå¯èƒ½æ²¡æœ‰å‘½ä¸­ï¼ŒåŒæ—¶payloadæ¯”è¾ƒå°ï¼Œæ‰€ä»¥è¿™æ˜¯\nä¸ªæé™æ€§èƒ½ã€‚")]),e._v(" "),_("p",[e._v("å¦å¤–ï¼Œè¿˜æœ‰ä¸€ä¸ªå·¥å…·æ˜¯RedisLabæ”¾å‡ºæ¥çš„ï¼Œæˆ‘å¹¶æ²¡æœ‰è¿›è¡Œæµ‹è¯• å‚\nè§ï¼šhttps://github.com/RedisLabs/memtier_benchmark")]),e._v(" "),_("p",[e._v("142")]),e._v(" "),_("p",[e._v("Redis-cliå‘½ä»¤è¡Œå…¶ä»–æ“ä½œ")]),e._v(" "),_("p",[e._v("3.12 Redis-cliå‘½ä»¤è¡Œå…¶ä»–æ“ä½œ")]),e._v(" "),_("ol",[_("li",[e._v("echo ï¼šåœ¨å‘½ä»¤è¡Œæ‰“å°ä¸€äº›å†…å®¹")])]),e._v(" "),_("p",[e._v('redis 127.0.0.1:6379> echo HongWan "HongWan"')]),e._v(" "),_("ol",{attrs:{start:"2"}},[_("li",[e._v("quit ï¼šé€€å‡ºè¿æ¥ã€‚")])]),e._v(" "),_("p",[e._v("redis 127.0.0.1:6379> quit")]),e._v(" "),_("ol",{attrs:{start:"3"}},[_("li",[e._v("-xé€‰é¡¹ä»æ ‡å‡†è¾“å…¥ï¼ˆstdinï¼‰è¯»å–æœ€åä¸€ä¸ªå‚æ•°ã€‚ æ¯”å¦‚ä»ç®¡é“\nä¸­è¯»å–è¾“å…¥ï¼š")])]),e._v(" "),_("p",[e._v('echo -en "chen.qun" | redis-cli -x set name')]),e._v(" "),_("ol",{attrs:{start:"4"}},[_("li",[e._v("-r -i")])]),e._v(" "),_("p",[e._v("-r é€‰é¡¹é‡å¤æ‰§è¡Œä¸€ä¸ªå‘½ä»¤æŒ‡å®šçš„æ¬¡æ•°ã€‚ -i è®¾ç½®å‘½ä»¤æ‰§è¡Œçš„é—´éš”ã€‚ æ¯”å¦‚æŸ¥çœ‹redisæ¯ç§’æ‰§è¡Œçš„\ncommandsï¼ˆqpsï¼‰ redis-cli -r 100 -i 1 info stats | grep instantaneous_ops_per_sec è¿™ä¸ªé€‰é¡¹\nåœ¨ç¼–å†™ä¸€äº›è„šæœ¬æ—¶éå¸¸æœ‰ç”¨")]),e._v(" "),_("ol",{attrs:{start:"5"}},[_("li",[_("p",[e._v("-cï¼šå¼€å¯reidis clusteræ¨¡å¼ï¼Œè¿æ¥redis clusterèŠ‚ç‚¹æ—¶å€™ä½¿\nç”¨ã€‚")])]),e._v(" "),_("li",[_("p",[e._v("--rdbï¼šè·å–æŒ‡å®šrediså®ä¾‹çš„rdbæ–‡ä»¶,ä¿å­˜åˆ°æœ¬åœ°ã€‚")])])]),e._v(" "),_("p",[e._v("redis-cli -h 192.168.44.16 -p 6379 --rdb 6379.rdb")]),e._v(" "),_("ol",{attrs:{start:"7"}},[_("li",[e._v("--slave")])]),e._v(" "),_("p",[e._v("æ¨¡æ‹Ÿslaveä»masterä¸Šæ¥æ”¶åˆ°çš„commandsã€‚slaveä¸Šæ¥æ”¶åˆ°çš„commandséƒ½æ˜¯updateæ“ä½œï¼Œè®°\nå½•æ•°æ®çš„æ›´æ–°è¡Œä¸ºã€‚")]),e._v(" "),_("ol",{attrs:{start:"8"}},[_("li",[e._v("--pipe")])]),e._v(" "),_("p",[e._v("è¿™ä¸ªä¸€ä¸ªéå¸¸æœ‰ç”¨çš„å‚æ•°ã€‚å‘é€åŸå§‹çš„redis protoclæ ¼å¼æ•°æ®åˆ°æœåŠ¡å™¨ç«¯æ‰§è¡Œã€‚æ¯”å¦‚ä¸‹é¢çš„å½¢\nå¼çš„æ•°æ®ï¼ˆlinuxæœåŠ¡å™¨ä¸Šéœ€è¦ç”¨unix2dosè½¬åŒ–æˆdosæ–‡ä»¶ï¼‰ã€‚ linuxä¸‹é»˜è®¤çš„æ¢è¡Œæ˜¯")]),e._v(" "),_("p",[e._v("\\n,windowsç³»ç»Ÿçš„æ¢è¡Œç¬¦æ˜¯\\r\\nï¼Œredisä½¿ç”¨çš„æ˜¯\\r\\n. echo -en")]),e._v(" "),_("p",[e._v("143")]),e._v(" "),_("p",[e._v("Redis-cliå‘½ä»¤è¡Œå…¶ä»–æ“ä½œ")]),e._v(" "),_("p",[e._v("'*3\\r\\n$3\\r\\nSET\\r\\n$3\\r\\nkey\\r\\n$5\\r\\nvalue\\r\\n' | redis-cli --pipe")]),e._v(" "),_("ol",{attrs:{start:"9"}},[_("li",[e._v("-a")])]),e._v(" "),_("p",[e._v("å¦‚æœå¼€å¯äº†requirepassï¼Œé‚£ä¹ˆä½ å¦‚æœå¸Œæœ›è°ƒç”¨æˆ–è€…è‡ªå·±ç¼–å†™ä¸€äº›å¤–éƒ¨è„šæœ¬é€šè¿‡redis-cliè¿›è¡Œæ“\nä½œæˆ–è€…ç›‘æ§redisï¼Œé‚£ä¹ˆè¿™ä¸ªé€‰é¡¹å¯ä»¥è®©ä½ ä¸ç”¨å†æ‰‹åŠ¨è¾“å…¥authã€‚è¿™ä¸ªé€‰é¡¹å¾ˆæ™®éï¼Œä½†æ˜¯å¾€å¾€\nè¢«äººå¿½è§†ã€‚")]),e._v(" "),_("p",[e._v("144")]),e._v(" "),_("p",[e._v("æŒä¹…åŒ–ä¸å¤‡ä»½æ¢å¤")]),e._v(" "),_("p",[e._v("6.13 æŒä¹…åŒ–ä¸å¤‡ä»½æ¢å¤")]),e._v(" "),_("p",[e._v("145")]),e._v(" "),_("p",[e._v("RDBç›¸å…³æ“ä½œ")]),e._v(" "),_("p",[e._v("3.13.1 RDBç›¸å…³æ“ä½œ")]),e._v(" "),_("p",[e._v("BGSAVEï¼šåå°å­è¿›ç¨‹è¿›è¡ŒRDBæŒä¹…åŒ– SAVEï¼šä¸»è¿›ç¨‹è¿›è¡ŒRDBï¼Œç”Ÿäº§ç¯å¢ƒåƒä¸‡åˆ«ç”¨ï¼ŒæœåŠ¡\nå™¨å°†æ— æ³•å“åº”ä»»ä½•æ“ä½œã€‚ LASTSAVEï¼š è¿”å›ä¸Šä¸€æ¬¡æˆåŠŸSAVEçš„Unixæ—¶é—´")]),e._v(" "),_("p",[e._v("åŠ¨æ€å…³é—­RDBï¼š")]),e._v(" "),_("p",[e._v('redis-cli config set save ""')]),e._v(" "),_("p",[e._v("åŠ¨æ€è®¾ç½®RDBï¼š")]),e._v(" "),_("p",[e._v('redis-cli config set save "900 1"')]),e._v(" "),_("p",[e._v("æ°¸ä¹…å…³é—­RDBï¼š")]),e._v(" "),_("p",[e._v("sed -e '/save/ s/^#*/#/' -i /etc/redis/redis.conf")]),e._v(" "),_("p",[e._v("æ°¸ä¹…è®¾ç½®RDBï¼š")]),e._v(" "),_("p",[e._v("åœ¨redis.confä¸­è®¾ç½®saveé€‰é¡¹")]),e._v(" "),_("p",[e._v("æŸ¥çœ‹RDBæ˜¯å¦æ‰“å¼€ï¼š")]),e._v(" "),_("p",[e._v("redis-cli config get save")]),e._v(" "),_("p",[e._v("ç©ºçš„å³æ˜¯å…³é—­ï¼Œæœ‰æ•°å­—çš„éƒ½æ˜¯æ‰“å¼€çš„ã€‚")]),e._v(" "),_("p",[e._v("146")]),e._v(" "),_("p",[e._v("AOFç›¸å…³æ“ä½œ")]),e._v(" "),_("p",[e._v("3.13.2 AOFç›¸å…³æ“ä½œ")]),e._v(" "),_("p",[e._v("BGREWRITEAOF")]),e._v(" "),_("p",[e._v("åœ¨åå°æ‰§è¡Œä¸€ä¸ª AOFæ–‡ä»¶é‡å†™æ“ä½œ\nåŠ¨æ€å…³é—­AOFï¼š")]),e._v(" "),_("p",[e._v("redis-cli config set appendonly no")]),e._v(" "),_("p",[e._v("åŠ¨æ€æ‰“å¼€AOFï¼š")]),e._v(" "),_("p",[e._v("redis-cli config set appendonly yes")]),e._v(" "),_("p",[e._v("æ°¸ä¹…å…³é—­AOFï¼š")]),e._v(" "),_("p",[e._v("sed -e '/appendonly/ s/^#*/#/' -i /etc/redis/redis.conf ï¼ˆé»˜è®¤æ˜¯å…³é—­çš„ï¼‰")]),e._v(" "),_("p",[e._v("æ°¸ä¹…æ‰“å¼€AOFï¼š")]),e._v(" "),_("p",[e._v("å°†appendonly yesè®¾ç½®åœ¨redis.confä¸­")]),e._v(" "),_("p",[e._v("147")]),e._v(" "),_("p",[e._v("å¤‡ä»½")]),e._v(" "),_("p",[e._v("3.13.3 å¤‡ä»½")]),e._v(" "),_("p",[e._v("å¯¹äºRDBå’ŒAOFï¼Œéƒ½æ˜¯ç›´æ¥æ‹·è´æ–‡ä»¶å³å¯ï¼Œå¯ä»¥è®¾å®šcrontabè¿›è¡Œå®šæ—¶å¤‡ä»½ï¼š cp")]),e._v(" "),_("p",[e._v("/var/lib/redis/dump.rdb /somewhere/safe/dump.$(date +%Y%m%d%H%M).rdb")]),e._v(" "),_("p",[e._v("148")]),e._v(" "),_("p",[e._v("æ¢å¤")]),e._v(" "),_("p",[e._v("3.13.4 æ¢å¤")]),e._v(" "),_("p",[e._v("å¦‚æœåªä½¿ç”¨äº†RDBï¼Œåˆ™é¦–å…ˆå°†redis-serveråœæ‰ï¼Œåˆ é™¤dump.rdbï¼Œæœ€åå°†å¤‡ä»½çš„dump.rdbæ–‡ä»¶\næ‹·è´å›dataç›®å½•å¹¶ä¿®æ”¹ç›¸å…³å±ä¸»ä¿è¯å…¶å±ä¸»å’Œredis-serverå¯åŠ¨ç”¨æˆ·ä¸€è‡´ï¼Œç„¶åå¯åŠ¨redis-\nserverã€‚")]),e._v(" "),_("p",[e._v("å¦‚æœæ˜¯RDB+AOFçš„æŒä¹…åŒ–ï¼Œåªéœ€è¦å°†aofæ–‡ä»¶æ”¾å…¥dataç›®å½•ï¼Œå¯åŠ¨redis-serverï¼ŒæŸ¥çœ‹æ˜¯å¦æ¢\nå¤ï¼Œå¦‚æ— æ³•æ¢å¤åˆ™åº”è¯¥å°†aofå…³é—­åé‡å¯ï¼Œrediså°±ä¼šä»rdbè¿›è¡Œæ¢å¤äº†ï¼Œéšåè°ƒç”¨å‘½ä»¤\nBGREWRITEAOFè¿›è¡ŒAOFæ–‡ä»¶å†™å…¥ï¼Œåœ¨infoçš„aof_rewrite_in_progressä¸º0åä¸€ä¸ªæ–°çš„aofæ–‡\nä»¶å°±ç”Ÿæˆäº†ï¼Œæ­¤æ—¶å†å°†é…ç½®æ–‡ä»¶çš„aofæ‰“å¼€ï¼Œå†æ¬¡é‡å¯redis-serverå°±å¯ä»¥æ¢å¤äº†ã€‚æ³¨æ„å…ˆä¸è¦\nå°†dump.rdbæ”¾å…¥dataç›®å½•ï¼Œå¦åˆ™ä¼šå› ä¸ºaofæ–‡ä»¶ä¸‡ä¸€ä¸å¯ç”¨ï¼Œåˆ™rdbä¹Ÿä¸ä¼šè¢«æ¢å¤è¿›å†…å­˜ï¼Œæ­¤\næ—¶å¦‚æœæœ‰æ–°çš„è¯·æ±‚è¿›æ¥ååˆ™åŸå…ˆçš„rdbæ–‡ä»¶è¢«é‡å†™ã€‚")]),e._v(" "),_("p",[e._v("å¦‚æœåªé…ç½®äº†AOFï¼Œé‡å¯æ—¶åŠ è½½AOFæ–‡ä»¶æ¢å¤æ•°æ®ã€‚\næ¢å¤é€Ÿåº¦å‚è§æ–°æµªçš„æµ‹è¯•ç»“æœï¼š")]),e._v(" "),_("p",[e._v("è¿™ä¸ªç»“æœæ˜¯å¯ä¿¡çš„ï¼Œåœ¨ä¸€å°SSDã€4ä¸ªCPUçš„è™šæ‹Ÿæœºä¸Šæµ‹è¯•ä¸º28.3G/s.\næ£€æŸ¥ä¿®å¤AOFæ–‡ä»¶ï¼š")]),e._v(" "),_("p",[e._v("redis-check-aof data/appendonly.aof")]),e._v(" "),_("p",[e._v("149")]),e._v(" "),_("p",[e._v("æ•°æ®è¿ç§»")]),e._v(" "),_("ol",{attrs:{start:"7"}},[_("li",[e._v("æ•°æ®è¿ç§»")])]),e._v(" "),_("p",[e._v("150")]),e._v(" "),_("p",[e._v("å°†keyä»å½“å‰æ•°æ®åº“ç§»åŠ¨åˆ°æŒ‡å®šæ•°æ®åº“")]),e._v(" "),_("p",[e._v("4.1 å°†keyä»å½“å‰æ•°æ®åº“ç§»åŠ¨åˆ°æŒ‡å®šæ•°æ®åº“")]),e._v(" "),_("p",[e._v("move key db-index")]),e._v(" "),_("p",[e._v("è¿”å›1æˆåŠŸã€‚0 å¦‚æœkeyä¸å­˜åœ¨ï¼Œæˆ–è€…å·²ç»åœ¨æŒ‡å®šæ•°æ®åº“ä¸­")]),e._v(" "),_("p",[e._v("151")]),e._v(" "),_("p",[e._v("é—®é¢˜å¤„ç†")]),e._v(" "),_("ol",{attrs:{start:"8"}},[_("li",[e._v("æ•°æ®è¿ç§»")])]),e._v(" "),_("p",[e._v("152")]),e._v(" "),_("p",[e._v("ä¸€èˆ¬å¤„ç†æµç¨‹")]),e._v(" "),_("p",[e._v("8.1 ä¸€èˆ¬å¤„ç†æµç¨‹")]),e._v(" "),_("p",[e._v("153")]),e._v(" "),_("p",[e._v("æ¢æµ‹æœåŠ¡æ˜¯å¦å¯ç”¨")]),e._v(" "),_("p",[e._v("6.1.1 æ¢æµ‹æœåŠ¡æ˜¯å¦å¯ç”¨")]),e._v(" "),_("p",[e._v("127.0.0.1:6379> ping")]),e._v(" "),_("p",[e._v("è¿”å›PONGè¯´æ˜æ­£å¸¸")]),e._v(" "),_("p",[e._v("154")]),e._v(" "),_("p",[e._v("æ¢æµ‹æœåŠ¡å»¶è¿Ÿ")]),e._v(" "),_("p",[e._v("6.1.2 æ¢æµ‹æœåŠ¡å»¶è¿Ÿ")]),e._v(" "),_("p",[e._v("redis-cli --latency æ˜¾ç¤ºçš„å•ä½æ˜¯millisecondsï¼Œä½œä¸ºå‚è€ƒï¼Œåƒå…†ç½‘ä¸€è·³ä¸€èˆ¬å»¶è¿Ÿä¸º0.16mså·¦å³")]),e._v(" "),_("p",[e._v("155")]),e._v(" "),_("p",[e._v("ç›‘æ§æ­£åœ¨è¯·æ±‚æ‰§è¡Œçš„å‘½ä»¤")]),e._v(" "),_("p",[e._v("6.1.3 ç›‘æ§æ­£åœ¨è¯·æ±‚æ‰§è¡Œçš„å‘½ä»¤ åœ¨cliä¸‹æ‰§è¡Œmonitorï¼Œç”Ÿäº§ç¯å¢ƒæ…ç”¨ã€‚")]),e._v(" "),_("p",[e._v("156")]),e._v(" "),_("p",[e._v("æŸ¥çœ‹ç»Ÿè®¡ä¿¡æ¯")]),e._v(" "),_("p",[e._v("6.1.4 æŸ¥çœ‹ç»Ÿè®¡ä¿¡æ¯")]),e._v(" "),_("p",[e._v("Mrds:6379> info")]),e._v(" "),_("p",[e._v("åœ¨cliä¸‹æ‰§è¡Œinfoã€‚")]),e._v(" "),_("p",[e._v("info Replication")]),e._v(" "),_("p",[e._v("åªçœ‹å…¶ä¸­ä¸€éƒ¨åˆ†ã€‚")]),e._v(" "),_("p",[e._v("config resetstat")]),e._v(" "),_("p",[e._v("é‡æ–°ç»Ÿè®¡ã€‚")]),e._v(" "),_("h1",{attrs:{id:"server"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#server"}},[e._v("#")]),e._v(" Server")]),e._v(" "),_("p",[e._v("redis_version:2.8.19 ###redisç‰ˆæœ¬å·\nredis_git_sha1:00000000 ###git SHA1\nredis_git_dirty:0  ###git dirty flag\nredis_build_id:78796c63e58b72dc\nredis_mode:standalone                ###redisè¿è¡Œæ¨¡å¼")]),e._v(" "),_("p",[e._v("os:Linux 2.6.32-431.el6.x86_64 x86_64 ###osç‰ˆæœ¬å·")]),e._v(" "),_("p",[e._v("arch_bits:64 ###64ä½æ¶æ„\nmultiplexing_api:epoll ###è°ƒç”¨epollç®—æ³•\ngcc_version:4.4.7 ###gccç‰ˆæœ¬å·\nprocess_id:25899   ###æœåŠ¡å™¨è¿›ç¨‹PID")]),e._v(" "),_("p",[e._v("run_id:eae356ac1098c13b68f2b00fd7e1c9f93b1c6a2c  ###Redisçš„éšæœºæ ‡è¯†ç¬¦(ç”¨äºsentinelå’Œé›†ç¾¤)\ntcp_port:6379  ###Redisç›‘å¬çš„ç«¯å£å·")]),e._v(" "),_("p",[e._v("uptime_in_seconds:6419 ###Redisè¿è¡Œæ—¶é•¿(sä¸ºå•ä½)\nuptime_in_days:0 ###Redisè¿è¡Œæ—¶é•¿(å¤©ä¸ºå•ä½)\nhz:10")]),e._v(" "),_("p",[e._v("lru_clock:10737922 ###ä»¥åˆ†é’Ÿä¸ºå•ä½çš„è‡ªå¢æ—¶é’Ÿ,ç”¨äºLRUç®¡ç†\nconfig_file:/etc/redis/redis.conf  ###redisé…ç½®æ–‡ä»¶")]),e._v(" "),_("h1",{attrs:{id:"clients"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#clients"}},[e._v("#")]),e._v(" Clients")]),e._v(" "),_("p",[e._v("connected_clients:1  ###å·²è¿æ¥å®¢æˆ·ç«¯çš„æ•°é‡ï¼ˆä¸åŒ…æ‹¬é€šè¿‡ä»å±æœåŠ¡å™¨è¿æ¥çš„å®¢æˆ·ç«¯ï¼‰è¿™ä¸ªå‚æ•°ä¹Ÿè¦ä¸€å®šå…³\næ³¨ï¼Œæœ‰é£™å‡å’Œæ˜æ˜¾ä¸‹é™æ—¶éƒ½ä¼šæœ‰é—®é¢˜ã€‚å³ä½¿ä¸æ“ä½œ")]),e._v(" "),_("p",[e._v("client_longest_output_list:0  ###å½“å‰è¿æ¥çš„å®¢æˆ·ç«¯ä¸­æœ€é•¿çš„è¾“å‡ºåˆ—è¡¨\nclient_biggest_input_buf:0  ###å½“å‰è¿æ¥çš„å®¢æˆ·ç«¯ä¸­æœ€å¤§çš„ã€‚è¾“å‡ºç¼“å­˜")]),e._v(" "),_("p",[e._v("blocked_clients:0 ###æ­£åœ¨ç­‰å¾…é˜»å¡å‘½ä»¤ï¼ˆBLPOPã€BRPOPã€BRPOPLPUSHï¼‰çš„å®¢æˆ·ç«¯çš„æ•°é‡ éœ€ç›‘æ§")]),e._v(" "),_("h1",{attrs:{id:"memory"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#memory"}},[e._v("#")]),e._v(" Memory")]),e._v(" "),_("p",[e._v("used_memory:2281560  ###ç”± Redis åˆ†é…å™¨åˆ†é…çš„å†…å­˜æ€»é‡ï¼Œä»¥å­—èŠ‚ï¼ˆbyteï¼‰ä¸ºå•ä½")]),e._v(" "),_("p",[e._v("used_memory_human:2.18M ###ä»¥æ›´å‹å¥½çš„æ ¼å¼è¾“å‡ºrediså ç”¨çš„å†…å­˜")]),e._v(" "),_("p",[e._v("used_memory_rss:2699264  ###ä»æ“ä½œç³»ç»Ÿçš„è§’åº¦ï¼Œè¿”å› Redis å·²åˆ†é…çš„å†…å­˜æ€»é‡ï¼ˆä¿—ç§°å¸¸é©»é›†å¤§å°ï¼‰ã€‚è¿™\nä¸ªå€¼å’Œ top ã€ ps ç­‰å‘½ä»¤çš„è¾“å‡ºä¸€è‡´ï¼ŒåŒ…å«äº†used_memoryå’Œå†…å­˜ç¢ç‰‡ã€‚")]),e._v(" "),_("p",[e._v("used_memory_peak:22141272 ### Redis çš„å†…å­˜æ¶ˆè€—å³°å€¼ï¼ˆä»¥å­—èŠ‚ä¸ºå•ä½ï¼‰\nused_memory_peak_human:21.12M ###ä»¥æ›´å‹å¥½çš„æ ¼å¼è¾“å‡ºrediså³°å€¼å†…å­˜å ç”¨\nused_memory_lua:35840  ###LUAå¼•æ“æ‰€ä½¿ç”¨çš„å†…å­˜å¤§å°")]),e._v(" "),_("p",[e._v("157")]),e._v(" "),_("p",[e._v("æŸ¥çœ‹ç»Ÿè®¡ä¿¡æ¯")]),e._v(" "),_("p",[e._v("mem_fragmentation_ratio:1.18  ###  =used_memory_rss /used_memory è¿™ä¸¤ä¸ªå‚æ•°éƒ½åŒ…å«ä¿å­˜ç”¨æˆ·\nk-væ•°æ®çš„å†…å­˜å’Œrediså†…éƒ¨ä¸åŒæ•°æ®ç»“æ„éœ€è¦å ç”¨çš„å†…å­˜ï¼Œå¹¶ä¸”RSSæŒ‡çš„æ˜¯åŒ…å«æ“ä½œç³»ç»Ÿç»™rediså®ä¾‹åˆ†é…çš„å†…å­˜ï¼Œ\nè¿™é‡Œé¢è¿˜åŒ…å«ä¸è¿ç»­åˆ†é…æ‰€å¸¦æ¥çš„å¼€é”€ã€‚å› æ­¤åœ¨ç†æƒ³æƒ…å†µä¸‹ï¼Œ used_memory_rss çš„å€¼åº”è¯¥åªæ¯” used_memory\nç¨å¾®é«˜ä¸€ç‚¹å„¿ã€‚å½“ rss > used ï¼Œä¸”ä¸¤è€…çš„å€¼ç›¸å·®è¾ƒå¤§æ—¶ï¼Œè¡¨ç¤ºå­˜åœ¨ï¼ˆå†…éƒ¨æˆ–å¤–éƒ¨çš„ï¼‰å†…å­˜ç¢ç‰‡ã€‚å†…å­˜ç¢ç‰‡çš„æ¯”ç‡\nå¯ä»¥é€šè¿‡ mem_fragmentation_ratio çš„å€¼çœ‹å‡ºã€‚å½“ used > rss æ—¶ï¼Œè¡¨ç¤º Redis çš„éƒ¨åˆ†å†…å­˜è¢«æ“ä½œç³»ç»Ÿæ¢\nå‡ºåˆ°äº¤æ¢ç©ºé—´äº†ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ“ä½œå¯èƒ½ä¼šäº§ç”Ÿæ˜æ˜¾çš„å»¶è¿Ÿã€‚å¯ä»¥è¯´è¿™ä¸ªå€¼å¤§äº1.5æˆ–è€…å°äº1éƒ½æ˜¯æœ‰é—®é¢˜çš„ã€‚å½“å¤§\näº1.5çš„æ—¶å€™éœ€è¦æ‹©æœºè¿›è¡ŒæœåŠ¡å™¨é‡å¯ã€‚å½“å°äº1çš„æ—¶å€™éœ€è¦å¯¹redisè¿›è¡Œæ•°æ®æ¸…ç†")]),e._v(" "),_("p",[e._v("mem_allocator:jemalloc-3.6.0")]),e._v(" "),_("h1",{attrs:{id:"persistence"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#persistence"}},[e._v("#")]),e._v(" Persistence")]),e._v(" "),_("p",[e._v("loading:0 ###è®°å½•æœåŠ¡å™¨æ˜¯å¦æ­£åœ¨è½½å…¥æŒä¹…åŒ–æ–‡ä»¶ï¼Œ1ä¸ºæ­£åœ¨åŠ è½½")]),e._v(" "),_("p",[e._v("rdb_changes_since_last_save:0 ###è·ç¦»æœ€è¿‘ä¸€æ¬¡æˆåŠŸåˆ›å»ºæŒä¹…åŒ–æ–‡ä»¶ä¹‹åï¼Œäº§ç”Ÿäº†å¤šå°‘æ¬¡ä¿®æ”¹æ•°æ®é›†çš„\næ“ä½œ")]),e._v(" "),_("p",[e._v("rdb_bgsave_in_progress:0  ###è®°å½•äº†æœåŠ¡å™¨æ˜¯å¦æ­£åœ¨åˆ›å»º RDB æ–‡ä»¶ï¼Œ1ä¸ºæ­£åœ¨è¿›è¡Œ\nrdb_last_save_time:1420023749 ###æœ€è¿‘ä¸€æ¬¡æˆåŠŸåˆ›å»º RDB æ–‡ä»¶çš„ UNIX æ—¶é—´æˆ³\nrdb_last_bgsave_status:ok        ###æœ€è¿‘ä¸€æ¬¡åˆ›å»º RDB æ–‡ä»¶çš„ç»“æœæ˜¯æˆåŠŸè¿˜æ˜¯å¤±è´¥,å¤±è´¥æ ‡è¯†ä¸ºerrï¼Œè¿™ä¸ªæ—¶\nå€™å†™å…¥redis çš„æ“ä½œå¯èƒ½ä¼šåœæ­¢ï¼Œå› ä¸ºé»˜è®¤stop-writes-on-bgsave-erroræ˜¯å¼€å¯çš„ï¼Œè¿™ä¸ªæ—¶å€™å¦‚æœéœ€è¦å°½å¿«æ¢\nå¤å†™æ“ä½œï¼Œå¯ä»¥æ‰‹å·¥å°†è¿™ä¸ªé€‰é¡¹è®¾ç½®ä¸ºnoã€‚")]),e._v(" "),_("p",[e._v("rdb_last_bgsave_time_sec:0 ###æœ€è¿‘ä¸€æ¬¡åˆ›å»º RDB æ–‡ä»¶è€—è´¹çš„ç§’æ•°\nrdb_current_bgsave_time_sec:-1 ###å¦‚æœæœåŠ¡å™¨æ­£åœ¨åˆ›å»º RDB æ–‡ä»¶ï¼Œé‚£ä¹ˆè¿™ä¸ªåŸŸè®°å½•çš„å°±æ˜¯å½“å‰çš„åˆ›å»º\næ“ä½œå·²ç»è€—è´¹çš„ç§’æ•°")]),e._v(" "),_("p",[e._v("aof_enabled:1 ###AOF æ˜¯å¦å¤„äºæ‰“å¼€çŠ¶æ€ï¼Œ1ä¸ºå¯ç”¨")]),e._v(" "),_("p",[e._v("aof_rewrite_in_progress:0 ###æœåŠ¡å™¨æ˜¯å¦æ­£åœ¨åˆ›å»º AOF æ–‡ä»¶")]),e._v(" "),_("p",[e._v("aof_rewrite_scheduled:0  ###RDB æ–‡ä»¶åˆ›å»ºå®Œæ¯•ä¹‹åï¼Œæ˜¯å¦éœ€è¦æ‰§è¡Œé¢„çº¦çš„ AOF é‡å†™æ“ä½œï¼ˆå› ä¸ºåœ¨RDBæ—¶")]),e._v(" "),_("p",[e._v("aofçš„rewriteä¼šè¢«é˜»å¡ä¸€ç›´åˆ°RDBç»“æŸï¼‰")]),e._v(" "),_("p",[e._v("aof_last_rewrite_time_sec:-1 ###æœ€è¿‘ä¸€æ¬¡åˆ›å»º AOF æ–‡ä»¶è€—è´¹çš„æ—¶é•¿\naof_current_rewrite_time_sec:-1 ###å¦‚æœæœåŠ¡å™¨æ­£åœ¨åˆ›å»º AOF æ–‡ä»¶ï¼Œé‚£ä¹ˆè¿™ä¸ªåŸŸè®°å½•çš„å°±æ˜¯å½“å‰çš„åˆ›å»º\næ“ä½œå·²ç»è€—è´¹çš„ç§’æ•°")]),e._v(" "),_("p",[e._v("aof_last_bgrewrite_status:ok ###æœ€è¿‘ä¸€æ¬¡åˆ›å»º AOF æ–‡ä»¶çš„ç»“æœæ˜¯æˆåŠŸè¿˜æ˜¯å¤±è´¥")]),e._v(" "),_("p",[e._v("aof_last_write_status:ok\naof_current_size:176265 ###AOF æ–‡ä»¶ç›®å‰çš„å¤§å°")]),e._v(" "),_("p",[e._v("aof_base_size:176265 ###æœåŠ¡å™¨å¯åŠ¨æ—¶æˆ–è€… AOF é‡å†™æœ€è¿‘ä¸€æ¬¡æ‰§è¡Œä¹‹åï¼ŒAOF æ–‡ä»¶çš„å¤§å°\naof_pending_rewrite:0 ###æ˜¯å¦æœ‰ AOF é‡å†™æ“ä½œåœ¨ç­‰å¾… RDB æ–‡ä»¶åˆ›å»ºå®Œæ¯•ä¹‹åæ‰§è¡Œ\naof_buffer_length:0  ###AOF ç¼“å†²åŒºçš„å¤§å°")]),e._v(" "),_("p",[e._v("aof_rewrite_buffer_length:0 ###AOF é‡å†™ç¼“å†²åŒºçš„å¤§å°\naof_pending_bio_fsync:0 ###åå° I/O é˜Ÿåˆ—é‡Œé¢ï¼Œç­‰å¾…æ‰§è¡Œçš„ fsync è°ƒç”¨æ•°é‡\naof_delayed_fsync:0###è¢«å»¶è¿Ÿçš„ fsync è°ƒç”¨æ•°é‡\nloading_start_time:1441769386    loadingå¯åŠ¨æ—¶é—´æˆ³\nloading_total_bytes:1787767808      loadingéœ€è¦åŠ è½½æ•°æ®é‡\nloading_loaded_bytes:1587418182 å·²ç»åŠ è½½çš„æ•°æ®é‡\nloading_loaded_perc:88.79           åŠ è½½ç™¾åˆ†æ¯”")]),e._v(" "),_("p",[e._v("loading_eta_seconds:7 å‰©ä½™æ—¶é—´")]),e._v(" "),_("h1",{attrs:{id:"stats"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#stats"}},[e._v("#")]),e._v(" Stats")]),e._v(" "),_("p",[e._v("total_connections_received:8466 ###æœåŠ¡å™¨å·²æ¥å—çš„è¿æ¥è¯·æ±‚æ•°é‡ï¼Œæ³¨æ„è¿™æ˜¯ä¸ªç´¯è®¡å€¼ã€‚\ntotal_commands_processed:900668  ###æœåŠ¡å™¨å·²æ‰§è¡Œçš„å‘½ä»¤æ•°é‡ï¼Œè¿™ä¸ªæ•°å€¼éœ€è¦æŒç»­ç›‘æ§ï¼Œå¦‚æœåœ¨ä¸€æ®µæ—¶\né—´å†…å‡ºç°å¤§èŒƒå›´æ³¢åŠ¨è¯´æ˜ç³»ç»Ÿè¦ä¹ˆå‡ºç°å¤§é‡è¯·æ±‚ï¼Œè¦ä¹ˆå‡ºç°æ‰§è¡Œç¼“æ…¢çš„æ“ä½œã€‚")]),e._v(" "),_("p",[e._v("instantaneous_ops_per_sec:1 ###æœåŠ¡å™¨æ¯ç§’é’Ÿæ‰§è¡Œçš„å‘½ä»¤æ•°é‡\ntotal_net_input_bytes:82724170\ntotal_net_output_bytes:39509080\ninstantaneous_input_kbps:0.07\ninstantaneous_output_kbps:0.02")]),e._v(" "),_("p",[e._v("rejected_connections:0 ###å› ä¸ºæœ€å¤§å®¢æˆ·ç«¯æ•°é‡é™åˆ¶è€Œè¢«æ‹’ç»çš„è¿æ¥è¯·æ±‚æ•°é‡")]),e._v(" "),_("p",[e._v("158")]),e._v(" "),_("p",[e._v("æŸ¥çœ‹ç»Ÿè®¡ä¿¡æ¯")]),e._v(" "),_("p",[e._v("sync_full:2\nsync_partial_ok:0\nsync_partial_err:0")]),e._v(" "),_("p",[e._v("expired_keys:0 ###å› ä¸ºè¿‡æœŸè€Œè¢«è‡ªåŠ¨åˆ é™¤çš„æ•°æ®åº“é”®æ•°é‡")]),e._v(" "),_("p",[e._v("evicted_keys:0 ###å› ä¸ºæœ€å¤§å†…å­˜å®¹é‡é™åˆ¶è€Œè¢«é©±é€ï¼ˆevictï¼‰çš„é”®æ•°é‡ã€‚è¿™ä¸ªæ•°å€¼å¦‚æœä¸æ˜¯0åˆ™è¯´æ˜maxmemo\nryè¢«è§¦å‘ï¼Œå¹¶ä¸”  evicted_keysä¸€ç›´å¤§äº0ï¼Œåˆ™ç³»ç»Ÿçš„latencyå¢åŠ ï¼Œæ­¤æ—¶å¯ä»¥ä¸´æ—¶æé«˜æœ€å¤§å†…å­˜ï¼Œä½†è¿™åªæ˜¯ä¸´\næ—¶æªæ–½ï¼Œéœ€è¦ä»åº”ç”¨ç€æ‰‹åˆ†æã€‚")]),e._v(" "),_("p",[e._v("keyspace_hits:0 ###æŸ¥æ‰¾æ•°æ®åº“é”®æˆåŠŸçš„æ¬¡æ•°ã€‚å¯ä»¥è®¡ç®—å‘½ä¸­ç‡\nkeyspace_misses:500000  ###æŸ¥æ‰¾æ•°æ®åº“é”®å¤±è´¥çš„æ¬¡æ•°ã€‚\npubsub_channels:0     ###ç›®å‰è¢«è®¢é˜…çš„é¢‘é“æ•°é‡\npubsub_patterns:0      ###ç›®å‰è¢«è®¢é˜…çš„æ¨¡å¼æ•°é‡\nlatest_fork_usec:402     ###æœ€è¿‘ä¸€æ¬¡ fork() æ“ä½œè€—è´¹çš„æ¯«ç§’æ•°")]),e._v(" "),_("h1",{attrs:{id:"replication"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#replication"}},[e._v("#")]),e._v(" Replication")]),e._v(" "),_("p",[e._v("role:master  ###å¦‚æœå½“å‰æœåŠ¡å™¨æ²¡æœ‰åœ¨å¤åˆ¶ä»»ä½•å…¶ä»–æœåŠ¡å™¨ï¼Œé‚£ä¹ˆè¿™ä¸ªåŸŸçš„å€¼å°±æ˜¯ master ï¼›å¦åˆ™çš„è¯ï¼Œè¿™\nä¸ªåŸŸçš„å€¼å°±æ˜¯ slave ã€‚æ³¨æ„ï¼Œåœ¨åˆ›å»ºå¤åˆ¶é“¾çš„æ—¶å€™ï¼Œä¸€ä¸ªä»æœåŠ¡å™¨ä¹Ÿå¯èƒ½æ˜¯å¦ä¸€ä¸ªæœåŠ¡å™¨çš„ä¸»æœåŠ¡å™¨\nconnected_slaves:2  ###2ä¸ªslaves\nslave0:ip=192.168.65.130,port=6379,state=online,offset=1639,lag=1\nslave1:ip=192.168.65.129,port=6379,state=online,offset=1639,lag=0\nmaster_repl_offset:1639")]),e._v(" "),_("p",[e._v("repl_backlog_active:1\nrepl_backlog_size:1048576\nrepl_backlog_first_byte_offset:2\nrepl_backlog_histlen:1638")]),e._v(" "),_("h1",{attrs:{id:"cpu"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#cpu"}},[e._v("#")]),e._v(" CPU")]),e._v(" "),_("p",[e._v("used_cpu_sys:41.87 ###Redis æœåŠ¡å™¨è€—è´¹çš„ç³»ç»Ÿ CPU\nused_cpu_user:17.82 ###Redis æœåŠ¡å™¨è€—è´¹çš„ç”¨æˆ· CPU\nused_cpu_sys_children:0.01 ###åå°è¿›ç¨‹è€—è´¹çš„ç³»ç»Ÿ CPU\nused_cpu_user_children:0.01 ###åå°è¿›ç¨‹è€—è´¹çš„ç”¨æˆ· CPU")]),e._v(" "),_("h1",{attrs:{id:"keyspace"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#keyspace"}},[e._v("#")]),e._v(" Keyspace")]),e._v(" "),_("p",[e._v("db0:keys=3101,expires=0,avg_ttl=0  ###keyspace éƒ¨åˆ†è®°å½•äº†æ•°æ®åº“ç›¸å…³çš„ç»Ÿè®¡ä¿¡æ¯ï¼Œæ¯”å¦‚æ•°æ®åº“çš„é”®\næ•°é‡ã€æ•°æ®åº“è¿‡æœŸé”®æ•°é‡ç­‰ã€‚å¯¹äºæ¯ä¸ªæ•°æ®åº“ï¼Œè¿™ä¸ªéƒ¨åˆ†éƒ½ä¼šæ·»åŠ ä¸€è¡Œæ­¤ä¿¡æ¯")]),e._v(" "),_("p",[e._v("159")]),e._v(" "),_("p",[e._v("è·å–æ…¢æŸ¥è¯¢")]),e._v(" "),_("p",[e._v("6.1.5 è·å–æ…¢æŸ¥è¯¢")]),e._v(" "),_("p",[e._v("SLOWLOG GET 10")]),e._v(" "),_("p",[e._v("ç»“æœä¸ºæŸ¥è¯¢IDã€å‘ç”Ÿæ—¶é—´ã€è¿è¡Œæ—¶é•¿å’ŒåŸå‘½ä»¤ é»˜è®¤10æ¯«ç§’ï¼Œé»˜è®¤åªä¿ç•™æœ€åçš„128æ¡ã€‚å•çº¿\nç¨‹çš„æ¨¡å‹ä¸‹ï¼Œä¸€ä¸ªè¯·æ±‚å æ‰10æ¯«ç§’æ˜¯ä»¶å¤§äº‹æƒ…ï¼Œæ³¨æ„è®¾ç½®å’Œæ˜¾ç¤ºçš„å•ä½ä¸ºå¾®ç§’ï¼Œæ³¨æ„è¿™ä¸ªæ—¶\né—´æ˜¯ä¸åŒ…å«ç½‘ç»œå»¶è¿Ÿçš„ã€‚")]),e._v(" "),_("p",[e._v("slowlog get")]),e._v(" "),_("p",[e._v("è·å–æ…¢æŸ¥è¯¢æ—¥å¿—")]),e._v(" "),_("p",[e._v("slowlog len")]),e._v(" "),_("p",[e._v("è·å–æ…¢æŸ¥è¯¢æ—¥å¿—æ¡æ•°")]),e._v(" "),_("p",[e._v("slowlog reset")]),e._v(" "),_("p",[e._v("æ¸…ç©ºæ…¢æŸ¥è¯¢")]),e._v(" "),_("p",[e._v("160")]),e._v(" "),_("p",[e._v("æŸ¥çœ‹å®¢æˆ·ç«¯")]),e._v(" "),_("p",[e._v("6.1.6 æŸ¥çœ‹å®¢æˆ·ç«¯")]),e._v(" "),_("p",[e._v("client list")]),e._v(" "),_("p",[e._v("åˆ—å‡ºæ‰€æœ‰è¿æ¥")]),e._v(" "),_("p",[e._v("client kill")]),e._v(" "),_("p",[e._v("æ€æ­»æŸä¸ªè¿æ¥ï¼Œ ä¾‹å¦‚ CLIENT KILL 127.0.0.1:43501")]),e._v(" "),_("p",[e._v("client getname #")]),e._v(" "),_("p",[e._v("è·å–è¿æ¥çš„åç§° é»˜è®¤nil")]),e._v(" "),_("p",[e._v('client setname "åç§°"')]),e._v(" "),_("p",[e._v("è®¾ç½®è¿æ¥åç§°,ä¾¿äºè°ƒè¯•")]),e._v(" "),_("p",[e._v("161")]),e._v(" "),_("p",[e._v("æŸ¥çœ‹æ—¥å¿—")]),e._v(" "),_("p",[e._v("6.1.7 æŸ¥çœ‹æ—¥å¿—")]),e._v(" "),_("p",[e._v("æ—¥å¿—ä½ç½®åœ¨/redis/logä¸‹ï¼Œredis.logä¸ºredisä¸»æ—¥å¿—ï¼Œsentinel.logä¸ºsentinelç›‘æ§æ—¥å¿—ã€‚")]),e._v(" "),_("p",[e._v("162")]),e._v(" "),_("p",[e._v("å»¶è¿Ÿæ£€æŸ¥")]),e._v(" "),_("p",[e._v("6.2 å¹¶å‘å»¶è¿Ÿæ£€æŸ¥")]),e._v(" "),_("p",[e._v("topçœ‹åˆ°å•ä¸ªCPU 100%æ—¶ï¼Œå°±æ˜¯å‚ç›´æ‰©å±•çš„æ—¶å€™äº†ã€‚å¦‚æœéœ€è¦è®©CPUä½¿ç”¨ç‡æœ€å¤§åŒ–ï¼Œå¯ä»¥é…\nç½®Rediså®ä¾‹æ•°å¯¹åº”CPUæ•°, Rediså®ä¾‹æ•°å¯¹åº”ç«¯å£æ•°(8æ ¸Cpu, 8ä¸ªå®ä¾‹, 8ä¸ªç«¯å£), ä»¥æé«˜å¹¶\nå‘ã€‚å•æœºæµ‹è¯•æ—¶, å•æ¡æ•°æ®åœ¨200å­—èŠ‚, æµ‹è¯•çš„ç»“æœä¸º8~9ä¸‡tpsã€‚ï¼ˆæœªå®æµ‹ï¼‰ã€‚ å¦å¤–ï¼Œå¯¹äºå‘½\nä»¤çš„å¤æ‚åº¦ä¸€å®šè¦å…³æ³¨ã€‚")]),e._v(" "),_("p",[e._v("163")]),e._v(" "),_("p",[e._v("æ£€æŸ¥CPUæƒ…å†µ")]),e._v(" "),_("p",[e._v("6.2.1 æ£€æŸ¥CPUæƒ…å†µ")]),e._v(" "),_("p",[e._v("mpstat -P ALL 1")]),e._v(" "),_("p",[e._v("164")]),e._v(" "),_("p",[e._v("æ£€æŸ¥ç½‘ç»œæƒ…å†µ")]),e._v(" "),_("p",[e._v("6.2.2 æ£€æŸ¥ç½‘ç»œæƒ…å†µ")]),e._v(" "),_("p",[e._v("å¯ä»¥åœ¨ç³»ç»Ÿä¸ç¹å¿™æˆ–è€…ä¸´æ—¶ä¸‹çº¿å‰æ£€æµ‹å®¢æˆ·ç«¯å’Œserveræˆ–è€…proxy çš„å¸¦å®½ï¼š")]),e._v(" "),_("p",[e._v("1)ä½¿ç”¨ iperf -s å‘½ä»¤å°† Iperf å¯åŠ¨ä¸º server æ¨¡å¼:")]),e._v(" "),_("p",[e._v("iperf â€“s")]),e._v(" "),_("p",[e._v("â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”")]),e._v(" "),_("p",[e._v("Server listening on TCP port 5001\nTCP window size: 8.00 KByte (default)")]),e._v(" "),_("p",[e._v("â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”")]),e._v(" "),_("p",[e._v("2)å¯åŠ¨å®¢æˆ·ç«¯ï¼Œå‘IPä¸º10.230.48.65çš„ä¸»æœºå‘å‡ºTCPæµ‹è¯•ï¼Œå¹¶æ¯2ç§’è¿”å›ä¸€æ¬¡æµ‹è¯•ç»“æœï¼Œä»¥\nMbytes/secä¸ºå•ä½æ˜¾ç¤ºæµ‹è¯•ç»“æœï¼š")]),e._v(" "),_("p",[e._v("iperf -c 10.230.48.65 -f M -i 2")]),e._v(" "),_("p",[e._v("165")]),e._v(" "),_("p",[e._v("æ£€æŸ¥redisæ•´ä½“æƒ…å†µ")]),e._v(" "),_("p",[e._v("6.2.3 æ£€æŸ¥ç³»ç»Ÿæƒ…å†µ")]),e._v(" "),_("p",[e._v("ç€é‡æ£€æŸ¥æ¢æµ‹æœåŠ¡å»¶è¿Ÿã€ ç›‘æ§æ­£åœ¨è¯·æ±‚æ‰§è¡Œçš„å‘½ä»¤ã€è·å–æ…¢æŸ¥è¯¢")]),e._v(" "),_("p",[e._v("166")]),e._v(" "),_("p",[e._v("æ£€æŸ¥è¿æ¥æ•°")]),e._v(" "),_("p",[e._v("6.2.4 æ£€æŸ¥è¿æ¥æ•°")]),e._v(" "),_("p",[e._v("æŸ¥çœ‹infoé‡Œé¢çš„total_connections_receivedï¼Œå¦‚æœè¯¥å€¼ä¸æ–­å‡é«˜ï¼Œåˆ™éœ€è¦ä¿®æ”¹åº”ç”¨ï¼Œé‡‡ç”¨è¿æ¥\næ± æ–¹å¼è¿›è¡Œï¼Œå› ä¸ºé¢‘ç¹å…³é—­å†åˆ›å»ºè¿æ¥redisçš„å¼€é”€å¾ˆå¤§ã€‚")]),e._v(" "),_("p",[e._v("167")]),e._v(" "),_("p",[e._v("æ£€æŸ¥æŒä¹…åŒ–")]),e._v(" "),_("p",[e._v("6.2.5 æ£€æŸ¥æŒä¹…åŒ–")]),e._v(" "),_("p",[e._v("RDBçš„æ—¶é—´ï¼š latest_fork_usec:936  ä¸Šæ¬¡å¯¼å‡ºrdbå¿«ç…§,æŒä¹…åŒ–èŠ±è´¹ï¼Œå¾®ç§’ã€‚ æ£€æŸ¥æ˜¯å¦æœ‰äººä½¿\nç”¨äº†SAVEã€‚")]),e._v(" "),_("p",[e._v("168")]),e._v(" "),_("p",[e._v("æ£€æŸ¥å‘½ä»¤æ‰§è¡Œæƒ…å†µ")]),e._v(" "),_("p",[e._v("6.2.6 æ£€æŸ¥å‘½ä»¤æ‰§è¡Œæƒ…å†µ")]),e._v(" "),_("p",[e._v("INFO commandstats")]),e._v(" "),_("p",[e._v("æŸ¥çœ‹å‘½ä»¤æ‰§è¡Œäº†å¤šå°‘æ¬¡ï¼Œæ‰§è¡Œå‘½ä»¤æ‰€è€—è´¹çš„æ¯«ç§’æ•°(æ¯ä¸ªå‘½ä»¤çš„æ€»æ—¶é—´å’Œå¹³å‡æ—¶é—´)")]),e._v(" "),_("p",[e._v("169")]),e._v(" "),_("p",[e._v("å†…å­˜æ£€æŸ¥")]),e._v(" "),_("p",[e._v("8.3 å†…å­˜æ£€æŸ¥")]),e._v(" "),_("p",[e._v("170")]),e._v(" "),_("p",[e._v("ç³»ç»Ÿå†…å­˜æŸ¥çœ‹")]),e._v(" "),_("p",[e._v("8.3.1 ç³»ç»Ÿå†…å­˜æŸ¥çœ‹")]),e._v(" "),_("p",[e._v("script/ä¸‹çš„memstat.shæˆ–è€…ps_mem.pyéƒ½å¯ä»¥æŸ¥çœ‹ç³»ç»Ÿçš„å†…å­˜æƒ…å†µï¼Œä¸¤ä¸ªå·¥å…·éƒ½éœ€è¦rootæƒ\né™ã€‚")]),e._v(" "),_("p",[e._v("171")]),e._v(" "),_("p",[e._v("ç³»ç»Ÿswapå†…å­˜æŸ¥çœ‹")]),e._v(" "),_("p",[e._v("8.3.2 ç³»ç»Ÿswapå†…å­˜æŸ¥çœ‹")]),e._v(" "),_("p",[e._v("#!/bin/bash")]),e._v(" "),_("h1",{attrs:{id:"get-current-swap-usage-for-all-running-processes"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#get-current-swap-usage-for-all-running-processes"}},[e._v("#")]),e._v(" Get current swap usage for all running processes")]),e._v(" "),_("h1",{attrs:{id:"erik-ljungstrom-27-05-2011"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#erik-ljungstrom-27-05-2011"}},[e._v("#")]),e._v(" Erik Ljungstrom 27/05/2011")]),e._v(" "),_("h1",{attrs:{id:"modified-by-mikko-rantalainen-2012-08-09"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#modified-by-mikko-rantalainen-2012-08-09"}},[e._v("#")]),e._v(" Modified by Mikko Rantalainen 2012-08-09")]),e._v(" "),_("h1",{attrs:{id:"pipe-the-output-to-sort-nk3-to-get-sorted-output"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#pipe-the-output-to-sort-nk3-to-get-sorted-output"}},[e._v("#")]),e._v(' Pipe the output to "sort -nk3" to get sorted output')]),e._v(" "),_("h1",{attrs:{id:"modified-by-marc-methot-2014-09-18"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#modified-by-marc-methot-2014-09-18"}},[e._v("#")]),e._v(" Modified by Marc Methot 2014-09-18")]),e._v(" "),_("h1",{attrs:{id:"removed-the-need-for-sudo"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#removed-the-need-for-sudo"}},[e._v("#")]),e._v(" removed the need for sudo")]),e._v(" "),_("p",[e._v("SUM=0\nOVERALL=0")]),e._v(" "),_("p",[e._v("for DIR in "),_("code",[e._v('find /proc/ -maxdepth 1 -type d -regex "^/proc/[0-9]+"')]),e._v("\ndo")]),e._v(" "),_("p",[e._v("PID="),_("code",[e._v("echo $DIR | cut -d / -f 3")]),e._v("\nPROGNAME="),_("code",[e._v("ps -p $PID -o comm --no-headers")])]),e._v(" "),_("p",[e._v("for SWAP in "),_("code",[e._v("grep VmSwap $DIR/status 2>/dev/null | awk '{ print $2 }'")]),e._v("\ndo")]),e._v(" "),_("p",[e._v("let SUM=$SUM+$SWAP")]),e._v(" "),_("p",[e._v("done")]),e._v(" "),_("p",[e._v("if (( $SUM > 0 )); then")]),e._v(" "),_("p",[e._v('echo "PID=$PID swapped $SUM KB ($PROGNAME)"')]),e._v(" "),_("p",[e._v("fi")]),e._v(" "),_("p",[e._v("let OVERALL=$OVERALL+$SUM\nSUM=0")]),e._v(" "),_("p",[e._v("done")]),e._v(" "),_("p",[e._v('echo "Overall swap used: $OVERALL KB"')]),e._v(" "),_("p",[e._v("172")]),e._v(" "),_("p",[e._v("infoæŸ¥çœ‹å†…å­˜")]),e._v(" "),_("p",[e._v("8.3.3 infoæŸ¥çœ‹å†…å­˜")]),e._v(" "),_("p",[e._v("used_memory:859192 æ•°æ®ç»“æ„çš„ç©ºé—´  used_memory_rss:7634944 å®å ç©ºé—´")]),e._v(" "),_("p",[e._v("mem_fragmentation_ratio:8.89 å‰2è€…çš„æ¯”ä¾‹,1.Nä¸ºä½³,å¦‚æœæ­¤å€¼è¿‡å¤§,è¯´æ˜redisçš„å†…å­˜çš„ç¢ç‰‡åŒ–")]),e._v(" "),_("p",[e._v("ä¸¥é‡,å¯ä»¥å¯¼å‡ºå†å¯¼å…¥ä¸€æ¬¡.")]),e._v(" "),_("p",[e._v("173")]),e._v(" "),_("p",[e._v("dump.rdbæ–‡ä»¶æˆç”Ÿå†…å­˜æŠ¥å‘Šï¼ˆrdb-toolï¼‰")]),e._v(" "),_("p",[e._v("8.3.4 dump.rdbæ–‡ä»¶æˆç”Ÿå†…å­˜æŠ¥å‘Šï¼ˆrdb-\ntoolï¼‰")]),e._v(" "),_("h1",{attrs:{id:"rdb-c-memory-dump-rdb-redis-memory-report-csv"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#rdb-c-memory-dump-rdb-redis-memory-report-csv"}},[e._v("#")]),e._v(" rdb -c memory ./dump.rdb > redis_memory_report.csv")]),e._v(" "),_("h1",{attrs:{id:"sort-t-k4nr-redis-memory-report-csv"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#sort-t-k4nr-redis-memory-report-csv"}},[e._v("#")]),e._v(" sort -t, -k4nr redis_memory_report.csv")]),e._v(" "),_("p",[e._v("174")]),e._v(" "),_("p",[e._v("queryåœ¨çº¿åˆ†æ")]),e._v(" "),_("p",[e._v("8.3.5 queryåœ¨çº¿åˆ†æ")]),e._v(" "),_("p",[e._v("redis-cli MONITOR | head -n 5000 | ./redis-faina.py")]),e._v(" "),_("p",[e._v("175")]),e._v(" "),_("p",[e._v("å†…å­˜æŠ½æ ·åˆ†æ")]),e._v(" "),_("p",[e._v("8.3.6 å†…å­˜æŠ½æ ·åˆ†æ")]),e._v(" "),_("p",[e._v("/redis/script/redis-sampler.rb 127.0.0.1 6379 0 10000")]),e._v(" "),_("p",[e._v("/redis/script/redis-audit.rb 127.0.0.1 6379 0 10000")]),e._v(" "),_("p",[e._v("176")]),e._v(" "),_("p",[e._v("ç»Ÿè®¡ç”Ÿäº§ä¸Šæ¯”è¾ƒå¤§çš„key")]),e._v(" "),_("p",[e._v("8.3.7 ç»Ÿè®¡ç”Ÿäº§ä¸Šæ¯”è¾ƒå¤§çš„key")]),e._v(" "),_("p",[e._v("./redis-cli --bigkeys")]),e._v(" "),_("p",[e._v("å¯¹redisä¸­çš„keyè¿›è¡Œé‡‡æ ·ï¼Œå¯»æ‰¾è¾ƒå¤§çš„keysã€‚æ˜¯ç”¨çš„æ˜¯scanæ–¹å¼ï¼Œä¸ç”¨æ‹…å¿ƒä¼šé˜»å¡rediså¾ˆé•¿\næ—¶é—´ä¸èƒ½å¤„ç†å…¶ä»–çš„è¯·æ±‚ã€‚æ‰§è¡Œçš„ç»“æœå¯ä»¥ç”¨äºåˆ†æredisçš„å†…å­˜çš„åªç”¨çŠ¶æ€ï¼Œæ¯ç§ç±»å‹keyçš„\nå¹³å‡å¤§å°ã€‚")]),e._v(" "),_("p",[e._v("177")]),e._v(" "),_("p",[e._v("æŸ¥çœ‹keyå†…éƒ¨ç»“æ„å’Œç¼–ç ç­‰é—®é¢˜")]),e._v(" "),_("p",[e._v("8.3.8 æŸ¥çœ‹keyå†…éƒ¨ç»“æ„å’Œç¼–ç ç­‰ä¿¡æ¯")]),e._v(" "),_("p",[e._v("debug object")]),e._v(" "),_("p",[e._v("æŸ¥çœ‹ä¸€ä¸ªkeyå†…éƒ¨ä¿¡æ¯ï¼Œæ¯”å¦‚refcountã€encodingã€serializedlengthç­‰ï¼Œç»“æœå¦‚ä¸‹ Value\nat:0x7f21b9479850 refcount:1 encoding:raw serializedlength:6 lru:8462202\nlru_seconds_idle:215")]),e._v(" "),_("p",[e._v("178")]),e._v(" "),_("p",[e._v("Rssä¸å†…å­˜ç¢ç‰‡å¢åŠ é—®é¢˜")]),e._v(" "),_("p",[e._v("8.3.9 Rsså¢åŠ ï¼Œå†…å­˜ç¢ç‰‡å¢åŠ ")]),e._v(" "),_("p",[e._v("æ­¤æ—¶å¯ä»¥é€‰æ‹©æ—¶é—´è¿›è¡ŒredisæœåŠ¡å™¨çš„é‡æ–°å¯åŠ¨ï¼Œå¹¶ä¸”æ³¨æ„åœ¨rssçªç„¶é™ä½è§‚å¯Ÿæ˜¯å¦swapè¢«ä½¿\nç”¨ï¼Œä»¥ç¡®å®šå¹¶éæ˜¯å› ä¸ºswapè€Œå¯¼è‡´çš„rssé™ä½ã€‚")]),e._v(" "),_("p",[e._v("ä¸€ä¸ªå…¸å‹çš„ä¾‹å­æ˜¯ï¼šhttp://grokbase.com/t/gg/redis-db/14ag5n9qhv/redis-memory-\nfragmentation-ratio-reached-5000")]),e._v(" "),_("p",[e._v("179")]),e._v(" "),_("p",[e._v("æµ‹è¯•æ–¹æ³•")]),e._v(" "),_("ol",{attrs:{start:"9"}},[_("li",[e._v("æµ‹è¯•æ–¹æ³•")])]),e._v(" "),_("p",[e._v("180")]),e._v(" "),_("p",[e._v("æ¨¡æ‹Ÿoom")]),e._v(" "),_("p",[e._v("7.1 æ¨¡æ‹Ÿoom")]),e._v(" "),_("p",[e._v("redis-cli debug oom")]),e._v(" "),_("p",[e._v("redisç›´æ¥é€€å‡ºã€‚")]),e._v(" "),_("p",[e._v("181")]),e._v(" "),_("p",[e._v("æ¨¡æ‹Ÿå®•æœº")]),e._v(" "),_("p",[e._v("7.2 æ¨¡æ‹Ÿå®•æœº")]),e._v(" "),_("p",[e._v("redis-cli debug segfault")]),e._v(" "),_("p",[e._v("182")]),e._v(" "),_("p",[e._v("æ¨¡æ‹Ÿhang")]),e._v(" "),_("p",[e._v("7.3 æ¨¡æ‹Ÿhang")]),e._v(" "),_("p",[e._v("redis-cli -p 6379 DEBUG sleep 30")]),e._v(" "),_("p",[e._v("183")]),e._v(" "),_("p",[e._v("å¿«é€Ÿäº§ç”Ÿæµ‹è¯•æ•°æ®")]),e._v(" "),_("p",[e._v("7.4 å¿«é€Ÿäº§ç”Ÿæµ‹è¯•æ•°æ®")]),e._v(" "),_("p",[e._v("debug populate")]),e._v(" "),_("p",[e._v("æµ‹è¯•åˆ©å™¨ï¼Œå¿«é€Ÿäº§ç”Ÿå¤§é‡çš„key")]),e._v(" "),_("p",[e._v("127.0.0.1:6379> debug populate 10000\nOK")]),e._v(" "),_("p",[e._v("127.0.0.1:6379> dbsize")]),e._v(" "),_("p",[e._v("(integer) 10000")]),e._v(" "),_("p",[e._v("184")]),e._v(" "),_("p",[e._v("æ¨¡æ‹ŸRDB loadæƒ…å½¢")]),e._v(" "),_("p",[e._v("7.5 æ¨¡æ‹ŸRDB loadæƒ…å½¢")]),e._v(" "),_("p",[e._v("debug reload")]),e._v(" "),_("p",[e._v("saveå½“å‰çš„rdbæ–‡ä»¶ï¼Œå¹¶æ¸…ç©ºå½“å‰æ•°æ®åº“ï¼Œé‡æ–°åŠ è½½rdbï¼ŒåŠ è½½ä¸å¯åŠ¨æ—¶åŠ è½½ç±»ä¼¼ï¼ŒåŠ è½½è¿‡ç¨‹\nä¸­åªèƒ½æœåŠ¡éƒ¨åˆ†åªè¯»è¯·æ±‚ï¼ˆæ¯”å¦‚infoã€pingç­‰ï¼‰ï¼š rdbSave(); emptyDb(); rdbLoad();")]),e._v(" "),_("p",[e._v("185")]),e._v(" "),_("p",[e._v("æ¨¡æ‹ŸAOF loadæƒ…å½¢")]),e._v(" "),_("p",[e._v("7.6 æ¨¡æ‹ŸAOFåŠ è½½æƒ…å½¢")]),e._v(" "),_("p",[e._v("debug loadaof")]),e._v(" "),_("p",[e._v("æ¸…ç©ºå½“å‰æ•°æ®åº“ï¼Œé‡æ–°ä»aofæ–‡ä»¶é‡ŒåŠ è½½æ•°æ®åº“ emptyDb(); loadAppendOnlyFile();")]),e._v(" "),_("p",[e._v("186")]),e._v(" "),_("p",[e._v("Rediså®‰å…¨é—®é¢˜")]),e._v(" "),_("ol",{attrs:{start:"9"}},[_("li",[e._v("Rediså®‰å…¨é—®é¢˜")])]),e._v(" "),_("p",[e._v("Redisæ˜¯ä¸€ä¸ªå¼±å®‰å…¨çš„ç»„ä»¶ï¼Œåªæœ‰ä¸€ä¸ªç®€å•çš„æ˜æ–‡å¯†ç ï¼Œå› æ­¤åœ¨ä¿æŠ¤ä¸Šéœ€è¦å¯¹å…¶ä»–å¤šæ–¹é¢çš„æª\næ–½ï¼Œå¦å¤–ï¼Œå¾ˆå¤šæ‰€è°“å®‰å…¨é—®é¢˜ä¸æ˜¯redisæœ¬èº«é€ æˆçš„ï¼Œè€Œæ˜¯è¯¯ç”¨çš„ç»“æœã€‚")]),e._v(" "),_("p",[e._v("187")]),e._v(" "),_("p",[e._v("Shellææƒé—®é¢˜")]),e._v(" "),_("p",[e._v("9.1 Shellææƒé—®é¢˜")]),e._v(" "),_("p",[e._v("é—®é¢˜æŠ¥å‘Šï¼šhttp://drops.wooyun.org/papers/3062")]),e._v(" "),_("p",[e._v("é—®é¢˜åˆ†æï¼šRedis å®‰å…¨æ¨¡å‹çš„è§‚å¿µæ˜¯: â€œè¯·ä¸è¦å°†Redisæš´éœ²åœ¨å…¬å¼€ç½‘ç»œä¸­, å› ä¸ºè®©ä¸å—ä¿¡ä»»çš„å®¢\næˆ·æ¥è§¦åˆ°Redisæ˜¯éå¸¸å±é™©çš„â€ ã€‚The Redis security model is: â€œitâ€™s totally insecure to let\nuntrusted clients access the system, please protect it from the outside world yourselfâ€. å› æ­¤\næœ€è¿‘çˆ†å‡ºçš„é—®é¢˜ä¹Ÿéredisæœ¬èº«äº§å“é—®é¢˜ï¼Œå±äºä¸å½“é…ç½®ã€‚")]),e._v(" "),_("p",[e._v("é—®é¢˜è§„é¿ï¼š")]),e._v(" "),_("ol",[_("li",[_("p",[e._v("ä½¿ç”¨rediså•ç‹¬ç”¨æˆ·å’Œç»„è¿›è¡Œå®‰å…¨éƒ¨ç½²ï¼Œå¹¶ä¸”åœ¨OSå±‚é¢ç¦æ­¢æ­¤ç”¨æˆ·sshç™»é™†ï¼Œè¿™å°±ä»æ ¹æœ¬\nä¸Šé˜²æ­¢äº†rootç”¨æˆ·å¯åœrediså¸¦æ¥çš„é£é™©ã€‚")])]),e._v(" "),_("li",[_("p",[e._v("ä¿®æ”¹é»˜è®¤ç«¯å£ï¼Œé™ä½ç½‘ç»œç®€å•æ‰«æå±å®³ã€‚")])]),e._v(" "),_("li",[_("p",[e._v("ä¿®æ”¹ç»‘å®šåœ°å€ï¼Œå¦‚æœæ˜¯æœ¬åœ°è®¿é—®è¦æ±‚ç»‘å®šæœ¬åœ°å›ç¯ã€‚")])]),e._v(" "),_("li",[_("p",[e._v("è¦æ±‚è®¾ç½®å¯†ç ï¼Œå¹¶å¯¹é…ç½®æ–‡ä»¶è®¿é—®æƒé™è¿›è¡Œæ§åˆ¶ï¼Œå› ä¸ºå¯†ç åœ¨å…¶ä¸­æ˜¯æ˜æ–‡ã€‚")])]),e._v(" "),_("li",[_("p",[e._v("HAç¯å¢ƒä¸‹ä¸»ä»å‡è¦æ±‚è®¾ç½®å¯†ç ã€‚ å¦å¤–ï¼Œæˆ‘ä»¬å»ºè®®åœ¨ç½‘ç»œé˜²ç«å¢™å±‚é¢è¿›è¡Œä¿æŠ¤ï¼Œæœç»ä»»ä½•\néƒ¨ç½²åœ¨å¤–ç½‘ç›´æ¥å¯ä»¥è®¿é—®çš„redisçš„å‡ºç°ã€‚")])])]),e._v(" "),_("p",[e._v("188")]),e._v(" "),_("p",[e._v("é«˜å¯ç”¨å’Œé›†ç¾¤ç®€è¿°")]),e._v(" "),_("ol",{attrs:{start:"10"}},[_("li",[e._v("ç®€è¿°")])]),e._v(" "),_("p",[e._v("189")]),e._v(" "),_("p",[e._v("é«˜å¯ç”¨ä¸åˆ†ç‰‡çš„æ¦‚å¿µ")]),e._v(" "),_("p",[e._v("10.1 æ¦‚å¿µ")]),e._v(" "),_("p",[e._v("åœ¨æœ¬æ–‡æ¡£ä¸­ï¼Œé«˜å¯ç”¨ä¸»è¦æŒ‡çš„æ˜¯è§£å†³å°½å¯èƒ½åœ¨ä¸ä¸¢å¤±æ•°æ®çš„å‰æä¸‹ä¸é—´æ–­æœåŠ¡é—®é¢˜ï¼Œç”±äº\nredisæ˜¯å¼‚æ­¥å¤åˆ¶ï¼Œå› æ­¤ä¸ä¿è¯æ•°æ®å®Œå…¨ä¸ä¸¢å¤±ï¼Œåœ¨è¿™ä¸ªåœºæ™¯ä¸‹å¹¶ä¸å®ç°åŠ¨æ€æ¨ªå‘æ‰©å®¹ï¼Œåªèƒ½\nè¿›è¡Œçºµå‘æ‰©å®¹ï¼Œä½ åªè¦åŠ å†…å­˜ï¼Œå¯åŠ¨redisï¼Œè®¾ç½®maxmemoryå³å¯ã€‚è€Œåˆ†ç‰‡ï¼ˆShardingï¼‰ä¸»è¦\næŒ‡çš„æ˜¯è§£å†³åœ¨çº¿åŠ¨æ€æ¨ªå‘æ‰©å®¹ç¼©å®¹é—®é¢˜ï¼Œå½“ç„¶ä¸ºäº†ç¨³å®šä¹Ÿè¿›è¡Œé«˜å¯ç”¨éƒ¨ç½²é…ç½®ï¼Œå³åŒ…å«æˆå¯¹\nçš„ä¸»ä»å…³ç³»ã€‚")]),e._v(" "),_("p",[e._v("190")]),e._v(" "),_("p",[e._v("é«˜å¯ç”¨ä¸»è¦åœºæ™¯å’Œå¯¹åº”æ€è·¯")]),e._v(" "),_("p",[e._v("10.2 é«˜å¯ç”¨ä¸»è¦åœºæ™¯å’Œå¯¹åº”æ€è·¯")]),e._v(" "),_("p",[e._v("é€‚ç”¨äºrediséé‡åº¦ç”¨æˆ·ï¼Œå†…å­˜å ç”¨ä¸å¤§ï¼Œæ€»ä½“å†…å­˜å¤§å°çš„å¢é•¿è¶‹åŠ¿å¯é¢„ä¼°ï¼Œæœ‰ä¸€å®šåœæœºæ—¶é—´\nçš„ç³»ç»Ÿâ€”â€”çºµå‘æ‰©å®¹å³å¯æ»¡è¶³ï¼Œå¯ä»¥å¯¹å…¨åº“è¿›è¡Œä¸»ä»å¤åˆ¶å³æ»¡è¶³éœ€æ±‚è€Œä¸éœ€è¦åšåˆ†ç‰‡ï¼Œä¸€èˆ¬\né’ˆå¯¹å•ä¸ªå°å‹é¡¹ç›®çš„cache ç­‰åœºæ™¯ã€‚ä¸€èˆ¬é‡‡ç”¨ä¸€ä¸»å¤šä»çš„sentinelæ–¹æ¡ˆè¿›è¡Œéƒ¨ç½²ã€‚")]),e._v(" "),_("p",[e._v("191")]),e._v(" "),_("p",[e._v("åˆ†ç‰‡ä¸»è¦åœºæ™¯å’Œå¯¹åº”æ€è·¯")]),e._v(" "),_("p",[e._v("10.3 åˆ†ç‰‡ä¸»è¦åœºæ™¯å’Œå¯¹åº”æ€è·¯")]),e._v(" "),_("p",[e._v("åˆ†ç‰‡æ˜¯ä¸ºäº†åº”å¯¹ä¸šåŠ¡å¢é•¿å¸¦æ¥çš„æ•°æ®å¢é•¿ï¼Œéœ€è¦å¯¹åŠ¨æ€æ¨ªå‘æ‰©å®¹æœ‰ä¸€å®šè¦æ±‚æ—¶é‡‡ç”¨ã€‚å¯¹äºä¸€\nèˆ¬çš„åˆ†ç‰‡é‡‡ç”¨ä¸€è‡´æ€§å“ˆå¸Œï¼Œå®ƒæå¤§çš„ä¼˜åŒ–æœºå™¨å¢åˆ æ—¶å¸¦æ¥çš„å“ˆå¸Œç›®æ ‡æ¼‚ç§»é—®é¢˜ã€‚åŒæ—¶å¯¹äº\nHashç›®æ ‡æ¼‚ç§»æ—¶äº§ç”Ÿçš„ä¸¥é‡çš„æ•°æ®å€¾æ–œï¼Œå¯ä»¥åˆ©ç”¨è™šæ‹ŸèŠ‚ç‚¹æ¥ä¼˜åŒ–ã€‚åŸºæœ¬ä¸Šï¼Œç‰©ç†èŠ‚ç‚¹æœ‰äº†\nä¸€å®šè§„æ¨¡åï¼Œåªè¦ä¸æ˜¯åŒæ—¶æŒ‚å¤šä¸ªèŠ‚ç‚¹ï¼Œæˆ–è€…åŒæ—¶æ‰©å®¹å¤šä¸ªèŠ‚ç‚¹ï¼Œæ•°æ®åˆ†ç‰‡ä¸ä¼šæœ‰å¤ªå¤§çš„æ‰°\nåŠ¨ã€‚ç©¿é€è¿‡Cacheçš„è¯·æ±‚åç«¯å­˜å‚¨å¯ä»¥æŠ—ä½å³å¯ã€‚")]),e._v(" "),_("p",[e._v("ç¨å¾®å¤æ‚çš„æ–¹æ¡ˆæ˜¯å¯ä»¥ä½¿ç”¨â€œé¢„åˆ†ç‰‡ï¼ˆPre-Sharding)â€çš„æ–¹æ¡ˆï¼Œä¹Ÿç§°ä¸ºæŒ‰â€œæ¡¶â€è¿›è¡Œæ•°æ®åˆ’åˆ†ï¼Œå³\nåˆ†é…ä¸€ä¸ªç›¸å½“å¤§çš„é›†åˆï¼Œå¯¹Keyå“ˆå¸Œçš„ç»“æœè½åœ¨è¿™ä¸ªé›†åˆä¸­ï¼Œé›†åˆçš„æ¯ä¸ªå…ƒç´ åˆä¸å…·ä½“çš„ç‰©ç†\nèŠ‚ç‚¹å­˜åœ¨å¤šå¯¹ä¸€çš„è·¯ç”±æ˜ å°„å…³ç³»ï¼Œè¿™å¼ è·¯ç”±è¡¨ç”±ä¸€ä¸ªé…ç½®ä¸­å¿ƒè¿›è¡Œç»´æŠ¤ã€‚å…¶å®ï¼Œä¸€è‡´æ€§å“ˆå¸Œ\nä¸­çš„è™šæ‹ŸèŠ‚ç‚¹ï¼Œå®é™…ä¸Šä¹Ÿå¯ä»¥å½’ç±»åˆ°Pre-Shardingæ–¹æ¡ˆä¸­ã€‚æ¢å¥è¯è¯´ï¼Œåªè¦æ˜¯keyç»è¿‡ä¸¤æ¬¡å“ˆ\nå¸Œï¼Œç¬¬ä¸€æ¬¡Hashåˆ°è™šæ‹ŸèŠ‚ç‚¹ï¼Œç¬¬äºŒæ¬¡Hashåˆ°ç‰©ç†èŠ‚ç‚¹ï¼Œéƒ½å¯ä»¥ç®—ä½œPre-Shardingã€‚åªä¸è¿‡åŒº\nåˆ«åœ¨äºï¼Œä¸€è‡´æ€§å“ˆå¸Œçš„ç¬¬äºŒæ¬¡Hashå…¶è·¯ç”±è¡¨æ˜¯æŒ‰ç…§ç®—æ³•å›ºå®šçš„ï¼Œè€Œåˆ†æ¡¶çš„ç¬¬äºŒæ¬¡Hashå…¶è·¯ç”±\nè¡¨æ˜¯ç¬¬ä¸‰æ–¹å¯é…çš„ã€‚")]),e._v(" "),_("p",[e._v("192")]),e._v(" "),_("p",[e._v("é€‚ç”¨åœºæ™¯å¯¹æ¯”åˆ—è¡¨")]),e._v(" "),_("p",[e._v("10.4 é€‚ç”¨åœºæ™¯å¯¹æ¯”åˆ—è¡¨")]),e._v(" "),_("hr"),e._v(" "),_("p",[e._v("ä¸»ä»å¤åˆ¶+Sentinel\nTwemproxy")]),e._v(" "),_("p",[e._v("3.0 Cluster\nCodis")]),e._v(" "),_("p",[e._v("åº”ç”¨å±‚é¢")]),e._v(" "),_("p",[e._v("presharding")]),e._v(" "),_("p",[e._v("åŠ¨æ€æ‰©å®¹èƒ½\nåŠ›")]),e._v(" "),_("p",[e._v("No\nNo\nYes\nYes")]),e._v(" "),_("p",[e._v("Yes")]),e._v(" "),_("p",[e._v("ç³»ç»Ÿå¤æ‚\nåº¦")]),e._v(" "),_("p",[e._v("ç®€å•\nç®€å•\nç®€å•\nå¤æ‚")]),e._v(" "),_("p",[e._v("å¤æ‚")]),e._v(" "),_("p",[e._v("å¼€å‘å¤æ‚\nåº¦")]),e._v(" "),_("p",[e._v("ç®€å•\nç®€å•\nç®€å•\nç®€å•")]),e._v(" "),_("p",[e._v("å¤æ‚")]),e._v(" "),_("p",[e._v("è¿ç»´å¤æ‚åº¦")]),e._v(" "),_("p",[e._v("ç®€å•")]),e._v(" "),_("p",[e._v("ç¨å¾®å¤æ‚\nå¤æ‚")]),e._v(" "),_("p",[e._v("å¤æ‚")]),e._v(" "),_("p",[e._v("è§†å¼€å‘çš„æ°´å¹³è€Œ\nå®š")]),e._v(" "),_("p",[e._v("193")]),e._v(" "),_("p",[e._v("é«˜å¯ç”¨å’Œé›†ç¾¤æ¶æ„ä¸å®è·µ")]),e._v(" "),_("ol",{attrs:{start:"11"}},[_("li",[e._v("é«˜å¯ç”¨å’Œé›†ç¾¤æ¶æ„ä¸å®è·µ")])]),e._v(" "),_("p",[e._v("194")]),e._v(" "),_("p",[e._v("ä¸»ä»å¤åˆ¶-sentinelæ¶æ„")]),e._v(" "),_("p",[e._v("11.1 ä¸»ä»å¤åˆ¶-sentinelæ¶æ„")]),e._v(" "),_("p",[e._v("195")]),e._v(" "),_("p",[e._v("é«˜å¯ç”¨åŸç†")]),e._v(" "),_("p",[e._v("11.1.1 é«˜å¯ç”¨åŸç†")]),e._v(" "),_("p",[e._v("196")]),e._v(" "),_("p",[e._v("é«˜å¯ç”¨åŸç†")]),e._v(" "),_("p",[e._v("12.1.1.1 å‘ç°åŸç†")]),e._v(" "),_("p",[e._v("Sentinelå‘ç°åˆ†ä¸ºå‘ç°ä»æœåŠ¡å™¨å’Œå‘ç°å…¶ä»–sentinelæœåŠ¡ä¸¤ç±»ï¼š")]),e._v(" "),_("p",[e._v("Sentinelå®ä¾‹å¯ä»¥é€šè¿‡è¯¢é—®ä¸»å®ä¾‹æ¥è·å¾—æ‰€æœ‰ä»å®ä¾‹çš„ä¿¡æ¯")]),e._v(" "),_("p",[e._v("Sentinelè¿›ç¨‹å¯ä»¥é€šè¿‡å‘å¸ƒä¸è®¢é˜…æ¥è‡ªåŠ¨å‘ç°æ­£åœ¨ç›‘è§†ç›¸åŒä¸»å®ä¾‹çš„å…¶ä»–Sentinelï¼Œæ¯ä¸ª\nSentinel éƒ½è®¢é˜…äº†è¢«å®ƒç›‘è§†çš„æ‰€æœ‰ä¸»æœåŠ¡å™¨å’Œä»æœåŠ¡å™¨çš„   sentinel  :hello é¢‘é“ï¼Œ æŸ¥æ‰¾\nä¹‹å‰æœªå‡ºç°è¿‡çš„ sentinelè¿›ç¨‹ã€‚ å½“ä¸€ä¸ª Sentinel å‘ç°ä¸€ä¸ªæ–°çš„ Sentinel æ—¶ï¼Œå®ƒä¼šå°†æ–°çš„\nSentinel æ·»åŠ åˆ°ä¸€ä¸ªåˆ—è¡¨ä¸­ï¼Œè¿™ä¸ªåˆ—è¡¨ä¿å­˜äº† Sentinel å·²çŸ¥çš„ï¼Œç›‘è§†åŒä¸€ä¸ªä¸»æœåŠ¡å™¨çš„\næ‰€æœ‰å…¶ä»–Sentinelã€‚")]),e._v(" "),_("p",[e._v("æ³¨ï¼šæ–‡ä¸­çš„æ¨ªæ è¦æ›¿æ¢ä¸ºä¸‹æ»‘çº¿ï¼Œmarkdownä¸å¤ªèƒ½æ˜¾ç¤ºå‡ºæ¥...")]),e._v(" "),_("p",[e._v("197")]),e._v(" "),_("p",[e._v("é«˜å¯ç”¨åŸç†")]),e._v(" "),_("p",[e._v("11.1.1.2 åŸºæœ¬åˆ‡æ¢åŸç†")]),e._v(" "),_("p",[e._v("åœ¨åˆ‡æ¢ä¸­ï¼Œé…ç½®æ–‡ä»¶æ˜¯ä¼šè¢«åŠ¨æ€ä¿®æ”¹çš„ï¼Œä¾‹å¦‚å½“å‘ç”Ÿä¸»å¤‡åˆ‡æ¢æ—¶å€™ï¼Œé…ç½®æ–‡ä»¶ä¸­çš„masterä¼š\nè¢«ä¿®æ”¹ä¸ºå¦å¤–ä¸€ä¸ªslaveã€‚è¿™æ ·ï¼Œä¹‹åsentinelå¦‚æœé‡å¯æ—¶ï¼Œå°±å¯ä»¥æ ¹æ®è¿™ä¸ªé…ç½®æ¥æ¢å¤å…¶ä¹‹å‰\næ‰€ç›‘æ§çš„redisé›†ç¾¤çš„çŠ¶æ€ã€‚ åœ¨sentinelåˆ‡æ¢è¿‡ç¨‹ä¸­æœ‰ä¸‰å¤§æ­¥éª¤ï¼š")]),e._v(" "),_("ol",[_("li",[_("p",[e._v("åˆ¤æ–­æ˜¯å¦ä¸‹çº¿ï¼ˆè€ä¸»æ˜¯å¦çœŸçš„å’½æ°”é©¾å´©ï¼‰ æ¯ä¸ªsentinelåœ¨ç›‘æ§çš„æ—¶å€™ï¼Œæ¯ç§’å¯¹ä¸»è¿›è¡Œä¸€æ¬¡\npingå‘½ä»¤ï¼Œå¦‚æœå¤šæ¬¡pingçš„å“åº”æ—¶é—´è¶…è¿‡äº†é…ç½®æ–‡ä»¶ä¸­çš„down-after-millisecondsï¼Œé‚£ä¹ˆ\nè¿™ä¸ªå“¨å…µå°±ä¼šè®¤ä¸ºè¢«ç›‘æ§çš„å®ä¾‹æ˜¯SDownçŠ¶æ€ï¼ˆSubjectively Downï¼Œä¸»è§‚downï¼Œ\nSDOWNï¼‰ã€‚ è¿™ä¸ªæ—¶å€™æ­¤sentinelä¼šåˆ¤æ–­æ­¤masteræ˜¯å¦çœŸçš„æŒ‚äº†â€”â€”å³å¯ä»¥è®¾ç½®æˆ\nODOWNï¼ˆObjectively Downï¼Œå®¢è§‚downï¼ŒODOWNï¼‰ã€‚è®¾ç½®æˆODOWNçš„æ¡ä»¶æ˜¯é™¤äº†å½“\nå‰sentinelè®¤ä¸ºæ­¤master SDOWNï¼Œè¿˜å¿…é¡»æœ‰å…¶ä»–sentinelè®¤ä¸ºæ­¤master SDOWNï¼Œå½“è®¤\nä¸ºSDOWNçš„sentinelçš„ä¸ªæ•°ç­‰äºæˆ–è¶…è¿‡é…ç½®æ–‡ä»¶ä¸­monitor masteræœ€åçš„é‚£ä¸ªå‚æ•°\nquorumåï¼Œå°±sentinelå°±ä¼šè®¤ä¸ºæ­¤masteræ˜¯ODOWNã€‚ è¢«æ ‡è®°ä¸ºODOWNçš„å¦ä¸€ä¸ªæ•ˆåº”\næ˜¯ï¼šåœ¨ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæ¯ä¸ª Sentinel è¿›ç¨‹ä¼šä»¥æ¯ 10 ç§’ä¸€æ¬¡çš„é¢‘ç‡å‘å®ƒå·²çŸ¥çš„æ‰€æœ‰ä¸»å®ä¾‹å’Œ\nä»å®ä¾‹å‘é€ INFO å‘½ä»¤ã€‚ å½“ä¸€ä¸ªä¸»å®ä¾‹è¢« Sentinelå®ä¾‹æ ‡è®°ä¸ºå®¢è§‚ä¸‹çº¿æ—¶ï¼Œ Sentinel å‘\nODOWN Masterçš„æ‰€æœ‰ä»å®ä¾‹å‘é€ INFO å‘½ä»¤çš„é¢‘ç‡ä¼šä» 10 ç§’ä¸€æ¬¡æ”¹ä¸ºæ¯ç§’ä¸€æ¬¡ã€‚")])]),e._v(" "),_("li",[_("p",[e._v("è¿›è¡ŒæŠ•ç¥¨é€‰ä¸¾ä¸»æŒåˆ‡æ¢çš„sentinelï¼ˆé€‰ä¸¾ä¸€ä¸ªé•¿è€ï¼Œç”±å®ƒæ¥é’¦ç‚¹æ–°å¸ç‹ï¼‰ å½“masterè¢«è®¤ä¸º\næ˜¯ODOWNçš„æ—¶å€™ï¼Œå¯èƒ½éœ€è¦è¿›è¡Œfailoverï¼Œä½†æ˜¯å¹¶ä¸æ˜¯odownäº†å°±å¯ä»¥æ‰§è¡Œfailoverï¼Œå› \nä¸ºå¯èƒ½æœ‰å¤šä¸ªsentineléƒ½è®¤ä¸ºmasteræ˜¯odownäº†ï¼Œè¿™æ—¶å€™å°±éœ€è¦é€‰ä¸¾ä¸€ä¸ªsentielæ¥æ‰§è¡Œ\nfailoverã€‚ä¹Ÿå°±æ˜¯è¯´åˆ‡æ¢ä¹‹å‰è¦å…ˆé€‰ä¸¾ä¸€ä¸ªsentinelæ¥ä¸»æŒåˆ‡æ¢ï¼Œæ¡ä»¶æ˜¯å¿…é¡»æœ‰")])])]),e._v(" "),_("blockquote",[_("p",[e._v("=max(quorum, num(sentinels)/2 +1)çš„sentineléƒ½åŒæ„æŸä¸€ä¸ªsentinelä¸»æŒfailoverï¼Œé‚£ä¹ˆ\nè¿™ä¸ªsentinelå°±å¯ä»¥ä¸»æŒfailoverï¼Œè¶…è¿‡åŠæ•°è¿™ä¸ªæ¡ä»¶å°±èƒ½é™åˆ¶ä½æ­¤æ—¶åˆ»åªæœ‰ä¸€ä¸ªsentinel\næ¥æ“ä½œã€‚ è¿™ä¸ªä¹Ÿæ˜¯é€šè¿‡is-master-down-by-addræ¶ˆæ¯è¿›è¡Œæ›´æ–°æ¯ä¸ªsentinelçš„é€‰ä¸¾çš„\nleaderã€‚æ¯ä¸ªsentineléƒ½æœ‰ä¸€ä¸ªepochï¼Œè¿™ä¸ªä¸œè¥¿ç›¸å½“äºä¸€ä¸ªæ—¶é—´æˆ³ï¼Œæ˜¯é€’å¢çš„å€¼ï¼Œå¦‚æœ\né›†ç¾¤æ­£å¸¸çš„è¯ï¼Œæ‰€æœ‰çš„sentinelçš„è¿™ä¸ªå€¼éƒ½æ˜¯ä¸€æ ·çš„ã€‚å½“masterå‡ºç°å¼‚å¸¸åï¼Œæ¯ä¸ª\nsentinelåè‡ªå¢è¿™ä¸ªå€¼ï¼Œå¦‚æœä¸€ç›´æ²¡æœ‰é€‰ä¸¾å‡ºæ¥leaderçš„è¯ï¼Œè¿™ä¸ªå€¼ä¼šè·Ÿéšè¿™time eventçš„\nè½®è¯¢ï¼Œæ¯æ¬¡åŠ ä¸€ï¼Œåœ¨è®¾å®šçš„æ•…éšœè¿ç§»è¶…æ—¶æ—¶é—´çš„ä¸¤å€ä¹‹åï¼Œ é‡æ–°å°è¯•å½“é€‰ã€‚åŒæ—¶is-\nmaster-down-by-addrä¼šæŠŠè¿™ä¸ªå€¼å‘é€åˆ°å…¶ä»–çš„sentinelï¼Œå…¶ä»–çš„sentinelæ”¶åˆ°è¿™ä¸ªæ¶ˆæ¯")])]),e._v(" "),_("p",[e._v("åï¼Œä¼šåˆ¤æ–­è‡ªå·±çš„epochå’Œæ¶ˆæ¯ä¸­çš„epochï¼Œå¦‚æœè‡ªå·±çš„epochå°äºæ¶ˆæ¯ä¸­çš„epochï¼Œé‚£ä¹ˆ\nå…¶ä»–çš„sentinelå°±ä¼šé€‰ä¸¾ä¼ é€’æ¶ˆæ¯çš„è¿™ä¸ªsentinelã€‚æœ€ç»ˆä¼šå¤§éƒ¨åˆ†sentineléƒ½åŒæ„ä¸€ä¸ªè¾ƒå¤§\nçš„epochçš„sentinelä¸»æŒfailoverã€‚")]),e._v(" "),_("ol",{attrs:{start:"3"}},[_("li",[e._v("è¿›è¡Œåˆ‡æ¢ï¼Œå¹¶å…¶ä»–å®ä¾‹åŒæ­¥æ–°Masterï¼ˆæ–°å¸ç‹ç™»åŸºï¼Œå…¶ä½™è—©ç‹å®£èª“æ•ˆå¿ æ–°å¸ç‹ï¼‰ è¿™ä¸ªä¸»\næŒåˆ‡æ¢çš„sentinelé€‰å‡ºä¸€ä¸ªä»rediså®ä¾‹ï¼Œå¹¶å°†å®ƒå‡çº§ä¸ºMasterã€‚é¦–å…ˆæ˜¯è¦ä¸‹é¢çš„æ¡ä»¶æŒ‰ç…§\nå¦‚ä¸‹æ¡ä»¶ç­›é€‰å¤‡é€‰nodeï¼š 1) slaveèŠ‚ç‚¹çŠ¶æ€å¤„äºS_DOWN,O_DOWN,DISCONNECTED")])]),e._v(" "),_("p",[e._v("çš„é™¤å¤– 2) æœ€è¿‘ä¸€æ¬¡pingåº”ç­”æ—¶é—´ä¸è¶…è¿‡5å€pingçš„é—´éš”ï¼ˆå‡å¦‚pingçš„é—´éš”ä¸º1ç§’ï¼Œåˆ™æœ€è¿‘\nä¸€æ¬¡åº”ç­”å»¶è¿Ÿä¸åº”è¶…è¿‡5ç§’ï¼Œredis sentinelé»˜è®¤ä¸º1ç§’ï¼‰ 3) info_refreshåº”ç­”ä¸è¶…è¿‡3å€\ninfo_refreshçš„é—´éš”ï¼ˆåŸç†åŒ2,redis sentinelé»˜è®¤ä¸º10ç§’ï¼‰ 4) slaveèŠ‚ç‚¹ä¸masterèŠ‚ç‚¹å¤±")]),e._v(" "),_("p",[e._v("198")]),e._v(" "),_("p",[e._v("é«˜å¯ç”¨åŸç†")]),e._v(" "),_("p",[e._v("å»è”ç³»çš„æ—¶é—´ä¸èƒ½è¶…è¿‡ï¼ˆ (now - master->s_down_since_time) + (master-")]),e._v(" "),_("blockquote",[_("p",[e._v("down_after_period * 10)ï¼‰ã€‚æ€»ä½“æ„æ€æ˜¯è¯´ï¼ŒslaveèŠ‚ç‚¹ä¸masteråŒæ­¥å¤ªä¸åŠæ—¶çš„ï¼ˆæ¯”å¦‚\næ–°å¯åŠ¨çš„èŠ‚ç‚¹ï¼‰ï¼Œä¸åº”è¯¥å‚ä¸è¢«é€‰ä¸¾ã€‚ 5) Slave priorityä¸ç­‰äº0ï¼ˆè¿™ä¸ªæ˜¯åœ¨é…ç½®æ–‡ä»¶ä¸­æŒ‡\nå®šï¼Œé»˜è®¤é…ç½®ä¸º100ï¼‰ã€‚")])]),e._v(" "),_("p",[e._v("ç„¶åå†ä»å¤‡é€‰nodeä¸­ï¼ŒæŒ‰ç…§å¦‚ä¸‹é¡ºåºé€‰æ‹©æ–°çš„master 1) è¾ƒä½çš„slave_priorityï¼ˆè¿™ä¸ªæ˜¯åœ¨é…ç½®\næ–‡ä»¶ä¸­æŒ‡å®šï¼Œé»˜è®¤é…ç½®ä¸º100ï¼‰ 2) è¾ƒå¤§çš„replication offsetï¼ˆæ¯ä¸ªslaveåœ¨ä¸masteråŒæ­¥å\noffsetè‡ªåŠ¨å¢åŠ ï¼‰ 3) è¾ƒå°çš„runidï¼ˆæ¯ä¸ªrediså®ä¾‹ï¼Œéƒ½ä¼šæœ‰ä¸€ä¸ªrunid,é€šå¸¸æ˜¯ä¸€ä¸ª40ä½çš„éšæœºå­—")]),e._v(" "),_("p",[e._v("ç¬¦ä¸²,åœ¨rediså¯åŠ¨æ—¶è®¾ç½®ï¼Œé‡å¤æ¦‚ç‡éå¸¸å°ï¼‰ 4) å¦‚æœä»¥ä¸Šæ¡ä»¶éƒ½ä¸è¶³ä»¥åŒºåˆ«å‡ºå”¯ä¸€çš„èŠ‚ç‚¹ï¼Œåˆ™\nä¼šçœ‹å“ªä¸ªslaveèŠ‚ç‚¹å¤„ç†ä¹‹å‰masterå‘é€çš„commandå¤šï¼Œå°±é€‰è°ã€‚ ä¸»æŒåˆ‡æ¢çš„sentinelå‘è¢«é€‰\nä¸­çš„ä»rediså®ä¾‹å‘é€ SLAVEOF NO ONE å‘½ä»¤ï¼Œè®©å®ƒè½¬å˜ä¸ºMasterã€‚ç„¶åé€šè¿‡å‘å¸ƒä¸è®¢é˜…åŠŸ\nèƒ½ï¼Œå°†æ›´æ–°åçš„é…ç½®ä¼ æ’­ç»™æ‰€æœ‰å…¶ä»– Sentinelï¼Œå…¶ä»– Sentinel å¯¹å®ƒä»¬è‡ªå·±çš„é…ç½®è¿›è¡Œconfig-\nrewriteã€‚éšåsentinelå‘å·²ä¸‹çº¿çš„Masterçš„ä»æœåŠ¡å™¨å‘é€SLAVEOFå‘½ä»¤ï¼Œè®©å®ƒä»¬å»å¤åˆ¶æ–°\nMasterã€‚")]),e._v(" "),_("p",[e._v("æ³¨æ„ï¼šsentinel failover-timeoutè¿™ä¸ªé€‰é¡¹æœ‰å››ä¸ªå«ä¹‰ï¼Œæœ‰å¿…è¦åœ¨æ­¤ç¿»è¯‘ä¸€ä¸‹ 1) å¯¹äºä¸€ä¸ª\nsentinelé€‰å‡ºçš„åŒä¸€ä¸ªmasterè¿›è¡Œå†æ¬¡çš„failoverå°è¯•æ‰€éœ€è¦çš„æ—¶é—´â€”â€”è¿™ä¸ªå‚æ•°å€¼çš„ä¸¤å€ã€‚ 2)\nå½“sentinelå‘ç°ä¸€ä¸ªslaveé”™è¯¯çš„å¤åˆ¶äº†ä¸€ä¸ªé”™çš„ä¸»æ—¶sentinelä¼šå¼ºè¿«å…¶å¤åˆ¶æ­£ç¡®çš„ä¸»çš„æ—¶é—´ã€‚")]),e._v(" "),_("ol",{attrs:{start:"3"}},[_("li",[e._v("å–æ¶ˆä¸€ä¸ªå·²ç»å¼€å§‹ä½†æ˜¯è¿˜æ²¡æœ‰å¼•èµ·ä»»ä½•é…ç½®æ”¹å˜çš„failoveræ‰€éœ€è¦çš„æ—¶é—´ã€‚ 4) ç­‰å¾…æ‰€æœ‰\nslaveè¢«é‡æ–°é…ç½®ä¸ºæ–°ä¸»çš„slaveè€Œæ‰€éœ€è¦çš„æœ€å¤§æ—¶é—´ã€‚æ³¨æ„å³ä½¿è¶…è¿‡äº†è¿™ä¸ªæ—¶é—´sentinelä¹Ÿä¼š\næœ€ç»ˆé…ç½®slaveå»åŒæ­¥æœ€æ–°çš„master")])]),e._v(" "),_("p",[e._v("199")]),e._v(" "),_("p",[e._v("ç¯å¢ƒæ­å»º")]),e._v(" "),_("p",[e._v("11.1.2 ç¯å¢ƒæ­å»º")]),e._v(" "),_("p",[e._v("200")]),e._v(" "),_("p",[e._v("ç¯å¢ƒæ­å»º")]),e._v(" "),_("p",[e._v("11.1.2.1 éƒ¨ç½²æ¶æ„")]),e._v(" "),_("p",[e._v("éƒ¨ç½²æ¶æ„ä¸Šé‡‡ç”¨ä¸‰å°æœºå™¨ï¼Œä¸€ä¸ªMasteræ¥å—å†™è¯·æ±‚ï¼Œä¸¤ä¸ªSlaveè¿›è¡Œæ•°æ®åŒæ­¥ï¼Œä¸‰å°æœºå™¨ä¸Šéƒ½\néƒ¨ç½²sentinelï¼ˆä¸€èˆ¬ä¸ºå¥‡æ•°ä¸ªï¼Œå› ä¸ºéœ€è¦ç»å¤§éƒ¨åˆ†è¿›è¡ŒæŠ•ç¥¨æ‰èƒ½failoverï¼‰ã€‚ï¼ˆå®˜æ–¹ç¤ºä¾‹ï¼‰å…·ä½“\næ¶æ„å¦‚ä¸‹å›¾ï¼š")]),e._v(" "),_("p",[e._v("æ³¨æ„ï¼šå¦‚æœæœ‰æ¡ä»¶å¯ä»¥å°†sentinelå¤šéƒ¨ç½²å‡ ä¸ªåœ¨å®¢æˆ·ç«¯æ‰€åœ¨çš„åº”ç”¨æœåŠ¡å™¨ä¸Šï¼Œè€Œä¸æ˜¯ä¸ä»èŠ‚ç‚¹\néƒ¨ç½²åœ¨ä¸€èµ·ï¼Œè¿™æ ·é¿å…æ•´æœºå®•æœºåsentinelå’Œslaveéƒ½å‡å°‘è€Œå¯¼è‡´çš„åˆ‡æ¢é€‰ä¸¾sentinelæ— æ³•è¶…è¿‡\nåŠæ•°ã€‚")]),e._v(" "),_("p",[e._v("201")]),e._v(" "),_("p",[e._v("ç¯å¢ƒæ­å»º")]),e._v(" "),_("p",[e._v("11.1.2.2 ç½‘ç»œè§„åˆ’")]),e._v(" "),_("p",[e._v("redisé«˜å¯ç”¨ç¯å¢ƒä¸éœ€è¦è¿›è¡Œå¿ƒè·³çº¿çš„é…ç½®ï¼Œæ¯ä¸ªç‰©ç†èŠ‚ç‚¹çš„ç½‘å¡è¿›è¡ŒåŒç½‘å¡ä¸»å¤‡ç»‘å®šç”Ÿæˆ\nbond0å³å¯ã€‚")]),e._v(" "),_("p",[e._v("202")]),e._v(" "),_("p",[e._v("ç¯å¢ƒæ­å»º")]),e._v(" "),_("p",[e._v("11.1.2.3 ç”¨æˆ·è§„åˆ’")]),e._v(" "),_("p",[e._v("ç”¨æˆ·å")]),e._v(" "),_("p",[e._v("redis(10086)")]),e._v(" "),_("p",[e._v("ç”¨æˆ·æ‰€åœ¨ç»„")]),e._v(" "),_("p",[e._v("redis (10086)")]),e._v(" "),_("p",[e._v("ç”¨æˆ·ç›®å½•")]),e._v(" "),_("p",[e._v("/redis")]),e._v(" "),_("p",[e._v("æƒé™ å¤‡æ³¨")]),e._v(" "),_("p",[e._v("sudoï¼ˆå¦‚éœ€è¦æµ®åŠ¨IPæ—¶èµ‹äºˆï¼‰  --")]),e._v(" "),_("p",[e._v("203")]),e._v(" "),_("p",[e._v("ç¯å¢ƒæ­å»º")]),e._v(" "),_("p",[e._v("11.1.2.4 æŒä¹…åŒ–è§„åˆ’")]),e._v(" "),_("p",[e._v("å¦‚æœè¯»å¤šå†™å°‘ï¼Œå¯ä»¥åœ¨masterä¸Šåªå¼€å¯aofï¼Œåœ¨ä½å³°æœŸå®šæ—¶è¿›è¡Œbgsaveï¼Œåœ¨slaveä¸Šå½»åº•å…³é—­\næŒä¹…åŒ–ã€‚ å¦‚æœè¯»å†™å·®ä¸å¤šï¼Œå¯ä»¥åœ¨ä¸€ä¸ªslaveä¸Šå¼€å¯rdbï¼ˆè¿™ä¸ªslaveåªåšæŒä¹…åŒ–ï¼Œä¸è¿›è¡Œè¯»æ“\nä½œï¼‰ï¼Œåœ¨å…¶ä½™ä¸»ä»éƒ½å…³é—­æŒä¹…åŒ–ã€‚ æ³¨æ„ï¼šä»èŠ‚ç‚¹æ˜¯ä¸ä¼šä»æœ¬åœ°æ¢å¤è€Œç›´æ¥ä»masterèŠ‚ç‚¹è¿›è¡Œ\næ¢å¤çš„ï¼Œå› æ­¤åœ¨é‡å¯å‰å¦‚æœæœ‰éœ€è¦å¤‡ä»½ä»èŠ‚ç‚¹ï¼Œåˆ™éœ€è¦æŠŠaofå’Œrdbæ–‡ä»¶ç§»èµ°ã€‚")]),e._v(" "),_("p",[e._v("204")]),e._v(" "),_("p",[e._v("ç¯å¢ƒæ­å»º")]),e._v(" "),_("p",[e._v("11.1.2.5 ç›®å½•è§„åˆ’")]),e._v(" "),_("p",[e._v("ç›®å½•")]),e._v(" "),_("p",[e._v("/redis/bin")]),e._v(" "),_("p",[e._v("/redis/conf")]),e._v(" "),_("p",[e._v("/redis/run")]),e._v(" "),_("p",[e._v("/redis/log")]),e._v(" "),_("p",[e._v("/redis/script")]),e._v(" "),_("p",[e._v("/redis/data")]),e._v(" "),_("p",[e._v("å«ä¹‰")]),e._v(" "),_("p",[e._v("rediså¯æ‰§è¡Œæ–‡ä»¶")]),e._v(" "),_("p",[e._v("redis å’Œsupervisordçš„é…ç½®æ–‡ä»¶\nrediså’Œsupervisordè¿è¡Œæ—¶çš„pidæ–‡ä»¶\nrediså’Œsupervisordçš„æ—¥å¿—")]),e._v(" "),_("p",[e._v("ä¸€äº›ç®¡ç†è„šæœ¬å’Œæµ‹è¯•è„šæœ¬")]),e._v(" "),_("p",[e._v("RedisæŒä¹…åŒ–æ•°æ®ç›®å½•")]),e._v(" "),_("p",[e._v("205")]),e._v(" "),_("p",[e._v("ç¯å¢ƒæ­å»º")]),e._v(" "),_("p",[e._v("11.1.2.6 éƒ¨ç½²æ­¥éª¤")]),e._v(" "),_("p",[e._v("è§£å‹ä¸‹åˆ—å‹ç¼©åŒ…è‡³/tmp/redisç›®å½•ï¼Œä»¥ç¬¦åˆä¸Šè¿°ç›®å½•ç»“æ„ï¼š\néƒ¨ç½²ç›¸å…³ç»„ä»¶ï¼š cd /tmp/redis/deploy ./deploy.sh")]),e._v(" "),_("p",[e._v("ä¿®æ”¹Masteré…ç½®æ–‡ä»¶redis.confï¼Œæ³¨é‡Šæ‰åŒ…å«slaveofçš„è¯­å¥ã€‚ ä¿®æ”¹Slaveé…ç½®æ–‡ä»¶redis.confï¼Œ\næ·»åŠ slaveof masterIP portï¼ŒæŒ‡å®šä¸»ä» ä¿®æ”¹ä¸‰å°æœºå™¨çš„sentinelé…ç½®æ–‡ä»¶ï¼ŒæŒ‡å®šä¸»æœåŠ¡å™¨çš„IP\nå’Œç«¯å£ï¼š sentinel monitor mymaster masterIP port 2")]),e._v(" "),_("p",[e._v("ç„¶åä½¿ç”¨supervisordé‡æ–°å¯åŠ¨ã€‚")]),e._v(" "),_("p",[e._v("206")]),e._v(" "),_("p",[e._v("ç¯å¢ƒæ­å»º")]),e._v(" "),_("p",[e._v("11.1.2.7 é…ç½®æ–‡ä»¶")]),e._v(" "),_("p",[e._v("é¦–å…ˆï¼Œä¸€ä¸ªsentinelå¯ä»¥é…ç½®å¤šä¸ªmasterã€‚ä¸€ä¸ªmasterçš„é…ç½®å¦‚ä¸‹ï¼š")]),e._v(" "),_("p",[e._v('port 26379\n###å®šä¹‰ç›®å½•å­˜æ”¾\ndir "/redis"')]),e._v(" "),_("p",[e._v("###ç›‘æ§mymaster(å¯è‡ªå®šä¹‰-ä½†åªèƒ½åŒ…æ‹¬A-z 0-9å’Œâ€._-â€)ï¼Œæ³¨æ„quorumåªå½±å“ODOWNçš„åˆ¤æ–­ï¼Œä½†æ˜¯ä¸å½±å“fail\noverï¼Œ\nå‘ç”Ÿfailoverçš„æ¡ä»¶å¿…é¡»æ˜¯åŠæ•°sentinelè®¤ä¸ºè€Masterå·²ç»ODOWNã€‚æ­¤å‚æ•°å»ºè®®è®¾ç½®ä¸ºsentinel/2+1çš„\næ•°å€¼ï¼Œå¦åˆ™å¯èƒ½ä¼šäº§ç”Ÿè„‘è£‚ã€‚")]),e._v(" "),_("p",[e._v("sentinel monitor mymaster 192.168.145.131 6379 2")]),e._v(" "),_("p",[e._v("###mymasterå¤šä¹…ä¸å“åº”è®¤ä¸ºSDOWNï¼Œè®¾ç½®ä¸º3100ä¹Ÿå°±æ˜¯è¯´3æ¬¡pingå¤±è´¥åè®¤ä¸ºSDOWN\nsentinel down-after-milliseconds mymaster 3100")]),e._v(" "),_("p",[e._v("###å¦‚æœåœ¨è¯¥æ—¶é—´ï¼ˆmsï¼‰å†…æœªèƒ½å®Œæˆfailoveræ“ä½œï¼Œåˆ™è®¤ä¸ºè¯¥failoverå¤±è´¥")]),e._v(" "),_("p",[e._v("sentinel failover-timeout mymaster 15000")]),e._v(" "),_("p",[e._v("###åœ¨æ‰§è¡Œæ•…éšœè½¬ç§»æ—¶ï¼Œ æœ€å¤šå¯ä»¥æœ‰å¤šå°‘ä¸ªä»Rediså®ä¾‹åœ¨åŒæ­¥æ–°çš„ä¸»å®ä¾‹ï¼Œ åœ¨ä»Rediså®ä¾‹è¾ƒå¤šçš„æƒ…å†µä¸‹è¿™ä¸ªæ•°\nå­—è¶Šå°ï¼ŒåŒæ­¥çš„æ—¶é—´è¶Šé•¿ï¼Œå®Œæˆæ•…éšœè½¬ç§»æ‰€éœ€çš„æ—¶é—´å°±è¶Šé•¿")]),e._v(" "),_("p",[e._v("sentinel parallel-syncs mymaster 1")]),e._v(" "),_("p",[e._v("###reconfigçš„æ—¶å€™æ‰§è¡Œçš„è„šæœ¬ï¼ˆé€‰é…ï¼‰")]),e._v(" "),_("p",[e._v("sentinel client-reconfig-script mymaster /redis/script/failover.sh")]),e._v(" "),_("p",[e._v("###å‡ºç°ä»»ä½•sentinelåœ¨warningäº‹ä»¶æ—¶å€™æ‰§è¡Œçš„è„šæœ¬ï¼ˆé€‰é…ï¼‰")]),e._v(" "),_("p",[e._v("sentinel notification-script mymaster /redis/script/notify.sh")]),e._v(" "),_("p",[e._v("####æ—¥å¿—ä½ç½®")]),e._v(" "),_("p",[e._v('logfile "/redis/log/sentinel.log"')]),e._v(" "),_("p",[e._v("207")]),e._v(" "),_("p",[e._v("ç»´æŠ¤æ“ä½œ")]),e._v(" "),_("p",[e._v("11.1.3 ç»´æŠ¤æ“ä½œ")]),e._v(" "),_("p",[e._v("208")]),e._v(" "),_("p",[e._v("ç»´æŠ¤æ“ä½œ")]),e._v(" "),_("p",[e._v("11.1.3.1 å®Œæ•´å¯åŠ¨")]),e._v(" "),_("p",[e._v("supervisord -c /redis/conf/redis-supervisord.conf ä¼šè‡ªåŠ¨æ‹‰èµ·æœ¬æœºçš„rediså’Œsentinel")]),e._v(" "),_("p",[e._v("209")]),e._v(" "),_("p",[e._v("ç»´æŠ¤æ“ä½œ")]),e._v(" "),_("p",[e._v("11.1.3.2 å¯åœredis")]),e._v(" "),_("p",[e._v("supervisorctl -c /redis/conf/redis-supervisord.conf start redis supervisorctl -c")]),e._v(" "),_("p",[e._v("/redis/conf/redis-supervisord.conf stop redis supervisorctl -c /redis/conf/redis-\nsupervisord.conf restart redis")]),e._v(" "),_("p",[e._v("210")]),e._v(" "),_("p",[e._v("ç»´æŠ¤æ“ä½œ")]),e._v(" "),_("p",[e._v("11.1.3.3 æ‰‹åŠ¨å¯åŠ¨")]),e._v(" "),_("p",[e._v("æœ‰ä¸¤ç§æ–¹å¼ï¼š ç¬¬ä¸€ç§ï¼šredis-sentinel /path/to/sentinel.conf ç¬¬äºŒç§ï¼šredis-server")]),e._v(" "),_("p",[e._v("/path/to/sentinel.conf --sentinel")]),e._v(" "),_("p",[e._v("211")]),e._v(" "),_("p",[e._v("ç»´æŠ¤æ“ä½œ")]),e._v(" "),_("p",[e._v("11.1.3.4 å¯åœsentinel")]),e._v(" "),_("p",[e._v("supervisorctl -c /redis/conf/redis-supervisord.conf start redis-sentinel supervisorctl -c")]),e._v(" "),_("p",[e._v("/redis/conf/redis-supervisord.conf stop redis-sentinel supervisorctl -c /redis/conf/redis-\nsupervisord.conf restart redis-sentinel")]),e._v(" "),_("p",[e._v("212")]),e._v(" "),_("p",[e._v("ç»´æŠ¤æ“ä½œ")]),e._v(" "),_("p",[e._v("11.1.3.5 æŸ¥çœ‹sentinelçŠ¶æ€")]),e._v(" "),_("p",[e._v("redis-cli -p 26379 info")]),e._v(" "),_("p",[e._v("213")]),e._v(" "),_("p",[e._v("ç»´æŠ¤æ“ä½œ")]),e._v(" "),_("p",[e._v("11.1.3.6 æŸ¥çœ‹masteråœ°å€å’Œç«¯å£")]),e._v(" "),_("p",[e._v("sentinel get-master-addr-by-name myredis")]),e._v(" "),_("p",[e._v("214")]),e._v(" "),_("p",[e._v("ç»´æŠ¤æ“ä½œ")]),e._v(" "),_("p",[e._v("11.1.3.7 æŸ¥çœ‹masteré…ç½®")]),e._v(" "),_("p",[e._v("redis-cli -p 26379 sentinel masters")]),e._v(" "),_("p",[e._v("215")]),e._v(" "),_("p",[e._v("ç»´æŠ¤æ“ä½œ")]),e._v(" "),_("p",[e._v("11.1.3.8 é‡ç½®è¯¥sentinel")]),e._v(" "),_("p",[e._v("sentinel reset myredis é‡ç½®æ“ä½œæ¸…é™¤è¯¥sentinelçš„æ‰€ä¿å­˜çš„æ‰€æœ‰çŠ¶æ€ä¿¡æ¯ï¼Œå¹¶è¿›è¡Œä¸€æ¬¡é‡æ–°çš„\nå‘ç°è¿‡ç¨‹ã€‚")]),e._v(" "),_("p",[e._v("216")]),e._v(" "),_("p",[e._v("ç»´æŠ¤æ“ä½œ")]),e._v(" "),_("p",[e._v("11.1.3.9 åŠ¨æ€ä¿®æ”¹sentinelé…ç½®")]),e._v(" "),_("p",[e._v("SENTINEL SET command ä¾‹å¦‚ï¼š")]),e._v(" "),_("p",[e._v("SENTINEL SET objects-cache-master down-after-milliseconds 1000")]),e._v(" "),_("p",[e._v("217")]),e._v(" "),_("p",[e._v("ç»´æŠ¤æ“ä½œ")]),e._v(" "),_("p",[e._v("11.1.3.10 ä¸»åŠ¨åˆ‡æ¢")]),e._v(" "),_("p",[e._v("sentinel failover myredis æ­¤æ“ä½œä¼šå°†æ–°çš„é…ç½®å‘é€åˆ°å…¶ä»–sentinelä¸Šã€‚")]),e._v(" "),_("p",[e._v("218")]),e._v(" "),_("p",[e._v("ç»´æŠ¤æ“ä½œ")]),e._v(" "),_("p",[e._v("11.1.3.11 åˆ¤æ–­ä¸»ä»æ˜¯å¦å®Œå…¨ä¸€è‡´")]),e._v(" "),_("p",[e._v("dbsize")]),e._v(" "),_("p",[e._v("æŸ¥çœ‹key çš„æ•°ç›®")]),e._v(" "),_("p",[e._v("debug digest")]),e._v(" "),_("p",[e._v("å¯¹æ•´ä¸ªæ•°æ®åº“çš„æ•°æ®ï¼Œäº§ç”Ÿä¸€ä¸ªæ‘˜è¦ï¼Œå¯ç”¨äºéªŒè¯ä¸¤ä¸ªredisæ•°æ®åº“æ•°æ®æ˜¯å¦ä¸€è‡´\n127.0.0.1:6379> debug digest 7164ae8b6730c8bcade46532e5e4a8015d4cccfb\n127.0.0.1:6379> debug digest 7164ae8b6730c8bcade46532e5e4a8015d4cccfb")]),e._v(" "),_("p",[e._v("219")]),e._v(" "),_("p",[e._v("ç»´æŠ¤æ“ä½œ")]),e._v(" "),_("p",[e._v("11.1.3.12 æ¥æ”¶æ‰€æœ‰äº‹ä»¶ä¿¡æ¯")]),e._v(" "),_("p",[e._v("127.0.0.1:26379> PSUBSCRIBE *")]),e._v(" "),_("p",[e._v("æ³¨æ„è¿™æ˜¯åœ¨sentinelä¸Šç›‘æ§æ‰€æœ‰çš„é¢‘é“ä¿¡æ¯ï¼ŒæŸ¥çœ‹çš„æ˜¯åˆ‡æ¢å‰åå‘ç”Ÿçš„æ¶ˆæ¯ã€‚")]),e._v(" "),_("p",[e._v("è¿˜æœ‰ä¸€ä¸ª sentinel :helloçš„é¢‘é“ï¼Œè¿™ä¸ªé¢‘é“æ˜¯åœ¨rediså®ä¾‹ä¸Šçš„ï¼Œç”¨é€”æ˜¯sentinelä¹‹é—´å‘ç°å¯¹\næ–¹çš„ï¼Œåˆ«æ— å®ƒç”¨ã€‚åœ¨rediså®ä¾‹ä¸Šå¯ä»¥é€šè¿‡monitoræˆ–è€…è®¢é˜…æ­¤é¢‘é“çœ‹åˆ°è¿™ä¸ªæ¶ˆæ¯ã€‚")]),e._v(" "),_("p",[e._v("220")]),e._v(" "),_("p",[e._v("é«˜å¯ç”¨å’Œå¼‚å¸¸æµ‹è¯•")]),e._v(" "),_("p",[e._v("11.1.4 é«˜å¯ç”¨å’Œå¼‚å¸¸æµ‹è¯•")]),e._v(" "),_("p",[e._v("221")]),e._v(" "),_("p",[e._v("é«˜å¯ç”¨å’Œå¼‚å¸¸æµ‹è¯•")]),e._v(" "),_("p",[e._v("11.1.4.1 æµ‹è¯•ç¯å¢ƒä»‹ç»")]),e._v(" "),_("p",[e._v("Masterï¼š192.168.2.128 ï¼ˆAï¼‰:6379\nSlaveï¼š192.168.2.129 ï¼ˆBï¼‰:6379\nSlaveï¼š192.168.2.130 ï¼ˆBï¼‰:6379")]),e._v(" "),_("p",[e._v("Sentinelï¼šä¸‰å°æœºå™¨çš„26379ç«¯å£")]),e._v(" "),_("p",[e._v("sentinelçš„æ¶ˆæ¯å¯ä»¥é€šè¿‡sentinelæ—¥å¿—ï¼ˆ/redis/log/sentinel.logï¼‰ä»¥åŠsentinel:helloè®¢é˜…æ­¤é¢‘é“\nè¿›è¡ŒæŸ¥çœ‹ã€‚")]),e._v(" "),_("p",[e._v("222")]),e._v(" "),_("p",[e._v("é«˜å¯ç”¨å’Œå¼‚å¸¸æµ‹è¯•")]),e._v(" "),_("p",[e._v("11.1.4.2 æ‰‹åŠ¨åˆ‡æ¢æµ‹è¯•")]),e._v(" "),_("p",[e._v("é›†ç¾¤æƒ…å†µï¼Œ2.128ä¸ºä¸»")]),e._v(" "),_("p",[e._v("å‘èµ·ä¸»åŠ¨åˆ‡æ¢ï¼š")]),e._v(" "),_("p",[e._v("127.0.0.1:26379> sentinel failover mymaster\nOK")]),e._v(" "),_("p",[e._v("æŸ¥çœ‹sentinelæ—¥å¿—ï¼š")]),e._v(" "),_("p",[e._v("223")]),e._v(" "),_("p",[e._v("é«˜å¯ç”¨å’Œå¼‚å¸¸æµ‹è¯•")]),e._v(" "),_("p",[e._v("[1158] 19 Jun 08:14:38.504 # Executing user requested FAILOVER of 'mymaster'\n[1158] 19 Jun 08:14:38.507 # +new-epoch 29")]),e._v(" "),_("p",[e._v("[1158] 19 Jun 08:14:38.507 # +try-failover master mymaster 192.168.2.129 6379")]),e._v(" "),_("p",[e._v("[1158] 19 Jun 08:14:38.581 # +vote-for-leader 7d60ccf8a9f9f81e5292a0dbde2c54c76a2b")]),e._v(" "),_("p",[e._v("d265 29")]),e._v(" "),_("p",[e._v("[1158] 19 Jun 08:14:38.581 # +elected-leader master mymaster 192.168.2.129 6379")]),e._v(" "),_("p",[e._v("[1158] 19 Jun 08:14:38.581 # +failover-state-select-slave master mymaster 192.168.")]),e._v(" "),_("p",[e._v("2.129 6379")]),e._v(" "),_("p",[e._v("[1158] 19 Jun 08:14:38.655 # +selected-slave slave 192.168.2.128:6379 192.168.2.12")]),e._v(" "),_("p",[e._v("8 6379 @ mymaster 192.168.2.129 6379")]),e._v(" "),_("p",[e._v("[1158] 19 Jun 08:14:38.655 * +failover-state-send-slaveof-noone slave 192.168.2.12")]),e._v(" "),_("p",[e._v("8:6379 192.168.2.128 6379 @ mymaster 192.168.2.129 6379")]),e._v(" "),_("p",[e._v("[1158] 19 Jun 08:14:38.714 * +failover-state-wait-promotion slave 192.168.2.128:63")]),e._v(" "),_("p",[e._v("79 192.168.2.128 6379 @ mymaster 192.168.2.129 6379")]),e._v(" "),_("p",[e._v("[1158] 19 Jun 08:14:39.642 # +promoted-slave slave 192.168.2.128:6379 192.168.2.12")]),e._v(" "),_("p",[e._v("8 6379 @ mymaster 192.168.2.129 6379")]),e._v(" "),_("p",[e._v("[1158] 19 Jun 08:14:39.642 # +failover-state-reconf-slaves master mymaster 192.168")]),e._v(" "),_("p",[e._v(".2.129 6379")]),e._v(" "),_("p",[e._v("[1158] 19 Jun 08:14:39.705 * +slave-reconf-sent slave 192.168.2.130:6379 192.168.2")]),e._v(" "),_("p",[e._v(".130 6379 @ mymaster 192.168.2.129 6379")]),e._v(" "),_("p",[e._v("[1158] 19 Jun 08:14:40.645 * +slave-reconf-inprog slave 192.168.2.130:6379 192.168")]),e._v(" "),_("p",[e._v(".2.130 6379 @ mymaster 192.168.2.129 6379")]),e._v(" "),_("p",[e._v("[1158] 19 Jun 08:14:40.645 * +slave-reconf-done slave 192.168.2.130:6379 192.168.2")]),e._v(" "),_("p",[e._v(".130 6379 @ mymaster 192.168.2.129 6379")]),e._v(" "),_("p",[e._v("[1158] 19 Jun 08:14:40.735 # +failover-end master mymaster 192.168.2.129 6379")]),e._v(" "),_("p",[e._v("[1158] 19 Jun 08:14:40.735 # +switch-master mymaster 192.168.2.129 6379 192.168.2.")]),e._v(" "),_("p",[e._v("128 6379")]),e._v(" "),_("p",[e._v("[1158] 19 Jun 08:14:40.736 * +slave slave 192.168.2.130:6379 192.168.2.130 6379 @")]),e._v(" "),_("p",[e._v("mymaster 192.168.2.128 6379")]),e._v(" "),_("p",[e._v("[1158] 19 Jun 08:14:40.743 * +slave slave 192.168.2.129:6379 192.168.2.129 6379 @")]),e._v(" "),_("p",[e._v("mymaster 192.168.2.128 6379")]),e._v(" "),_("p",[e._v("[1158] 19 Jun 08:27:56.524 # +new-epoch 30")]),e._v(" "),_("p",[e._v("[1158] 19 Jun 08:27:57.519 # +config-update-from sentinel 192.168.2.128:26379 192.")]),e._v(" "),_("p",[e._v("168.2.128 26379 @ mymaster 192.168.2.128 6379")]),e._v(" "),_("p",[e._v("[1158] 19 Jun 08:27:57.519 # +switch-master mymaster 192.168.2.128 6379 192.168.2.")]),e._v(" "),_("p",[e._v("129 6379")]),e._v(" "),_("p",[e._v("[1158] 19 Jun 08:27:57.519 * +slave slave 192.168.2.130:6379 192.168.2.130 6379 @")]),e._v(" "),_("p",[e._v("mymaster 192.168.2.129 6379")]),e._v(" "),_("p",[e._v("[1158] 19 Jun 08:27:57.524 * +slave slave 192.168.2.128:6379 192.168.2.128 6379 @")]),e._v(" "),_("p",[e._v("mymaster 192.168.2.129 6379")]),e._v(" "),_("p",[e._v("åœ¨2.129ä¸Šçœ‹ï¼Œé›†ç¾¤å·²ç»åˆ‡æ¢è¿‡æ¥ï¼š")]),e._v(" "),_("p",[e._v("224")]),e._v(" "),_("p",[e._v("é«˜å¯ç”¨å’Œå¼‚å¸¸æµ‹è¯•")]),e._v(" "),_("p",[e._v("11.1.4.3 ä¸»å®ä¾‹å®•æµ‹è¯•")]),e._v(" "),_("p",[e._v("æ¥ä¸Šï¼Œæ­¤æ—¶masterä¸º2.129ï¼Œæ‰¾å‡ºrediså®ä¾‹çš„pidï¼Œç„¶åkillï¼š")]),e._v(" "),_("p",[e._v("[root@hadoop2 log]# ps -ef |grep redis-server")]),e._v(" "),_("p",[e._v("root   11349  1157 1 Jun18 ?    00:15:45 /usr/bin/redis-server 0.0.0.0:6379")]),e._v(" "),_("p",[e._v("root   14969 10433 0 08:33 pts/1  00:00:00 grep --color=auto redis-server\n[root@hadoop2 log]# kill 11349")]),e._v(" "),_("p",[e._v("æ­¤æ—¶æŸ¥çœ‹sentinelæ—¥å¿—ï¼š")]),e._v(" "),_("p",[e._v("225")]),e._v(" "),_("p",[e._v("é«˜å¯ç”¨å’Œå¼‚å¸¸æµ‹è¯•")]),e._v(" "),_("p",[e._v("[1158] 19 Jun 08:33:57.953 # +sdown master mymaster 192.168.2.129 6379")]),e._v(" "),_("p",[e._v("[1158] 19 Jun 08:33:58.025 # +odown master mymaster 192.168.2.129 6379 #quorum 3/2")]),e._v(" "),_("p",[e._v("[1158] 19 Jun 08:33:58.025 # +new-epoch 31")]),e._v(" "),_("p",[e._v("[1158] 19 Jun 08:33:58.025 # +try-failover master mymaster 192.168.2.129 6379")]),e._v(" "),_("p",[e._v("[1158] 19 Jun 08:33:58.028 # +vote-for-leader 7d60ccf8a9f9f81e5292a0dbde2c54c76a2bd265")]),e._v(" "),_("p",[e._v("31")]),e._v(" "),_("p",[e._v("[1158] 19 Jun 08:33:58.036 # 192.168.2.130:26379 voted for 7d60ccf8a9f9f81e5292a0dbde2")]),e._v(" "),_("p",[e._v("c54c76a2bd265 31")]),e._v(" "),_("p",[e._v("[1158] 19 Jun 08:33:58.037 # 192.168.2.128:26379 voted for 7d60ccf8a9f9f81e5292a0dbde2")]),e._v(" "),_("p",[e._v("c54c76a2bd265 31")]),e._v(" "),_("p",[e._v("[1158] 19 Jun 08:33:58.105 # +elected-leader master mymaster 192.168.2.129 6379")]),e._v(" "),_("p",[e._v("[1158] 19 Jun 08:33:58.105 # +failover-state-select-slave master mymaster 192.168.2.12")]),e._v(" "),_("p",[e._v("9 6379")]),e._v(" "),_("p",[e._v("[1158] 19 Jun 08:33:58.183 # +selected-slave slave 192.168.2.128:6379 192.168.2.128 63")]),e._v(" "),_("p",[e._v("79 @ mymaster 192.168.2.129 6379")]),e._v(" "),_("p",[e._v("[1158] 19 Jun 08:33:58.183 * +failover-state-send-slaveof-noone slave 192.168.2.128:63")]),e._v(" "),_("p",[e._v("79 192.168.2.128 6379 @ mymaster 192.168.2.129 6379")]),e._v(" "),_("p",[e._v("[1158] 19 Jun 08:33:58.267 * +failover-state-wait-promotion slave 192.168.2.128:6379 1")]),e._v(" "),_("p",[e._v("92.168.2.128 6379 @ mymaster 192.168.2.129 6379")]),e._v(" "),_("p",[e._v("[1158] 19 Jun 08:33:59.039 # +promoted-slave slave 192.168.2.128:6379 192.168.2.128 63")]),e._v(" "),_("p",[e._v("79 @ mymaster 192.168.2.129 6379")]),e._v(" "),_("p",[e._v("[1158] 19 Jun 08:33:59.040 # +failover-state-reconf-slaves master mymaster 192.168.2.1")]),e._v(" "),_("p",[e._v("29 6379")]),e._v(" "),_("p",[e._v("[1158] 19 Jun 08:33:59.104 * +slave-reconf-sent slave 192.168.2.130:6379 192.168.2.130")]),e._v(" "),_("p",[e._v("6379 @ mymaster 192.168.2.129 6379")]),e._v(" "),_("p",[e._v("[1158] 19 Jun 08:33:59.245 # -odown master mymaster 192.168.2.129 6379")]),e._v(" "),_("p",[e._v("[1158] 19 Jun 08:34:00.082 * +slave-reconf-inprog slave 192.168.2.130:6379 192.168.2.1")]),e._v(" "),_("p",[e._v("30 6379 @ mymaster 192.168.2.129 6379")]),e._v(" "),_("p",[e._v("[1158] 19 Jun 08:34:00.082 * +slave-reconf-done slave 192.168.2.130:6379 192.168.2.130")]),e._v(" "),_("p",[e._v("6379 @ mymaster 192.168.2.129 6379")]),e._v(" "),_("p",[e._v("[1158] 19 Jun 08:34:00.193 # +failover-end master mymaster 192.168.2.129 6379")]),e._v(" "),_("p",[e._v("[1158] 19 Jun 08:34:00.193 # +switch-master mymaster 192.168.2.129 6379 192.168.2.128")]),e._v(" "),_("p",[e._v("6379")]),e._v(" "),_("p",[e._v("[1158] 19 Jun 08:34:00.194 * +slave slave 192.168.2.130:6379 192.168.2.130 6379 @ myma")]),e._v(" "),_("p",[e._v("ster 192.168.2.128 6379")]),e._v(" "),_("p",[e._v("[1158] 19 Jun 08:34:00.200 * +slave slave 192.168.2.129:6379 192.168.2.129 6379 @ myma")]),e._v(" "),_("p",[e._v("ster 192.168.2.128 6379")]),e._v(" "),_("p",[e._v("[1158] 19 Jun 08:34:03.319 # +sdown slave 192.168.2.129:6379 192.168.2.129 6379 @ myma")]),e._v(" "),_("p",[e._v("ster 192.168.2.128 6379")]),e._v(" "),_("p",[e._v("ä»æ—¥å¿—ä¸­å¯ä»¥çœ‹å‡ºå·²ç»åˆ‡æ¢åˆ°2.128ï¼Œæ­¤æ—¶åœ¨2.128ä¸Šçœ‹é›†ç¾¤çŠ¶æ€ï¼š")]),e._v(" "),_("p",[e._v("ç›®å‰2.128ä¸ºä¸»ï¼Œ2.130ä¸ºä»ï¼Œ2.129ä¸Šçš„rediså®•æ‰ã€‚ç°åœ¨é‡å¯2.129ä¸Šçš„rediså®ä¾‹ï¼Œå¯åŠ¨åè¯¥\nèŠ‚ç‚¹ä¼šä»åŸå…ˆçš„ä¸»å˜ä¸ºä»ï¼Œå¹¶å¯¹2.128è¿›è¡ŒåŒæ­¥ï¼Œæœ€åè¾¾åˆ°åŒæ­¥çŠ¶æ€ï¼š")]),e._v(" "),_("p",[e._v("226")]),e._v(" "),_("p",[e._v("é«˜å¯ç”¨å’Œå¼‚å¸¸æµ‹è¯•")]),e._v(" "),_("p",[e._v("æŸ¥çœ‹redis.confå’Œredis-sentinel.confï¼Œå‘ç°éƒ½è¢«æ”¹å†™ã€‚")]),e._v(" "),_("p",[e._v("227")]),e._v(" "),_("p",[e._v("é«˜å¯ç”¨å’Œå¼‚å¸¸æµ‹è¯•")]),e._v(" "),_("p",[e._v("11.1.4.4 å•ä»å®ä¾‹å®•æµ‹è¯•")]),e._v(" "),_("p",[e._v("æ¥ä¸Šï¼Œ2.129ä¸ºä»ï¼Œæ­¤æ—¶æ€æ‰è¯¥è¿›ç¨‹ï¼Œredis.logæ—¥å¿—è®°å½•å¦‚ä¸‹ï¼š")]),e._v(" "),_("p",[e._v("[14984 | signal handler] (1434674492) Received SIGTERM scheduling shutdown...\n[14984] 19 Jun 08:41:32.545 # User requested shutdown...")]),e._v(" "),_("p",[e._v("[14984] 19 Jun 08:41:32.545 * Calling fsync() on the AOF file.")]),e._v(" "),_("p",[e._v("[14984] 19 Jun 08:41:32.545 * Saving the final RDB snapshot before exiting.\n[14984] 19 Jun 08:41:32.580 * DB saved on disk")]),e._v(" "),_("p",[e._v("[14984] 19 Jun 08:41:32.580 # Redis is now ready to exit, bye bye...")]),e._v(" "),_("p",[e._v("æ­¤æ—¶é›†ç¾¤æ­£å¸¸æä¾›å¯¹å¤–æœåŠ¡ï¼Œå¹¶ä¸å½±å“ã€‚")]),e._v(" "),_("p",[e._v("228")]),e._v(" "),_("p",[e._v("é«˜å¯ç”¨å’Œå¼‚å¸¸æµ‹è¯•")]),e._v(" "),_("p",[e._v("11.1.4.5 åŒä»å®ä¾‹å®•æµ‹è¯•")]),e._v(" "),_("p",[e._v("æ¥ä¸Šï¼Œæ­¤æ—¶Masterä¸º2.128ï¼Œè¿˜æœ‰ä¸€ä¸ªæ´»ç€çš„ä»2.130ï¼Œé›†ç¾¤çŠ¶æ€å¦‚ä¸‹ï¼š")]),e._v(" "),_("p",[e._v("æ­¤æ—¶ï¼Œæ€æ‰2.130çš„rediså®ä¾‹åï¼Œé›†ç¾¤çŠ¶æ€å¦‚ä¸‹ï¼š")]),e._v(" "),_("p",[e._v("æ­¤æ—¶ç”±äºé…ç½®äº†æœ€å°slaveä¸ªæ•°ä¸º1ï¼Œå·²ç»ä¸æ»¡è¶³ï¼Œå› æ­¤é›†ç¾¤å˜ä¸ºåªè¯»çŠ¶æ€ï¼š")]),e._v(" "),_("p",[e._v("229")]),e._v(" "),_("p",[e._v("é«˜å¯ç”¨å’Œå¼‚å¸¸æµ‹è¯•")]),e._v(" "),_("p",[e._v("11.1.4.6 å•sentinelå®•æµ‹è¯•")]),e._v(" "),_("p",[e._v("æ¢å¤é›†ç¾¤çŠ¶æ€ï¼Œ2.128ä¸ºä¸»ï¼Œ2.129ã€2.130ä¸ºä»ã€‚")]),e._v(" "),_("p",[e._v("æ­¤æ—¶ï¼Œä»2.128ä¸Šçœ‹sentinelçŠ¶æ€ï¼š")]),e._v(" "),_("p",[e._v("ç”±äºsentineléƒ½æ˜¯å¯¹ç­‰çš„ï¼Œåœ¨æ­¤é€‰æ‹©å¯¹2.128ä¸Šçš„sentinelè¿›è¡Œè¿›ç¨‹å®•æµ‹è¯•ï¼š")]),e._v(" "),_("p",[e._v("æ­¤æ—¶ï¼Œæœ¬èŠ‚ç‚¹sentinelæ—¥å¿—ä¸ºï¼š")]),e._v(" "),_("p",[e._v("å…¶ä»–èŠ‚ç‚¹sentinelæ—¥å¿—ä¸ºï¼š")]),e._v(" "),_("p",[e._v("è¡¨ç¤º2.128ä¸Šçš„sentnelå·²ç»å®•ã€‚ æ­¤æ—¶é›†ç¾¤è¯»å†™æ­£å¸¸ï¼Œåœ¨ä¸€ä¸ªsentinelå®•æœºçš„åŸºç¡€ä¸Šå®•masterå\nåˆ‡æ¢æ­£å¸¸ã€‚")]),e._v(" "),_("p",[e._v("230")]),e._v(" "),_("p",[e._v("é«˜å¯ç”¨å’Œå¼‚å¸¸æµ‹è¯•")]),e._v(" "),_("p",[e._v("11.1.4.7 åŒsentinelå®•æµ‹è¯•")]),e._v(" "),_("p",[e._v("æ¢å¤é›†ç¾¤çŠ¶æ€ï¼Œ2.128ä¸ºä¸»ï¼Œ2.129ã€2.130ä¸ºä»ã€‚æ­¤æ—¶ï¼Œå°†2.128çš„sentinelå’Œ2.129çš„sentinel\néƒ½å®•æ‰ã€‚æ­¤æ—¶ä¸»ä»é›†ç¾¤è¯»å†™å‡æ­£å¸¸ã€‚ åœ¨åŒæ–¹sentinelå®•æœºæ—¶ï¼Œæ€æ‰masterï¼Œä¸»ä»é›†ç¾¤åˆ‡æ¢å¤±\næ•ˆï¼ŒåŸå› æ˜¯å› ä¸ºè®¾ç½®sentinel çš„quorumä¸º2ï¼Œæœ€å°‘æœ‰ä¸¤ä¸ªsentinelæ´»é›†ç¾¤æ‰æ­£å¸¸åˆ‡æ¢ã€‚")]),e._v(" "),_("p",[e._v("231")]),e._v(" "),_("p",[e._v("é«˜å¯ç”¨å’Œå¼‚å¸¸æµ‹è¯•")]),e._v(" "),_("p",[e._v("11.1.4.8 masteræ‰€åœ¨ä¸»æœºæ•´ä½“å®•æµ‹è¯•")]),e._v(" "),_("p",[e._v("æ¢å¤é›†ç¾¤çŠ¶æ€ï¼Œ2.128ä¸ºä¸»ï¼Œ2.129ã€2.130ä¸ºä»ã€‚æ­¤æ—¶ï¼Œå¯¹2.128è¿›è¡Œå®•æœºæµ‹è¯•ï¼Œç›´æ¥å…³é—­ç”µ\næºã€‚ ä¸»ä»åˆ‡æ¢è‡³2.130,ä»2.129æŒ‡å‘æ–°çš„ä¸»ï¼š")]),e._v(" "),_("p",[e._v("sentinelæ—¥å¿—ä¸ºï¼š")]),e._v(" "),_("p",[e._v("232")]),e._v(" "),_("p",[e._v("é«˜å¯ç”¨å’Œå¼‚å¸¸æµ‹è¯•")]),e._v(" "),_("p",[e._v("11.1.4.9 slaveæ‰€åœ¨ä¸»æœºæ•´ä½“å®•æµ‹è¯•")]),e._v(" "),_("p",[e._v("æ¢å¤é›†ç¾¤çŠ¶æ€ï¼Œ2.128ä¸ºä¸»ï¼Œ2.129ã€2.130ä¸ºä»ã€‚æ­¤æ—¶ç›´æ¥å…³é—­2.129ï¼Œè¿™æ—¶ç›¸å½“äºä¸€ä¸ªredis\nslaveè¿›ç¨‹å’Œä¸€ä¸ªsentinelè¿›ç¨‹å®•ã€‚ä¸»ä¸å—å½±å“ï¼Œå¹¶ä¸”æ„ŸçŸ¥åˆ°ä¸€ä¸ªä»å·²ç»å®•æœºã€‚")]),e._v(" "),_("p",[e._v("sentinelæ—¥å¿—è®°å½•äº†æ­¤äº‹ä»¶ã€‚")]),e._v(" "),_("p",[e._v("233")]),e._v(" "),_("p",[e._v("é«˜å¯ç”¨å’Œå¼‚å¸¸æµ‹è¯•")]),e._v(" "),_("p",[e._v("11.1.4.10 è„‘è£‚æµ‹è¯•")]),e._v(" "),_("p",[e._v("æ¢å¤é›†ç¾¤çŠ¶æ€ï¼Œ2.128ä¸ºä¸»ï¼Œ2.129ã€2.130ä¸ºä»ã€‚é¦–å…ˆè¿›è¡Œä¸€ä¸ªä»ç½‘ç»œåˆ†ç¦»çš„æµ‹è¯•ï¼š")]),e._v(" "),_("p",[e._v("æ­¤æ—¶é›†ç¾¤çŠ¶æ€ä¸ºï¼ˆä»masterçœ‹ï¼‰ï¼š")]),e._v(" "),_("p",[e._v("æ­¤æ—¶åˆ‡æ–­2.130è¿™ä¸ªé“¾è·¯ï¼Œ2.128å’Œ2.129åˆ†åˆ«ä¸ºä¸»ä»å½¢æˆä¸€ä¸ªé›†ç¾¤ï¼Œ2.130ä¼šå¤±è´¥ï¼Œå› ä¸ºæ²¡æœ‰\nè¶³å¤Ÿçš„sentinelè¿›è¡ŒæŠ•ç¥¨å®Œæˆfailoverã€‚å‰©ä½™é›†ç¾¤å¦‚ä¸‹ï¼š")]),e._v(" "),_("p",[e._v("ç¬¬ä¸‰å°æœºå™¨åˆ™ä¸ºslaveå¤±è´¥çŠ¶æ€ï¼š")]),e._v(" "),_("p",[e._v("234")]),e._v(" "),_("p",[e._v("é«˜å¯ç”¨å’Œå¼‚å¸¸æµ‹è¯•")]),e._v(" "),_("p",[e._v("æ­¤æ—¶ç”±äºæ²¡æœ‰å‘ç”Ÿåˆ‡æ¢ï¼Œå› æ­¤å¯¹åº”ç”¨æ²¡æœ‰å½±å“ã€‚")]),e._v(" "),_("p",[e._v("å¦ä¸€ç§æƒ…å†µï¼Œå¦‚æœå°†ä¸»æœºç½‘ç»œæ–­å¼€ï¼Œå‰©ä½™ä¸¤ä¸ªä»æˆä¸ºä¸€ä¸ªæ–°çš„é›†ç¾¤ï¼Œå…¶ä¸­ä¸€ä¸ªä»ï¼ˆ2.129ï¼‰æˆ\nä¸ºä¸»ï¼š")]),e._v(" "),_("p",[e._v("åŸæ¥çš„ä¸»æœºåˆ™ä¸ºæ²¡æœ‰slaveçš„ä¸»ï¼š")]),e._v(" "),_("p",[e._v("æ­¤æ—¶ç”±äºæ²¡æœ‰å¯ç”¨çš„slaveï¼Œæ—§ä¸»æ— æ³•å†™å…¥ï¼ˆå®é™…ä¸Šç”±äºç½‘ç»œæ–­å¼€ä¹Ÿæ ¹æœ¬æ— æ³•è®¿é—®ï¼Œå› æ­¤ä»ç½‘\nç»œå’Œæ•°æ®åº“æœ¬èº«éƒ½ä¸å…·æœ‰å¯å†™æ€§ï¼‰ï¼š")]),e._v(" "),_("p",[e._v("æ–°ä¸»ä»å¯ä»¥æ¥å—è¯»å†™è¯·æ±‚ï¼š")]),e._v(" "),_("p",[e._v("æ­¤æ—¶å¦‚æœæ—§\nä¸»çš„ç½‘ç»œæ¢å¤ï¼Œç”±äºå®ƒçš„epochæ¯”è¾ƒæ—§ï¼Œå› æ­¤ä¼šæˆä¸ºä»ï¼Œå°†éƒ¨åˆ†åŒæ­¥ï¼ˆpsyncï¼‰ç½‘ç»œå®•æœŸé—´äº§\nç”Ÿçš„æ–°æ•°æ®ã€‚")]),e._v(" "),_("p",[e._v("ä»ä¸Šè¿°ä¸¤ç§æƒ…å†µæµ‹è¯•ï¼Œæ­¤æ¶æ„ä¸ä¼šå¯¼è‡´åŒä¸»å¯¹å¤–æœåŠ¡ï¼Œä¹Ÿä¸ä¼šå› ä¸ºç½‘ç»œæ¢å¤è€Œæ•°æ®æ··ä¹±ã€‚")]),e._v(" "),_("p",[e._v("è„‘è£‚çš„åœºæ™¯è¿˜å¯ä»¥è¿›è¡Œçš„ä¸€ä¸ªæµ‹è¯•æ—¶å¤šä¸ªsentinelï¼Œä¾‹å¦‚ä¸‹åˆ—æ¶æ„ï¼ˆä¸ºäº†ä¾¿äºæµ‹è¯•åœ¨ä¸¤å°æœºå™¨\nä¸Šå¼€å¤šç«¯å£æ¨¡æ‹Ÿå¤šå°æœºå™¨ï¼‰ï¼š")]),e._v(" "),_("p",[e._v("235")]),e._v(" "),_("p",[e._v("é«˜å¯ç”¨å’Œå¼‚å¸¸æµ‹è¯•")]),e._v(" "),_("p",[e._v("è¿™ä¸ªåœºæ™¯é…ç½®Quorum=3. æ­¤æ—¶åˆ‡æ–­ä¸¤å°æœºå™¨çš„é€šä¿¡ç½‘ç»œï¼ˆæ¨¡æ‹Ÿä¸¤ä¸ªæœºæˆ¿ä¹‹é—´é€šä¿¡ä¸­æ–­ï¼‰ï¼Œå·¦\nè¾¹çš„æœºå™¨ï¼ˆæ¨¡æ‹Ÿä¸»æœºæˆ¿ï¼‰é›†ç¾¤ä¸ä¼šå—åˆ°å½±å“ï¼Œå³è¾¹çš„æœºå™¨ï¼ˆæ¨¡æ‹Ÿç¾å¤‡æœºæˆ¿ï¼‰ç”±äºä¸å¤Ÿå¤§å¤šæ•°\nå› æ­¤ä¸ä¼šäº§ç”Ÿæ–°çš„Masterã€‚")]),e._v(" "),_("p",[e._v("236")]),e._v(" "),_("p",[e._v("é«˜å¯ç”¨å’Œå¼‚å¸¸æµ‹è¯•")]),e._v(" "),_("p",[e._v("11.1.4.11 quorumæµ‹è¯•")]),e._v(" "),_("p",[e._v("åœ¨ä¸€ä¸ªå¦‚ä¸‹çš„å››èŠ‚ç‚¹ç¯å¢ƒä¸­ï¼Œ")]),e._v(" "),_("p",[e._v("å¦‚æœsentinel monitorçš„quorumè®¾ç½®ä¸º3ï¼Œåˆ™å®•æœºä¸€å°åå†å®•æœºï¼Œæ­¤æ—¶è¿˜å‰©ä½™ä¸¤å°ï¼Œå­˜åœ¨ä¸¤ä¸ª\nsentinelï¼Œä¸¤ä¸ªslaveã€‚ç”±äºquorumä¸º3ï¼Œè€Œå¿…é¡»æœ‰>=max(quorum, num(sentinels)/2 +1) =\nmax(3,2) = 3ä¸ªsentineléƒ½åŒæ„å…¶ä¸­æŸä¸€ä¸ªsentinelä¸»æŒfailoverï¼Œå› æ­¤æ­¤æ—¶æ— sentinelå¯ä¸»æŒåˆ‡\næ¢ï¼Œå› æ­¤æµ‹è¯•è¡¨æ˜ï¼Œæ²¡æœ‰æ–°çš„masterè¢«é€‰å‡ºæ¥ï¼Œæ­¤æ—¶åªèƒ½æ‰‹åŠ¨é€šè¿‡slaveofå‘½ä»¤è®¾ç½®ä¸»ä»ï¼Œå¹¶\nä¸”æ‰‹åŠ¨åˆ‡æ¢ï¼ˆredisã€sentinelå’Œéƒ½åº”ç”¨ä¸ç”¨é‡å¯ï¼‰ï¼š")]),e._v(" "),_("p",[e._v("é¦–å…ˆä¿®æ”¹redisï¼š")]),e._v(" "),_("p",[e._v("ä»»æ„é€‰å–å‰©ä½™çš„å…¶ä¸­ä¸€ä¸ªèŠ‚ç‚¹è¿›è¡Œï¼šslaveof no one")]),e._v(" "),_("p",[e._v("å…¶ä»–èŠ‚ç‚¹ï¼šslaveof 192.168.145.135 6379")]),e._v(" "),_("p",[e._v("æ‰¾ä¸€ä¸ªä»èŠ‚ç‚¹ä¸Šçš„sentinelï¼Œè¿›å…¥sentinelï¼š")]),e._v(" "),_("p",[e._v("redis-cli -p 26379")]),e._v(" "),_("p",[e._v("è¿›è¡Œä¸»åŠ¨åˆ‡æ¢ï¼š")]),e._v(" "),_("p",[e._v("sentinel failover mymaster")]),e._v(" "),_("p",[e._v("ç„¶åå†åœ¨ä¸¤ä¸ªsentinelä¸Šé‡æ–°å‘ç°é›†ç¾¤ï¼š")]),e._v(" "),_("p",[e._v("sentinel reset mymaster")]),e._v(" "),_("p",[e._v("æ£€æŸ¥é›†ç¾¤çŠ¶æ€ã€‚")]),e._v(" "),_("p",[e._v("å¦‚æœsentinel monitorçš„quorumè®¾ç½®ä¸º2ï¼Œåˆ™å®•æœºä¸€å°åå†å®•æœºï¼Œæ­¤æ—¶è¿˜å‰©ä½™ä¸¤å°ï¼Œå­˜åœ¨ä¸¤ä¸ª\nsentinelï¼Œä¸¤ä¸ªslaveã€‚ç”±äºquorumä¸º2ï¼Œå¿…é¡»æœ‰>=max(quorum, num(sentinels)/2")]),e._v(" "),_("p",[e._v("+1)=max(2,2) =2ä¸ªçš„sentineléƒ½åŒæ„å…¶ä¸­æŸä¸€ä¸ªsentinelä¸»æŒfailoverï¼Œå› æ­¤æ­¤æ—¶å­˜åœ¨sentinel")]),e._v(" "),_("p",[e._v("å¯ä¸»æŒåˆ‡æ¢ï¼Œå› æ­¤æµ‹è¯•è¡¨æ˜ï¼Œæ–°çš„masterè¢«é€‰å‡ºæ¥ã€‚")]),e._v(" "),_("p",[e._v("ä½†æ˜¯è®¾ç½®ä¸º2æœ‰ä¸€ä¸ªå±é™©å°±æ˜¯å¦‚æœå‡ºç°å¦‚ä¸‹çš„ç½‘ç»œéš”ç¦»çŠ¶å†µï¼š")]),e._v(" "),_("p",[e._v("237")]),e._v(" "),_("p",[e._v("é«˜å¯ç”¨å’Œå¼‚å¸¸æµ‹è¯•")]),e._v(" "),_("p",[e._v("é›†ç¾¤å°±ä¼šè„‘è£‚ï¼Œå°±ä¼šå‡ºç°ä¸¤ä¸ªmasterã€‚å› æ­¤ï¼Œç”Ÿäº§ä¸Šä¸ºäº†ä¸‡æ— ä¸€å¤±ï¼Œå®å¯ç‰ºç‰²æ‰ä¸€å®šçš„é«˜å¯\nç”¨å®¹é”™åº¦ä¹Ÿè¦é¿å…è„‘è£‚ã€‚å¦‚æœå¸Œæœ›ä¸¤å°å®•æœºä¾ç„¶å¯ä»¥åˆ‡æ¢ï¼Œæœ€å¥½çš„æ–¹æ¡ˆä¸æ˜¯é™ä½quorumè€Œæ˜¯\nå¢å¤šsentinelçš„ä¸ªæ•°ï¼Œè¿™ä¸ªå»ºè®®ä¹Ÿæ˜¯antirezåœ¨stackoverflowä¸­å›ç­”ä¸€ä¸ªäººçš„æé—®æ—¶ç»™çš„å»ºè®®")]),e._v(" "),_("p",[e._v("ï¼ˆhttp://stackoverflow.com/questions/27605843/redis-sentinel-last-node-doesnt-become-\nmaster#ï¼‰ã€‚ å¦‚ä¸‹åœºæ™¯æµ‹è¯•ï¼š")]),e._v(" "),_("p",[e._v("æ­¤æ—¶å…¶ä¸­ä¸¤\nå°å®•æœºï¼Œå¿…é¡»æœ‰>=max(quorum, num(sentinels)/2 +1)=max(3,3) =3ä¸ªçš„sentineléƒ½åŒæ„å…¶ä¸­æŸ\nä¸€ä¸ªsentinelä¸»æŒfailoverï¼Œå› æ­¤æ­¤æ—¶å­˜åœ¨sentinelå¯ä¸»æŒåˆ‡æ¢ï¼Œæµ‹è¯•ç»“æœè¡¨æ˜æ­¤ç§éƒ¨ç½²æ–¹æ¡ˆå¯\nä»¥æ­£å¸¸åˆ‡æ¢ã€‚")]),e._v(" "),_("p",[e._v("238")]),e._v(" "),_("p",[e._v("é«˜å¯ç”¨å’Œå¼‚å¸¸æµ‹è¯•")]),e._v(" "),_("p",[e._v("11.1.4.12 Master hangæ­»æµ‹è¯•")]),e._v(" "),_("p",[e._v("ç”±äºæˆ‘ä»¬çš„sentinel down-after-millisecondsä¸º3100ï¼Œå³3.1sï¼Œå› æ­¤åœ¨masterä¸Šæ‰§è¡Œï¼š debug\nsleep 3.0ï¼Œç³»ç»Ÿä¸ä¼šåˆ‡æ¢ï¼Œä½†æ˜¯æ‰§è¡Œdebug sleep 3.7æˆ–è€…æ›´å¤§çš„æ•°å€¼ï¼Œç³»ç»Ÿå°±ä¼šåˆ¤å®šä¸ºä¸»\nsdownï¼Œè¿›è€Œå˜ä¸ºodownéšåå‘èµ·æŠ•ç¥¨åˆ‡æ¢ã€‚å¾ˆéš¾æ¨¡æ‹Ÿå–æ¶ˆodownçš„ï¼Œå› ä¸ºæ—¶é—´å·®å¾ˆçŸ­ã€‚")]),e._v(" "),_("p",[e._v("239")]),e._v(" "),_("p",[e._v("é«˜å¯ç”¨å’Œå¼‚å¸¸æµ‹è¯•")]),e._v(" "),_("p",[e._v("11.1.4.13 é™„ï¼šsentinel.confè¢«ä¿®æ”¹åçš„å«ä¹‰")]),e._v(" "),_("p",[e._v('port 26379 dir "/var/lib/redis/tmp" sentinel monitor mymaster 192.168.65.128 6379 2 sentinel\nconfig-epoch mymaster 18 ###ç¡®è®¤mymater SDOWNæ—¶é•¿ sentinel leader-epoch mymaster\n18 ###åŒæ—¶ä¸€æ—¶é—´æœ€å¤š18ä¸ªslaveå¯åŒæ—¶æ›´æ–°é…ç½®,å»ºè®®æ•°å­—ä¸è¦å¤ªå¤§,ä»¥å…å½±å“æ­£å¸¸å¯¹å¤–æä¾›\næœåŠ¡ sentinel known-slave mymaster 192.168.65.129 6379 ###å·²çŸ¥çš„slave sentinel known-\nslave mymaster 192.168.65.130 6379 ###å·²çŸ¥çš„slave sentinel known-sentinel mymaster\n192.168.65.130 26379 be964e6330ee1eaa9a6b5a97417e866448c0ae40 ###å·²çŸ¥slaveçš„å”¯')]),e._v(" "),_("p",[e._v("ä¸€id sentinel known-sentinel mymaster 192.168.65.129 26379\n3e468037d5dda0bbd86adc3e47b29c04f2afe9e6 ###å·²çŸ¥slaveçš„å”¯ä¸€id sentinel current-\nepoch                      18 ####å½“å‰å¯åŒæ—¶åŒæ­¥çš„salveæ•°æœ€å¤§åŒæ­¥é˜€å€¼")]),e._v(" "),_("p",[e._v("240")]),e._v(" "),_("p",[e._v("é«˜å¯ç”¨å’Œå¼‚å¸¸æµ‹è¯•")]),e._v(" "),_("p",[e._v("11.1.4.14 é™„ï¼šsentineläº‹ä»¶å«ä¹‰")]),e._v(" "),_("p",[e._v("+reset-master "),_("instance",{attrs:{details:""}},[e._v(" -- å½“masterè¢«é‡ç½®æ—¶.")])],1),e._v(" "),_("p",[e._v("+slave "),_("instance",{attrs:{details:""}},[e._v(" -- å½“æ£€æµ‹åˆ°ä¸€ä¸ªslaveå¹¶æ·»åŠ è¿›slaveåˆ—è¡¨æ—¶.")])],1),e._v(" "),_("p",[e._v("+failover-state-reconf-slaves "),_("instance",{attrs:{details:""}},[e._v(" -- FailoverçŠ¶æ€å˜ä¸ºreconf-slavesçŠ¶æ€æ—¶")])],1),e._v(" "),_("p",[e._v("+failover-detected "),_("instance",{attrs:{details:""}},[e._v(" -- å½“failoverå‘ç”Ÿæ—¶")])],1),e._v(" "),_("p",[e._v("+slave-reconf-sent "),_("instance",{attrs:{details:""}},[e._v(" -- sentinelå‘é€SLAVEOFå‘½ä»¤æŠŠå®ƒé‡æ–°é…ç½®æ—¶")])],1),e._v(" "),_("p",[e._v("+slave-reconf-inprog "),_("instance",{attrs:{details:""}},[e._v(" -- slaveè¢«é‡æ–°é…ç½®ä¸ºå¦å¤–ä¸€ä¸ªmasterçš„slaveï¼Œä½†æ•°æ®å¤\nåˆ¶è¿˜æœªå‘ç”Ÿæ—¶ã€‚")])],1),e._v(" "),_("p",[e._v("+slave-reconf-done "),_("instance",{attrs:{details:""}},[e._v(" -- slaveè¢«é‡æ–°é…ç½®ä¸ºå¦å¤–ä¸€ä¸ªmasterçš„slaveå¹¶ä¸”æ•°æ®å¤åˆ¶\nå·²ç»ä¸masteråŒæ­¥æ—¶ã€‚")])],1),e._v(" "),_("p",[e._v("-dup-sentinel "),_("instance",{attrs:{details:""}},[e._v(" -- åˆ é™¤æŒ‡å®šmasterä¸Šçš„å†—ä½™sentinelæ—¶ (å½“ä¸€ä¸ªsentinelé‡æ–°å¯\nåŠ¨æ—¶ï¼Œå¯èƒ½ä¼šå‘ç”Ÿè¿™ä¸ªäº‹ä»¶).")])],1),e._v(" "),_("p",[e._v("+sentinel "),_("instance",{attrs:{details:""}},[e._v(" -- å½“masterå¢åŠ äº†ä¸€ä¸ªsentinelæ—¶ã€‚")])],1),e._v(" "),_("p",[e._v("+sdown "),_("instance",{attrs:{details:""}},[e._v(" -- è¿›å…¥SDOWNçŠ¶æ€æ—¶;")])],1),e._v(" "),_("p",[e._v("-sdown "),_("instance",{attrs:{details:""}},[e._v(" -- ç¦»å¼€SDOWNçŠ¶æ€æ—¶ã€‚")])],1),e._v(" "),_("p",[e._v("+odown "),_("instance",{attrs:{details:""}},[e._v(" -- è¿›å…¥ODOWNçŠ¶æ€æ—¶ã€‚")])],1),e._v(" "),_("p",[e._v("-odown "),_("instance",{attrs:{details:""}},[e._v(" -- ç¦»å¼€ODOWNçŠ¶æ€æ—¶ã€‚")])],1),e._v(" "),_("p",[e._v("+new-epoch "),_("instance",{attrs:{details:""}},[e._v(" -- å½“å‰é…ç½®ç‰ˆæœ¬è¢«æ›´æ–°æ—¶ã€‚")])],1),e._v(" "),_("p",[e._v("+try-failover "),_("instance",{attrs:{details:""}},[e._v(" -- è¾¾åˆ°failoveræ¡ä»¶ï¼Œæ­£ç­‰å¾…å…¶ä»–sentinelçš„é€‰ä¸¾ã€‚")])],1),e._v(" "),_("p",[e._v("+elected-leader "),_("instance",{attrs:{details:""}},[e._v(" -- è¢«é€‰ä¸¾ä¸ºå»æ‰§è¡Œfailoverçš„æ—¶å€™ã€‚")])],1),e._v(" "),_("p",[e._v("+failover-state-select-slave "),_("instance",{attrs:{details:""}},[e._v(" -- å¼€å§‹è¦é€‰æ‹©ä¸€ä¸ªslaveå½“é€‰æ–°masteræ—¶ã€‚")])],1),e._v(" "),_("p",[e._v("no-good-slave "),_("instance",{attrs:{details:""}},[e._v(" -- æ²¡æœ‰åˆé€‚çš„slaveæ¥æ‹…å½“æ–°master\nselected-slave "),_("instance",{attrs:{details:""}},[e._v(" -- æ‰¾åˆ°äº†ä¸€ä¸ªé€‚åˆçš„slaveæ¥æ‹…å½“æ–°master")])],1)],1),e._v(" "),_("p",[e._v("failover-state-send-slaveof-noone "),_("instance",{attrs:{details:""}},[e._v(" -- å½“æŠŠé€‰æ‹©ä¸ºæ–°masterçš„slaveçš„èº«ä»½è¿›\nè¡Œåˆ‡æ¢çš„æ—¶å€™ã€‚")])],1),e._v(" "),_("p",[e._v("failover-end-for-timeout "),_("instance",{attrs:{details:""}},[e._v(" -- failoverç”±äºè¶…æ—¶è€Œå¤±è´¥æ—¶ã€‚\nfailover-end "),_("instance",{attrs:{details:""}},[e._v(" -- failoveræˆåŠŸå®Œæˆæ—¶ã€‚")])],1)],1),e._v(" "),_("p",[e._v("switch-master "),_("master",{attrs:{name:""}},[_("oldip",[_("oldport",[_("newip",[_("newport",[e._v(" -- å½“masterçš„åœ°å€å‘ç”Ÿå˜åŒ–\næ—¶ã€‚é€šå¸¸è¿™æ˜¯å®¢æˆ·ç«¯æœ€æ„Ÿå…´è¶£çš„æ¶ˆæ¯äº†ã€‚")])],1)],1)],1)],1)],1),e._v(" "),_("p",[e._v("+tilt -- è¿›å…¥Tiltæ¨¡å¼ã€‚")]),e._v(" "),_("p",[e._v("-tilt -- é€€å‡ºTiltæ¨¡å¼ã€‚")]),e._v(" "),_("p",[e._v("241")]),e._v(" "),_("p",[e._v("å…¶ä»–é—®é¢˜")]),e._v(" "),_("p",[e._v("11.1.5 å…¶ä»–é—®é¢˜")]),e._v(" "),_("p",[e._v("242")]),e._v(" "),_("p",[e._v("å…¶ä»–é—®é¢˜")]),e._v(" "),_("p",[e._v("11.1.5.1 åªè¯»æ€§")]),e._v(" "),_("p",[e._v("ä¸»ä»å¤åˆ¶æ¶æ„ä¸‹ï¼Œé»˜è®¤Slaveæ˜¯åªè¯»çš„ï¼Œå¦‚æœå†™å…¥åˆ™ä¼šæŠ¥é”™ï¼š")]),e._v(" "),_("p",[e._v("127.0.0.1:6379> set foo bar")]),e._v(" "),_("p",[e._v("(error) READONLY You can't write against a read only slave.")]),e._v(" "),_("p",[e._v("æ³¨æ„è¿™ä¸ªè¡Œä¸ºæ˜¯å¯ä»¥ä¿®æ”¹çš„ï¼Œè™½ç„¶è¿™æ ·çš„ä¿®æ”¹æ²¡æœ‰æ„ä¹‰ï¼š")]),e._v(" "),_("p",[e._v("127.0.0.1:6379> CONFIG SET slave-read-only no\nOK")]),e._v(" "),_("p",[e._v("127.0.0.1:6379> set foo bar\nOK")]),e._v(" "),_("p",[e._v("243")]),e._v(" "),_("p",[e._v("å…¶ä»–é—®é¢˜")]),e._v(" "),_("p",[e._v("11.1.5.1 äº‹ä»¶é€šçŸ¥")]),e._v(" "),_("p",[e._v("åœ¨sentinelä¸­ï¼Œå¦‚æœå‡ºç°warningä»¥ä¸Šçº§åˆ«çš„äº‹ä»¶å‘ç”Ÿï¼Œ æ˜¯å¯ä»¥é€šè¿‡å¦‚ä¸‹é…ç½®è¿›è¡Œè„šæœ¬è°ƒç”¨çš„")]),e._v(" "),_("p",[e._v("ï¼ˆå¯¹äºè¯¥è„šæœ¬rediså¯åŠ¨ç”¨æˆ·éœ€è¦æœ‰æ‰§è¡Œæƒé™ï¼‰ï¼š")]),e._v(" "),_("p",[e._v("sentinel notification-script mymaster /redis/script/notify.py")]),e._v(" "),_("p",[e._v("æ¯”å¦‚è¯´ï¼Œæˆ‘ä»¬å¸Œæœ›åœ¨å‘ç”Ÿè¿™äº›äº‹ä»¶çš„æ—¶å€™è¿›è¡Œé‚®ä»¶é€šçŸ¥ï¼Œé‚£ä¹ˆï¼Œnotify.pyå°±æ˜¯ä¸€ä¸ªè§¦å‘é‚®ä»¶è°ƒ\nç”¨çš„ä¸œä¸œï¼Œä¼ å…¥ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºäº‹ä»¶ç±»å‹ï¼Œç¬¬äºŒä¸ªå‚æ•°ä¸ºäº‹ä»¶ä¿¡æ¯ï¼š")]),e._v(" "),_("p",[e._v("#!/bin/python")]),e._v(" "),_("p",[e._v("from sendmail import send_mail\nimport sys")]),e._v(" "),_("p",[e._v("event_type = sys.argv[1]\nevent_desc = sys.argv[2]")]),e._v(" "),_("p",[e._v('mail_content = event_type + ":" + event_desc')]),e._v(" "),_("p",[e._v('send_mail("xxxx@qq.com",')]),e._v(" "),_("p",[e._v('["xxxxx@cmbc.com.cn","xxxx@gmail.com"],\n"Redis Sentinel Event Notification Mail",\nmail_content,\ncc=["xxx@gmail.com","xxx@139.com"],\nbcc=["xxxx@qq.com"]')]),e._v(" "),_("p",[e._v(")")]),e._v(" "),_("p",[e._v("æœ‰ä¸¤ä¸ªæ³¨æ„äº‹é¡¹ï¼š 1ï¼‰ è¿™ä¸ªæ—¶å€™å¦‚æœé›†ç¾¤å‘ç”Ÿäº†åˆ‡æ¢ä¼šäº§ç”Ÿå¾ˆå¤šäº‹ä»¶ï¼Œæ­¤è„šæœ¬æ˜¯åœ¨æ¯ä¸€ä¸ªäº‹\nä»¶å‘ç”Ÿæ—¶è°ƒç”¨ä¸€æ¬¡ï¼Œé‚£ä¹ˆä½ å°†çŸ­æ—¶é—´æ”¶åˆ°å¾ˆå¤šå°é‚®ä»¶ï¼ŒåŠ ä¸Šå¾ˆå¤šçš„é‚®ä»¶ç½‘å…³æ˜¯ä¸å…è®¸åœ¨ä¸€ä¸ª\nçŸ­æ—¶é—´å†…å‘é€å¤ªå¤šçš„é‚®ä»¶çš„ï¼Œå› æ­¤è¿™ä¸ªä»…ä»…æ˜¯ä¸€ä¸ªç¤ºä¾‹ï¼Œå¹¶ä¸å…·å¤‡å®é™…ä¸Šçš„ä½œç”¨ã€‚ 2ï¼‰ ä¸€èˆ¬\næˆ‘ä»¬ä¼šé‡‡ç”¨å¤šä¸ªsentinelï¼Œåªéœ€åœ¨ä¸€ä¸ªsentinelä¸Šé…ç½®å³å¯ï¼Œå¦åˆ™å°†åŒä¸€ä¸ªæ¶ˆæ¯ä¼šè¢«å¤šä¸ª\nsentinelå¤šæ¬¡å¤„ç†ã€‚")]),e._v(" "),_("p",[e._v("é™„sendmailæ¨¡å—ä»£ç ï¼š")]),e._v(" "),_("p",[e._v("244")]),e._v(" "),_("p",[e._v("å…¶ä»–é—®é¢˜")]),e._v(" "),_("p",[e._v("import smtplib\nimport os")]),e._v(" "),_("p",[e._v("from email.mime.multipart import MIMEMultipart\nfrom email.mime.application import MIMEApplication\nfrom email.mime.base import MIMEBase")]),e._v(" "),_("p",[e._v("from email.mime.text import MIMEText\nfrom email.utils import formatdate\nfrom email import Encoders")]),e._v(" "),_("p",[e._v("from email.message import Message\nimport datetime")]),e._v(" "),_("p",[e._v('def send_mail(fromPerson,toPerson, subject="", text="",files=[], cc=[], bcc=[]):\nserver = "smtp.qq.com"')]),e._v(" "),_("p",[e._v("assert type(toPerson)==list\nassert type(files)==list\nassert type(cc)==list\nassert type(bcc)==list")]),e._v(" "),_("p",[e._v("message = MIMEMultipart()\nmessage['From'] = fromPerson\nmessage['To']   = ', '.join(toPerson)")]),e._v(" "),_("p",[e._v("message['Date'] = formatdate(localtime=True)\nmessage['Subject'] = subject")]),e._v(" "),_("p",[e._v("message['Cc'] = ','.join(cc)")]),e._v(" "),_("p",[e._v("message['Bcc'] = ','.join(bcc)\nmessage.attach(MIMEText(text))")]),e._v(" "),_("p",[e._v("for f in files:")]),e._v(" "),_("p",[e._v('part = MIMEApplication(open(f,"rb").read())')]),e._v(" "),_("p",[e._v("part.add_header('Content-Disposition', 'attachment', filename=filename)\nmessage.attach(part)")]),e._v(" "),_("p",[e._v("addresses = []\nfor x in toPerson:")]),e._v(" "),_("p",[e._v("addresses.append(x)\nfor x in cc:")]),e._v(" "),_("p",[e._v("addresses.append(x)\nfor x in bcc:")]),e._v(" "),_("p",[e._v("addresses.append(x)")]),e._v(" "),_("p",[e._v('smtp = smtplib.SMTP_SSL(server)\nsmtp.login("xxxx@qq.com","xxxx")\nsmtp.sendmail(message[\'From\'],addresses,message.as_string())\nsmtp.close()')]),e._v(" "),_("p",[e._v("æœ€ä½³å®è·µï¼šé‡‡ç”¨ELKï¼ˆElastic+Logstash+Kibanaï¼‰è¿›è¡Œæ—¥å¿—æ”¶é›†å‘Šè­¦ï¼ˆElastAlertç”¨èµ·æ¥ä¸\né”™ï¼‰ï¼Œä¸å¯ç”¨è¿™ä¸ªäº‹ä»¶é€šçŸ¥åŠŸèƒ½ã€‚å¦‚æœä½ çš„ç¯å¢ƒä¸­æ²¡æœ‰ELKï¼Œæˆ–è€…å¯åŠ¨ä¸€ä¸ªTcp Serverè¿›ç¨‹ï¼Œ\nnotifyè„šæœ¬å°†äº‹ä»¶é€šè¿‡tcpæ–¹å¼åç»™è¿™ä¸ªserverï¼Œè¯¥Serveræ”¶é›†ä¸€æ‰¹äº‹ä»¶åå†åšè¯¸å¦‚å‘é‚®ä»¶çš„å¤„\nç†ã€‚")]),e._v(" "),_("p",[e._v("245")]),e._v(" "),_("p",[e._v("å…¶ä»–é—®é¢˜")]),e._v(" "),_("p",[e._v("246")]),e._v(" "),_("p",[e._v("å…¶ä»–é—®é¢˜")]),e._v(" "),_("p",[e._v("11.1.5.2 è™šæ‹ŸIPåˆ‡æ¢")]),e._v(" "),_("p",[e._v("åœ¨sentinelè¿›è¡Œåˆ‡æ¢æ—¶è¿˜ä¼šè‡ªåŠ¨è°ƒç”¨ä¸€ä¸ªè„šæœ¬ï¼ˆå¦‚æœè®¾ç½®çš„è¯ï¼‰ï¼Œåšä¸€äº›è‡ªåŠ¨åŒ–æ“ä½œï¼Œæ¯”å¦‚å¦‚\næœæˆ‘ä»¬éœ€è¦ä¸€ä¸ªè™šæ‹ŸIPæ°¸è¿œé£˜åœ¨Masterä¸Šï¼ˆè¿™ä¸ªVIPå¯ä¸æ˜¯è¢«åº”ç”¨ç”¨æ¥è¿æ¥redis çš„ï¼Œç”¨è¿‡çš„\näººéƒ½çŸ¥é“è¿æ¥redis sentinelå¹¶ä¸ä¾èµ–äºVIPçš„ï¼‰ï¼Œé‚£ä¹ˆå¯ä»¥åœ¨sentinelé…ç½®æ–‡ä»¶ä¸­é…ç½®ï¼š")]),e._v(" "),_("p",[e._v("sentinel client-reconfig-script mymaster /redis/script/failover.sh")]),e._v(" "),_("p",[e._v("åœ¨å‘ç”Ÿä¸»ä»åˆ‡æ¢ï¼ŒMasterå‘ç”Ÿå˜åŒ–æ—¶ï¼Œè¯¥è„šæœ¬ä¼šè¢«sentinelè¿›è¡Œè°ƒç”¨ï¼Œè°ƒç”¨çš„å‚æ•°å¦‚å…¶é…ç½®æ–‡\nä»¶æ‰€æè¿°çš„ï¼š")]),e._v(" "),_("h1",{attrs:{id:"the-following-arguments-are-passed-to-the-script"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#the-following-arguments-are-passed-to-the-script"}},[e._v("#")]),e._v(" The following arguments are passed to the script:")]),e._v(" "),_("h1",{attrs:{id:""}},[_("a",{staticClass:"header-anchor",attrs:{href:"#"}},[e._v("#")])]),e._v(" "),_("h1",{attrs:{id:"-2"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#-2"}},[e._v("#")]),e._v(" "),_("master-name",[_("role",[_("state",[_("from-ip",[_("from-port",[_("to-ip",[_("to-port")],1)],1)],1)],1)],1)],1)],1),e._v(" "),_("h1",{attrs:{id:"-3"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#-3"}},[e._v("#")])]),e._v(" "),_("h1",{attrs:{id:"is-currently-always-failover"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#is-currently-always-failover"}},[e._v("#")]),e._v(" "),_("state",[e._v(' is currently always "failover"')])],1),e._v(" "),_("h1",{attrs:{id:"is-either-leader-or-observer"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#is-either-leader-or-observer"}},[e._v("#")]),e._v(" "),_("role",[e._v(' is either "leader" or "observer"')])],1),e._v(" "),_("h1",{attrs:{id:"-4"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#-4"}},[e._v("#")])]),e._v(" "),_("h1",{attrs:{id:"the-arguments-from-ip-from-port-to-ip-to-port-are-used-to-communicate"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#the-arguments-from-ip-from-port-to-ip-to-port-are-used-to-communicate"}},[e._v("#")]),e._v(" The arguments from-ip, from-port, to-ip, to-port are used to communicate")]),e._v(" "),_("h1",{attrs:{id:"the-old-address-of-the-master-and-the-new-address-of-the-elected-slave"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#the-old-address-of-the-master-and-the-new-address-of-the-elected-slave"}},[e._v("#")]),e._v(" the old address of the master and the new address of the elected slave")]),e._v(" "),_("h1",{attrs:{id:"now-a-master"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#now-a-master"}},[e._v("#")]),e._v(" (now a master).")]),e._v(" "),_("p",[e._v("å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨failover.shä¸­è¿›è¡Œåˆ¤æ–­ï¼Œå¦‚æœè¯¥è„šæœ¬æ‰€è¿è¡Œçš„ä¸»æœºIPç­‰äºæ–°çš„Master IPï¼Œé‚£\nä¹ˆå°†VIPåŠ ä¸Šï¼Œå¦‚æœä¸ç­‰äºï¼Œåˆ™è¯¥æœºå™¨ä¸ºSlaveï¼Œå°±å»æ‰VIPã€‚é€šè¿‡è¿™ç§æ–¹å¼è¿›è¡ŒVIPçš„åˆ‡æ¢ï¼š")]),e._v(" "),_("p",[e._v("247")]),e._v(" "),_("p",[e._v("å…¶ä»–é—®é¢˜")]),e._v(" "),_("p",[e._v("#!/bin/sh")]),e._v(" "),_("p",[e._v('_DEBUG="on"')]),e._v(" "),_("p",[e._v("DEBUGFILE=/tmp/sentinel_failover.log\nVIP='192.168.2.120'")]),e._v(" "),_("p",[e._v("MASTERIP=${6}\nMASK='24'\nIFACE='eno33554960'")]),e._v(" "),_("p",[e._v("MYIP=$(ip -4 -o addr show dev ${IFACE}| grep -v secondary| awk '{split($4,a,\"/\");print\na[1]}')")]),e._v(" "),_("p",[e._v("DEBUG () {")]),e._v(" "),_("p",[e._v('if [ "$_DEBUG" = "on" ]; then\necho '),_("code",[e._v("$@")]),e._v(" >> ${DEBUGFILE}")]),e._v(" "),_("p",[e._v("fi")]),e._v(" "),_("p",[e._v("}")]),e._v(" "),_("p",[e._v("set -e\nDEBUG date")]),e._v(" "),_("p",[e._v("DEBUG echo $@")]),e._v(" "),_("p",[e._v('DEBUG echo "Master: ${MASTERIP} My IP: ${MYIP}"\nif [ ${MASTERIP} = ${MYIP} ]; then')]),e._v(" "),_("p",[e._v("if [ $(ip addr show ${IFACE} | grep ${VIP} | wc -l) = 0 ]; then")]),e._v(" "),_("p",[e._v("/sbin/ip addr add ${VIP}/${MASK} dev ${IFACE}\nDEBUG date")]),e._v(" "),_("p",[e._v('DEBUG echo "/sbin/ip addr add ${VIP}/${MASK} dev ${IFACE}"\nDEBUG date')]),e._v(" "),_("p",[e._v('DEBUG echo "IP Arp cleaning: /usr/sbin/arping -q -f -c 1 -A ${VIP} -I ${IFACE}')]),e._v(" "),_("p",[e._v('"')]),e._v(" "),_("p",[e._v("else")]),e._v(" "),_("p",[e._v("/usr/sbin/arping -q -f -c 1 -A ${VIP} -I ${IFACE}\nDEBUG date")]),e._v(" "),_("p",[e._v('DEBUG echo "IP Failover finished!"\nfi')]),e._v(" "),_("p",[e._v("exit 0")]),e._v(" "),_("p",[e._v("if [ $(ip addr show ${IFACE} | grep ${VIP} | wc -l) != 0 ]; then")]),e._v(" "),_("p",[e._v("/sbin/ip addr del ${VIP}/${MASK} dev ${IFACE}")]),e._v(" "),_("p",[e._v('DEBUG echo "/sbin/ip addr del ${VIP}/${MASK} dev ${IFACE}"')]),e._v(" "),_("p",[e._v("fi\nexit 0")]),e._v(" "),_("p",[e._v("fi\nexit 1")]),e._v(" "),_("p",[e._v("æœ€æ—©è¿™æ ·çš„ç”¨æ³•æ˜¯ä¸€ä¸ªæ—¥æœ¬äººå†™çš„blogï¼Œè¯·å‚")]),e._v(" "),_("p",[e._v("è§ï¼šhttp://blog.youyo.info/blog/2014/05/24/redis-cluster/")]),e._v(" "),_("p",[e._v("248")]),e._v(" "),_("p",[e._v("å…¶ä»–é—®é¢˜")]),e._v(" "),_("p",[e._v("11.1.5.3 æŒä¹…åŒ–åŠ¨æ€ä¿®æ”¹")]),e._v(" "),_("p",[e._v("å…¶å®ç›¸å¯¹äºVIPçš„åˆ‡æ¢ï¼ŒåŠ¨æ€ä¿®æ”¹æŒä¹…åŒ–åˆ™æ˜¯æ¯”è¾ƒå¸¸è§çš„ä¸€ä¸ªéœ€æ±‚ï¼Œä¸€èˆ¬åœ¨ä¸€ä¸»å¤šä»å¤š\nSentinelçš„HAç¯å¢ƒä¸­ï¼Œä¸ºäº†æ€§èƒ½å¸¸å¸¸åœ¨Masterä¸Šå…³é—­æŒä¹…åŒ–ï¼Œè€Œåœ¨Slaveä¸Šå¼€å¯æŒä¹…åŒ–ï¼Œä½†æ˜¯\nå¦‚æœå‘ç”Ÿåˆ‡æ¢å°±å¿…é¡»æœ‰äººå·¥å¹²é¢„æ‰èƒ½å®ç°è¿™ä¸ªåŠŸèƒ½ã€‚å¯ä»¥åˆ©ç”¨client-reconfig-scriptè‡ªåŠ¨åŒ–è¯¥\nè¿›ç¨‹ï¼Œæ— éœ€äººå·¥å®ˆæŠ¤ï¼Œæˆ‘ä»¬å°±ä»¥RDBçš„åŠ¨æ€æ§åˆ¶ä¸ºä¾‹ï¼š Sentinelé…ç½®æ–‡ä»¶å¦‚ä¸‹ï¼š")]),e._v(" "),_("p",[e._v("sentinel client-reconfig-script mymaster /redis/script/rdbctl.sh")]),e._v(" "),_("p",[e._v("rdbctl.shæºä»£ç ï¼š")]),e._v(" "),_("p",[e._v("249")]),e._v(" "),_("p",[e._v("å…¶ä»–é—®é¢˜")]),e._v(" "),_("p",[e._v("#!/bin/bash")]),e._v(" "),_("p",[e._v('_DEBUG="on"')]),e._v(" "),_("p",[e._v('DEBUGFILE="/smsred/redis-3.0.4/log/sentinel_failover.log"\nMASTERIP=${6}')]),e._v(" "),_("p",[e._v("MASTERPORT=${7}\nSLAVEIP=${4}\nSLAVEPORT=${5}\nMASK='24'")]),e._v(" "),_("p",[e._v("IFACE='bond0'")]),e._v(" "),_("p",[e._v("MYIP=$(ip -4 -o addr show dev ${IFACE}| grep -v secondary| awk '{split($4,a,\"/\");print\na[1]}')")]),e._v(" "),_("p",[e._v("DEBUG () {")]),e._v(" "),_("p",[e._v('if [ "$_DEBUG" = "on" ]; then\necho '),_("code",[e._v("$@")]),e._v(" >> ${DEBUGFILE}")]),e._v(" "),_("p",[e._v("fi")]),e._v(" "),_("p",[e._v("}")]),e._v(" "),_("p",[e._v("set -e\nDEBUG date")]),e._v(" "),_("p",[e._v("DEBUG echo $@")]),e._v(" "),_("p",[e._v('DEBUG echo "===Begin Failover==="\n#If Master')]),e._v(" "),_("p",[e._v("if [ ${MASTERIP} = ${MYIP} ]; then")]),e._v(" "),_("p",[e._v("#Disable RDB")]),e._v(" "),_("p",[e._v('redis-cli -h ${MYIP} -p ${MASTERPORT} -a c1m2b3c4 config set save ""\nDEBUG echo ${MYIP}')]),e._v(" "),_("p",[e._v('DEBUG echo "Disable Master RDB:" ${MYIP} ${MASTERPORT}\nDEBUG echo "===End Failover==="')]),e._v(" "),_("p",[e._v("exit 0")]),e._v(" "),_("p",[e._v("#Or Slave\nelse")]),e._v(" "),_("p",[e._v('echo "test5" >> $DEBUGFILE')]),e._v(" "),_("p",[e._v('redis-cli -h ${MYIP} -p ${SLAVEPORT} -a c1m2b3c4 config set save "900 1 300 10')]),e._v(" "),_("p",[e._v('60 100000000"')]),e._v(" "),_("p",[e._v("DEBUG echo ${MYIP}")]),e._v(" "),_("p",[e._v('DEBUG echo "Enable Slave RDB:" ${MYIP} ${SLAVEPORT}\nDEBUG echo "===End Failover==="')]),e._v(" "),_("p",[e._v("exit 0")]),e._v(" "),_("p",[e._v("fi\nexit 1")]),e._v(" "),_("p",[e._v("åŸç†å’ŒVIPåˆ‡æ¢ä¸€èŠ‚åŸºæœ¬ä¸€è‡´ï¼Œä¸å†èµ˜è¿°ã€‚")]),e._v(" "),_("p",[e._v("250")]),e._v(" "),_("p",[e._v("å…¶ä»–é—®é¢˜")]),e._v(" "),_("p",[e._v("251")]),e._v(" "),_("p",[e._v("å…¶ä»–é—®é¢˜")]),e._v(" "),_("p",[e._v("11.1.5.4 Sentinelæœ€å¤§è¿æ¥æ•°")]),e._v(" "),_("ol",[_("li",[e._v("é—®é¢˜æè¿°")])]),e._v(" "),_("p",[e._v("æŸå‡†ç”Ÿäº§ç³»ç»Ÿï¼Œæµ‹è¯•è¿è¡Œä¸€æ®µæ—¶é—´åç¨‹åºå’Œå‘½ä»¤è¡Œå·¥å…·è¿æ¥sentinelå‡æŠ¥é”™ï¼ŒæŠ¥é”™ä¿¡æ¯ä¸ºï¼š")]),e._v(" "),_("p",[e._v("jedis.exceptions.JedisDataException: ERR max number of clients reached")]),e._v(" "),_("p",[e._v("æ­¤æ—¶åº”ç”¨åˆ›å»ºredisæ–°è¿æ¥ç”±äºsentinelå·²ç»æ— æ³•å“åº”è€Œæ— æ³•æ‰¾åˆ°masterçš„IPä¸ç«¯å£ï¼Œå› æ­¤æ— æ³•\nè¿æ¥redisï¼Œå¹¶ä¸”æ­¤æ—¶å¦‚æœå‘ç”Ÿrediså®•æœºäº¦æ— æ³•è¿›è¡Œç”Ÿäº§åˆ‡æ¢ã€‚")]),e._v(" "),_("ol",{attrs:{start:"2"}},[_("li",[e._v("é—®é¢˜åˆæ­¥æ’æŸ¥è¿‡ç¨‹")])]),e._v(" "),_("p",[e._v("é¦–å…ˆï¼Œé€šè¿‡netstatå¯¹sentinelæ‰€ç›‘å¬ç«¯å£26379è¿›è¡Œè¿æ¥æ•°ç»Ÿè®¡ï¼Œæ­¤æ—¶è¿æ¥åˆ™æŠ¥é”™ã€‚å¦‚ä¸‹å›¾ï¼š")]),e._v(" "),_("p",[e._v("é€šè¿‡sentinelæœåŠ¡å™¨ç«¯ç»Ÿè®¡å‘ç°ï¼Œredis sentinel çš„è¿æ¥ä¸­å¤§éƒ¨åˆ†éƒ½æ˜¯æ¥è‡ªäºä¸¤å°éåŒç½‘æ®µï¼ˆä¸­\né—´æœ‰é˜²ç«å¢™ï¼‰çš„åº”ç”¨æœåŠ¡å™¨è¿æ¥ï¼ˆå‡ä¸ºEstablishedçŠ¶æ€ï¼‰ï¼Œå¹¶ä¸”æ¥è‡ªå…¶çš„è¿æ¥ä¹Ÿå¤§çº¦åŠä¸ªå°\næ—¶åç¨³æ­¥å¢åŠ ä¸€æ¬¡ï¼Œè€ŒåŒç½‘æ®µçš„åº”ç”¨æœåŠ¡å™¨è¿æ¥sentinelçš„è¿æ¥æ•°åŸºæœ¬ä¿æŒä¸€è‡´ã€‚æ’é™¤äº†åº”ç”¨\nçš„ç‰¹æ®Šæ€§ï¼ˆé‡‡ç”¨çš„jedisç‰ˆæœ¬å’Œå°è£…çš„å·¥å…·ç±»éƒ½æ˜¯ä¸€æ ·çš„ï¼‰åï¼Œåˆæ­¥åˆ¤æ–­æ­¤é—®é¢˜ä¸ç½‘ç»œæœ‰å…³ï¼Œ\næ›´è¯¦ç»†çš„è¯´æ˜¯è¿æ¥æ•°å¢åŠ ä¸é˜²ç«å¢™åˆ‡æ–­è¿æ¥åçš„é‡è¿æœ‰å…³ã€‚")]),e._v(" "),_("ol",{attrs:{start:"3"}},[_("li",[e._v("é—®é¢˜æŸ¥è¯è¿‡ç¨‹")])]),e._v(" "),_("p",[e._v("æ­¤é—®é¢˜åˆ†ä¸ºä¸¤ä¸ªå­é—®é¢˜ï¼š 1) é˜²ç«å¢™å°†TCPè¿æ¥è®¾ç½®ä¸ºæ— æ•ˆæ—¶sentinelæœåŠ¡å™¨ä¸ºä½•æ²¡æœ‰æ–­å¼€è¿")]),e._v(" "),_("p",[e._v("æ¥ï¼Œä¿æŒEstablishedçŠ¶æ€ï¼Ÿ 2) ä¸ºä½•è¿æ¥æ•°è¿˜ä¼šä¸æ–­å¢åŠ ï¼Ÿ")]),e._v(" "),_("p",[e._v("å¯¹äºé—®é¢˜1) ï¼ŒTCPåœ¨ä¸‰æ¬¡æ¡æ‰‹å»º è¿æ¥æ—¶OSä¼šå¯åŠ¨ä¸€ä¸ªTimeræ¥è¿›è¡Œå€’è®¡æ—¶ï¼Œç»è¿‡ä¸€ä¸ªè®¾å®š\nçš„æ—¶é—´ï¼ˆè¿™ä¸ªæ—¶é—´å»º socketçš„ç¨‹åºå¯ä»¥è®¾ç½®ï¼Œå¦‚æœæ²¡æœ‰è®¾ç½®åˆ™é‡‡ç”¨OSçš„å‚æ•°\ntcp_keepalive_timeï¼Œ                                è¿™ä¸ªå‚æ•°é»˜è®¤ä¸º7200sï¼Œå³2å°æ—¶ï¼‰åè¿™ä¸ªè¿æ¥è¿˜æ˜¯æ²¡æœ‰æ•°æ®ä¼ è¾“ï¼Œå®ƒå°±\nä¼šä»¥ä¸€å®šé—´éš”ï¼ˆç¨‹åºå¯ä»¥è®¾å®šï¼Œå¦‚æœæ²¡æœ‰è®¾ç½®åˆ™é‡‡ç”¨OSçš„å‚æ•°tcp_keepalive_intvlï¼Œé»˜è®¤ä¸º\n75sï¼‰å‘å‡ºNï¼ˆç¨‹åºå¯ä»¥è®¾å®šï¼Œå¦‚æœæ²¡æœ‰è®¾ç½®åˆ™é‡‡ç”¨OSçš„å‚æ•°tcp_keepalive_probesï¼Œé»˜è®¤ä¸º\n9æ¬¡ï¼‰æ¬¡Keep AliveåŒ…ã€‚TCPè¿æ¥å°±æ˜¯é€šè¿‡ä¸Šè¿°çš„è¿‡ç¨‹ï¼Œåœ¨æ²¡æœ‰æµé‡æ—¶æ˜¯é€šè¿‡å‘é€TCP Keep-")]),e._v(" "),_("p",[e._v("252")]),e._v(" "),_("p",[e._v("å…¶ä»–é—®é¢˜")]),e._v(" "),_("p",[e._v("Aliveæ•°æ®åŒ…ï¼Œç„¶åå¯¹æ–¹å›åº”TCP Keep-Alive ACKæ¥ç¡®å®šä¿¡é“æ˜¯å¦è¿˜åœ¨çœŸå®è¿æ¥ã€‚é€šè¿‡æŸ¥çœ‹\nSentinelæºä»£ç ï¼Œå…¶é»˜è®¤æ˜¯ä¸å¼€å¯Keepaliveçš„ï¼ˆè€Œjedisé»˜è®¤æ˜¯å¼€å¯çš„ï¼‰ï¼Œå¹¶ä¸”é»˜è®¤å¯¹äºä¸æ´»\nåŠ¨çš„è¿æ¥ä¹Ÿä¸ä¼šä¸»åŠ¨å…³é—­çš„ï¼ˆtimeouté»˜è®¤ä¸º0ï¼‰ã€‚")]),e._v(" "),_("p",[e._v("å¯¹äºé˜²ç«å¢™ï¼Œé€šè¿‡ç¿»é˜…é˜²ç«å¢™æŠ€æœ¯èµ„æ–™ï¼ˆè¯¦è§ä¸‹åˆ—æè¿°ï¼Œæ‘˜è‡ªï¼šã€ŠJunos Enterprise\nSwitching: A Practical Guide to Junos Switches and Certificationã€‹ï¼‰ï¼Œæˆ‘å¸é‡‡ç”¨çš„Juniperé˜²\nç«å¢™å¯¹äºæ²¡æœ‰æµé‡çš„TCPè¿æ¥é»˜è®¤æ˜¯30åˆ†é’Ÿï¼Œ30åˆ†é’Ÿå†…æ²¡æœ‰æµé‡å°±ä¼šæ–­æ‰é“¾è·¯ï¼Œè€Œä¸ä¼šå‘é€\nTCP Resetï¼ŒåŒæ—¶åœ¨é˜²ç«å¢™ç­–ç•¥ä¸Šå¹¶æ²¡æœ‰å¼€é•¿è¿æ¥ï¼Œä½¿ç”¨çš„å³ä¸ºæ­¤é»˜è®¤è®¾ç½®ã€‚")]),e._v(" "),_("p",[e._v("å› æ­¤åœ¨é˜²ç«å¢™æ¯åŠä¸ªå°æ—¶å°†è¿æ¥ç½®ä¸ºæ— æ•ˆæ—¶ï¼ŒsentinelåŒæ—¶åˆç¦æ­¢äº†Keepaliveï¼ˆå› ä¸ºé»˜è®¤è®¾ç½®\nKeepaliveä¸º0ï¼Œå³disableå‘é€KeepaliveåŒ…ï¼‰ã€‚åº”ç”¨æœåŠ¡å™¨çš„jedisè™½ç„¶å¼€å¯äº†keepaliveï¼Œä½†æ˜¯\nå®ƒå‘é€çš„keepaliveåŒ…ç”±äºé˜²ç«å¢™å·²ç»å°†æ­¤é“¾è·¯æ ‡è®°ä¸ºæ— æ•ˆï¼Œè€Œæ— æ³•å‘é€åˆ°sentinelç«¯ï¼Œè€Œä¸”\njedisç”±äºé‡‡ç”¨äº†OSé»˜è®¤å‚æ•°ï¼Œå› æ­¤éœ€è¦ç­‰å¾…tcp_keepalive_timeï¼ˆ2å°æ—¶ï¼‰åæ‰å¯åŠ¨å‘é€\nKeep AliveåŒ…è¿›è¡Œæ¢æ´»çš„ï¼Œåœ¨\ntcp_keepalive_time+tcp_keepalive_intvl*tcp_keepalive_probes=7895s=131.58åˆ†é’Ÿåï¼Œjedis\nç«¯æ‰ä¼šè®¤å®šè¿™ä¸ªè¿æ¥æ–­æ‰è€Œæ¸…ç†æ‰è¿™ä¸ªè¿æ¥ã€‚ç®€å•çš„è¯´å°±æ˜¯jedisä¼šåœ¨å¾ˆé•¿ä¸€æ®µæ—¶é—´åæ‰ä¼šå‘\nkeepaliveåŒ…ï¼Œå¹¶ä¸”è¿™ä¸ªåŒ…ä¹Ÿæ˜¯å‘ä¸åˆ°sentinelä¸Šçš„ï¼Œè€Œsentinelæœ¬èº«ä¹Ÿä¸ä¼šå‘é€keepaliveåŒ…ï¼Œ\næ‰€ä»¥ä»sentinelè¿™ç«¯çœ‹è¿æ¥ä¸€ç›´å­˜åœ¨ï¼Œè€Œä»jedisé‚£ç«¯çœ‹7895sä¹‹åå°±ä¼šæ¸…ç†ä¸€æ¬¡è¿æ¥ã€‚è¿™ä¹Ÿè§£\né‡Šäº†ä¸ºä»€ä¹ˆé˜²ç«å¢™å°†TCPè¿æ¥æ–­å¼€åï¼Œsentinelç«¯çš„è¿æ¥å¹¶æ²¡æœ‰é‡Šæ”¾ã€‚")]),e._v(" "),_("p",[e._v("å¯¹äºé—®é¢˜2) ï¼Œç¿»é˜…jedisæºä»£ç ï¼Œjedisé€šè¿‡è¿æ¥sentinelå¹¶pubsubæ¥ç›‘å¬é›†ç¾¤äº‹ä»¶ï¼Œä»¥ç¡®å®šæ˜¯\nå¦å‘ç”Ÿäº†åˆ‡æ¢ï¼Œå¹¶ä¸”æ‹¿åˆ°æ–°çš„master åœ°å€å’Œç«¯å£ã€‚å¦‚æœæ–­å¼€åˆ™ä¼š5ç§’åå°è¯•é‡è¿")]),e._v(" "),_("p",[e._v("ï¼ˆJedisSentinelPool.javaï¼‰ã€‚")]),e._v(" "),_("p",[e._v("253")]),e._v(" "),_("p",[e._v("å…¶ä»–é—®é¢˜")]),e._v(" "),_("p",[e._v("å› æ­¤ï¼Œè¿™æ˜¯å¯¼è‡´è¿æ¥æ•°ä¸æ–­ä¸Šå‡çš„åŸå› ã€‚ ç»¼ä¸Šï¼Œé˜²ç«å¢™ç›¸å¯¹é¢‘ç¹çš„æ–­å¼€å’ŒæœåŠ¡å™¨ä¸æ–­é‡è¿å¯¼\nè‡´åœ¨ä¸€ä¸ªç›¸å¯¹è¾ƒçŸ­çš„æ—¶é—´å†…è¿æ¥éª¤å¢ï¼Œé€ æˆåˆ°è¾¾sentinelæœ€å¤§è¿æ¥æ•°ï¼Œsentinel çš„æœ€å¤§è¿æ¥æ•°\nåœ¨redis.hä¸­å®šä¹‰ï¼Œä¸º10000ï¼š")]),e._v(" "),_("ol",{attrs:{start:"4"}},[_("li",[e._v("é—®é¢˜è§£å†³è¿‡ç¨‹")])]),e._v(" "),_("p",[e._v("æ­¤ç³»ç»Ÿç”±äºè®¿é—®å…³ç³»ä¸ç½‘æ®µè§„åˆ’é—´çš„å®‰å…¨é—®é¢˜ï¼Œå¿…é¡»è·¨è¶Šé˜²ç«å¢™ï¼Œå› æ­¤è¯•å›¾ä»é…ç½®è§’åº¦è§£å†³\næ­¤é—®é¢˜ã€‚")]),e._v(" "),_("p",[e._v("é¦–å…ˆï¼Œè”ç³»ç½‘ç»œç›¸å…³åŒäº‹ï¼Œè¿›è¡Œç½‘ç»œå˜æ›´ï¼Œå¼€å¯ä»åº”ç”¨æœåŠ¡å™¨åˆ°sentinelçš„é“¾è·¯ç›¸å¯¹çš„é•¿è¿\næ¥ï¼Œå³æ— æµé‡è¶…æ—¶è€Œæ–­å¼€çš„æ—¶é—´è®¾ç½®ä¸º8å°æ—¶ã€‚ä»¥æ­¤æ‰‹æ®µé™ä½æ–­å¼€é¢‘ç‡ï¼Œä»¥ä¾¿ç¼“è§£çŸ­æ—¶é—´å†…ä¸\næ–­é‡è¯•è¿æ¥é€ æˆçš„sentinelè¿æ¥å¢é•¿ã€‚")]),e._v(" "),_("p",[e._v("ç„¶åï¼Œé€šè¿‡é˜…è¯»redisæºä»£ç ï¼ˆnet.cï¼‰ï¼Œå‘ç°ï¼Œsentinelä¹Ÿé‡‡ç”¨äº†redis æ‰€æœ‰å‚æ•°è®¾ç½®ï¼ˆé€šè¿‡\nconfig.cçš„å‡½æ•°void loadServerConfigFromString(char *config)ï¼‰ã€‚å› æ­¤ï¼Œé€šè¿‡è®¾ç½®redis çš„ä¸‹\nåˆ—ä¸¤ä¸ªå‚æ•°å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯TCP Keepaliveå‚æ•°ï¼Œæ­¤å‚æ•°é»˜è®¤ä¸º0ï¼Œä¹Ÿå°±æ˜¯\nä¸å‘é€keepaliveã€‚ä¹Ÿå°±æ˜¯æ”¹å˜OSé»˜è®¤çš„tcp_keepalive_timeå‚æ•°ï¼ˆåœ¨Unix Cçš„socketç¼–ç¨‹ä¸­\nTCP_KEEPIDLEå‚æ•°å¯¹åº”OS çš„tcp_keepalive_timeå‚æ•°ï¼‰ã€‚")]),e._v(" "),_("p",[e._v("è¯¥å‚æ•°çš„å®˜æ–¹è§£é‡Šä¸ºï¼š")]),e._v(" "),_("p",[e._v("254")]),e._v(" "),_("p",[e._v("å…¶ä»–é—®é¢˜")]),e._v(" "),_("h1",{attrs:{id:"tcp-keepalive"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#tcp-keepalive"}},[e._v("#")]),e._v(" TCP keepalive.")]),e._v(" "),_("h1",{attrs:{id:"-5"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#-5"}},[e._v("#")])]),e._v(" "),_("h1",{attrs:{id:"if-non-zero-use-so-keepalive-to-send-tcp-acks-to-clients-in-absence"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#if-non-zero-use-so-keepalive-to-send-tcp-acks-to-clients-in-absence"}},[e._v("#")]),e._v(" If non-zero, use SO_KEEPALIVE to send TCP ACKs to clients in absence")]),e._v(" "),_("h1",{attrs:{id:"of-communication-this-is-useful-for-two-reasons"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#of-communication-this-is-useful-for-two-reasons"}},[e._v("#")]),e._v(" of communication. This is useful for two reasons:")]),e._v(" "),_("h1",{attrs:{id:"-6"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#-6"}},[e._v("#")])]),e._v(" "),_("h1",{attrs:{id:"_1-detect-dead-peers"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#_1-detect-dead-peers"}},[e._v("#")]),e._v(" 1) Detect dead peers.")]),e._v(" "),_("h1",{attrs:{id:"_2-take-the-connection-alive-from-the-point-of-view-of-network"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#_2-take-the-connection-alive-from-the-point-of-view-of-network"}},[e._v("#")]),e._v(" 2) Take the connection alive from the point of view of network")]),e._v(" "),_("h1",{attrs:{id:"equipment-in-the-middle"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#equipment-in-the-middle"}},[e._v("#")]),e._v(" equipment in the middle.")]),e._v(" "),_("h1",{attrs:{id:"-7"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#-7"}},[e._v("#")])]),e._v(" "),_("h1",{attrs:{id:"on-linux-the-specified-value-in-seconds-is-the-period-used-to-send-acks"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#on-linux-the-specified-value-in-seconds-is-the-period-used-to-send-acks"}},[e._v("#")]),e._v(" On Linux, the specified value (in seconds) is the period used to send ACKs.")]),e._v(" "),_("h1",{attrs:{id:"note-that-to-close-the-connection-the-double-of-the-time-is-needed"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#note-that-to-close-the-connection-the-double-of-the-time-is-needed"}},[e._v("#")]),e._v(" Note that to close the connection the double of the time is needed.")]),e._v(" "),_("h1",{attrs:{id:"on-other-kernels-the-period-depends-on-the-kernel-configuration"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#on-other-kernels-the-period-depends-on-the-kernel-configuration"}},[e._v("#")]),e._v(" On other kernels the period depends on the kernel configuration.")]),e._v(" "),_("h1",{attrs:{id:"-8"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#-8"}},[e._v("#")])]),e._v(" "),_("h1",{attrs:{id:"a-reasonable-value-for-this-option-is-60-seconds"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#a-reasonable-value-for-this-option-is-60-seconds"}},[e._v("#")]),e._v(" A reasonable value for this option is 60 seconds.")]),e._v(" "),_("p",[e._v("æˆ‘ä»¬è®¾ç½®ä¸ºtcp-keepalive 60ï¼ŒåŠ å¿«å›æ”¶è¿æ¥é€Ÿåº¦ï¼Œä»ç½‘ç»œæ–­å¼€åˆ°è¿æ¥æ¸…ç†æ—¶é—´ç¼©çŸ­ä¸º\n60+75*9=12.25åˆ†é’Ÿã€‚")]),e._v(" "),_("p",[e._v("åŒæ—¶ï¼Œé€šè¿‡è®¾ç½®maxclientsä¸º65536ï¼Œå¢å¤§sentinelæœ€å¤§è¿æ¥æ•°ï¼Œä½¿å¾—åœ¨ä¸Šè¿°12.25åˆ†é’Ÿå³ä½¿æœ‰\næŸç§å¼‚å¸¸å¯¼è‡´sentinelè¿æ¥æ•°å¢åŠ ä¹Ÿä¸è‡³äºåˆ°è¾¾æœ€å¤§é™åˆ¶ã€‚æ­¤å‚æ•°çš„å®˜æ–¹è§£é‡Šä¸ºï¼š")]),e._v(" "),_("p",[e._v("################################### LIMITS ####################################")]),e._v(" "),_("h1",{attrs:{id:"set-the-max-number-of-connected-clients-at-the-same-time-by-default"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#set-the-max-number-of-connected-clients-at-the-same-time-by-default"}},[e._v("#")]),e._v(" Set the max number of connected clients at the same time. By default")]),e._v(" "),_("h1",{attrs:{id:"this-limit-is-set-to-10000-clients-however-if-the-redis-server-is-not"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#this-limit-is-set-to-10000-clients-however-if-the-redis-server-is-not"}},[e._v("#")]),e._v(" this limit is set to 10000 clients, however if the Redis server is not")]),e._v(" "),_("h1",{attrs:{id:"able-to-configure-the-process-file-limit-to-allow-for-the-specified-limit"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#able-to-configure-the-process-file-limit-to-allow-for-the-specified-limit"}},[e._v("#")]),e._v(" able to configure the process file limit to allow for the specified limit")]),e._v(" "),_("h1",{attrs:{id:"the-max-number-of-allowed-clients-is-set-to-the-current-file-limit"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#the-max-number-of-allowed-clients-is-set-to-the-current-file-limit"}},[e._v("#")]),e._v(" the max number of allowed clients is set to the current file limit")]),e._v(" "),_("h1",{attrs:{id:"minus-32-as-redis-reserves-a-few-file-descriptors-for-internal-uses"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#minus-32-as-redis-reserves-a-few-file-descriptors-for-internal-uses"}},[e._v("#")]),e._v(" minus 32 (as Redis reserves a few file descriptors for internal uses).")]),e._v(" "),_("h1",{attrs:{id:"-9"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#-9"}},[e._v("#")])]),e._v(" "),_("h1",{attrs:{id:"once-the-limit-is-reached-redis-will-close-all-the-new-connections-sending"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#once-the-limit-is-reached-redis-will-close-all-the-new-connections-sending"}},[e._v("#")]),e._v(" Once the limit is reached Redis will close all the new connections sending")]),e._v(" "),_("h1",{attrs:{id:"an-error-max-number-of-clients-reached"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#an-error-max-number-of-clients-reached"}},[e._v("#")]),e._v(" an error 'max number of clients reached'.")]),e._v(" "),_("h1",{attrs:{id:"-10"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#-10"}},[e._v("#")])]),e._v(" "),_("p",[e._v("maxclients 10000")]),e._v(" "),_("p",[e._v("å¯¹äºredis çš„timeoutå‚æ•°ï¼Œç”±äºå¯ç”¨è¿™ä¸ªå‚æ•°æœ‰ç¨‹åºå¾®å°å¼€é”€ï¼ˆä¼šè°ƒç”¨redis.cä¸­çš„int\nclientsCronHandleTimeout(redisClient *c, mstime_t now_ms)ï¼‰ï¼Œå†³å®šä¿æŒé»˜è®¤ä¸º0ï¼Œè€Œé€šè¿‡\nä¸Šè¿°å‚æ•°ä½¿ç”¨OSè¿›è¡Œè¿æ¥æ–­å¼€ã€‚")]),e._v(" "),_("ol",{attrs:{start:"5"}},[_("li",[e._v("é—®é¢˜è§£å†³ç»“æœ")])]),e._v(" "),_("p",[e._v("é€šè¿‡å¼€å‘ã€ç½‘ç»œå’Œæ•°æ®åº“å›¢é˜Ÿçš„ååŒåŠªåŠ›ï¼Œé…ç½®ä¸Šè¿°å‚æ•°å’Œä¿®æ”¹é˜²ç«å¢™ç­–ç•¥åï¼Œæ‰‹åŠ¨å¢åŠ \nsentinelè¿›ç¨‹ï¼Œè¶…è¿‡åŸé»˜è®¤æœ€å¤§è¿æ¥æ•°10000åsentinelå¯ä»¥æ­£å¸¸è®¿é—®æ“ä½œï¼Œå¹¶ä¸”é€šè¿‡tcpdump\nè¿›è¡ŒæŠ“åŒ…ï¼Œåœ¨æŒ‡å®šæ—¶é—´å†…ï¼ˆ1åˆ†é’Ÿï¼‰ï¼Œå°±æœ‰KeepAliveåŒ…å¯¹æ¯ä¸ªsentinel TCPè¿æ¥è¿›è¡Œæ¢æ´»ï¼Œç»\nè¿‡è§‚å¯Ÿsentinelè¿æ¥ç¨³å®šï¼Œå†æœªå‡ºç°çŸ­æ—¶é—´å†…æš´æ¶¨çš„æƒ…å†µã€‚")]),e._v(" "),_("p",[e._v("255")]),e._v(" "),_("p",[e._v("å…¶ä»–é—®é¢˜")]),e._v(" "),_("ol",{attrs:{start:"6"}},[_("li",[e._v("é—®é¢˜åç»­")])]),e._v(" "),_("p",[e._v("åœ¨redisä¸­é»˜è®¤ä¸å¼€å¯keepaliveå°±æ˜¯ä¸ºäº†å°½å¯èƒ½å‡å°ç½‘ç»œè´Ÿè½½ï¼Œæ¦¨å¹²ç½‘ç»œæ€§èƒ½ï¼Œå°½å¯èƒ½è¾¾åˆ°\nredisçš„ã€‚åœ¨åç»­çš„ç¨‹åºè¿è¡Œä¸­ï¼Œå¦‚æœå‘ç°ç½‘ç»œæ˜¯ç“¶é¢ˆæ—¶ï¼ˆåœ¨ç›¸å½“é•¿çš„ä¸€æ®µæ—¶é—´å†…ä¸ä¼šï¼‰ï¼Œå¯\nä»¥åŠ å¤§sentinelçš„keepaliveå‚æ•°ï¼Œå‡å°keepaliveæ•°æ®åŒ…çš„ä¼ è¾“ï¼Œè¿™ä¸ªä¿®æ”¹æ˜¯ä¸å½±å“rediså¯¹å¤–\næœåŠ¡çš„ã€‚")]),e._v(" "),_("p",[e._v("å‚è€ƒæ–‡æ¡£ï¼š http://www.tldp.org/HOWTO/html_single/TCP-Keepalive-HOWTO/")]),e._v(" "),_("p",[e._v("é™„å½•ï¼šå¦‚ä½•ç”¨TCPDUMPè¿›è¡Œkeep aliveæŠ“åŒ…")]),e._v(" "),_("p",[e._v('tcpdump -pni bond0 -v "src port 26379 and ( tcp[tcpflags] & tcp-ack != 0 and ( (ip[2:2')]),e._v(" "),_("p",[e._v('] - ((ip[0]&0xf)<<2) ) - ((tcp[12]&0xf0)>>2) ) == 0 ) "')]),e._v(" "),_("ol",{attrs:{start:"7"}},[_("li",[e._v("é—®é¢˜å†åç»­")])]),e._v(" "),_("p",[e._v("æˆ‘ä»¬åæ¥åœ¨è¿™ä¸ªåº”ç”¨ä¸Šå‘ç°ä¸€æ—¦ç½‘ç»œæœ‰æŠ–åŠ¨ï¼Œsentinelçš„è¿æ¥å¢åŠ å°±å›å¤§å¹…åº¦å¢åŠ ï¼Œåæ¥é€šè¿‡\njmapæŸ¥çœ‹sentinelpoolçš„å®ä¾‹ç«Ÿç„¶å¤šè¾¾200å¤šä¸ªï¼Œä¹Ÿå°±æ˜¯è¯´è¿™ä¸ªå°±æ˜¯ç¨‹åºçš„é—®é¢˜ï¼Œåœ¨\nsentinelpoolä¸Šä¸åº”è¯¥å¤šæ¬¡å®ä¾‹åŒ–ï¼Œè€Œæ˜¯é‡‡ç”¨å·²æœ‰è¿æ¥è¿›è¡Œé‡è¿ã€‚")]),e._v(" "),_("p",[e._v("256")])])}),[],!1,null,null,null);v.default=t.exports}}]);