<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>第九章 CAS | Java全栈</title>
    <meta name="generator" content="VuePress 1.8.2">
    
    <meta name="description" content="Java 基础, Java 部分源码, JVM, Spring, Spring Boot, Spring Cloud, 数据库原理, MySQL, ElasticSearch, Docker, Linux, 分布式, 中间件, Git">
    
    <link rel="preload" href="/javanote/assets/css/0.styles.1d83b9a0.css" as="style"><link rel="preload" href="/javanote/assets/js/app.4d8a0605.js" as="script"><link rel="preload" href="/javanote/assets/js/11.31b4bfe5.js" as="script"><link rel="preload" href="/javanote/assets/js/92.69a38839.js" as="script"><link rel="prefetch" href="/javanote/assets/js/10.c191a387.js"><link rel="prefetch" href="/javanote/assets/js/100.f858324b.js"><link rel="prefetch" href="/javanote/assets/js/101.cf545769.js"><link rel="prefetch" href="/javanote/assets/js/102.70c05b3a.js"><link rel="prefetch" href="/javanote/assets/js/103.f1004525.js"><link rel="prefetch" href="/javanote/assets/js/104.0d76607f.js"><link rel="prefetch" href="/javanote/assets/js/105.1706f100.js"><link rel="prefetch" href="/javanote/assets/js/106.c2ff977c.js"><link rel="prefetch" href="/javanote/assets/js/107.5aede27e.js"><link rel="prefetch" href="/javanote/assets/js/108.8ceb754f.js"><link rel="prefetch" href="/javanote/assets/js/109.0921def7.js"><link rel="prefetch" href="/javanote/assets/js/110.1b5f3a78.js"><link rel="prefetch" href="/javanote/assets/js/111.60c4a726.js"><link rel="prefetch" href="/javanote/assets/js/112.a779216c.js"><link rel="prefetch" href="/javanote/assets/js/113.b5d94b79.js"><link rel="prefetch" href="/javanote/assets/js/114.c6f877f7.js"><link rel="prefetch" href="/javanote/assets/js/115.47ecb381.js"><link rel="prefetch" href="/javanote/assets/js/116.92ec84e7.js"><link rel="prefetch" href="/javanote/assets/js/117.e4829b5a.js"><link rel="prefetch" href="/javanote/assets/js/118.b23c1a98.js"><link rel="prefetch" href="/javanote/assets/js/119.b43f94dd.js"><link rel="prefetch" href="/javanote/assets/js/12.fa4003f9.js"><link rel="prefetch" href="/javanote/assets/js/120.f30ed6c6.js"><link rel="prefetch" href="/javanote/assets/js/121.b0022ef6.js"><link rel="prefetch" href="/javanote/assets/js/122.8fffcc78.js"><link rel="prefetch" href="/javanote/assets/js/123.e3fa7a42.js"><link rel="prefetch" href="/javanote/assets/js/124.58e10cb2.js"><link rel="prefetch" href="/javanote/assets/js/125.1b49d5f0.js"><link rel="prefetch" href="/javanote/assets/js/126.7f8e276b.js"><link rel="prefetch" href="/javanote/assets/js/127.000a6e84.js"><link rel="prefetch" href="/javanote/assets/js/128.18177328.js"><link rel="prefetch" href="/javanote/assets/js/129.0a2b7f4e.js"><link rel="prefetch" href="/javanote/assets/js/13.c51f2bed.js"><link rel="prefetch" href="/javanote/assets/js/130.31bfbbdd.js"><link rel="prefetch" href="/javanote/assets/js/131.dab5fd7f.js"><link rel="prefetch" href="/javanote/assets/js/132.34fb1d32.js"><link rel="prefetch" href="/javanote/assets/js/133.3cc3cb6c.js"><link rel="prefetch" href="/javanote/assets/js/134.8b0d230c.js"><link rel="prefetch" href="/javanote/assets/js/135.905e9937.js"><link rel="prefetch" href="/javanote/assets/js/136.23e19c54.js"><link rel="prefetch" href="/javanote/assets/js/137.3c091787.js"><link rel="prefetch" href="/javanote/assets/js/138.83313b98.js"><link rel="prefetch" href="/javanote/assets/js/139.c8e9d90b.js"><link rel="prefetch" href="/javanote/assets/js/14.8fe80835.js"><link rel="prefetch" href="/javanote/assets/js/140.de3bddcd.js"><link rel="prefetch" href="/javanote/assets/js/141.1575c6e3.js"><link rel="prefetch" href="/javanote/assets/js/142.a6471307.js"><link rel="prefetch" href="/javanote/assets/js/143.ad7eb666.js"><link rel="prefetch" href="/javanote/assets/js/144.c43ced04.js"><link rel="prefetch" href="/javanote/assets/js/145.633601ea.js"><link rel="prefetch" href="/javanote/assets/js/146.b65b7a43.js"><link rel="prefetch" href="/javanote/assets/js/147.f6ba557e.js"><link rel="prefetch" href="/javanote/assets/js/148.046226ae.js"><link rel="prefetch" href="/javanote/assets/js/149.0ad83751.js"><link rel="prefetch" href="/javanote/assets/js/15.414ac078.js"><link rel="prefetch" href="/javanote/assets/js/150.230e4d1c.js"><link rel="prefetch" href="/javanote/assets/js/151.905804f3.js"><link rel="prefetch" href="/javanote/assets/js/152.154b514a.js"><link rel="prefetch" href="/javanote/assets/js/153.37aa1b21.js"><link rel="prefetch" href="/javanote/assets/js/154.76fcd840.js"><link rel="prefetch" href="/javanote/assets/js/155.684e2d46.js"><link rel="prefetch" href="/javanote/assets/js/156.2288654a.js"><link rel="prefetch" href="/javanote/assets/js/157.9550ddf7.js"><link rel="prefetch" href="/javanote/assets/js/158.6f176501.js"><link rel="prefetch" href="/javanote/assets/js/159.38b45246.js"><link rel="prefetch" href="/javanote/assets/js/16.f6bcfda9.js"><link rel="prefetch" href="/javanote/assets/js/160.24484228.js"><link rel="prefetch" href="/javanote/assets/js/161.f8a53ea7.js"><link rel="prefetch" href="/javanote/assets/js/162.91a5d72d.js"><link rel="prefetch" href="/javanote/assets/js/163.2ad88c09.js"><link rel="prefetch" href="/javanote/assets/js/164.4cefc831.js"><link rel="prefetch" href="/javanote/assets/js/165.96d54d27.js"><link rel="prefetch" href="/javanote/assets/js/166.3ced3f05.js"><link rel="prefetch" href="/javanote/assets/js/167.9fd4dada.js"><link rel="prefetch" href="/javanote/assets/js/168.64063340.js"><link rel="prefetch" href="/javanote/assets/js/169.49eefc79.js"><link rel="prefetch" href="/javanote/assets/js/17.5ebaaa3f.js"><link rel="prefetch" href="/javanote/assets/js/170.3938afd5.js"><link rel="prefetch" href="/javanote/assets/js/171.5eb5c5a0.js"><link rel="prefetch" href="/javanote/assets/js/172.a9e33ea2.js"><link rel="prefetch" href="/javanote/assets/js/173.98e6d831.js"><link rel="prefetch" href="/javanote/assets/js/174.03448352.js"><link rel="prefetch" href="/javanote/assets/js/175.64340ac0.js"><link rel="prefetch" href="/javanote/assets/js/176.2dc52060.js"><link rel="prefetch" href="/javanote/assets/js/177.bd69843e.js"><link rel="prefetch" href="/javanote/assets/js/178.59341490.js"><link rel="prefetch" href="/javanote/assets/js/179.cc35c0a6.js"><link rel="prefetch" href="/javanote/assets/js/18.62d03701.js"><link rel="prefetch" href="/javanote/assets/js/180.11ae1e52.js"><link rel="prefetch" href="/javanote/assets/js/181.3e438e5d.js"><link rel="prefetch" href="/javanote/assets/js/182.c53a8efc.js"><link rel="prefetch" href="/javanote/assets/js/183.8b441dfb.js"><link rel="prefetch" href="/javanote/assets/js/184.d7f6c4f5.js"><link rel="prefetch" href="/javanote/assets/js/185.b439d0f4.js"><link rel="prefetch" href="/javanote/assets/js/186.b68e5585.js"><link rel="prefetch" href="/javanote/assets/js/187.56de8200.js"><link rel="prefetch" href="/javanote/assets/js/188.841fcdf2.js"><link rel="prefetch" href="/javanote/assets/js/189.be2262c2.js"><link rel="prefetch" href="/javanote/assets/js/19.0efb6573.js"><link rel="prefetch" href="/javanote/assets/js/190.40a63f47.js"><link rel="prefetch" href="/javanote/assets/js/191.a61a7c80.js"><link rel="prefetch" href="/javanote/assets/js/192.88507421.js"><link rel="prefetch" href="/javanote/assets/js/193.d0a95520.js"><link rel="prefetch" href="/javanote/assets/js/194.c66644e0.js"><link rel="prefetch" href="/javanote/assets/js/195.fdaceef8.js"><link rel="prefetch" href="/javanote/assets/js/196.85a1da29.js"><link rel="prefetch" href="/javanote/assets/js/197.a0b73b7e.js"><link rel="prefetch" href="/javanote/assets/js/198.c46de3af.js"><link rel="prefetch" href="/javanote/assets/js/199.86ad5ea9.js"><link rel="prefetch" href="/javanote/assets/js/2.8a34de3e.js"><link rel="prefetch" href="/javanote/assets/js/20.25232ae5.js"><link rel="prefetch" href="/javanote/assets/js/200.3d524295.js"><link rel="prefetch" href="/javanote/assets/js/201.2352b044.js"><link rel="prefetch" href="/javanote/assets/js/202.c96b8ae2.js"><link rel="prefetch" href="/javanote/assets/js/203.344e4887.js"><link rel="prefetch" href="/javanote/assets/js/204.cedde8a4.js"><link rel="prefetch" href="/javanote/assets/js/205.76202206.js"><link rel="prefetch" href="/javanote/assets/js/206.c4406aa6.js"><link rel="prefetch" href="/javanote/assets/js/207.8a27b698.js"><link rel="prefetch" href="/javanote/assets/js/208.59f5b615.js"><link rel="prefetch" href="/javanote/assets/js/209.fd4a6c64.js"><link rel="prefetch" href="/javanote/assets/js/21.d432caaa.js"><link rel="prefetch" href="/javanote/assets/js/210.b0e3a8d1.js"><link rel="prefetch" href="/javanote/assets/js/211.7cb84367.js"><link rel="prefetch" href="/javanote/assets/js/212.e743f232.js"><link rel="prefetch" href="/javanote/assets/js/213.d50db884.js"><link rel="prefetch" href="/javanote/assets/js/214.6da86c20.js"><link rel="prefetch" href="/javanote/assets/js/215.fd5aa565.js"><link rel="prefetch" href="/javanote/assets/js/216.e95bcc55.js"><link rel="prefetch" href="/javanote/assets/js/217.2231449c.js"><link rel="prefetch" href="/javanote/assets/js/218.b8330003.js"><link rel="prefetch" href="/javanote/assets/js/219.aa7e9cf0.js"><link rel="prefetch" href="/javanote/assets/js/22.53113347.js"><link rel="prefetch" href="/javanote/assets/js/220.9ff6e0e6.js"><link rel="prefetch" href="/javanote/assets/js/23.2238c07a.js"><link rel="prefetch" href="/javanote/assets/js/24.cb7d3039.js"><link rel="prefetch" href="/javanote/assets/js/25.b4eaea24.js"><link rel="prefetch" href="/javanote/assets/js/26.e42a49f7.js"><link rel="prefetch" href="/javanote/assets/js/27.e7587f1f.js"><link rel="prefetch" href="/javanote/assets/js/28.19eae749.js"><link rel="prefetch" href="/javanote/assets/js/29.9ddf7186.js"><link rel="prefetch" href="/javanote/assets/js/3.e91a84a2.js"><link rel="prefetch" href="/javanote/assets/js/30.a380d83f.js"><link rel="prefetch" href="/javanote/assets/js/31.02c44506.js"><link rel="prefetch" href="/javanote/assets/js/32.e4bff71a.js"><link rel="prefetch" href="/javanote/assets/js/33.e26b4f6b.js"><link rel="prefetch" href="/javanote/assets/js/34.187f65f5.js"><link rel="prefetch" href="/javanote/assets/js/35.6cd623a3.js"><link rel="prefetch" href="/javanote/assets/js/36.c018db78.js"><link rel="prefetch" href="/javanote/assets/js/37.fd665c05.js"><link rel="prefetch" href="/javanote/assets/js/38.123aa35e.js"><link rel="prefetch" href="/javanote/assets/js/39.58271e1f.js"><link rel="prefetch" href="/javanote/assets/js/4.953d09eb.js"><link rel="prefetch" href="/javanote/assets/js/40.d588f7b4.js"><link rel="prefetch" href="/javanote/assets/js/41.330ac4ba.js"><link rel="prefetch" href="/javanote/assets/js/42.4d2bcc61.js"><link rel="prefetch" href="/javanote/assets/js/43.e446c0f3.js"><link rel="prefetch" href="/javanote/assets/js/44.77abc34b.js"><link rel="prefetch" href="/javanote/assets/js/45.910e4aa5.js"><link rel="prefetch" href="/javanote/assets/js/46.7f8fd6bb.js"><link rel="prefetch" href="/javanote/assets/js/47.9e340085.js"><link rel="prefetch" href="/javanote/assets/js/48.b4c35e1e.js"><link rel="prefetch" href="/javanote/assets/js/49.807495b7.js"><link rel="prefetch" href="/javanote/assets/js/5.fe579469.js"><link rel="prefetch" href="/javanote/assets/js/50.71cfb288.js"><link rel="prefetch" href="/javanote/assets/js/51.8da13592.js"><link rel="prefetch" href="/javanote/assets/js/52.cf90a64f.js"><link rel="prefetch" href="/javanote/assets/js/53.c685fb7a.js"><link rel="prefetch" href="/javanote/assets/js/54.7d73666a.js"><link rel="prefetch" href="/javanote/assets/js/55.59497bd7.js"><link rel="prefetch" href="/javanote/assets/js/56.22cdda6e.js"><link rel="prefetch" href="/javanote/assets/js/57.36f6ee91.js"><link rel="prefetch" href="/javanote/assets/js/58.6655543d.js"><link rel="prefetch" href="/javanote/assets/js/59.1d073e32.js"><link rel="prefetch" href="/javanote/assets/js/6.1af208a0.js"><link rel="prefetch" href="/javanote/assets/js/60.f782c216.js"><link rel="prefetch" href="/javanote/assets/js/61.4f05bcba.js"><link rel="prefetch" href="/javanote/assets/js/62.d607ed0e.js"><link rel="prefetch" href="/javanote/assets/js/63.0d7a42e8.js"><link rel="prefetch" href="/javanote/assets/js/64.ce15498e.js"><link rel="prefetch" href="/javanote/assets/js/65.b9f31598.js"><link rel="prefetch" href="/javanote/assets/js/66.aeff3690.js"><link rel="prefetch" href="/javanote/assets/js/67.f6f59ffa.js"><link rel="prefetch" href="/javanote/assets/js/68.f875e4ca.js"><link rel="prefetch" href="/javanote/assets/js/69.d6512b6b.js"><link rel="prefetch" href="/javanote/assets/js/7.5739f4db.js"><link rel="prefetch" href="/javanote/assets/js/70.881dc1cf.js"><link rel="prefetch" href="/javanote/assets/js/71.263db750.js"><link rel="prefetch" href="/javanote/assets/js/72.58f08a97.js"><link rel="prefetch" href="/javanote/assets/js/73.df9399d4.js"><link rel="prefetch" href="/javanote/assets/js/74.1d6ddc56.js"><link rel="prefetch" href="/javanote/assets/js/75.fcb30922.js"><link rel="prefetch" href="/javanote/assets/js/76.46a74eb4.js"><link rel="prefetch" href="/javanote/assets/js/77.b5e7728c.js"><link rel="prefetch" href="/javanote/assets/js/78.fcc34355.js"><link rel="prefetch" href="/javanote/assets/js/79.9d5204da.js"><link rel="prefetch" href="/javanote/assets/js/8.26c83b6c.js"><link rel="prefetch" href="/javanote/assets/js/80.672a4f74.js"><link rel="prefetch" href="/javanote/assets/js/81.78acaf25.js"><link rel="prefetch" href="/javanote/assets/js/82.7755c8c3.js"><link rel="prefetch" href="/javanote/assets/js/83.9b495285.js"><link rel="prefetch" href="/javanote/assets/js/84.a1270bb3.js"><link rel="prefetch" href="/javanote/assets/js/85.64d4eb9a.js"><link rel="prefetch" href="/javanote/assets/js/86.9cd6604e.js"><link rel="prefetch" href="/javanote/assets/js/87.588e06ac.js"><link rel="prefetch" href="/javanote/assets/js/88.8dad582a.js"><link rel="prefetch" href="/javanote/assets/js/89.b19689ac.js"><link rel="prefetch" href="/javanote/assets/js/9.51e5d2e7.js"><link rel="prefetch" href="/javanote/assets/js/90.586b9559.js"><link rel="prefetch" href="/javanote/assets/js/91.c9188033.js"><link rel="prefetch" href="/javanote/assets/js/93.f0c9bdcd.js"><link rel="prefetch" href="/javanote/assets/js/94.f8f6b855.js"><link rel="prefetch" href="/javanote/assets/js/95.a92c2c02.js"><link rel="prefetch" href="/javanote/assets/js/96.ab442531.js"><link rel="prefetch" href="/javanote/assets/js/97.8a60e627.js"><link rel="prefetch" href="/javanote/assets/js/98.3eed55eb.js"><link rel="prefetch" href="/javanote/assets/js/99.b9c138ea.js">
    <link rel="stylesheet" href="/javanote/assets/css/0.styles.1d83b9a0.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/javanote/" class="home-link router-link-active"><!----> <span class="site-name">Java全栈</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="基础" class="dropdown-title"><span class="title">基础</span> <span class="arrow down"></span></button> <button type="button" aria-label="基础" class="mobile-dropdown-title"><span class="title">基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/javanote/note/basic/java/day01/" class="nav-link">
  Java
</a></li><li class="dropdown-item"><!----> <a href="/javanote/note/basic/linux/background/" class="nav-link">
  linux
</a></li><li class="dropdown-item"><!----> <a href="/javanote/note/basic/mysql/mysql-basic/" class="nav-link">
  mysql
</a></li><li class="dropdown-item"><!----> <a href="/javanote/note/basic/web/WEBday01_HTML-CSS/" class="nav-link">
  web
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="高级" class="dropdown-title"><span class="title">高级</span> <span class="arrow down"></span></button> <button type="button" aria-label="高级" class="mobile-dropdown-title"><span class="title">高级</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/javanote/note/advance/juc/chapter01/" class="nav-link">
  JUC
</a></li><li class="dropdown-item"><!----> <a href="/javanote/note/advance/jvm/chapter01/" class="nav-link">
  JVM
</a></li><li class="dropdown-item"><!----> <a href="/javanote/note/advance/mysql/chapter01/" class="nav-link">
  MYSQL
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="中间件" class="dropdown-title"><span class="title">中间件</span> <span class="arrow down"></span></button> <button type="button" aria-label="中间件" class="mobile-dropdown-title"><span class="title">中间件</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/javanote/note/middleware/rabbitmq/day01/" class="nav-link">
  rabbitmq
</a></li><li class="dropdown-item"><!----> <a href="/javanote/note/middleware/elasticsearch/day01/" class="nav-link">
  elasticsearch
</a></li><li class="dropdown-item"><!----> <a href="/javanote/note/middleware/redis/" class="nav-link">
  Redis
</a></li><li class="dropdown-item"><!----> <a href="/javanote/note/middleware/nginx/" class="nav-link">
  nginx
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="微服务" class="dropdown-title"><span class="title">微服务</span> <span class="arrow down"></span></button> <button type="button" aria-label="微服务" class="mobile-dropdown-title"><span class="title">微服务</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/javanote/note/microservice/springboot/" class="nav-link">
  springboot
</a></li><li class="dropdown-item"><!----> <a href="/javanote/note/microservice/springcloud/day01/" class="nav-link">
  springcloud
</a></li><li class="dropdown-item"><!----> <a href="/javanote/note/microservice/docker/" class="nav-link">
  Docker
</a></li><li class="dropdown-item"><!----> <a href="/javanote/note/microservice/distributed-transaction/" class="nav-link">
  分布式事务
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="工具" class="dropdown-title"><span class="title">工具</span> <span class="arrow down"></span></button> <button type="button" aria-label="工具" class="mobile-dropdown-title"><span class="title">工具</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/javanote/note/tools/git/" class="nav-link">
  git
</a></li><li class="dropdown-item"><!----> <a href="/javanote/note/tools/maven/maven-overview/" class="nav-link">
  maven
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="ssm" class="dropdown-title"><span class="title">ssm</span> <span class="arrow down"></span></button> <button type="button" aria-label="ssm" class="mobile-dropdown-title"><span class="title">ssm</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/javanote/note/ssm/mybatis/preface/" class="nav-link">
  mybatis
</a></li><li class="dropdown-item"><!----> <a href="/javanote/note/ssm/spring/AOP-aspect-oriented-programming/agency-model/" class="nav-link">
  spring
</a></li><li class="dropdown-item"><!----> <a href="/javanote/note/ssm/springmvc/basic-function/" class="nav-link">
  springmvc
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="其他" class="dropdown-title"><span class="title">其他</span> <span class="arrow down"></span></button> <button type="button" aria-label="其他" class="mobile-dropdown-title"><span class="title">其他</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/javanote/note/others/cryptography/" class="nav-link">
  密码学
</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="基础" class="dropdown-title"><span class="title">基础</span> <span class="arrow down"></span></button> <button type="button" aria-label="基础" class="mobile-dropdown-title"><span class="title">基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/javanote/note/basic/java/day01/" class="nav-link">
  Java
</a></li><li class="dropdown-item"><!----> <a href="/javanote/note/basic/linux/background/" class="nav-link">
  linux
</a></li><li class="dropdown-item"><!----> <a href="/javanote/note/basic/mysql/mysql-basic/" class="nav-link">
  mysql
</a></li><li class="dropdown-item"><!----> <a href="/javanote/note/basic/web/WEBday01_HTML-CSS/" class="nav-link">
  web
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="高级" class="dropdown-title"><span class="title">高级</span> <span class="arrow down"></span></button> <button type="button" aria-label="高级" class="mobile-dropdown-title"><span class="title">高级</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/javanote/note/advance/juc/chapter01/" class="nav-link">
  JUC
</a></li><li class="dropdown-item"><!----> <a href="/javanote/note/advance/jvm/chapter01/" class="nav-link">
  JVM
</a></li><li class="dropdown-item"><!----> <a href="/javanote/note/advance/mysql/chapter01/" class="nav-link">
  MYSQL
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="中间件" class="dropdown-title"><span class="title">中间件</span> <span class="arrow down"></span></button> <button type="button" aria-label="中间件" class="mobile-dropdown-title"><span class="title">中间件</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/javanote/note/middleware/rabbitmq/day01/" class="nav-link">
  rabbitmq
</a></li><li class="dropdown-item"><!----> <a href="/javanote/note/middleware/elasticsearch/day01/" class="nav-link">
  elasticsearch
</a></li><li class="dropdown-item"><!----> <a href="/javanote/note/middleware/redis/" class="nav-link">
  Redis
</a></li><li class="dropdown-item"><!----> <a href="/javanote/note/middleware/nginx/" class="nav-link">
  nginx
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="微服务" class="dropdown-title"><span class="title">微服务</span> <span class="arrow down"></span></button> <button type="button" aria-label="微服务" class="mobile-dropdown-title"><span class="title">微服务</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/javanote/note/microservice/springboot/" class="nav-link">
  springboot
</a></li><li class="dropdown-item"><!----> <a href="/javanote/note/microservice/springcloud/day01/" class="nav-link">
  springcloud
</a></li><li class="dropdown-item"><!----> <a href="/javanote/note/microservice/docker/" class="nav-link">
  Docker
</a></li><li class="dropdown-item"><!----> <a href="/javanote/note/microservice/distributed-transaction/" class="nav-link">
  分布式事务
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="工具" class="dropdown-title"><span class="title">工具</span> <span class="arrow down"></span></button> <button type="button" aria-label="工具" class="mobile-dropdown-title"><span class="title">工具</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/javanote/note/tools/git/" class="nav-link">
  git
</a></li><li class="dropdown-item"><!----> <a href="/javanote/note/tools/maven/maven-overview/" class="nav-link">
  maven
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="ssm" class="dropdown-title"><span class="title">ssm</span> <span class="arrow down"></span></button> <button type="button" aria-label="ssm" class="mobile-dropdown-title"><span class="title">ssm</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/javanote/note/ssm/mybatis/preface/" class="nav-link">
  mybatis
</a></li><li class="dropdown-item"><!----> <a href="/javanote/note/ssm/spring/AOP-aspect-oriented-programming/agency-model/" class="nav-link">
  spring
</a></li><li class="dropdown-item"><!----> <a href="/javanote/note/ssm/springmvc/basic-function/" class="nav-link">
  springmvc
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="其他" class="dropdown-title"><span class="title">其他</span> <span class="arrow down"></span></button> <button type="button" aria-label="其他" class="mobile-dropdown-title"><span class="title">其他</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/javanote/note/others/cryptography/" class="nav-link">
  密码学
</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/javanote/note/advance/juc/chapter01/" class="sidebar-link">第一章 线程创建方式</a></li><li><a href="/javanote/note/advance/juc/chapter02/" class="sidebar-link">第二章 线程中使用的锁</a></li><li><a href="/javanote/note/advance/juc/chapter03/" class="sidebar-link">第三章 线程间通信</a></li><li><a href="/javanote/note/advance/juc/chapter04/" class="sidebar-link">第四章 集合的线程安全问题</a></li><li><a href="/javanote/note/advance/juc/chapter05/" class="sidebar-link">第五章 JUC中提供的特定场景线程操作类</a></li><li><a href="/javanote/note/advance/juc/chapter06/" class="sidebar-link">第六章 线程池</a></li><li><a href="/javanote/note/advance/juc/chapter07/" class="sidebar-link">第七章 Java内存模型</a></li><li><a href="/javanote/note/advance/juc/chapter08/" class="sidebar-link">第八章 volatile关键字</a></li><li><a href="/javanote/note/advance/juc/chapter09/" aria-current="page" class="active sidebar-link">第九章 CAS</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/javanote/note/advance/juc/chapter09/#_1、乐观锁工作机制" class="sidebar-link">1、乐观锁工作机制</a></li><li class="sidebar-sub-header"><a href="/javanote/note/advance/juc/chapter09/#_2、cas概念" class="sidebar-link">2、CAS概念</a></li><li class="sidebar-sub-header"><a href="/javanote/note/advance/juc/chapter09/#_3、cas测试代码" class="sidebar-link">3、CAS测试代码</a></li><li class="sidebar-sub-header"><a href="/javanote/note/advance/juc/chapter09/#_4、cas和自旋" class="sidebar-link">4、CAS和自旋</a></li><li class="sidebar-sub-header"><a href="/javanote/note/advance/juc/chapter09/#_5、aba问题" class="sidebar-link">5、ABA问题</a></li><li class="sidebar-sub-header"><a href="/javanote/note/advance/juc/chapter09/#_6、cas机制的缺点" class="sidebar-link">6、CAS机制的缺点</a></li><li class="sidebar-sub-header"><a href="/javanote/note/advance/juc/chapter09/#_7、cas原子性、有序性验证" class="sidebar-link">7、CAS原子性、有序性验证</a></li></ul></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="第九章-cas"><a href="#第九章-cas" class="header-anchor">#</a> 第九章 CAS</h1> <h2 id="_1、乐观锁工作机制"><a href="#_1、乐观锁工作机制" class="header-anchor">#</a> 1、乐观锁工作机制</h2> <p><img alt="images" data-src="/javanote/assets/img/img024.00d0867d.png" loading="lazy" class="lazy"></p> <blockquote><p>初始状态：明天休息		版本：0
变更操作：明天户外拓展	版本：1
变更操作：明天补课		版本基准：0
更新基准：更新到版本1
变更操作：明天补课		版本基准：1</p></blockquote> <h2 id="_2、cas概念"><a href="#_2、cas概念" class="header-anchor">#</a> 2、CAS概念</h2> <p>CAS：Compare and swap，比较并交换。</p> <p><img alt="images" data-src="data:image/png;base64,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" loading="lazy" class="lazy"></p> <p>当我们想基于CAS机制修改变量a的时候：</p> <ul><li>将作为修改基准的旧值和内存实际值进行比较
<ul><li>一致：接受修改</li> <li>不一致：不接受修改</li></ul></li></ul> <h2 id="_3、cas测试代码"><a href="#_3、cas测试代码" class="header-anchor">#</a> 3、CAS测试代码</h2> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">AtomicInteger</span> atomicNumber <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AtomicInteger</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">boolean</span> updateResult <span class="token operator">=</span> atomicNumber<span class="token punctuation">.</span><span class="token function">compareAndSet</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">666</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;修改结果：&quot;</span> <span class="token operator">+</span> updateResult <span class="token operator">+</span> <span class="token string">&quot; 当前值：&quot;</span> <span class="token operator">+</span> atomicNumber<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

updateResult <span class="token operator">=</span> atomicNumber<span class="token punctuation">.</span><span class="token function">compareAndSet</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">777</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;修改结果：&quot;</span> <span class="token operator">+</span> updateResult <span class="token operator">+</span> <span class="token string">&quot; 当前值：&quot;</span> <span class="token operator">+</span> atomicNumber<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

updateResult <span class="token operator">=</span> atomicNumber<span class="token punctuation">.</span><span class="token function">compareAndSet</span><span class="token punctuation">(</span><span class="token number">666</span><span class="token punctuation">,</span> <span class="token number">777</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;修改结果：&quot;</span> <span class="token operator">+</span> updateResult <span class="token operator">+</span> <span class="token string">&quot; 当前值：&quot;</span> <span class="token operator">+</span> atomicNumber<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>打印结果：</p> <blockquote><p>修改结果：true 当前值：666
修改结果：false 当前值：666
修改结果：true 当前值：777</p></blockquote> <h2 id="_4、cas和自旋"><a href="#_4、cas和自旋" class="header-anchor">#</a> 4、CAS和自旋</h2> <p>CAS是解决多线程并发安全问题的一种乐观锁算法。因为它在对共享变量更新之前，会先比较当前值是否与更新前的值一致，如果一致则更新，如果不一致则循环执行（称为<span style="color:blue;font-weight:bold;">自旋锁</span>），直到当前值与更新前的值一致为止，才执行更新。
Unsafe类是CAS的核心类，提供硬件级别的原子操作（目前所有CPU基本都支持硬件级别的CAS操作）。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// 对象、对象的地址、预期值、修改值</span>
<span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">native</span> <span class="token keyword">boolean</span> <span class="token function">compareAndSwapInt</span><span class="token punctuation">(</span><span class="token class-name">Object</span> var1<span class="token punctuation">,</span> <span class="token keyword">long</span> var2<span class="token punctuation">,</span> <span class="token keyword">int</span> var4<span class="token punctuation">,</span> <span class="token keyword">int</span> var5<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="_5、aba问题"><a href="#_5、aba问题" class="header-anchor">#</a> 5、ABA问题</h2> <p><img alt="images" data-src="/javanote/assets/img/img026.2068dc10.png" loading="lazy" class="lazy"></p> <p>进一步说明：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Person</span><span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token keyword">int</span> num <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> personName<span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre></div><p>以num的值作为基准，运用CAS机制。</p> <ul><li>第一次修改：
<ul><li>基准旧值：5</li> <li>新值：10</li> <li>personName：tom</li> <li>操作能够被接受</li></ul></li> <li>第二次修改：
<ul><li>基准旧值：10</li> <li>新值：5</li> <li>personName：jerry</li> <li>操作能够被接受</li></ul></li> <li>第三次修改：
<ul><li>基准旧值：5</li> <li>新值：666</li> <li>personName：harry</li> <li>当前操作无法判断是基于旧版还是新版</li></ul></li></ul> <blockquote><p>当一个类中除了作为基准的数据之外还有其他数据也被连带修改，那么CAS机制中的ABA问题就有可能导致代码出错。</p></blockquote> <h2 id="_6、cas机制的缺点"><a href="#_6、cas机制的缺点" class="header-anchor">#</a> 6、CAS机制的缺点</h2> <ul><li><strong>开销大</strong>：在并发量比较高的情况下，如果反复尝试更新某个变量，却又一直更新不成功，会给CPU带来较大的压力</li> <li><strong>ABA问题</strong>：当变量从A修改为B再修改回A时，变量值等于期望值A，但是无法判断是否修改，CAS操作在ABA修改后依然成功——但此时无法识别是否是基于旧版的不该接受的修改。</li> <li><strong>不能保证代码块的原子性</strong>：CAS机制所保证的只是一个变量的原子性操作，而不能保证整个代码块的原子性。</li></ul> <h2 id="_7、cas原子性、有序性验证"><a href="#_7、cas原子性、有序性验证" class="header-anchor">#</a> 7、CAS原子性、有序性验证</h2> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CASAtumicTest</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">AtomicInteger</span> number <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AtomicInteger</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">incr</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token keyword">return</span> number<span class="token punctuation">.</span><span class="token function">incrementAndGet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token class-name">CASAtumicTest</span> casAtumicTest <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CASAtumicTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">1000</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

            <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token punctuation">{</span>

                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;number = &quot;</span> <span class="token operator">+</span> casAtumicTest<span class="token punctuation">.</span><span class="token function">incr</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><p>打印效果：</p> <blockquote><p>number = 244
number = 239
number = 240
number = 1000
number = 998
number = 999
number = 997</p></blockquote> <p>结论：</p> <ul><li>CAS能够为变量提供局部的原子性</li> <li>CAS不能提供有序性</li></ul> <p><a href="/javanote/note/advance/juc/chapter08/index.html">上一章</a> <a href="/javanote/note/advance/juc/index.html">回目录</a></p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/javanote/note/advance/juc/chapter08/" class="prev">
        第八章 volatile关键字
      </a></span> <!----></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/javanote/assets/js/app.4d8a0605.js" defer></script><script src="/javanote/assets/js/11.31b4bfe5.js" defer></script><script src="/javanote/assets/js/92.69a38839.js" defer></script>
  </body>
</html>
